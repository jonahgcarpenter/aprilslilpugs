(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();function sA(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Xf={exports:{}},Ha={};var Zp;function rA(){if(Zp)return Ha;Zp=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,a,l){var o=null;if(l!==void 0&&(o=""+l),a.key!==void 0&&(o=""+a.key),"key"in a){l={};for(var c in a)c!=="key"&&(l[c]=a[c])}else l=a;return a=l.ref,{$$typeof:s,type:i,key:o,ref:a!==void 0?a:null,props:l}}return Ha.Fragment=e,Ha.jsx=t,Ha.jsxs=t,Ha}var Jp;function aA(){return Jp||(Jp=1,Xf.exports=rA()),Xf.exports}var I=aA(),Qf={exports:{}},Re={};var ey;function lA(){if(ey)return Re;ey=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),y=Symbol.iterator;function S(C){return C===null||typeof C!="object"?null:(C=y&&C[y]||C["@@iterator"],typeof C=="function"?C:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,T={};function R(C,F,ee){this.props=C,this.context=F,this.refs=T,this.updater=ee||E}R.prototype.isReactComponent={},R.prototype.setState=function(C,F){if(typeof C!="object"&&typeof C!="function"&&C!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,C,F,"setState")},R.prototype.forceUpdate=function(C){this.updater.enqueueForceUpdate(this,C,"forceUpdate")};function L(){}L.prototype=R.prototype;function _(C,F,ee){this.props=C,this.context=F,this.refs=T,this.updater=ee||E}var O=_.prototype=new L;O.constructor=_,x(O,R.prototype),O.isPureReactComponent=!0;var M=Array.isArray;function G(){}var w={H:null,A:null,T:null,S:null},$=Object.prototype.hasOwnProperty;function U(C,F,ee){var ae=ee.ref;return{$$typeof:s,type:C,key:F,ref:ae!==void 0?ae:null,props:ee}}function P(C,F){return U(C.type,F,C.props)}function q(C){return typeof C=="object"&&C!==null&&C.$$typeof===s}function re(C){var F={"=":"=0",":":"=2"};return"$"+C.replace(/[=:]/g,function(ee){return F[ee]})}var ce=/\/+/g;function oe(C,F){return typeof C=="object"&&C!==null&&C.key!=null?re(""+C.key):F.toString(36)}function fe(C){switch(C.status){case"fulfilled":return C.value;case"rejected":throw C.reason;default:switch(typeof C.status=="string"?C.then(G,G):(C.status="pending",C.then(function(F){C.status==="pending"&&(C.status="fulfilled",C.value=F)},function(F){C.status==="pending"&&(C.status="rejected",C.reason=F)})),C.status){case"fulfilled":return C.value;case"rejected":throw C.reason}}throw C}function k(C,F,ee,ae,ue){var he=typeof C;(he==="undefined"||he==="boolean")&&(C=null);var Se=!1;if(C===null)Se=!0;else switch(he){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(C.$$typeof){case s:case e:Se=!0;break;case m:return Se=C._init,k(Se(C._payload),F,ee,ae,ue)}}if(Se)return ue=ue(C),Se=ae===""?"."+oe(C,0):ae,M(ue)?(ee="",Se!=null&&(ee=Se.replace(ce,"$&/")+"/"),k(ue,F,ee,"",function(bt){return bt})):ue!=null&&(q(ue)&&(ue=P(ue,ee+(ue.key==null||C&&C.key===ue.key?"":(""+ue.key).replace(ce,"$&/")+"/")+Se)),F.push(ue)),1;Se=0;var Fe=ae===""?".":ae+":";if(M(C))for(var we=0;we<C.length;we++)ae=C[we],he=Fe+oe(ae,we),Se+=k(ae,F,ee,he,ue);else if(we=S(C),typeof we=="function")for(C=we.call(C),we=0;!(ae=C.next()).done;)ae=ae.value,he=Fe+oe(ae,we++),Se+=k(ae,F,ee,he,ue);else if(he==="object"){if(typeof C.then=="function")return k(fe(C),F,ee,ae,ue);throw F=String(C),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(C).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.")}return Se}function X(C,F,ee){if(C==null)return C;var ae=[],ue=0;return k(C,ae,"","",function(he){return F.call(ee,he,ue++)}),ae}function J(C){if(C._status===-1){var F=C._result;F=F(),F.then(function(ee){(C._status===0||C._status===-1)&&(C._status=1,C._result=ee)},function(ee){(C._status===0||C._status===-1)&&(C._status=2,C._result=ee)}),C._status===-1&&(C._status=0,C._result=F)}if(C._status===1)return C._result.default;throw C._result}var le=typeof reportError=="function"?reportError:function(C){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof C=="object"&&C!==null&&typeof C.message=="string"?String(C.message):String(C),error:C});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",C);return}console.error(C)},de={map:X,forEach:function(C,F,ee){X(C,function(){F.apply(this,arguments)},ee)},count:function(C){var F=0;return X(C,function(){F++}),F},toArray:function(C){return X(C,function(F){return F})||[]},only:function(C){if(!q(C))throw Error("React.Children.only expected to receive a single React element child.");return C}};return Re.Activity=g,Re.Children=de,Re.Component=R,Re.Fragment=t,Re.Profiler=a,Re.PureComponent=_,Re.StrictMode=i,Re.Suspense=h,Re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,Re.__COMPILER_RUNTIME={__proto__:null,c:function(C){return w.H.useMemoCache(C)}},Re.cache=function(C){return function(){return C.apply(null,arguments)}},Re.cacheSignal=function(){return null},Re.cloneElement=function(C,F,ee){if(C==null)throw Error("The argument must be a React element, but you passed "+C+".");var ae=x({},C.props),ue=C.key;if(F!=null)for(he in F.key!==void 0&&(ue=""+F.key),F)!$.call(F,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&F.ref===void 0||(ae[he]=F[he]);var he=arguments.length-2;if(he===1)ae.children=ee;else if(1<he){for(var Se=Array(he),Fe=0;Fe<he;Fe++)Se[Fe]=arguments[Fe+2];ae.children=Se}return U(C.type,ue,ae)},Re.createContext=function(C){return C={$$typeof:o,_currentValue:C,_currentValue2:C,_threadCount:0,Provider:null,Consumer:null},C.Provider=C,C.Consumer={$$typeof:l,_context:C},C},Re.createElement=function(C,F,ee){var ae,ue={},he=null;if(F!=null)for(ae in F.key!==void 0&&(he=""+F.key),F)$.call(F,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(ue[ae]=F[ae]);var Se=arguments.length-2;if(Se===1)ue.children=ee;else if(1<Se){for(var Fe=Array(Se),we=0;we<Se;we++)Fe[we]=arguments[we+2];ue.children=Fe}if(C&&C.defaultProps)for(ae in Se=C.defaultProps,Se)ue[ae]===void 0&&(ue[ae]=Se[ae]);return U(C,he,ue)},Re.createRef=function(){return{current:null}},Re.forwardRef=function(C){return{$$typeof:c,render:C}},Re.isValidElement=q,Re.lazy=function(C){return{$$typeof:m,_payload:{_status:-1,_result:C},_init:J}},Re.memo=function(C,F){return{$$typeof:d,type:C,compare:F===void 0?null:F}},Re.startTransition=function(C){var F=w.T,ee={};w.T=ee;try{var ae=C(),ue=w.S;ue!==null&&ue(ee,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(G,le)}catch(he){le(he)}finally{F!==null&&ee.types!==null&&(F.types=ee.types),w.T=F}},Re.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},Re.use=function(C){return w.H.use(C)},Re.useActionState=function(C,F,ee){return w.H.useActionState(C,F,ee)},Re.useCallback=function(C,F){return w.H.useCallback(C,F)},Re.useContext=function(C){return w.H.useContext(C)},Re.useDebugValue=function(){},Re.useDeferredValue=function(C,F){return w.H.useDeferredValue(C,F)},Re.useEffect=function(C,F){return w.H.useEffect(C,F)},Re.useEffectEvent=function(C){return w.H.useEffectEvent(C)},Re.useId=function(){return w.H.useId()},Re.useImperativeHandle=function(C,F,ee){return w.H.useImperativeHandle(C,F,ee)},Re.useInsertionEffect=function(C,F){return w.H.useInsertionEffect(C,F)},Re.useLayoutEffect=function(C,F){return w.H.useLayoutEffect(C,F)},Re.useMemo=function(C,F){return w.H.useMemo(C,F)},Re.useOptimistic=function(C,F){return w.H.useOptimistic(C,F)},Re.useReducer=function(C,F,ee){return w.H.useReducer(C,F,ee)},Re.useRef=function(C){return w.H.useRef(C)},Re.useState=function(C){return w.H.useState(C)},Re.useSyncExternalStore=function(C,F,ee){return w.H.useSyncExternalStore(C,F,ee)},Re.useTransition=function(){return w.H.useTransition()},Re.version="19.2.1",Re}var ty;function Au(){return ty||(ty=1,Qf.exports=lA()),Qf.exports}var W=Au();const sn=sA(W);var Wf={exports:{}},za={},Zf={exports:{}},Jf={};var iy;function oA(){return iy||(iy=1,(function(s){function e(k,X){var J=k.length;k.push(X);e:for(;0<J;){var le=J-1>>>1,de=k[le];if(0<a(de,X))k[le]=X,k[J]=de,J=le;else break e}}function t(k){return k.length===0?null:k[0]}function i(k){if(k.length===0)return null;var X=k[0],J=k.pop();if(J!==X){k[0]=J;e:for(var le=0,de=k.length,C=de>>>1;le<C;){var F=2*(le+1)-1,ee=k[F],ae=F+1,ue=k[ae];if(0>a(ee,J))ae<de&&0>a(ue,ee)?(k[le]=ue,k[ae]=J,le=ae):(k[le]=ee,k[F]=J,le=F);else if(ae<de&&0>a(ue,J))k[le]=ue,k[ae]=J,le=ae;else break e}}return X}function a(k,X){var J=k.sortIndex-X.sortIndex;return J!==0?J:k.id-X.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;s.unstable_now=function(){return l.now()}}else{var o=Date,c=o.now();s.unstable_now=function(){return o.now()-c}}var h=[],d=[],m=1,g=null,y=3,S=!1,E=!1,x=!1,T=!1,R=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function O(k){for(var X=t(d);X!==null;){if(X.callback===null)i(d);else if(X.startTime<=k)i(d),X.sortIndex=X.expirationTime,e(h,X);else break;X=t(d)}}function M(k){if(x=!1,O(k),!E)if(t(h)!==null)E=!0,G||(G=!0,re());else{var X=t(d);X!==null&&fe(M,X.startTime-k)}}var G=!1,w=-1,$=5,U=-1;function P(){return T?!0:!(s.unstable_now()-U<$)}function q(){if(T=!1,G){var k=s.unstable_now();U=k;var X=!0;try{e:{E=!1,x&&(x=!1,L(w),w=-1),S=!0;var J=y;try{t:{for(O(k),g=t(h);g!==null&&!(g.expirationTime>k&&P());){var le=g.callback;if(typeof le=="function"){g.callback=null,y=g.priorityLevel;var de=le(g.expirationTime<=k);if(k=s.unstable_now(),typeof de=="function"){g.callback=de,O(k),X=!0;break t}g===t(h)&&i(h),O(k)}else i(h);g=t(h)}if(g!==null)X=!0;else{var C=t(d);C!==null&&fe(M,C.startTime-k),X=!1}}break e}finally{g=null,y=J,S=!1}X=void 0}}finally{X?re():G=!1}}}var re;if(typeof _=="function")re=function(){_(q)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,oe=ce.port2;ce.port1.onmessage=q,re=function(){oe.postMessage(null)}}else re=function(){R(q,0)};function fe(k,X){w=R(function(){k(s.unstable_now())},X)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(k){k.callback=null},s.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<k?Math.floor(1e3/k):5},s.unstable_getCurrentPriorityLevel=function(){return y},s.unstable_next=function(k){switch(y){case 1:case 2:case 3:var X=3;break;default:X=y}var J=y;y=X;try{return k()}finally{y=J}},s.unstable_requestPaint=function(){T=!0},s.unstable_runWithPriority=function(k,X){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var J=y;y=k;try{return X()}finally{y=J}},s.unstable_scheduleCallback=function(k,X,J){var le=s.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?le+J:le):J=le,k){case 1:var de=-1;break;case 2:de=250;break;case 5:de=1073741823;break;case 4:de=1e4;break;default:de=5e3}return de=J+de,k={id:m++,callback:X,priorityLevel:k,startTime:J,expirationTime:de,sortIndex:-1},J>le?(k.sortIndex=J,e(d,k),t(h)===null&&k===t(d)&&(x?(L(w),w=-1):x=!0,fe(M,J-le))):(k.sortIndex=de,e(h,k),E||S||(E=!0,G||(G=!0,re()))),k},s.unstable_shouldYield=P,s.unstable_wrapCallback=function(k){var X=y;return function(){var J=y;y=X;try{return k.apply(this,arguments)}finally{y=J}}}})(Jf)),Jf}var ny;function uA(){return ny||(ny=1,Zf.exports=oA()),Zf.exports}var ed={exports:{}},$t={};var sy;function cA(){if(sy)return $t;sy=1;var s=Au();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)d+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(h,d,m){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:g==null?null:""+g,children:h,containerInfo:d,implementation:m}}var o=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return $t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,$t.createPortal=function(h,d){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return l(h,d,null,m)},$t.flushSync=function(h){var d=o.T,m=i.p;try{if(o.T=null,i.p=2,h)return h()}finally{o.T=d,i.p=m,i.d.f()}},$t.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(h,d))},$t.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},$t.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var m=d.as,g=c(m,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,S=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;m==="style"?i.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:S}):m==="script"&&i.d.X(h,{crossOrigin:g,integrity:y,fetchPriority:S,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},$t.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var m=c(d.as,d.crossOrigin);i.d.M(h,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(h)},$t.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var m=d.as,g=c(m,d.crossOrigin);i.d.L(h,m,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},$t.preloadModule=function(h,d){if(typeof h=="string")if(d){var m=c(d.as,d.crossOrigin);i.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(h)},$t.requestFormReset=function(h){i.d.r(h)},$t.unstable_batchedUpdates=function(h,d){return h(d)},$t.useFormState=function(h,d,m){return o.H.useFormState(h,d,m)},$t.useFormStatus=function(){return o.H.useHostTransitionStatus()},$t.version="19.2.1",$t}var ry;function fA(){if(ry)return ed.exports;ry=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),ed.exports=cA(),ed.exports}var ay;function dA(){if(ay)return za;ay=1;var s=uA(),e=Au(),t=fA();function i(n){var r="https://react.dev/errors/"+n;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)r+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function l(n){var r=n,u=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,(r.flags&4098)!==0&&(u=r.return),n=r.return;while(n)}return r.tag===3?u:null}function o(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function c(n){if(n.tag===31){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function h(n){if(l(n)!==n)throw Error(i(188))}function d(n){var r=n.alternate;if(!r){if(r=l(n),r===null)throw Error(i(188));return r!==n?null:n}for(var u=n,f=r;;){var p=u.return;if(p===null)break;var v=p.alternate;if(v===null){if(f=p.return,f!==null){u=f;continue}break}if(p.child===v.child){for(v=p.child;v;){if(v===u)return h(p),n;if(v===f)return h(p),r;v=v.sibling}throw Error(i(188))}if(u.return!==f.return)u=p,f=v;else{for(var b=!1,D=p.child;D;){if(D===u){b=!0,u=p,f=v;break}if(D===f){b=!0,f=p,u=v;break}D=D.sibling}if(!b){for(D=v.child;D;){if(D===u){b=!0,u=v,f=p;break}if(D===f){b=!0,f=v,u=p;break}D=D.sibling}if(!b)throw Error(i(189))}}if(u.alternate!==f)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?n:r}function m(n){var r=n.tag;if(r===5||r===26||r===27||r===6)return n;for(n=n.child;n!==null;){if(r=m(n),r!==null)return r;n=n.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),L=Symbol.for("react.consumer"),_=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function re(n){return n===null||typeof n!="object"?null:(n=q&&n[q]||n["@@iterator"],typeof n=="function"?n:null)}var ce=Symbol.for("react.client.reference");function oe(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===ce?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case x:return"Fragment";case R:return"Profiler";case T:return"StrictMode";case M:return"Suspense";case G:return"SuspenseList";case U:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case E:return"Portal";case _:return n.displayName||"Context";case L:return(n._context.displayName||"Context")+".Consumer";case O:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case w:return r=n.displayName||null,r!==null?r:oe(n.type)||"Memo";case $:r=n._payload,n=n._init;try{return oe(n(r))}catch{}}return null}var fe=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},le=[],de=-1;function C(n){return{current:n}}function F(n){0>de||(n.current=le[de],le[de]=null,de--)}function ee(n,r){de++,le[de]=n.current,n.current=r}var ae=C(null),ue=C(null),he=C(null),Se=C(null);function Fe(n,r){switch(ee(he,r),ee(ue,n),ee(ae,null),r.nodeType){case 9:case 11:n=(n=r.documentElement)&&(n=n.namespaceURI)?Tp(n):0;break;default:if(n=r.tagName,r=r.namespaceURI)r=Tp(r),n=xp(r,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}F(ae),ee(ae,n)}function we(){F(ae),F(ue),F(he)}function bt(n){n.memoizedState!==null&&ee(Se,n);var r=ae.current,u=xp(r,n.type);r!==u&&(ee(ue,n),ee(ae,u))}function Vt(n){ue.current===n&&(F(ae),F(ue)),Se.current===n&&(F(Se),Ba._currentValue=J)}var ys,Ti;function Kt(n){if(ys===void 0)try{throw Error()}catch(u){var r=u.stack.trim().match(/\n( *(at )?)/);ys=r&&r[1]||"",Ti=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ys+n+Ti}var Xr=!1;function ye(n,r){if(!n||Xr)return"";Xr=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(r){var se=function(){throw Error()};if(Object.defineProperty(se.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(se,[])}catch(Z){var Y=Z}Reflect.construct(n,[],se)}else{try{se.call()}catch(Z){Y=Z}n.call(se.prototype)}}else{try{throw Error()}catch(Z){Y=Z}(se=n())&&typeof se.catch=="function"&&se.catch(function(){})}}catch(Z){if(Z&&Y&&typeof Z.stack=="string")return[Z.stack,Y.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=f.DetermineComponentFrameRoot(),b=v[0],D=v[1];if(b&&D){var N=b.split(`
`),K=D.split(`
`);for(p=f=0;f<N.length&&!N[f].includes("DetermineComponentFrameRoot");)f++;for(;p<K.length&&!K[p].includes("DetermineComponentFrameRoot");)p++;if(f===N.length||p===K.length)for(f=N.length-1,p=K.length-1;1<=f&&0<=p&&N[f]!==K[p];)p--;for(;1<=f&&0<=p;f--,p--)if(N[f]!==K[p]){if(f!==1||p!==1)do if(f--,p--,0>p||N[f]!==K[p]){var te=`
`+N[f].replace(" at new "," at ");return n.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",n.displayName)),te}while(1<=f&&0<=p);break}}}finally{Xr=!1,Error.prepareStackTrace=u}return(u=n?n.displayName||n.name:"")?Kt(u):""}function De(n,r){switch(n.tag){case 26:case 27:case 5:return Kt(n.type);case 16:return Kt("Lazy");case 13:return n.child!==r&&r!==null?Kt("Suspense Fallback"):Kt("Suspense");case 19:return Kt("SuspenseList");case 0:case 15:return ye(n.type,!1);case 11:return ye(n.type.render,!1);case 1:return ye(n.type,!0);case 31:return Kt("Activity");default:return""}}function ke(n){try{var r="",u=null;do r+=De(n,u),u=n,n=n.return;while(n);return r}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var $e=Object.prototype.hasOwnProperty,et=s.unstable_scheduleCallback,Ot=s.unstable_cancelCallback,tt=s.unstable_shouldYield,vt=s.unstable_requestPaint,Xe=s.unstable_now,vs=s.unstable_getCurrentPriorityLevel,Ni=s.unstable_ImmediatePriority,Pn=s.unstable_UserBlockingPriority,At=s.unstable_NormalPriority,Yt=s.unstable_LowPriority,ln=s.unstable_IdlePriority,on=s.log,Qr=s.unstable_setDisableYieldValue,Wr=null,ai=null;function Un(n){if(typeof on=="function"&&Qr(n),ai&&typeof ai.setStrictMode=="function")try{ai.setStrictMode(Wr,n)}catch{}}var li=Math.clz32?Math.clz32:zT,jT=Math.log,HT=Math.LN2;function zT(n){return n>>>=0,n===0?32:31-(jT(n)/HT|0)|0}var ml=256,gl=262144,pl=4194304;function Es(n){var r=n&42;if(r!==0)return r;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function yl(n,r,u){var f=n.pendingLanes;if(f===0)return 0;var p=0,v=n.suspendedLanes,b=n.pingedLanes;n=n.warmLanes;var D=f&134217727;return D!==0?(f=D&~v,f!==0?p=Es(f):(b&=D,b!==0?p=Es(b):u||(u=D&~n,u!==0&&(p=Es(u))))):(D=f&~v,D!==0?p=Es(D):b!==0?p=Es(b):u||(u=f&~n,u!==0&&(p=Es(u)))),p===0?0:r!==0&&r!==p&&(r&v)===0&&(v=p&-p,u=r&-r,v>=u||v===32&&(u&4194048)!==0)?r:p}function Zr(n,r){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&r)===0}function VT(n,r){switch(n){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function im(){var n=pl;return pl<<=1,(pl&62914560)===0&&(pl=4194304),n}function Pu(n){for(var r=[],u=0;31>u;u++)r.push(n);return r}function Jr(n,r){n.pendingLanes|=r,r!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function KT(n,r,u,f,p,v){var b=n.pendingLanes;n.pendingLanes=u,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=u,n.entangledLanes&=u,n.errorRecoveryDisabledLanes&=u,n.shellSuspendCounter=0;var D=n.entanglements,N=n.expirationTimes,K=n.hiddenUpdates;for(u=b&~u;0<u;){var te=31-li(u),se=1<<te;D[te]=0,N[te]=-1;var Y=K[te];if(Y!==null)for(K[te]=null,te=0;te<Y.length;te++){var Z=Y[te];Z!==null&&(Z.lane&=-536870913)}u&=~se}f!==0&&nm(n,f,0),v!==0&&p===0&&n.tag!==0&&(n.suspendedLanes|=v&~(b&~r))}function nm(n,r,u){n.pendingLanes|=r,n.suspendedLanes&=~r;var f=31-li(r);n.entangledLanes|=r,n.entanglements[f]=n.entanglements[f]|1073741824|u&261930}function sm(n,r){var u=n.entangledLanes|=r;for(n=n.entanglements;u;){var f=31-li(u),p=1<<f;p&r|n[f]&r&&(n[f]|=r),u&=~p}}function rm(n,r){var u=r&-r;return u=(u&42)!==0?1:Uu(u),(u&(n.suspendedLanes|r))!==0?0:u}function Uu(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Fu(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function am(){var n=X.p;return n!==0?n:(n=window.event,n===void 0?32:Vp(n.type))}function lm(n,r){var u=X.p;try{return X.p=n,r()}finally{X.p=u}}var Fn=Math.random().toString(36).slice(2),wt="__reactFiber$"+Fn,qt="__reactProps$"+Fn,Ks="__reactContainer$"+Fn,Bu="__reactEvents$"+Fn,YT="__reactListeners$"+Fn,qT="__reactHandles$"+Fn,om="__reactResources$"+Fn,ea="__reactMarker$"+Fn;function $u(n){delete n[wt],delete n[qt],delete n[Bu],delete n[YT],delete n[qT]}function Ys(n){var r=n[wt];if(r)return r;for(var u=n.parentNode;u;){if(r=u[Ks]||u[wt]){if(u=r.alternate,r.child!==null||u!==null&&u.child!==null)for(n=Ip(n);n!==null;){if(u=n[wt])return u;n=Ip(n)}return r}n=u,u=n.parentNode}return null}function qs(n){if(n=n[wt]||n[Ks]){var r=n.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return n}return null}function ta(n){var r=n.tag;if(r===5||r===26||r===27||r===6)return n.stateNode;throw Error(i(33))}function Xs(n){var r=n[om];return r||(r=n[om]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Dt(n){n[ea]=!0}var um=new Set,cm={};function Ss(n,r){Qs(n,r),Qs(n+"Capture",r)}function Qs(n,r){for(cm[n]=r,n=0;n<r.length;n++)um.add(r[n])}var XT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fm={},dm={};function QT(n){return $e.call(dm,n)?!0:$e.call(fm,n)?!1:XT.test(n)?dm[n]=!0:(fm[n]=!0,!1)}function vl(n,r,u){if(QT(r))if(u===null)n.removeAttribute(r);else{switch(typeof u){case"undefined":case"function":case"symbol":n.removeAttribute(r);return;case"boolean":var f=r.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){n.removeAttribute(r);return}}n.setAttribute(r,""+u)}}function El(n,r,u){if(u===null)n.removeAttribute(r);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(r);return}n.setAttribute(r,""+u)}}function un(n,r,u,f){if(f===null)n.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(u);return}n.setAttributeNS(r,u,""+f)}}function xi(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function hm(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function WT(n,r,u){var f=Object.getOwnPropertyDescriptor(n.constructor.prototype,r);if(!n.hasOwnProperty(r)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var p=f.get,v=f.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return p.call(this)},set:function(b){u=""+b,v.call(this,b)}}),Object.defineProperty(n,r,{enumerable:f.enumerable}),{getValue:function(){return u},setValue:function(b){u=""+b},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function Gu(n){if(!n._valueTracker){var r=hm(n)?"checked":"value";n._valueTracker=WT(n,r,""+n[r])}}function mm(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var u=r.getValue(),f="";return n&&(f=hm(n)?n.checked?"true":"false":n.value),n=f,n!==u?(r.setValue(n),!0):!1}function Sl(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var ZT=/[\n"\\]/g;function bi(n){return n.replace(ZT,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function ju(n,r,u,f,p,v,b,D){n.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?n.type=b:n.removeAttribute("type"),r!=null?b==="number"?(r===0&&n.value===""||n.value!=r)&&(n.value=""+xi(r)):n.value!==""+xi(r)&&(n.value=""+xi(r)):b!=="submit"&&b!=="reset"||n.removeAttribute("value"),r!=null?Hu(n,b,xi(r)):u!=null?Hu(n,b,xi(u)):f!=null&&n.removeAttribute("value"),p==null&&v!=null&&(n.defaultChecked=!!v),p!=null&&(n.checked=p&&typeof p!="function"&&typeof p!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?n.name=""+xi(D):n.removeAttribute("name")}function gm(n,r,u,f,p,v,b,D){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(n.type=v),r!=null||u!=null){if(!(v!=="submit"&&v!=="reset"||r!=null)){Gu(n);return}u=u!=null?""+xi(u):"",r=r!=null?""+xi(r):u,D||r===n.value||(n.value=r),n.defaultValue=r}f=f??p,f=typeof f!="function"&&typeof f!="symbol"&&!!f,n.checked=D?n.checked:!!f,n.defaultChecked=!!f,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(n.name=b),Gu(n)}function Hu(n,r,u){r==="number"&&Sl(n.ownerDocument)===n||n.defaultValue===""+u||(n.defaultValue=""+u)}function Ws(n,r,u,f){if(n=n.options,r){r={};for(var p=0;p<u.length;p++)r["$"+u[p]]=!0;for(u=0;u<n.length;u++)p=r.hasOwnProperty("$"+n[u].value),n[u].selected!==p&&(n[u].selected=p),p&&f&&(n[u].defaultSelected=!0)}else{for(u=""+xi(u),r=null,p=0;p<n.length;p++){if(n[p].value===u){n[p].selected=!0,f&&(n[p].defaultSelected=!0);return}r!==null||n[p].disabled||(r=n[p])}r!==null&&(r.selected=!0)}}function pm(n,r,u){if(r!=null&&(r=""+xi(r),r!==n.value&&(n.value=r),u==null)){n.defaultValue!==r&&(n.defaultValue=r);return}n.defaultValue=u!=null?""+xi(u):""}function ym(n,r,u,f){if(r==null){if(f!=null){if(u!=null)throw Error(i(92));if(fe(f)){if(1<f.length)throw Error(i(93));f=f[0]}u=f}u==null&&(u=""),r=u}u=xi(r),n.defaultValue=u,f=n.textContent,f===u&&f!==""&&f!==null&&(n.value=f),Gu(n)}function Zs(n,r){if(r){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=r;return}}n.textContent=r}var JT=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vm(n,r,u){var f=r.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?n.setProperty(r,""):r==="float"?n.cssFloat="":n[r]="":f?n.setProperty(r,u):typeof u!="number"||u===0||JT.has(r)?r==="float"?n.cssFloat=u:n[r]=(""+u).trim():n[r]=u+"px"}function Em(n,r,u){if(r!=null&&typeof r!="object")throw Error(i(62));if(n=n.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||r!=null&&r.hasOwnProperty(f)||(f.indexOf("--")===0?n.setProperty(f,""):f==="float"?n.cssFloat="":n[f]="");for(var p in r)f=r[p],r.hasOwnProperty(p)&&u[p]!==f&&vm(n,p,f)}else for(var v in r)r.hasOwnProperty(v)&&vm(n,v,r[v])}function zu(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ex=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),tx=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tl(n){return tx.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function cn(){}var Vu=null;function Ku(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Js=null,er=null;function Sm(n){var r=qs(n);if(r&&(n=r.stateNode)){var u=n[qt]||null;e:switch(n=r.stateNode,r.type){case"input":if(ju(n,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),r=u.name,u.type==="radio"&&r!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+bi(""+r)+'"][type="radio"]'),r=0;r<u.length;r++){var f=u[r];if(f!==n&&f.form===n.form){var p=f[qt]||null;if(!p)throw Error(i(90));ju(f,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(r=0;r<u.length;r++)f=u[r],f.form===n.form&&mm(f)}break e;case"textarea":pm(n,u.value,u.defaultValue);break e;case"select":r=u.value,r!=null&&Ws(n,!!u.multiple,r,!1)}}}var Yu=!1;function Tm(n,r,u){if(Yu)return n(r,u);Yu=!0;try{var f=n(r);return f}finally{if(Yu=!1,(Js!==null||er!==null)&&(oo(),Js&&(r=Js,n=er,er=Js=null,Sm(r),n)))for(r=0;r<n.length;r++)Sm(n[r])}}function ia(n,r){var u=n.stateNode;if(u===null)return null;var f=u[qt]||null;if(f===null)return null;u=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(n=n.type,f=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!f;break e;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(i(231,r,typeof u));return u}var fn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qu=!1;if(fn)try{var na={};Object.defineProperty(na,"passive",{get:function(){qu=!0}}),window.addEventListener("test",na,na),window.removeEventListener("test",na,na)}catch{qu=!1}var Bn=null,Xu=null,xl=null;function xm(){if(xl)return xl;var n,r=Xu,u=r.length,f,p="value"in Bn?Bn.value:Bn.textContent,v=p.length;for(n=0;n<u&&r[n]===p[n];n++);var b=u-n;for(f=1;f<=b&&r[u-f]===p[v-f];f++);return xl=p.slice(n,1<f?1-f:void 0)}function bl(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function Al(){return!0}function bm(){return!1}function Xt(n){function r(u,f,p,v,b){this._reactName=u,this._targetInst=p,this.type=f,this.nativeEvent=v,this.target=b,this.currentTarget=null;for(var D in n)n.hasOwnProperty(D)&&(u=n[D],this[D]=u?u(v):v[D]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Al:bm,this.isPropagationStopped=bm,this}return g(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Al)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Al)},persist:function(){},isPersistent:Al}),r}var Ts={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rl=Xt(Ts),sa=g({},Ts,{view:0,detail:0}),ix=Xt(sa),Qu,Wu,ra,Ll=g({},sa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ju,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ra&&(ra&&n.type==="mousemove"?(Qu=n.screenX-ra.screenX,Wu=n.screenY-ra.screenY):Wu=Qu=0,ra=n),Qu)},movementY:function(n){return"movementY"in n?n.movementY:Wu}}),Am=Xt(Ll),nx=g({},Ll,{dataTransfer:0}),sx=Xt(nx),rx=g({},sa,{relatedTarget:0}),Zu=Xt(rx),ax=g({},Ts,{animationName:0,elapsedTime:0,pseudoElement:0}),lx=Xt(ax),ox=g({},Ts,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),ux=Xt(ox),cx=g({},Ts,{data:0}),Rm=Xt(cx),fx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mx(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=hx[n])?!!r[n]:!1}function Ju(){return mx}var gx=g({},sa,{key:function(n){if(n.key){var r=fx[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=bl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?dx[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ju,charCode:function(n){return n.type==="keypress"?bl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?bl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),px=Xt(gx),yx=g({},Ll,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lm=Xt(yx),vx=g({},sa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ju}),Ex=Xt(vx),Sx=g({},Ts,{propertyName:0,elapsedTime:0,pseudoElement:0}),Tx=Xt(Sx),xx=g({},Ll,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),bx=Xt(xx),Ax=g({},Ts,{newState:0,oldState:0}),Rx=Xt(Ax),Lx=[9,13,27,32],ec=fn&&"CompositionEvent"in window,aa=null;fn&&"documentMode"in document&&(aa=document.documentMode);var _x=fn&&"TextEvent"in window&&!aa,_m=fn&&(!ec||aa&&8<aa&&11>=aa),Dm=" ",Im=!1;function Cm(n,r){switch(n){case"keyup":return Lx.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Om(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var tr=!1;function Dx(n,r){switch(n){case"compositionend":return Om(r);case"keypress":return r.which!==32?null:(Im=!0,Dm);case"textInput":return n=r.data,n===Dm&&Im?null:n;default:return null}}function Ix(n,r){if(tr)return n==="compositionend"||!ec&&Cm(n,r)?(n=xm(),xl=Xu=Bn=null,tr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return _m&&r.locale!=="ko"?null:r.data;default:return null}}var Cx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wm(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!Cx[n.type]:r==="textarea"}function Mm(n,r,u,f){Js?er?er.push(f):er=[f]:Js=f,r=po(r,"onChange"),0<r.length&&(u=new Rl("onChange","change",null,u,f),n.push({event:u,listeners:r}))}var la=null,oa=null;function Ox(n){gp(n,0)}function _l(n){var r=ta(n);if(mm(r))return n}function Nm(n,r){if(n==="change")return r}var km=!1;if(fn){var tc;if(fn){var ic="oninput"in document;if(!ic){var Pm=document.createElement("div");Pm.setAttribute("oninput","return;"),ic=typeof Pm.oninput=="function"}tc=ic}else tc=!1;km=tc&&(!document.documentMode||9<document.documentMode)}function Um(){la&&(la.detachEvent("onpropertychange",Fm),oa=la=null)}function Fm(n){if(n.propertyName==="value"&&_l(oa)){var r=[];Mm(r,oa,n,Ku(n)),Tm(Ox,r)}}function wx(n,r,u){n==="focusin"?(Um(),la=r,oa=u,la.attachEvent("onpropertychange",Fm)):n==="focusout"&&Um()}function Mx(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return _l(oa)}function Nx(n,r){if(n==="click")return _l(r)}function kx(n,r){if(n==="input"||n==="change")return _l(r)}function Px(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var oi=typeof Object.is=="function"?Object.is:Px;function ua(n,r){if(oi(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var u=Object.keys(n),f=Object.keys(r);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var p=u[f];if(!$e.call(r,p)||!oi(n[p],r[p]))return!1}return!0}function Bm(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function $m(n,r){var u=Bm(n);n=0;for(var f;u;){if(u.nodeType===3){if(f=n+u.textContent.length,n<=r&&f>=r)return{node:u,offset:r-n};n=f}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Bm(u)}}function Gm(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?Gm(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function jm(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var r=Sl(n.document);r instanceof n.HTMLIFrameElement;){try{var u=typeof r.contentWindow.location.href=="string"}catch{u=!1}if(u)n=r.contentWindow;else break;r=Sl(n.document)}return r}function nc(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}var Ux=fn&&"documentMode"in document&&11>=document.documentMode,ir=null,sc=null,ca=null,rc=!1;function Hm(n,r,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;rc||ir==null||ir!==Sl(f)||(f=ir,"selectionStart"in f&&nc(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),ca&&ua(ca,f)||(ca=f,f=po(sc,"onSelect"),0<f.length&&(r=new Rl("onSelect","select",null,r,u),n.push({event:r,listeners:f}),r.target=ir)))}function xs(n,r){var u={};return u[n.toLowerCase()]=r.toLowerCase(),u["Webkit"+n]="webkit"+r,u["Moz"+n]="moz"+r,u}var nr={animationend:xs("Animation","AnimationEnd"),animationiteration:xs("Animation","AnimationIteration"),animationstart:xs("Animation","AnimationStart"),transitionrun:xs("Transition","TransitionRun"),transitionstart:xs("Transition","TransitionStart"),transitioncancel:xs("Transition","TransitionCancel"),transitionend:xs("Transition","TransitionEnd")},ac={},zm={};fn&&(zm=document.createElement("div").style,"AnimationEvent"in window||(delete nr.animationend.animation,delete nr.animationiteration.animation,delete nr.animationstart.animation),"TransitionEvent"in window||delete nr.transitionend.transition);function bs(n){if(ac[n])return ac[n];if(!nr[n])return n;var r=nr[n],u;for(u in r)if(r.hasOwnProperty(u)&&u in zm)return ac[n]=r[u];return n}var Vm=bs("animationend"),Km=bs("animationiteration"),Ym=bs("animationstart"),Fx=bs("transitionrun"),Bx=bs("transitionstart"),$x=bs("transitioncancel"),qm=bs("transitionend"),Xm=new Map,lc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");lc.push("scrollEnd");function ki(n,r){Xm.set(n,r),Ss(r,[n])}var Dl=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},Ai=[],sr=0,oc=0;function Il(){for(var n=sr,r=oc=sr=0;r<n;){var u=Ai[r];Ai[r++]=null;var f=Ai[r];Ai[r++]=null;var p=Ai[r];Ai[r++]=null;var v=Ai[r];if(Ai[r++]=null,f!==null&&p!==null){var b=f.pending;b===null?p.next=p:(p.next=b.next,b.next=p),f.pending=p}v!==0&&Qm(u,p,v)}}function Cl(n,r,u,f){Ai[sr++]=n,Ai[sr++]=r,Ai[sr++]=u,Ai[sr++]=f,oc|=f,n.lanes|=f,n=n.alternate,n!==null&&(n.lanes|=f)}function uc(n,r,u,f){return Cl(n,r,u,f),Ol(n)}function As(n,r){return Cl(n,null,null,r),Ol(n)}function Qm(n,r,u){n.lanes|=u;var f=n.alternate;f!==null&&(f.lanes|=u);for(var p=!1,v=n.return;v!==null;)v.childLanes|=u,f=v.alternate,f!==null&&(f.childLanes|=u),v.tag===22&&(n=v.stateNode,n===null||n._visibility&1||(p=!0)),n=v,v=v.return;return n.tag===3?(v=n.stateNode,p&&r!==null&&(p=31-li(u),n=v.hiddenUpdates,f=n[p],f===null?n[p]=[r]:f.push(r),r.lane=u|536870912),v):null}function Ol(n){if(50<wa)throw wa=0,Ef=null,Error(i(185));for(var r=n.return;r!==null;)n=r,r=n.return;return n.tag===3?n.stateNode:null}var rr={};function Gx(n,r,u,f){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ui(n,r,u,f){return new Gx(n,r,u,f)}function cc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function dn(n,r){var u=n.alternate;return u===null?(u=ui(n.tag,r,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=r,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&65011712,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,r=n.dependencies,u.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u.refCleanup=n.refCleanup,u}function Wm(n,r){n.flags&=65011714;var u=n.alternate;return u===null?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=u.childLanes,n.lanes=u.lanes,n.child=u.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=u.memoizedProps,n.memoizedState=u.memoizedState,n.updateQueue=u.updateQueue,n.type=u.type,r=u.dependencies,n.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),n}function wl(n,r,u,f,p,v){var b=0;if(f=n,typeof n=="function")cc(n)&&(b=1);else if(typeof n=="string")b=Kb(n,u,ae.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case U:return n=ui(31,u,r,p),n.elementType=U,n.lanes=v,n;case x:return Rs(u.children,p,v,r);case T:b=8,p|=24;break;case R:return n=ui(12,u,r,p|2),n.elementType=R,n.lanes=v,n;case M:return n=ui(13,u,r,p),n.elementType=M,n.lanes=v,n;case G:return n=ui(19,u,r,p),n.elementType=G,n.lanes=v,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case _:b=10;break e;case L:b=9;break e;case O:b=11;break e;case w:b=14;break e;case $:b=16,f=null;break e}b=29,u=Error(i(130,n===null?"null":typeof n,"")),f=null}return r=ui(b,u,r,p),r.elementType=n,r.type=f,r.lanes=v,r}function Rs(n,r,u,f){return n=ui(7,n,f,r),n.lanes=u,n}function fc(n,r,u){return n=ui(6,n,null,r),n.lanes=u,n}function Zm(n){var r=ui(18,null,null,0);return r.stateNode=n,r}function dc(n,r,u){return r=ui(4,n.children!==null?n.children:[],n.key,r),r.lanes=u,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}var Jm=new WeakMap;function Ri(n,r){if(typeof n=="object"&&n!==null){var u=Jm.get(n);return u!==void 0?u:(r={value:n,source:r,stack:ke(r)},Jm.set(n,r),r)}return{value:n,source:r,stack:ke(r)}}var ar=[],lr=0,Ml=null,fa=0,Li=[],_i=0,$n=null,zi=1,Vi="";function hn(n,r){ar[lr++]=fa,ar[lr++]=Ml,Ml=n,fa=r}function eg(n,r,u){Li[_i++]=zi,Li[_i++]=Vi,Li[_i++]=$n,$n=n;var f=zi;n=Vi;var p=32-li(f)-1;f&=~(1<<p),u+=1;var v=32-li(r)+p;if(30<v){var b=p-p%5;v=(f&(1<<b)-1).toString(32),f>>=b,p-=b,zi=1<<32-li(r)+p|u<<p|f,Vi=v+n}else zi=1<<v|u<<p|f,Vi=n}function hc(n){n.return!==null&&(hn(n,1),eg(n,1,0))}function mc(n){for(;n===Ml;)Ml=ar[--lr],ar[lr]=null,fa=ar[--lr],ar[lr]=null;for(;n===$n;)$n=Li[--_i],Li[_i]=null,Vi=Li[--_i],Li[_i]=null,zi=Li[--_i],Li[_i]=null}function tg(n,r){Li[_i++]=zi,Li[_i++]=Vi,Li[_i++]=$n,zi=r.id,Vi=r.overflow,$n=n}var Mt=null,rt=null,Be=!1,Gn=null,Di=!1,gc=Error(i(519));function jn(n){var r=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw da(Ri(r,n)),gc}function ig(n){var r=n.stateNode,u=n.type,f=n.memoizedProps;switch(r[wt]=n,r[qt]=f,u){case"dialog":Ne("cancel",r),Ne("close",r);break;case"iframe":case"object":case"embed":Ne("load",r);break;case"video":case"audio":for(u=0;u<Na.length;u++)Ne(Na[u],r);break;case"source":Ne("error",r);break;case"img":case"image":case"link":Ne("error",r),Ne("load",r);break;case"details":Ne("toggle",r);break;case"input":Ne("invalid",r),gm(r,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":Ne("invalid",r);break;case"textarea":Ne("invalid",r),ym(r,f.value,f.defaultValue,f.children)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||r.textContent===""+u||f.suppressHydrationWarning===!0||Ep(r.textContent,u)?(f.popover!=null&&(Ne("beforetoggle",r),Ne("toggle",r)),f.onScroll!=null&&Ne("scroll",r),f.onScrollEnd!=null&&Ne("scrollend",r),f.onClick!=null&&(r.onclick=cn),r=!0):r=!1,r||jn(n,!0)}function ng(n){for(Mt=n.return;Mt;)switch(Mt.tag){case 5:case 31:case 13:Di=!1;return;case 27:case 3:Di=!0;return;default:Mt=Mt.return}}function or(n){if(n!==Mt)return!1;if(!Be)return ng(n),Be=!0,!1;var r=n.tag,u;if((u=r!==3&&r!==27)&&((u=r===5)&&(u=n.type,u=!(u!=="form"&&u!=="button")||Nf(n.type,n.memoizedProps)),u=!u),u&&rt&&jn(n),ng(n),r===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));rt=Dp(n)}else if(r===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));rt=Dp(n)}else r===27?(r=rt,is(n.type)?(n=Bf,Bf=null,rt=n):rt=r):rt=Mt?Ci(n.stateNode.nextSibling):null;return!0}function Ls(){rt=Mt=null,Be=!1}function pc(){var n=Gn;return n!==null&&(Jt===null?Jt=n:Jt.push.apply(Jt,n),Gn=null),n}function da(n){Gn===null?Gn=[n]:Gn.push(n)}var yc=C(null),_s=null,mn=null;function Hn(n,r,u){ee(yc,r._currentValue),r._currentValue=u}function gn(n){n._currentValue=yc.current,F(yc)}function vc(n,r,u){for(;n!==null;){var f=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),n===u)break;n=n.return}}function Ec(n,r,u,f){var p=n.child;for(p!==null&&(p.return=n);p!==null;){var v=p.dependencies;if(v!==null){var b=p.child;v=v.firstContext;e:for(;v!==null;){var D=v;v=p;for(var N=0;N<r.length;N++)if(D.context===r[N]){v.lanes|=u,D=v.alternate,D!==null&&(D.lanes|=u),vc(v.return,u,n),f||(b=null);break e}v=D.next}}else if(p.tag===18){if(b=p.return,b===null)throw Error(i(341));b.lanes|=u,v=b.alternate,v!==null&&(v.lanes|=u),vc(b,u,n),b=null}else b=p.child;if(b!==null)b.return=p;else for(b=p;b!==null;){if(b===n){b=null;break}if(p=b.sibling,p!==null){p.return=b.return,b=p;break}b=b.return}p=b}}function ur(n,r,u,f){n=null;for(var p=r,v=!1;p!==null;){if(!v){if((p.flags&524288)!==0)v=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var b=p.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var D=p.type;oi(p.pendingProps.value,b.value)||(n!==null?n.push(D):n=[D])}}else if(p===Se.current){if(b=p.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(n!==null?n.push(Ba):n=[Ba])}p=p.return}n!==null&&Ec(r,n,u,f),r.flags|=262144}function Nl(n){for(n=n.firstContext;n!==null;){if(!oi(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Ds(n){_s=n,mn=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Nt(n){return sg(_s,n)}function kl(n,r){return _s===null&&Ds(n),sg(n,r)}function sg(n,r){var u=r._currentValue;if(r={context:r,memoizedValue:u,next:null},mn===null){if(n===null)throw Error(i(308));mn=r,n.dependencies={lanes:0,firstContext:r},n.flags|=524288}else mn=mn.next=r;return u}var jx=typeof AbortController<"u"?AbortController:function(){var n=[],r=this.signal={aborted:!1,addEventListener:function(u,f){n.push(f)}};this.abort=function(){r.aborted=!0,n.forEach(function(u){return u()})}},Hx=s.unstable_scheduleCallback,zx=s.unstable_NormalPriority,Et={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Sc(){return{controller:new jx,data:new Map,refCount:0}}function ha(n){n.refCount--,n.refCount===0&&Hx(zx,function(){n.controller.abort()})}var ma=null,Tc=0,cr=0,fr=null;function Vx(n,r){if(ma===null){var u=ma=[];Tc=0,cr=Rf(),fr={status:"pending",value:void 0,then:function(f){u.push(f)}}}return Tc++,r.then(rg,rg),r}function rg(){if(--Tc===0&&ma!==null){fr!==null&&(fr.status="fulfilled");var n=ma;ma=null,cr=0,fr=null;for(var r=0;r<n.length;r++)(0,n[r])()}}function Kx(n,r){var u=[],f={status:"pending",value:null,reason:null,then:function(p){u.push(p)}};return n.then(function(){f.status="fulfilled",f.value=r;for(var p=0;p<u.length;p++)(0,u[p])(r)},function(p){for(f.status="rejected",f.reason=p,p=0;p<u.length;p++)(0,u[p])(void 0)}),f}var ag=k.S;k.S=function(n,r){H0=Xe(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&Vx(n,r),ag!==null&&ag(n,r)};var Is=C(null);function xc(){var n=Is.current;return n!==null?n:it.pooledCache}function Pl(n,r){r===null?ee(Is,Is.current):ee(Is,r.pool)}function lg(){var n=xc();return n===null?null:{parent:Et._currentValue,pool:n}}var dr=Error(i(460)),bc=Error(i(474)),Ul=Error(i(542)),Fl={then:function(){}};function og(n){return n=n.status,n==="fulfilled"||n==="rejected"}function ug(n,r,u){switch(u=n[u],u===void 0?n.push(r):u!==r&&(r.then(cn,cn),r=u),r.status){case"fulfilled":return r.value;case"rejected":throw n=r.reason,fg(n),n;default:if(typeof r.status=="string")r.then(cn,cn);else{if(n=it,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=r,n.status="pending",n.then(function(f){if(r.status==="pending"){var p=r;p.status="fulfilled",p.value=f}},function(f){if(r.status==="pending"){var p=r;p.status="rejected",p.reason=f}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw n=r.reason,fg(n),n}throw Os=r,dr}}function Cs(n){try{var r=n._init;return r(n._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(Os=u,dr):u}}var Os=null;function cg(){if(Os===null)throw Error(i(459));var n=Os;return Os=null,n}function fg(n){if(n===dr||n===Ul)throw Error(i(483))}var hr=null,ga=0;function Bl(n){var r=ga;return ga+=1,hr===null&&(hr=[]),ug(hr,n,r)}function pa(n,r){r=r.props.ref,n.ref=r!==void 0?r:null}function $l(n,r){throw r.$$typeof===y?Error(i(525)):(n=Object.prototype.toString.call(r),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n)))}function dg(n){function r(j,B){if(n){var V=j.deletions;V===null?(j.deletions=[B],j.flags|=16):V.push(B)}}function u(j,B){if(!n)return null;for(;B!==null;)r(j,B),B=B.sibling;return null}function f(j){for(var B=new Map;j!==null;)j.key!==null?B.set(j.key,j):B.set(j.index,j),j=j.sibling;return B}function p(j,B){return j=dn(j,B),j.index=0,j.sibling=null,j}function v(j,B,V){return j.index=V,n?(V=j.alternate,V!==null?(V=V.index,V<B?(j.flags|=67108866,B):V):(j.flags|=67108866,B)):(j.flags|=1048576,B)}function b(j){return n&&j.alternate===null&&(j.flags|=67108866),j}function D(j,B,V,ne){return B===null||B.tag!==6?(B=fc(V,j.mode,ne),B.return=j,B):(B=p(B,V),B.return=j,B)}function N(j,B,V,ne){var Te=V.type;return Te===x?te(j,B,V.props.children,ne,V.key):B!==null&&(B.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===$&&Cs(Te)===B.type)?(B=p(B,V.props),pa(B,V),B.return=j,B):(B=wl(V.type,V.key,V.props,null,j.mode,ne),pa(B,V),B.return=j,B)}function K(j,B,V,ne){return B===null||B.tag!==4||B.stateNode.containerInfo!==V.containerInfo||B.stateNode.implementation!==V.implementation?(B=dc(V,j.mode,ne),B.return=j,B):(B=p(B,V.children||[]),B.return=j,B)}function te(j,B,V,ne,Te){return B===null||B.tag!==7?(B=Rs(V,j.mode,ne,Te),B.return=j,B):(B=p(B,V),B.return=j,B)}function se(j,B,V){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=fc(""+B,j.mode,V),B.return=j,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case S:return V=wl(B.type,B.key,B.props,null,j.mode,V),pa(V,B),V.return=j,V;case E:return B=dc(B,j.mode,V),B.return=j,B;case $:return B=Cs(B),se(j,B,V)}if(fe(B)||re(B))return B=Rs(B,j.mode,V,null),B.return=j,B;if(typeof B.then=="function")return se(j,Bl(B),V);if(B.$$typeof===_)return se(j,kl(j,B),V);$l(j,B)}return null}function Y(j,B,V,ne){var Te=B!==null?B.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return Te!==null?null:D(j,B,""+V,ne);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case S:return V.key===Te?N(j,B,V,ne):null;case E:return V.key===Te?K(j,B,V,ne):null;case $:return V=Cs(V),Y(j,B,V,ne)}if(fe(V)||re(V))return Te!==null?null:te(j,B,V,ne,null);if(typeof V.then=="function")return Y(j,B,Bl(V),ne);if(V.$$typeof===_)return Y(j,B,kl(j,V),ne);$l(j,V)}return null}function Z(j,B,V,ne,Te){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return j=j.get(V)||null,D(B,j,""+ne,Te);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case S:return j=j.get(ne.key===null?V:ne.key)||null,N(B,j,ne,Te);case E:return j=j.get(ne.key===null?V:ne.key)||null,K(B,j,ne,Te);case $:return ne=Cs(ne),Z(j,B,V,ne,Te)}if(fe(ne)||re(ne))return j=j.get(V)||null,te(B,j,ne,Te,null);if(typeof ne.then=="function")return Z(j,B,V,Bl(ne),Te);if(ne.$$typeof===_)return Z(j,B,V,kl(B,ne),Te);$l(B,ne)}return null}function pe(j,B,V,ne){for(var Te=null,je=null,ve=B,Ie=B=0,Ue=null;ve!==null&&Ie<V.length;Ie++){ve.index>Ie?(Ue=ve,ve=null):Ue=ve.sibling;var He=Y(j,ve,V[Ie],ne);if(He===null){ve===null&&(ve=Ue);break}n&&ve&&He.alternate===null&&r(j,ve),B=v(He,B,Ie),je===null?Te=He:je.sibling=He,je=He,ve=Ue}if(Ie===V.length)return u(j,ve),Be&&hn(j,Ie),Te;if(ve===null){for(;Ie<V.length;Ie++)ve=se(j,V[Ie],ne),ve!==null&&(B=v(ve,B,Ie),je===null?Te=ve:je.sibling=ve,je=ve);return Be&&hn(j,Ie),Te}for(ve=f(ve);Ie<V.length;Ie++)Ue=Z(ve,j,Ie,V[Ie],ne),Ue!==null&&(n&&Ue.alternate!==null&&ve.delete(Ue.key===null?Ie:Ue.key),B=v(Ue,B,Ie),je===null?Te=Ue:je.sibling=Ue,je=Ue);return n&&ve.forEach(function(ls){return r(j,ls)}),Be&&hn(j,Ie),Te}function xe(j,B,V,ne){if(V==null)throw Error(i(151));for(var Te=null,je=null,ve=B,Ie=B=0,Ue=null,He=V.next();ve!==null&&!He.done;Ie++,He=V.next()){ve.index>Ie?(Ue=ve,ve=null):Ue=ve.sibling;var ls=Y(j,ve,He.value,ne);if(ls===null){ve===null&&(ve=Ue);break}n&&ve&&ls.alternate===null&&r(j,ve),B=v(ls,B,Ie),je===null?Te=ls:je.sibling=ls,je=ls,ve=Ue}if(He.done)return u(j,ve),Be&&hn(j,Ie),Te;if(ve===null){for(;!He.done;Ie++,He=V.next())He=se(j,He.value,ne),He!==null&&(B=v(He,B,Ie),je===null?Te=He:je.sibling=He,je=He);return Be&&hn(j,Ie),Te}for(ve=f(ve);!He.done;Ie++,He=V.next())He=Z(ve,j,Ie,He.value,ne),He!==null&&(n&&He.alternate!==null&&ve.delete(He.key===null?Ie:He.key),B=v(He,B,Ie),je===null?Te=He:je.sibling=He,je=He);return n&&ve.forEach(function(nA){return r(j,nA)}),Be&&hn(j,Ie),Te}function Ze(j,B,V,ne){if(typeof V=="object"&&V!==null&&V.type===x&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case S:e:{for(var Te=V.key;B!==null;){if(B.key===Te){if(Te=V.type,Te===x){if(B.tag===7){u(j,B.sibling),ne=p(B,V.props.children),ne.return=j,j=ne;break e}}else if(B.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===$&&Cs(Te)===B.type){u(j,B.sibling),ne=p(B,V.props),pa(ne,V),ne.return=j,j=ne;break e}u(j,B);break}else r(j,B);B=B.sibling}V.type===x?(ne=Rs(V.props.children,j.mode,ne,V.key),ne.return=j,j=ne):(ne=wl(V.type,V.key,V.props,null,j.mode,ne),pa(ne,V),ne.return=j,j=ne)}return b(j);case E:e:{for(Te=V.key;B!==null;){if(B.key===Te)if(B.tag===4&&B.stateNode.containerInfo===V.containerInfo&&B.stateNode.implementation===V.implementation){u(j,B.sibling),ne=p(B,V.children||[]),ne.return=j,j=ne;break e}else{u(j,B);break}else r(j,B);B=B.sibling}ne=dc(V,j.mode,ne),ne.return=j,j=ne}return b(j);case $:return V=Cs(V),Ze(j,B,V,ne)}if(fe(V))return pe(j,B,V,ne);if(re(V)){if(Te=re(V),typeof Te!="function")throw Error(i(150));return V=Te.call(V),xe(j,B,V,ne)}if(typeof V.then=="function")return Ze(j,B,Bl(V),ne);if(V.$$typeof===_)return Ze(j,B,kl(j,V),ne);$l(j,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,B!==null&&B.tag===6?(u(j,B.sibling),ne=p(B,V),ne.return=j,j=ne):(u(j,B),ne=fc(V,j.mode,ne),ne.return=j,j=ne),b(j)):u(j,B)}return function(j,B,V,ne){try{ga=0;var Te=Ze(j,B,V,ne);return hr=null,Te}catch(ve){if(ve===dr||ve===Ul)throw ve;var je=ui(29,ve,null,j.mode);return je.lanes=ne,je.return=j,je}finally{}}}var ws=dg(!0),hg=dg(!1),zn=!1;function Ac(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Rc(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Vn(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Kn(n,r,u){var f=n.updateQueue;if(f===null)return null;if(f=f.shared,(ze&2)!==0){var p=f.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),f.pending=r,r=Ol(n),Qm(n,null,u),r}return Cl(n,f,r,u),Ol(n)}function ya(n,r,u){if(r=r.updateQueue,r!==null&&(r=r.shared,(u&4194048)!==0)){var f=r.lanes;f&=n.pendingLanes,u|=f,r.lanes=u,sm(n,u)}}function Lc(n,r){var u=n.updateQueue,f=n.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var p=null,v=null;if(u=u.firstBaseUpdate,u!==null){do{var b={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};v===null?p=v=b:v=v.next=b,u=u.next}while(u!==null);v===null?p=v=r:v=v.next=r}else p=v=r;u={baseState:f.baseState,firstBaseUpdate:p,lastBaseUpdate:v,shared:f.shared,callbacks:f.callbacks},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=r:n.next=r,u.lastBaseUpdate=r}var _c=!1;function va(){if(_c){var n=fr;if(n!==null)throw n}}function Ea(n,r,u,f){_c=!1;var p=n.updateQueue;zn=!1;var v=p.firstBaseUpdate,b=p.lastBaseUpdate,D=p.shared.pending;if(D!==null){p.shared.pending=null;var N=D,K=N.next;N.next=null,b===null?v=K:b.next=K,b=N;var te=n.alternate;te!==null&&(te=te.updateQueue,D=te.lastBaseUpdate,D!==b&&(D===null?te.firstBaseUpdate=K:D.next=K,te.lastBaseUpdate=N))}if(v!==null){var se=p.baseState;b=0,te=K=N=null,D=v;do{var Y=D.lane&-536870913,Z=Y!==D.lane;if(Z?(Pe&Y)===Y:(f&Y)===Y){Y!==0&&Y===cr&&(_c=!0),te!==null&&(te=te.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var pe=n,xe=D;Y=r;var Ze=u;switch(xe.tag){case 1:if(pe=xe.payload,typeof pe=="function"){se=pe.call(Ze,se,Y);break e}se=pe;break e;case 3:pe.flags=pe.flags&-65537|128;case 0:if(pe=xe.payload,Y=typeof pe=="function"?pe.call(Ze,se,Y):pe,Y==null)break e;se=g({},se,Y);break e;case 2:zn=!0}}Y=D.callback,Y!==null&&(n.flags|=64,Z&&(n.flags|=8192),Z=p.callbacks,Z===null?p.callbacks=[Y]:Z.push(Y))}else Z={lane:Y,tag:D.tag,payload:D.payload,callback:D.callback,next:null},te===null?(K=te=Z,N=se):te=te.next=Z,b|=Y;if(D=D.next,D===null){if(D=p.shared.pending,D===null)break;Z=D,D=Z.next,Z.next=null,p.lastBaseUpdate=Z,p.shared.pending=null}}while(!0);te===null&&(N=se),p.baseState=N,p.firstBaseUpdate=K,p.lastBaseUpdate=te,v===null&&(p.shared.lanes=0),Wn|=b,n.lanes=b,n.memoizedState=se}}function mg(n,r){if(typeof n!="function")throw Error(i(191,n));n.call(r)}function gg(n,r){var u=n.callbacks;if(u!==null)for(n.callbacks=null,n=0;n<u.length;n++)mg(u[n],r)}var mr=C(null),Gl=C(0);function pg(n,r){n=An,ee(Gl,n),ee(mr,r),An=n|r.baseLanes}function Dc(){ee(Gl,An),ee(mr,mr.current)}function Ic(){An=Gl.current,F(mr),F(Gl)}var ci=C(null),Ii=null;function Yn(n){var r=n.alternate;ee(mt,mt.current&1),ee(ci,n),Ii===null&&(r===null||mr.current!==null||r.memoizedState!==null)&&(Ii=n)}function Cc(n){ee(mt,mt.current),ee(ci,n),Ii===null&&(Ii=n)}function yg(n){n.tag===22?(ee(mt,mt.current),ee(ci,n),Ii===null&&(Ii=n)):qn()}function qn(){ee(mt,mt.current),ee(ci,ci.current)}function fi(n){F(ci),Ii===n&&(Ii=null),F(mt)}var mt=C(0);function jl(n){for(var r=n;r!==null;){if(r.tag===13){var u=r.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Uf(u)||Ff(u)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var pn=0,Le=null,Qe=null,St=null,Hl=!1,gr=!1,Ms=!1,zl=0,Sa=0,pr=null,Yx=0;function ft(){throw Error(i(321))}function Oc(n,r){if(r===null)return!1;for(var u=0;u<r.length&&u<n.length;u++)if(!oi(n[u],r[u]))return!1;return!0}function wc(n,r,u,f,p,v){return pn=v,Le=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,k.H=n===null||n.memoizedState===null?e0:Yc,Ms=!1,v=u(f,p),Ms=!1,gr&&(v=Eg(r,u,f,p)),vg(n),v}function vg(n){k.H=ba;var r=Qe!==null&&Qe.next!==null;if(pn=0,St=Qe=Le=null,Hl=!1,Sa=0,pr=null,r)throw Error(i(300));n===null||Tt||(n=n.dependencies,n!==null&&Nl(n)&&(Tt=!0))}function Eg(n,r,u,f){Le=n;var p=0;do{if(gr&&(pr=null),Sa=0,gr=!1,25<=p)throw Error(i(301));if(p+=1,St=Qe=null,n.updateQueue!=null){var v=n.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}k.H=t0,v=r(u,f)}while(gr);return v}function qx(){var n=k.H,r=n.useState()[0];return r=typeof r.then=="function"?Ta(r):r,n=n.useState()[0],(Qe!==null?Qe.memoizedState:null)!==n&&(Le.flags|=1024),r}function Mc(){var n=zl!==0;return zl=0,n}function Nc(n,r,u){r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~u}function kc(n){if(Hl){for(n=n.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}Hl=!1}pn=0,St=Qe=Le=null,gr=!1,Sa=zl=0,pr=null}function Ht(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return St===null?Le.memoizedState=St=n:St=St.next=n,St}function gt(){if(Qe===null){var n=Le.alternate;n=n!==null?n.memoizedState:null}else n=Qe.next;var r=St===null?Le.memoizedState:St.next;if(r!==null)St=r,Qe=n;else{if(n===null)throw Le.alternate===null?Error(i(467)):Error(i(310));Qe=n,n={memoizedState:Qe.memoizedState,baseState:Qe.baseState,baseQueue:Qe.baseQueue,queue:Qe.queue,next:null},St===null?Le.memoizedState=St=n:St=St.next=n}return St}function Vl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ta(n){var r=Sa;return Sa+=1,pr===null&&(pr=[]),n=ug(pr,n,r),r=Le,(St===null?r.memoizedState:St.next)===null&&(r=r.alternate,k.H=r===null||r.memoizedState===null?e0:Yc),n}function Kl(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Ta(n);if(n.$$typeof===_)return Nt(n)}throw Error(i(438,String(n)))}function Pc(n){var r=null,u=Le.updateQueue;if(u!==null&&(r=u.memoCache),r==null){var f=Le.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(r={data:f.data.map(function(p){return p.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),u===null&&(u=Vl(),Le.updateQueue=u),u.memoCache=r,u=r.data[r.index],u===void 0)for(u=r.data[r.index]=Array(n),f=0;f<n;f++)u[f]=P;return r.index++,u}function yn(n,r){return typeof r=="function"?r(n):r}function Yl(n){var r=gt();return Uc(r,Qe,n)}function Uc(n,r,u){var f=n.queue;if(f===null)throw Error(i(311));f.lastRenderedReducer=u;var p=n.baseQueue,v=f.pending;if(v!==null){if(p!==null){var b=p.next;p.next=v.next,v.next=b}r.baseQueue=p=v,f.pending=null}if(v=n.baseState,p===null)n.memoizedState=v;else{r=p.next;var D=b=null,N=null,K=r,te=!1;do{var se=K.lane&-536870913;if(se!==K.lane?(Pe&se)===se:(pn&se)===se){var Y=K.revertLane;if(Y===0)N!==null&&(N=N.next={lane:0,revertLane:0,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),se===cr&&(te=!0);else if((pn&Y)===Y){K=K.next,Y===cr&&(te=!0);continue}else se={lane:0,revertLane:K.revertLane,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},N===null?(D=N=se,b=v):N=N.next=se,Le.lanes|=Y,Wn|=Y;se=K.action,Ms&&u(v,se),v=K.hasEagerState?K.eagerState:u(v,se)}else Y={lane:se,revertLane:K.revertLane,gesture:K.gesture,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},N===null?(D=N=Y,b=v):N=N.next=Y,Le.lanes|=se,Wn|=se;K=K.next}while(K!==null&&K!==r);if(N===null?b=v:N.next=D,!oi(v,n.memoizedState)&&(Tt=!0,te&&(u=fr,u!==null)))throw u;n.memoizedState=v,n.baseState=b,n.baseQueue=N,f.lastRenderedState=v}return p===null&&(f.lanes=0),[n.memoizedState,f.dispatch]}function Fc(n){var r=gt(),u=r.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=n;var f=u.dispatch,p=u.pending,v=r.memoizedState;if(p!==null){u.pending=null;var b=p=p.next;do v=n(v,b.action),b=b.next;while(b!==p);oi(v,r.memoizedState)||(Tt=!0),r.memoizedState=v,r.baseQueue===null&&(r.baseState=v),u.lastRenderedState=v}return[v,f]}function Sg(n,r,u){var f=Le,p=gt(),v=Be;if(v){if(u===void 0)throw Error(i(407));u=u()}else u=r();var b=!oi((Qe||p).memoizedState,u);if(b&&(p.memoizedState=u,Tt=!0),p=p.queue,Gc(bg.bind(null,f,p,n),[n]),p.getSnapshot!==r||b||St!==null&&St.memoizedState.tag&1){if(f.flags|=2048,yr(9,{destroy:void 0},xg.bind(null,f,p,u,r),null),it===null)throw Error(i(349));v||(pn&127)!==0||Tg(f,r,u)}return u}function Tg(n,r,u){n.flags|=16384,n={getSnapshot:r,value:u},r=Le.updateQueue,r===null?(r=Vl(),Le.updateQueue=r,r.stores=[n]):(u=r.stores,u===null?r.stores=[n]:u.push(n))}function xg(n,r,u,f){r.value=u,r.getSnapshot=f,Ag(r)&&Rg(n)}function bg(n,r,u){return u(function(){Ag(r)&&Rg(n)})}function Ag(n){var r=n.getSnapshot;n=n.value;try{var u=r();return!oi(n,u)}catch{return!0}}function Rg(n){var r=As(n,2);r!==null&&ei(r,n,2)}function Bc(n){var r=Ht();if(typeof n=="function"){var u=n;if(n=u(),Ms){Un(!0);try{u()}finally{Un(!1)}}}return r.memoizedState=r.baseState=n,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yn,lastRenderedState:n},r}function Lg(n,r,u,f){return n.baseState=u,Uc(n,Qe,typeof f=="function"?f:yn)}function Xx(n,r,u,f,p){if(Ql(n))throw Error(i(485));if(n=r.action,n!==null){var v={payload:p,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){v.listeners.push(b)}};k.T!==null?u(!0):v.isTransition=!1,f(v),u=r.pending,u===null?(v.next=r.pending=v,_g(r,v)):(v.next=u.next,r.pending=u.next=v)}}function _g(n,r){var u=r.action,f=r.payload,p=n.state;if(r.isTransition){var v=k.T,b={};k.T=b;try{var D=u(p,f),N=k.S;N!==null&&N(b,D),Dg(n,r,D)}catch(K){$c(n,r,K)}finally{v!==null&&b.types!==null&&(v.types=b.types),k.T=v}}else try{v=u(p,f),Dg(n,r,v)}catch(K){$c(n,r,K)}}function Dg(n,r,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){Ig(n,r,f)},function(f){return $c(n,r,f)}):Ig(n,r,u)}function Ig(n,r,u){r.status="fulfilled",r.value=u,Cg(r),n.state=u,r=n.pending,r!==null&&(u=r.next,u===r?n.pending=null:(u=u.next,r.next=u,_g(n,u)))}function $c(n,r,u){var f=n.pending;if(n.pending=null,f!==null){f=f.next;do r.status="rejected",r.reason=u,Cg(r),r=r.next;while(r!==f)}n.action=null}function Cg(n){n=n.listeners;for(var r=0;r<n.length;r++)(0,n[r])()}function Og(n,r){return r}function wg(n,r){if(Be){var u=it.formState;if(u!==null){e:{var f=Le;if(Be){if(rt){t:{for(var p=rt,v=Di;p.nodeType!==8;){if(!v){p=null;break t}if(p=Ci(p.nextSibling),p===null){p=null;break t}}v=p.data,p=v==="F!"||v==="F"?p:null}if(p){rt=Ci(p.nextSibling),f=p.data==="F!";break e}}jn(f)}f=!1}f&&(r=u[0])}}return u=Ht(),u.memoizedState=u.baseState=r,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Og,lastRenderedState:r},u.queue=f,u=Wg.bind(null,Le,f),f.dispatch=u,f=Bc(!1),v=Kc.bind(null,Le,!1,f.queue),f=Ht(),p={state:r,dispatch:null,action:n,pending:null},f.queue=p,u=Xx.bind(null,Le,p,v,u),p.dispatch=u,f.memoizedState=n,[r,u,!1]}function Mg(n){var r=gt();return Ng(r,Qe,n)}function Ng(n,r,u){if(r=Uc(n,r,Og)[0],n=Yl(yn)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var f=Ta(r)}catch(b){throw b===dr?Ul:b}else f=r;r=gt();var p=r.queue,v=p.dispatch;return u!==r.memoizedState&&(Le.flags|=2048,yr(9,{destroy:void 0},Qx.bind(null,p,u),null)),[f,v,n]}function Qx(n,r){n.action=r}function kg(n){var r=gt(),u=Qe;if(u!==null)return Ng(r,u,n);gt(),r=r.memoizedState,u=gt();var f=u.queue.dispatch;return u.memoizedState=n,[r,f,!1]}function yr(n,r,u,f){return n={tag:n,create:u,deps:f,inst:r,next:null},r=Le.updateQueue,r===null&&(r=Vl(),Le.updateQueue=r),u=r.lastEffect,u===null?r.lastEffect=n.next=n:(f=u.next,u.next=n,n.next=f,r.lastEffect=n),n}function Pg(){return gt().memoizedState}function ql(n,r,u,f){var p=Ht();Le.flags|=n,p.memoizedState=yr(1|r,{destroy:void 0},u,f===void 0?null:f)}function Xl(n,r,u,f){var p=gt();f=f===void 0?null:f;var v=p.memoizedState.inst;Qe!==null&&f!==null&&Oc(f,Qe.memoizedState.deps)?p.memoizedState=yr(r,v,u,f):(Le.flags|=n,p.memoizedState=yr(1|r,v,u,f))}function Ug(n,r){ql(8390656,8,n,r)}function Gc(n,r){Xl(2048,8,n,r)}function Wx(n){Le.flags|=4;var r=Le.updateQueue;if(r===null)r=Vl(),Le.updateQueue=r,r.events=[n];else{var u=r.events;u===null?r.events=[n]:u.push(n)}}function Fg(n){var r=gt().memoizedState;return Wx({ref:r,nextImpl:n}),function(){if((ze&2)!==0)throw Error(i(440));return r.impl.apply(void 0,arguments)}}function Bg(n,r){return Xl(4,2,n,r)}function $g(n,r){return Xl(4,4,n,r)}function Gg(n,r){if(typeof r=="function"){n=n();var u=r(n);return function(){typeof u=="function"?u():r(null)}}if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function jg(n,r,u){u=u!=null?u.concat([n]):null,Xl(4,4,Gg.bind(null,r,n),u)}function jc(){}function Hg(n,r){var u=gt();r=r===void 0?null:r;var f=u.memoizedState;return r!==null&&Oc(r,f[1])?f[0]:(u.memoizedState=[n,r],n)}function zg(n,r){var u=gt();r=r===void 0?null:r;var f=u.memoizedState;if(r!==null&&Oc(r,f[1]))return f[0];if(f=n(),Ms){Un(!0);try{n()}finally{Un(!1)}}return u.memoizedState=[f,r],f}function Hc(n,r,u){return u===void 0||(pn&1073741824)!==0&&(Pe&261930)===0?n.memoizedState=r:(n.memoizedState=u,n=V0(),Le.lanes|=n,Wn|=n,u)}function Vg(n,r,u,f){return oi(u,r)?u:mr.current!==null?(n=Hc(n,u,f),oi(n,r)||(Tt=!0),n):(pn&42)===0||(pn&1073741824)!==0&&(Pe&261930)===0?(Tt=!0,n.memoizedState=u):(n=V0(),Le.lanes|=n,Wn|=n,r)}function Kg(n,r,u,f,p){var v=X.p;X.p=v!==0&&8>v?v:8;var b=k.T,D={};k.T=D,Kc(n,!1,r,u);try{var N=p(),K=k.S;if(K!==null&&K(D,N),N!==null&&typeof N=="object"&&typeof N.then=="function"){var te=Kx(N,f);xa(n,r,te,mi(n))}else xa(n,r,f,mi(n))}catch(se){xa(n,r,{then:function(){},status:"rejected",reason:se},mi())}finally{X.p=v,b!==null&&D.types!==null&&(b.types=D.types),k.T=b}}function Zx(){}function zc(n,r,u,f){if(n.tag!==5)throw Error(i(476));var p=Yg(n).queue;Kg(n,p,r,J,u===null?Zx:function(){return qg(n),u(f)})}function Yg(n){var r=n.memoizedState;if(r!==null)return r;r={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yn,lastRenderedState:J},next:null};var u={};return r.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yn,lastRenderedState:u},next:null},n.memoizedState=r,n=n.alternate,n!==null&&(n.memoizedState=r),r}function qg(n){var r=Yg(n);r.next===null&&(r=n.alternate.memoizedState),xa(n,r.next.queue,{},mi())}function Vc(){return Nt(Ba)}function Xg(){return gt().memoizedState}function Qg(){return gt().memoizedState}function Jx(n){for(var r=n.return;r!==null;){switch(r.tag){case 24:case 3:var u=mi();n=Vn(u);var f=Kn(r,n,u);f!==null&&(ei(f,r,u),ya(f,r,u)),r={cache:Sc()},n.payload=r;return}r=r.return}}function eb(n,r,u){var f=mi();u={lane:f,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Ql(n)?Zg(r,u):(u=uc(n,r,u,f),u!==null&&(ei(u,n,f),Jg(u,r,f)))}function Wg(n,r,u){var f=mi();xa(n,r,u,f)}function xa(n,r,u,f){var p={lane:f,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Ql(n))Zg(r,p);else{var v=n.alternate;if(n.lanes===0&&(v===null||v.lanes===0)&&(v=r.lastRenderedReducer,v!==null))try{var b=r.lastRenderedState,D=v(b,u);if(p.hasEagerState=!0,p.eagerState=D,oi(D,b))return Cl(n,r,p,0),it===null&&Il(),!1}catch{}finally{}if(u=uc(n,r,p,f),u!==null)return ei(u,n,f),Jg(u,r,f),!0}return!1}function Kc(n,r,u,f){if(f={lane:2,revertLane:Rf(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Ql(n)){if(r)throw Error(i(479))}else r=uc(n,u,f,2),r!==null&&ei(r,n,2)}function Ql(n){var r=n.alternate;return n===Le||r!==null&&r===Le}function Zg(n,r){gr=Hl=!0;var u=n.pending;u===null?r.next=r:(r.next=u.next,u.next=r),n.pending=r}function Jg(n,r,u){if((u&4194048)!==0){var f=r.lanes;f&=n.pendingLanes,u|=f,r.lanes=u,sm(n,u)}}var ba={readContext:Nt,use:Kl,useCallback:ft,useContext:ft,useEffect:ft,useImperativeHandle:ft,useLayoutEffect:ft,useInsertionEffect:ft,useMemo:ft,useReducer:ft,useRef:ft,useState:ft,useDebugValue:ft,useDeferredValue:ft,useTransition:ft,useSyncExternalStore:ft,useId:ft,useHostTransitionStatus:ft,useFormState:ft,useActionState:ft,useOptimistic:ft,useMemoCache:ft,useCacheRefresh:ft};ba.useEffectEvent=ft;var e0={readContext:Nt,use:Kl,useCallback:function(n,r){return Ht().memoizedState=[n,r===void 0?null:r],n},useContext:Nt,useEffect:Ug,useImperativeHandle:function(n,r,u){u=u!=null?u.concat([n]):null,ql(4194308,4,Gg.bind(null,r,n),u)},useLayoutEffect:function(n,r){return ql(4194308,4,n,r)},useInsertionEffect:function(n,r){ql(4,2,n,r)},useMemo:function(n,r){var u=Ht();r=r===void 0?null:r;var f=n();if(Ms){Un(!0);try{n()}finally{Un(!1)}}return u.memoizedState=[f,r],f},useReducer:function(n,r,u){var f=Ht();if(u!==void 0){var p=u(r);if(Ms){Un(!0);try{u(r)}finally{Un(!1)}}}else p=r;return f.memoizedState=f.baseState=p,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:p},f.queue=n,n=n.dispatch=eb.bind(null,Le,n),[f.memoizedState,n]},useRef:function(n){var r=Ht();return n={current:n},r.memoizedState=n},useState:function(n){n=Bc(n);var r=n.queue,u=Wg.bind(null,Le,r);return r.dispatch=u,[n.memoizedState,u]},useDebugValue:jc,useDeferredValue:function(n,r){var u=Ht();return Hc(u,n,r)},useTransition:function(){var n=Bc(!1);return n=Kg.bind(null,Le,n.queue,!0,!1),Ht().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,r,u){var f=Le,p=Ht();if(Be){if(u===void 0)throw Error(i(407));u=u()}else{if(u=r(),it===null)throw Error(i(349));(Pe&127)!==0||Tg(f,r,u)}p.memoizedState=u;var v={value:u,getSnapshot:r};return p.queue=v,Ug(bg.bind(null,f,v,n),[n]),f.flags|=2048,yr(9,{destroy:void 0},xg.bind(null,f,v,u,r),null),u},useId:function(){var n=Ht(),r=it.identifierPrefix;if(Be){var u=Vi,f=zi;u=(f&~(1<<32-li(f)-1)).toString(32)+u,r="_"+r+"R_"+u,u=zl++,0<u&&(r+="H"+u.toString(32)),r+="_"}else u=Yx++,r="_"+r+"r_"+u.toString(32)+"_";return n.memoizedState=r},useHostTransitionStatus:Vc,useFormState:wg,useActionState:wg,useOptimistic:function(n){var r=Ht();r.memoizedState=r.baseState=n;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=u,r=Kc.bind(null,Le,!0,u),u.dispatch=r,[n,r]},useMemoCache:Pc,useCacheRefresh:function(){return Ht().memoizedState=Jx.bind(null,Le)},useEffectEvent:function(n){var r=Ht(),u={impl:n};return r.memoizedState=u,function(){if((ze&2)!==0)throw Error(i(440));return u.impl.apply(void 0,arguments)}}},Yc={readContext:Nt,use:Kl,useCallback:Hg,useContext:Nt,useEffect:Gc,useImperativeHandle:jg,useInsertionEffect:Bg,useLayoutEffect:$g,useMemo:zg,useReducer:Yl,useRef:Pg,useState:function(){return Yl(yn)},useDebugValue:jc,useDeferredValue:function(n,r){var u=gt();return Vg(u,Qe.memoizedState,n,r)},useTransition:function(){var n=Yl(yn)[0],r=gt().memoizedState;return[typeof n=="boolean"?n:Ta(n),r]},useSyncExternalStore:Sg,useId:Xg,useHostTransitionStatus:Vc,useFormState:Mg,useActionState:Mg,useOptimistic:function(n,r){var u=gt();return Lg(u,Qe,n,r)},useMemoCache:Pc,useCacheRefresh:Qg};Yc.useEffectEvent=Fg;var t0={readContext:Nt,use:Kl,useCallback:Hg,useContext:Nt,useEffect:Gc,useImperativeHandle:jg,useInsertionEffect:Bg,useLayoutEffect:$g,useMemo:zg,useReducer:Fc,useRef:Pg,useState:function(){return Fc(yn)},useDebugValue:jc,useDeferredValue:function(n,r){var u=gt();return Qe===null?Hc(u,n,r):Vg(u,Qe.memoizedState,n,r)},useTransition:function(){var n=Fc(yn)[0],r=gt().memoizedState;return[typeof n=="boolean"?n:Ta(n),r]},useSyncExternalStore:Sg,useId:Xg,useHostTransitionStatus:Vc,useFormState:kg,useActionState:kg,useOptimistic:function(n,r){var u=gt();return Qe!==null?Lg(u,Qe,n,r):(u.baseState=n,[n,u.queue.dispatch])},useMemoCache:Pc,useCacheRefresh:Qg};t0.useEffectEvent=Fg;function qc(n,r,u,f){r=n.memoizedState,u=u(f,r),u=u==null?r:g({},r,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var Xc={enqueueSetState:function(n,r,u){n=n._reactInternals;var f=mi(),p=Vn(f);p.payload=r,u!=null&&(p.callback=u),r=Kn(n,p,f),r!==null&&(ei(r,n,f),ya(r,n,f))},enqueueReplaceState:function(n,r,u){n=n._reactInternals;var f=mi(),p=Vn(f);p.tag=1,p.payload=r,u!=null&&(p.callback=u),r=Kn(n,p,f),r!==null&&(ei(r,n,f),ya(r,n,f))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var u=mi(),f=Vn(u);f.tag=2,r!=null&&(f.callback=r),r=Kn(n,f,u),r!==null&&(ei(r,n,u),ya(r,n,u))}};function i0(n,r,u,f,p,v,b){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(f,v,b):r.prototype&&r.prototype.isPureReactComponent?!ua(u,f)||!ua(p,v):!0}function n0(n,r,u,f){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(u,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(u,f),r.state!==n&&Xc.enqueueReplaceState(r,r.state,null)}function Ns(n,r){var u=r;if("ref"in r){u={};for(var f in r)f!=="ref"&&(u[f]=r[f])}if(n=n.defaultProps){u===r&&(u=g({},u));for(var p in n)u[p]===void 0&&(u[p]=n[p])}return u}function s0(n){Dl(n)}function r0(n){console.error(n)}function a0(n){Dl(n)}function Wl(n,r){try{var u=n.onUncaughtError;u(r.value,{componentStack:r.stack})}catch(f){setTimeout(function(){throw f})}}function l0(n,r,u){try{var f=n.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Qc(n,r,u){return u=Vn(u),u.tag=3,u.payload={element:null},u.callback=function(){Wl(n,r)},u}function o0(n){return n=Vn(n),n.tag=3,n}function u0(n,r,u,f){var p=u.type.getDerivedStateFromError;if(typeof p=="function"){var v=f.value;n.payload=function(){return p(v)},n.callback=function(){l0(r,u,f)}}var b=u.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(n.callback=function(){l0(r,u,f),typeof p!="function"&&(Zn===null?Zn=new Set([this]):Zn.add(this));var D=f.stack;this.componentDidCatch(f.value,{componentStack:D!==null?D:""})})}function tb(n,r,u,f,p){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(r=u.alternate,r!==null&&ur(r,u,p,!0),u=ci.current,u!==null){switch(u.tag){case 31:case 13:return Ii===null?uo():u.alternate===null&&dt===0&&(dt=3),u.flags&=-257,u.flags|=65536,u.lanes=p,f===Fl?u.flags|=16384:(r=u.updateQueue,r===null?u.updateQueue=new Set([f]):r.add(f),xf(n,f,p)),!1;case 22:return u.flags|=65536,f===Fl?u.flags|=16384:(r=u.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=r):(u=r.retryQueue,u===null?r.retryQueue=new Set([f]):u.add(f)),xf(n,f,p)),!1}throw Error(i(435,u.tag))}return xf(n,f,p),uo(),!1}if(Be)return r=ci.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=p,f!==gc&&(n=Error(i(422),{cause:f}),da(Ri(n,u)))):(f!==gc&&(r=Error(i(423),{cause:f}),da(Ri(r,u))),n=n.current.alternate,n.flags|=65536,p&=-p,n.lanes|=p,f=Ri(f,u),p=Qc(n.stateNode,f,p),Lc(n,p),dt!==4&&(dt=2)),!1;var v=Error(i(520),{cause:f});if(v=Ri(v,u),Oa===null?Oa=[v]:Oa.push(v),dt!==4&&(dt=2),r===null)return!0;f=Ri(f,u),u=r;do{switch(u.tag){case 3:return u.flags|=65536,n=p&-p,u.lanes|=n,n=Qc(u.stateNode,f,n),Lc(u,n),!1;case 1:if(r=u.type,v=u.stateNode,(u.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Zn===null||!Zn.has(v))))return u.flags|=65536,p&=-p,u.lanes|=p,p=o0(p),u0(p,n,u,f),Lc(u,p),!1}u=u.return}while(u!==null);return!1}var Wc=Error(i(461)),Tt=!1;function kt(n,r,u,f){r.child=n===null?hg(r,null,u,f):ws(r,n.child,u,f)}function c0(n,r,u,f,p){u=u.render;var v=r.ref;if("ref"in f){var b={};for(var D in f)D!=="ref"&&(b[D]=f[D])}else b=f;return Ds(r),f=wc(n,r,u,b,v,p),D=Mc(),n!==null&&!Tt?(Nc(n,r,p),vn(n,r,p)):(Be&&D&&hc(r),r.flags|=1,kt(n,r,f,p),r.child)}function f0(n,r,u,f,p){if(n===null){var v=u.type;return typeof v=="function"&&!cc(v)&&v.defaultProps===void 0&&u.compare===null?(r.tag=15,r.type=v,d0(n,r,v,f,p)):(n=wl(u.type,null,f,r,r.mode,p),n.ref=r.ref,n.return=r,r.child=n)}if(v=n.child,!af(n,p)){var b=v.memoizedProps;if(u=u.compare,u=u!==null?u:ua,u(b,f)&&n.ref===r.ref)return vn(n,r,p)}return r.flags|=1,n=dn(v,f),n.ref=r.ref,n.return=r,r.child=n}function d0(n,r,u,f,p){if(n!==null){var v=n.memoizedProps;if(ua(v,f)&&n.ref===r.ref)if(Tt=!1,r.pendingProps=f=v,af(n,p))(n.flags&131072)!==0&&(Tt=!0);else return r.lanes=n.lanes,vn(n,r,p)}return Zc(n,r,u,f,p)}function h0(n,r,u,f){var p=f.children,v=n!==null?n.memoizedState:null;if(n===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((r.flags&128)!==0){if(v=v!==null?v.baseLanes|u:u,n!==null){for(f=r.child=n.child,p=0;f!==null;)p=p|f.lanes|f.childLanes,f=f.sibling;f=p&~v}else f=0,r.child=null;return m0(n,r,v,u,f)}if((u&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},n!==null&&Pl(r,v!==null?v.cachePool:null),v!==null?pg(r,v):Dc(),yg(r);else return f=r.lanes=536870912,m0(n,r,v!==null?v.baseLanes|u:u,u,f)}else v!==null?(Pl(r,v.cachePool),pg(r,v),qn(),r.memoizedState=null):(n!==null&&Pl(r,null),Dc(),qn());return kt(n,r,p,u),r.child}function Aa(n,r){return n!==null&&n.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function m0(n,r,u,f,p){var v=xc();return v=v===null?null:{parent:Et._currentValue,pool:v},r.memoizedState={baseLanes:u,cachePool:v},n!==null&&Pl(r,null),Dc(),yg(r),n!==null&&ur(n,r,f,!0),r.childLanes=p,null}function Zl(n,r){return r=eo({mode:r.mode,children:r.children},n.mode),r.ref=n.ref,n.child=r,r.return=n,r}function g0(n,r,u){return ws(r,n.child,null,u),n=Zl(r,r.pendingProps),n.flags|=2,fi(r),r.memoizedState=null,n}function ib(n,r,u){var f=r.pendingProps,p=(r.flags&128)!==0;if(r.flags&=-129,n===null){if(Be){if(f.mode==="hidden")return n=Zl(r,f),r.lanes=536870912,Aa(null,n);if(Cc(r),(n=rt)?(n=_p(n,Di),n=n!==null&&n.data==="&"?n:null,n!==null&&(r.memoizedState={dehydrated:n,treeContext:$n!==null?{id:zi,overflow:Vi}:null,retryLane:536870912,hydrationErrors:null},u=Zm(n),u.return=r,r.child=u,Mt=r,rt=null)):n=null,n===null)throw jn(r);return r.lanes=536870912,null}return Zl(r,f)}var v=n.memoizedState;if(v!==null){var b=v.dehydrated;if(Cc(r),p)if(r.flags&256)r.flags&=-257,r=g0(n,r,u);else if(r.memoizedState!==null)r.child=n.child,r.flags|=128,r=null;else throw Error(i(558));else if(Tt||ur(n,r,u,!1),p=(u&n.childLanes)!==0,Tt||p){if(f=it,f!==null&&(b=rm(f,u),b!==0&&b!==v.retryLane))throw v.retryLane=b,As(n,b),ei(f,n,b),Wc;uo(),r=g0(n,r,u)}else n=v.treeContext,rt=Ci(b.nextSibling),Mt=r,Be=!0,Gn=null,Di=!1,n!==null&&tg(r,n),r=Zl(r,f),r.flags|=4096;return r}return n=dn(n.child,{mode:f.mode,children:f.children}),n.ref=r.ref,r.child=n,n.return=r,n}function Jl(n,r){var u=r.ref;if(u===null)n!==null&&n.ref!==null&&(r.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(n===null||n.ref!==u)&&(r.flags|=4194816)}}function Zc(n,r,u,f,p){return Ds(r),u=wc(n,r,u,f,void 0,p),f=Mc(),n!==null&&!Tt?(Nc(n,r,p),vn(n,r,p)):(Be&&f&&hc(r),r.flags|=1,kt(n,r,u,p),r.child)}function p0(n,r,u,f,p,v){return Ds(r),r.updateQueue=null,u=Eg(r,f,u,p),vg(n),f=Mc(),n!==null&&!Tt?(Nc(n,r,v),vn(n,r,v)):(Be&&f&&hc(r),r.flags|=1,kt(n,r,u,v),r.child)}function y0(n,r,u,f,p){if(Ds(r),r.stateNode===null){var v=rr,b=u.contextType;typeof b=="object"&&b!==null&&(v=Nt(b)),v=new u(f,v),r.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Xc,r.stateNode=v,v._reactInternals=r,v=r.stateNode,v.props=f,v.state=r.memoizedState,v.refs={},Ac(r),b=u.contextType,v.context=typeof b=="object"&&b!==null?Nt(b):rr,v.state=r.memoizedState,b=u.getDerivedStateFromProps,typeof b=="function"&&(qc(r,u,b,f),v.state=r.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(b=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),b!==v.state&&Xc.enqueueReplaceState(v,v.state,null),Ea(r,f,v,p),va(),v.state=r.memoizedState),typeof v.componentDidMount=="function"&&(r.flags|=4194308),f=!0}else if(n===null){v=r.stateNode;var D=r.memoizedProps,N=Ns(u,D);v.props=N;var K=v.context,te=u.contextType;b=rr,typeof te=="object"&&te!==null&&(b=Nt(te));var se=u.getDerivedStateFromProps;te=typeof se=="function"||typeof v.getSnapshotBeforeUpdate=="function",D=r.pendingProps!==D,te||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(D||K!==b)&&n0(r,v,f,b),zn=!1;var Y=r.memoizedState;v.state=Y,Ea(r,f,v,p),va(),K=r.memoizedState,D||Y!==K||zn?(typeof se=="function"&&(qc(r,u,se,f),K=r.memoizedState),(N=zn||i0(r,u,N,f,Y,K,b))?(te||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(r.flags|=4194308)):(typeof v.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=K),v.props=f,v.state=K,v.context=b,f=N):(typeof v.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{v=r.stateNode,Rc(n,r),b=r.memoizedProps,te=Ns(u,b),v.props=te,se=r.pendingProps,Y=v.context,K=u.contextType,N=rr,typeof K=="object"&&K!==null&&(N=Nt(K)),D=u.getDerivedStateFromProps,(K=typeof D=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(b!==se||Y!==N)&&n0(r,v,f,N),zn=!1,Y=r.memoizedState,v.state=Y,Ea(r,f,v,p),va();var Z=r.memoizedState;b!==se||Y!==Z||zn||n!==null&&n.dependencies!==null&&Nl(n.dependencies)?(typeof D=="function"&&(qc(r,u,D,f),Z=r.memoizedState),(te=zn||i0(r,u,te,f,Y,Z,N)||n!==null&&n.dependencies!==null&&Nl(n.dependencies))?(K||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(f,Z,N),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(f,Z,N)),typeof v.componentDidUpdate=="function"&&(r.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof v.componentDidUpdate!="function"||b===n.memoizedProps&&Y===n.memoizedState||(r.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||b===n.memoizedProps&&Y===n.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=Z),v.props=f,v.state=Z,v.context=N,f=te):(typeof v.componentDidUpdate!="function"||b===n.memoizedProps&&Y===n.memoizedState||(r.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||b===n.memoizedProps&&Y===n.memoizedState||(r.flags|=1024),f=!1)}return v=f,Jl(n,r),f=(r.flags&128)!==0,v||f?(v=r.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:v.render(),r.flags|=1,n!==null&&f?(r.child=ws(r,n.child,null,p),r.child=ws(r,null,u,p)):kt(n,r,u,p),r.memoizedState=v.state,n=r.child):n=vn(n,r,p),n}function v0(n,r,u,f){return Ls(),r.flags|=256,kt(n,r,u,f),r.child}var Jc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ef(n){return{baseLanes:n,cachePool:lg()}}function tf(n,r,u){return n=n!==null?n.childLanes&~u:0,r&&(n|=hi),n}function E0(n,r,u){var f=r.pendingProps,p=!1,v=(r.flags&128)!==0,b;if((b=v)||(b=n!==null&&n.memoizedState===null?!1:(mt.current&2)!==0),b&&(p=!0,r.flags&=-129),b=(r.flags&32)!==0,r.flags&=-33,n===null){if(Be){if(p?Yn(r):qn(),(n=rt)?(n=_p(n,Di),n=n!==null&&n.data!=="&"?n:null,n!==null&&(r.memoizedState={dehydrated:n,treeContext:$n!==null?{id:zi,overflow:Vi}:null,retryLane:536870912,hydrationErrors:null},u=Zm(n),u.return=r,r.child=u,Mt=r,rt=null)):n=null,n===null)throw jn(r);return Ff(n)?r.lanes=32:r.lanes=536870912,null}var D=f.children;return f=f.fallback,p?(qn(),p=r.mode,D=eo({mode:"hidden",children:D},p),f=Rs(f,p,u,null),D.return=r,f.return=r,D.sibling=f,r.child=D,f=r.child,f.memoizedState=ef(u),f.childLanes=tf(n,b,u),r.memoizedState=Jc,Aa(null,f)):(Yn(r),nf(r,D))}var N=n.memoizedState;if(N!==null&&(D=N.dehydrated,D!==null)){if(v)r.flags&256?(Yn(r),r.flags&=-257,r=sf(n,r,u)):r.memoizedState!==null?(qn(),r.child=n.child,r.flags|=128,r=null):(qn(),D=f.fallback,p=r.mode,f=eo({mode:"visible",children:f.children},p),D=Rs(D,p,u,null),D.flags|=2,f.return=r,D.return=r,f.sibling=D,r.child=f,ws(r,n.child,null,u),f=r.child,f.memoizedState=ef(u),f.childLanes=tf(n,b,u),r.memoizedState=Jc,r=Aa(null,f));else if(Yn(r),Ff(D)){if(b=D.nextSibling&&D.nextSibling.dataset,b)var K=b.dgst;b=K,f=Error(i(419)),f.stack="",f.digest=b,da({value:f,source:null,stack:null}),r=sf(n,r,u)}else if(Tt||ur(n,r,u,!1),b=(u&n.childLanes)!==0,Tt||b){if(b=it,b!==null&&(f=rm(b,u),f!==0&&f!==N.retryLane))throw N.retryLane=f,As(n,f),ei(b,n,f),Wc;Uf(D)||uo(),r=sf(n,r,u)}else Uf(D)?(r.flags|=192,r.child=n.child,r=null):(n=N.treeContext,rt=Ci(D.nextSibling),Mt=r,Be=!0,Gn=null,Di=!1,n!==null&&tg(r,n),r=nf(r,f.children),r.flags|=4096);return r}return p?(qn(),D=f.fallback,p=r.mode,N=n.child,K=N.sibling,f=dn(N,{mode:"hidden",children:f.children}),f.subtreeFlags=N.subtreeFlags&65011712,K!==null?D=dn(K,D):(D=Rs(D,p,u,null),D.flags|=2),D.return=r,f.return=r,f.sibling=D,r.child=f,Aa(null,f),f=r.child,D=n.child.memoizedState,D===null?D=ef(u):(p=D.cachePool,p!==null?(N=Et._currentValue,p=p.parent!==N?{parent:N,pool:N}:p):p=lg(),D={baseLanes:D.baseLanes|u,cachePool:p}),f.memoizedState=D,f.childLanes=tf(n,b,u),r.memoizedState=Jc,Aa(n.child,f)):(Yn(r),u=n.child,n=u.sibling,u=dn(u,{mode:"visible",children:f.children}),u.return=r,u.sibling=null,n!==null&&(b=r.deletions,b===null?(r.deletions=[n],r.flags|=16):b.push(n)),r.child=u,r.memoizedState=null,u)}function nf(n,r){return r=eo({mode:"visible",children:r},n.mode),r.return=n,n.child=r}function eo(n,r){return n=ui(22,n,null,r),n.lanes=0,n}function sf(n,r,u){return ws(r,n.child,null,u),n=nf(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function S0(n,r,u){n.lanes|=r;var f=n.alternate;f!==null&&(f.lanes|=r),vc(n.return,r,u)}function rf(n,r,u,f,p,v){var b=n.memoizedState;b===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:p,treeForkCount:v}:(b.isBackwards=r,b.rendering=null,b.renderingStartTime=0,b.last=f,b.tail=u,b.tailMode=p,b.treeForkCount=v)}function T0(n,r,u){var f=r.pendingProps,p=f.revealOrder,v=f.tail;f=f.children;var b=mt.current,D=(b&2)!==0;if(D?(b=b&1|2,r.flags|=128):b&=1,ee(mt,b),kt(n,r,f,u),f=Be?fa:0,!D&&n!==null&&(n.flags&128)!==0)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&S0(n,u,r);else if(n.tag===19)S0(n,u,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(p){case"forwards":for(u=r.child,p=null;u!==null;)n=u.alternate,n!==null&&jl(n)===null&&(p=u),u=u.sibling;u=p,u===null?(p=r.child,r.child=null):(p=u.sibling,u.sibling=null),rf(r,!1,p,u,v,f);break;case"backwards":case"unstable_legacy-backwards":for(u=null,p=r.child,r.child=null;p!==null;){if(n=p.alternate,n!==null&&jl(n)===null){r.child=p;break}n=p.sibling,p.sibling=u,u=p,p=n}rf(r,!0,u,null,v,f);break;case"together":rf(r,!1,null,null,void 0,f);break;default:r.memoizedState=null}return r.child}function vn(n,r,u){if(n!==null&&(r.dependencies=n.dependencies),Wn|=r.lanes,(u&r.childLanes)===0)if(n!==null){if(ur(n,r,u,!1),(u&r.childLanes)===0)return null}else return null;if(n!==null&&r.child!==n.child)throw Error(i(153));if(r.child!==null){for(n=r.child,u=dn(n,n.pendingProps),r.child=u,u.return=r;n.sibling!==null;)n=n.sibling,u=u.sibling=dn(n,n.pendingProps),u.return=r;u.sibling=null}return r.child}function af(n,r){return(n.lanes&r)!==0?!0:(n=n.dependencies,!!(n!==null&&Nl(n)))}function nb(n,r,u){switch(r.tag){case 3:Fe(r,r.stateNode.containerInfo),Hn(r,Et,n.memoizedState.cache),Ls();break;case 27:case 5:bt(r);break;case 4:Fe(r,r.stateNode.containerInfo);break;case 10:Hn(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Cc(r),null;break;case 13:var f=r.memoizedState;if(f!==null)return f.dehydrated!==null?(Yn(r),r.flags|=128,null):(u&r.child.childLanes)!==0?E0(n,r,u):(Yn(r),n=vn(n,r,u),n!==null?n.sibling:null);Yn(r);break;case 19:var p=(n.flags&128)!==0;if(f=(u&r.childLanes)!==0,f||(ur(n,r,u,!1),f=(u&r.childLanes)!==0),p){if(f)return T0(n,r,u);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),ee(mt,mt.current),f)break;return null;case 22:return r.lanes=0,h0(n,r,u,r.pendingProps);case 24:Hn(r,Et,n.memoizedState.cache)}return vn(n,r,u)}function x0(n,r,u){if(n!==null)if(n.memoizedProps!==r.pendingProps)Tt=!0;else{if(!af(n,u)&&(r.flags&128)===0)return Tt=!1,nb(n,r,u);Tt=(n.flags&131072)!==0}else Tt=!1,Be&&(r.flags&1048576)!==0&&eg(r,fa,r.index);switch(r.lanes=0,r.tag){case 16:e:{var f=r.pendingProps;if(n=Cs(r.elementType),r.type=n,typeof n=="function")cc(n)?(f=Ns(n,f),r.tag=1,r=y0(null,r,n,f,u)):(r.tag=0,r=Zc(null,r,n,f,u));else{if(n!=null){var p=n.$$typeof;if(p===O){r.tag=11,r=c0(null,r,n,f,u);break e}else if(p===w){r.tag=14,r=f0(null,r,n,f,u);break e}}throw r=oe(n)||n,Error(i(306,r,""))}}return r;case 0:return Zc(n,r,r.type,r.pendingProps,u);case 1:return f=r.type,p=Ns(f,r.pendingProps),y0(n,r,f,p,u);case 3:e:{if(Fe(r,r.stateNode.containerInfo),n===null)throw Error(i(387));f=r.pendingProps;var v=r.memoizedState;p=v.element,Rc(n,r),Ea(r,f,null,u);var b=r.memoizedState;if(f=b.cache,Hn(r,Et,f),f!==v.cache&&Ec(r,[Et],u,!0),va(),f=b.element,v.isDehydrated)if(v={element:f,isDehydrated:!1,cache:b.cache},r.updateQueue.baseState=v,r.memoizedState=v,r.flags&256){r=v0(n,r,f,u);break e}else if(f!==p){p=Ri(Error(i(424)),r),da(p),r=v0(n,r,f,u);break e}else{switch(n=r.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(rt=Ci(n.firstChild),Mt=r,Be=!0,Gn=null,Di=!0,u=hg(r,null,f,u),r.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Ls(),f===p){r=vn(n,r,u);break e}kt(n,r,f,u)}r=r.child}return r;case 26:return Jl(n,r),n===null?(u=Mp(r.type,null,r.pendingProps,null))?r.memoizedState=u:Be||(u=r.type,n=r.pendingProps,f=yo(he.current).createElement(u),f[wt]=r,f[qt]=n,Pt(f,u,n),Dt(f),r.stateNode=f):r.memoizedState=Mp(r.type,n.memoizedProps,r.pendingProps,n.memoizedState),null;case 27:return bt(r),n===null&&Be&&(f=r.stateNode=Cp(r.type,r.pendingProps,he.current),Mt=r,Di=!0,p=rt,is(r.type)?(Bf=p,rt=Ci(f.firstChild)):rt=p),kt(n,r,r.pendingProps.children,u),Jl(n,r),n===null&&(r.flags|=4194304),r.child;case 5:return n===null&&Be&&((p=f=rt)&&(f=Mb(f,r.type,r.pendingProps,Di),f!==null?(r.stateNode=f,Mt=r,rt=Ci(f.firstChild),Di=!1,p=!0):p=!1),p||jn(r)),bt(r),p=r.type,v=r.pendingProps,b=n!==null?n.memoizedProps:null,f=v.children,Nf(p,v)?f=null:b!==null&&Nf(p,b)&&(r.flags|=32),r.memoizedState!==null&&(p=wc(n,r,qx,null,null,u),Ba._currentValue=p),Jl(n,r),kt(n,r,f,u),r.child;case 6:return n===null&&Be&&((n=u=rt)&&(u=Nb(u,r.pendingProps,Di),u!==null?(r.stateNode=u,Mt=r,rt=null,n=!0):n=!1),n||jn(r)),null;case 13:return E0(n,r,u);case 4:return Fe(r,r.stateNode.containerInfo),f=r.pendingProps,n===null?r.child=ws(r,null,f,u):kt(n,r,f,u),r.child;case 11:return c0(n,r,r.type,r.pendingProps,u);case 7:return kt(n,r,r.pendingProps,u),r.child;case 8:return kt(n,r,r.pendingProps.children,u),r.child;case 12:return kt(n,r,r.pendingProps.children,u),r.child;case 10:return f=r.pendingProps,Hn(r,r.type,f.value),kt(n,r,f.children,u),r.child;case 9:return p=r.type._context,f=r.pendingProps.children,Ds(r),p=Nt(p),f=f(p),r.flags|=1,kt(n,r,f,u),r.child;case 14:return f0(n,r,r.type,r.pendingProps,u);case 15:return d0(n,r,r.type,r.pendingProps,u);case 19:return T0(n,r,u);case 31:return ib(n,r,u);case 22:return h0(n,r,u,r.pendingProps);case 24:return Ds(r),f=Nt(Et),n===null?(p=xc(),p===null&&(p=it,v=Sc(),p.pooledCache=v,v.refCount++,v!==null&&(p.pooledCacheLanes|=u),p=v),r.memoizedState={parent:f,cache:p},Ac(r),Hn(r,Et,p)):((n.lanes&u)!==0&&(Rc(n,r),Ea(r,null,null,u),va()),p=n.memoizedState,v=r.memoizedState,p.parent!==f?(p={parent:f,cache:f},r.memoizedState=p,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=p),Hn(r,Et,f)):(f=v.cache,Hn(r,Et,f),f!==p.cache&&Ec(r,[Et],u,!0))),kt(n,r,r.pendingProps.children,u),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function En(n){n.flags|=4}function lf(n,r,u,f,p){if((r=(n.mode&32)!==0)&&(r=!1),r){if(n.flags|=16777216,(p&335544128)===p)if(n.stateNode.complete)n.flags|=8192;else if(X0())n.flags|=8192;else throw Os=Fl,bc}else n.flags&=-16777217}function b0(n,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Fp(r))if(X0())n.flags|=8192;else throw Os=Fl,bc}function to(n,r){r!==null&&(n.flags|=4),n.flags&16384&&(r=n.tag!==22?im():536870912,n.lanes|=r,Tr|=r)}function Ra(n,r){if(!Be)switch(n.tailMode){case"hidden":r=n.tail;for(var u=null;r!==null;)r.alternate!==null&&(u=r),r=r.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:f.sibling=null}}function at(n){var r=n.alternate!==null&&n.alternate.child===n.child,u=0,f=0;if(r)for(var p=n.child;p!==null;)u|=p.lanes|p.childLanes,f|=p.subtreeFlags&65011712,f|=p.flags&65011712,p.return=n,p=p.sibling;else for(p=n.child;p!==null;)u|=p.lanes|p.childLanes,f|=p.subtreeFlags,f|=p.flags,p.return=n,p=p.sibling;return n.subtreeFlags|=f,n.childLanes=u,r}function sb(n,r,u){var f=r.pendingProps;switch(mc(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return at(r),null;case 1:return at(r),null;case 3:return u=r.stateNode,f=null,n!==null&&(f=n.memoizedState.cache),r.memoizedState.cache!==f&&(r.flags|=2048),gn(Et),we(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(n===null||n.child===null)&&(or(r)?En(r):n===null||n.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,pc())),at(r),null;case 26:var p=r.type,v=r.memoizedState;return n===null?(En(r),v!==null?(at(r),b0(r,v)):(at(r),lf(r,p,null,f,u))):v?v!==n.memoizedState?(En(r),at(r),b0(r,v)):(at(r),r.flags&=-16777217):(n=n.memoizedProps,n!==f&&En(r),at(r),lf(r,p,n,f,u)),null;case 27:if(Vt(r),u=he.current,p=r.type,n!==null&&r.stateNode!=null)n.memoizedProps!==f&&En(r);else{if(!f){if(r.stateNode===null)throw Error(i(166));return at(r),null}n=ae.current,or(r)?ig(r):(n=Cp(p,f,u),r.stateNode=n,En(r))}return at(r),null;case 5:if(Vt(r),p=r.type,n!==null&&r.stateNode!=null)n.memoizedProps!==f&&En(r);else{if(!f){if(r.stateNode===null)throw Error(i(166));return at(r),null}if(v=ae.current,or(r))ig(r);else{var b=yo(he.current);switch(v){case 1:v=b.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:v=b.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":v=b.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":v=b.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":v=b.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild);break;case"select":v=typeof f.is=="string"?b.createElement("select",{is:f.is}):b.createElement("select"),f.multiple?v.multiple=!0:f.size&&(v.size=f.size);break;default:v=typeof f.is=="string"?b.createElement(p,{is:f.is}):b.createElement(p)}}v[wt]=r,v[qt]=f;e:for(b=r.child;b!==null;){if(b.tag===5||b.tag===6)v.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===r)break e;for(;b.sibling===null;){if(b.return===null||b.return===r)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}r.stateNode=v;e:switch(Pt(v,p,f),p){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&En(r)}}return at(r),lf(r,r.type,n===null?null:n.memoizedProps,r.pendingProps,u),null;case 6:if(n&&r.stateNode!=null)n.memoizedProps!==f&&En(r);else{if(typeof f!="string"&&r.stateNode===null)throw Error(i(166));if(n=he.current,or(r)){if(n=r.stateNode,u=r.memoizedProps,f=null,p=Mt,p!==null)switch(p.tag){case 27:case 5:f=p.memoizedProps}n[wt]=r,n=!!(n.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||Ep(n.nodeValue,u)),n||jn(r,!0)}else n=yo(n).createTextNode(f),n[wt]=r,r.stateNode=n}return at(r),null;case 31:if(u=r.memoizedState,n===null||n.memoizedState!==null){if(f=or(r),u!==null){if(n===null){if(!f)throw Error(i(318));if(n=r.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(557));n[wt]=r}else Ls(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;at(r),n=!1}else u=pc(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=u),n=!0;if(!n)return r.flags&256?(fi(r),r):(fi(r),null);if((r.flags&128)!==0)throw Error(i(558))}return at(r),null;case 13:if(f=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(p=or(r),f!==null&&f.dehydrated!==null){if(n===null){if(!p)throw Error(i(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[wt]=r}else Ls(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;at(r),p=!1}else p=pc(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=p),p=!0;if(!p)return r.flags&256?(fi(r),r):(fi(r),null)}return fi(r),(r.flags&128)!==0?(r.lanes=u,r):(u=f!==null,n=n!==null&&n.memoizedState!==null,u&&(f=r.child,p=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(p=f.alternate.memoizedState.cachePool.pool),v=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),v!==p&&(f.flags|=2048)),u!==n&&u&&(r.child.flags|=8192),to(r,r.updateQueue),at(r),null);case 4:return we(),n===null&&If(r.stateNode.containerInfo),at(r),null;case 10:return gn(r.type),at(r),null;case 19:if(F(mt),f=r.memoizedState,f===null)return at(r),null;if(p=(r.flags&128)!==0,v=f.rendering,v===null)if(p)Ra(f,!1);else{if(dt!==0||n!==null&&(n.flags&128)!==0)for(n=r.child;n!==null;){if(v=jl(n),v!==null){for(r.flags|=128,Ra(f,!1),n=v.updateQueue,r.updateQueue=n,to(r,n),r.subtreeFlags=0,n=u,u=r.child;u!==null;)Wm(u,n),u=u.sibling;return ee(mt,mt.current&1|2),Be&&hn(r,f.treeForkCount),r.child}n=n.sibling}f.tail!==null&&Xe()>ao&&(r.flags|=128,p=!0,Ra(f,!1),r.lanes=4194304)}else{if(!p)if(n=jl(v),n!==null){if(r.flags|=128,p=!0,n=n.updateQueue,r.updateQueue=n,to(r,n),Ra(f,!0),f.tail===null&&f.tailMode==="hidden"&&!v.alternate&&!Be)return at(r),null}else 2*Xe()-f.renderingStartTime>ao&&u!==536870912&&(r.flags|=128,p=!0,Ra(f,!1),r.lanes=4194304);f.isBackwards?(v.sibling=r.child,r.child=v):(n=f.last,n!==null?n.sibling=v:r.child=v,f.last=v)}return f.tail!==null?(n=f.tail,f.rendering=n,f.tail=n.sibling,f.renderingStartTime=Xe(),n.sibling=null,u=mt.current,ee(mt,p?u&1|2:u&1),Be&&hn(r,f.treeForkCount),n):(at(r),null);case 22:case 23:return fi(r),Ic(),f=r.memoizedState!==null,n!==null?n.memoizedState!==null!==f&&(r.flags|=8192):f&&(r.flags|=8192),f?(u&536870912)!==0&&(r.flags&128)===0&&(at(r),r.subtreeFlags&6&&(r.flags|=8192)):at(r),u=r.updateQueue,u!==null&&to(r,u.retryQueue),u=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),f=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(f=r.memoizedState.cachePool.pool),f!==u&&(r.flags|=2048),n!==null&&F(Is),null;case 24:return u=null,n!==null&&(u=n.memoizedState.cache),r.memoizedState.cache!==u&&(r.flags|=2048),gn(Et),at(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function rb(n,r){switch(mc(r),r.tag){case 1:return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return gn(Et),we(),n=r.flags,(n&65536)!==0&&(n&128)===0?(r.flags=n&-65537|128,r):null;case 26:case 27:case 5:return Vt(r),null;case 31:if(r.memoizedState!==null){if(fi(r),r.alternate===null)throw Error(i(340));Ls()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 13:if(fi(r),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(i(340));Ls()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return F(mt),null;case 4:return we(),null;case 10:return gn(r.type),null;case 22:case 23:return fi(r),Ic(),n!==null&&F(Is),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 24:return gn(Et),null;case 25:return null;default:return null}}function A0(n,r){switch(mc(r),r.tag){case 3:gn(Et),we();break;case 26:case 27:case 5:Vt(r);break;case 4:we();break;case 31:r.memoizedState!==null&&fi(r);break;case 13:fi(r);break;case 19:F(mt);break;case 10:gn(r.type);break;case 22:case 23:fi(r),Ic(),n!==null&&F(Is);break;case 24:gn(Et)}}function La(n,r){try{var u=r.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var p=f.next;u=p;do{if((u.tag&n)===n){f=void 0;var v=u.create,b=u.inst;f=v(),b.destroy=f}u=u.next}while(u!==p)}}catch(D){Ke(r,r.return,D)}}function Xn(n,r,u){try{var f=r.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var v=p.next;f=v;do{if((f.tag&n)===n){var b=f.inst,D=b.destroy;if(D!==void 0){b.destroy=void 0,p=r;var N=u,K=D;try{K()}catch(te){Ke(p,N,te)}}}f=f.next}while(f!==v)}}catch(te){Ke(r,r.return,te)}}function R0(n){var r=n.updateQueue;if(r!==null){var u=n.stateNode;try{gg(r,u)}catch(f){Ke(n,n.return,f)}}}function L0(n,r,u){u.props=Ns(n.type,n.memoizedProps),u.state=n.memoizedState;try{u.componentWillUnmount()}catch(f){Ke(n,r,f)}}function _a(n,r){try{var u=n.ref;if(u!==null){switch(n.tag){case 26:case 27:case 5:var f=n.stateNode;break;case 30:f=n.stateNode;break;default:f=n.stateNode}typeof u=="function"?n.refCleanup=u(f):u.current=f}}catch(p){Ke(n,r,p)}}function Ki(n,r){var u=n.ref,f=n.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(p){Ke(n,r,p)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(p){Ke(n,r,p)}else u.current=null}function _0(n){var r=n.type,u=n.memoizedProps,f=n.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break e;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(p){Ke(n,n.return,p)}}function of(n,r,u){try{var f=n.stateNode;_b(f,n.type,u,r),f[qt]=r}catch(p){Ke(n,n.return,p)}}function D0(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&is(n.type)||n.tag===4}function uf(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||D0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&is(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function cf(n,r,u){var f=n.tag;if(f===5||f===6)n=n.stateNode,r?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(n,r):(r=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,r.appendChild(n),u=u._reactRootContainer,u!=null||r.onclick!==null||(r.onclick=cn));else if(f!==4&&(f===27&&is(n.type)&&(u=n.stateNode,r=null),n=n.child,n!==null))for(cf(n,r,u),n=n.sibling;n!==null;)cf(n,r,u),n=n.sibling}function io(n,r,u){var f=n.tag;if(f===5||f===6)n=n.stateNode,r?u.insertBefore(n,r):u.appendChild(n);else if(f!==4&&(f===27&&is(n.type)&&(u=n.stateNode),n=n.child,n!==null))for(io(n,r,u),n=n.sibling;n!==null;)io(n,r,u),n=n.sibling}function I0(n){var r=n.stateNode,u=n.memoizedProps;try{for(var f=n.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);Pt(r,f,u),r[wt]=n,r[qt]=u}catch(v){Ke(n,n.return,v)}}var Sn=!1,xt=!1,ff=!1,C0=typeof WeakSet=="function"?WeakSet:Set,It=null;function ab(n,r){if(n=n.containerInfo,wf=Ao,n=jm(n),nc(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else e:{u=(u=n.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var p=f.anchorOffset,v=f.focusNode;f=f.focusOffset;try{u.nodeType,v.nodeType}catch{u=null;break e}var b=0,D=-1,N=-1,K=0,te=0,se=n,Y=null;t:for(;;){for(var Z;se!==u||p!==0&&se.nodeType!==3||(D=b+p),se!==v||f!==0&&se.nodeType!==3||(N=b+f),se.nodeType===3&&(b+=se.nodeValue.length),(Z=se.firstChild)!==null;)Y=se,se=Z;for(;;){if(se===n)break t;if(Y===u&&++K===p&&(D=b),Y===v&&++te===f&&(N=b),(Z=se.nextSibling)!==null)break;se=Y,Y=se.parentNode}se=Z}u=D===-1||N===-1?null:{start:D,end:N}}else u=null}u=u||{start:0,end:0}}else u=null;for(Mf={focusedElem:n,selectionRange:u},Ao=!1,It=r;It!==null;)if(r=It,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,It=n;else for(;It!==null;){switch(r=It,v=r.alternate,n=r.flags,r.tag){case 0:if((n&4)!==0&&(n=r.updateQueue,n=n!==null?n.events:null,n!==null))for(u=0;u<n.length;u++)p=n[u],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&v!==null){n=void 0,u=r,p=v.memoizedProps,v=v.memoizedState,f=u.stateNode;try{var pe=Ns(u.type,p);n=f.getSnapshotBeforeUpdate(pe,v),f.__reactInternalSnapshotBeforeUpdate=n}catch(xe){Ke(u,u.return,xe)}}break;case 3:if((n&1024)!==0){if(n=r.stateNode.containerInfo,u=n.nodeType,u===9)Pf(n);else if(u===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Pf(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=r.sibling,n!==null){n.return=r.return,It=n;break}It=r.return}}function O0(n,r,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:xn(n,u),f&4&&La(5,u);break;case 1:if(xn(n,u),f&4)if(n=u.stateNode,r===null)try{n.componentDidMount()}catch(b){Ke(u,u.return,b)}else{var p=Ns(u.type,r.memoizedProps);r=r.memoizedState;try{n.componentDidUpdate(p,r,n.__reactInternalSnapshotBeforeUpdate)}catch(b){Ke(u,u.return,b)}}f&64&&R0(u),f&512&&_a(u,u.return);break;case 3:if(xn(n,u),f&64&&(n=u.updateQueue,n!==null)){if(r=null,u.child!==null)switch(u.child.tag){case 27:case 5:r=u.child.stateNode;break;case 1:r=u.child.stateNode}try{gg(n,r)}catch(b){Ke(u,u.return,b)}}break;case 27:r===null&&f&4&&I0(u);case 26:case 5:xn(n,u),r===null&&f&4&&_0(u),f&512&&_a(u,u.return);break;case 12:xn(n,u);break;case 31:xn(n,u),f&4&&N0(n,u);break;case 13:xn(n,u),f&4&&k0(n,u),f&64&&(n=u.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(u=gb.bind(null,u),kb(n,u))));break;case 22:if(f=u.memoizedState!==null||Sn,!f){r=r!==null&&r.memoizedState!==null||xt,p=Sn;var v=xt;Sn=f,(xt=r)&&!v?bn(n,u,(u.subtreeFlags&8772)!==0):xn(n,u),Sn=p,xt=v}break;case 30:break;default:xn(n,u)}}function w0(n){var r=n.alternate;r!==null&&(n.alternate=null,w0(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&$u(r)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var lt=null,Qt=!1;function Tn(n,r,u){for(u=u.child;u!==null;)M0(n,r,u),u=u.sibling}function M0(n,r,u){if(ai&&typeof ai.onCommitFiberUnmount=="function")try{ai.onCommitFiberUnmount(Wr,u)}catch{}switch(u.tag){case 26:xt||Ki(u,r),Tn(n,r,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:xt||Ki(u,r);var f=lt,p=Qt;is(u.type)&&(lt=u.stateNode,Qt=!1),Tn(n,r,u),Pa(u.stateNode),lt=f,Qt=p;break;case 5:xt||Ki(u,r);case 6:if(f=lt,p=Qt,lt=null,Tn(n,r,u),lt=f,Qt=p,lt!==null)if(Qt)try{(lt.nodeType===9?lt.body:lt.nodeName==="HTML"?lt.ownerDocument.body:lt).removeChild(u.stateNode)}catch(v){Ke(u,r,v)}else try{lt.removeChild(u.stateNode)}catch(v){Ke(u,r,v)}break;case 18:lt!==null&&(Qt?(n=lt,Rp(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,u.stateNode),Ir(n)):Rp(lt,u.stateNode));break;case 4:f=lt,p=Qt,lt=u.stateNode.containerInfo,Qt=!0,Tn(n,r,u),lt=f,Qt=p;break;case 0:case 11:case 14:case 15:Xn(2,u,r),xt||Xn(4,u,r),Tn(n,r,u);break;case 1:xt||(Ki(u,r),f=u.stateNode,typeof f.componentWillUnmount=="function"&&L0(u,r,f)),Tn(n,r,u);break;case 21:Tn(n,r,u);break;case 22:xt=(f=xt)||u.memoizedState!==null,Tn(n,r,u),xt=f;break;default:Tn(n,r,u)}}function N0(n,r){if(r.memoizedState===null&&(n=r.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{Ir(n)}catch(u){Ke(r,r.return,u)}}}function k0(n,r){if(r.memoizedState===null&&(n=r.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Ir(n)}catch(u){Ke(r,r.return,u)}}function lb(n){switch(n.tag){case 31:case 13:case 19:var r=n.stateNode;return r===null&&(r=n.stateNode=new C0),r;case 22:return n=n.stateNode,r=n._retryCache,r===null&&(r=n._retryCache=new C0),r;default:throw Error(i(435,n.tag))}}function no(n,r){var u=lb(n);r.forEach(function(f){if(!u.has(f)){u.add(f);var p=pb.bind(null,n,f);f.then(p,p)}})}function Wt(n,r){var u=r.deletions;if(u!==null)for(var f=0;f<u.length;f++){var p=u[f],v=n,b=r,D=b;e:for(;D!==null;){switch(D.tag){case 27:if(is(D.type)){lt=D.stateNode,Qt=!1;break e}break;case 5:lt=D.stateNode,Qt=!1;break e;case 3:case 4:lt=D.stateNode.containerInfo,Qt=!0;break e}D=D.return}if(lt===null)throw Error(i(160));M0(v,b,p),lt=null,Qt=!1,v=p.alternate,v!==null&&(v.return=null),p.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)P0(r,n),r=r.sibling}var Pi=null;function P0(n,r){var u=n.alternate,f=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Wt(r,n),Zt(n),f&4&&(Xn(3,n,n.return),La(3,n),Xn(5,n,n.return));break;case 1:Wt(r,n),Zt(n),f&512&&(xt||u===null||Ki(u,u.return)),f&64&&Sn&&(n=n.updateQueue,n!==null&&(f=n.callbacks,f!==null&&(u=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var p=Pi;if(Wt(r,n),Zt(n),f&512&&(xt||u===null||Ki(u,u.return)),f&4){var v=u!==null?u.memoizedState:null;if(f=n.memoizedState,u===null)if(f===null)if(n.stateNode===null){e:{f=n.type,u=n.memoizedProps,p=p.ownerDocument||p;t:switch(f){case"title":v=p.getElementsByTagName("title")[0],(!v||v[ea]||v[wt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=p.createElement(f),p.head.insertBefore(v,p.querySelector("head > title"))),Pt(v,f,u),v[wt]=n,Dt(v),f=v;break e;case"link":var b=Pp("link","href",p).get(f+(u.href||""));if(b){for(var D=0;D<b.length;D++)if(v=b[D],v.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&v.getAttribute("rel")===(u.rel==null?null:u.rel)&&v.getAttribute("title")===(u.title==null?null:u.title)&&v.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){b.splice(D,1);break t}}v=p.createElement(f),Pt(v,f,u),p.head.appendChild(v);break;case"meta":if(b=Pp("meta","content",p).get(f+(u.content||""))){for(D=0;D<b.length;D++)if(v=b[D],v.getAttribute("content")===(u.content==null?null:""+u.content)&&v.getAttribute("name")===(u.name==null?null:u.name)&&v.getAttribute("property")===(u.property==null?null:u.property)&&v.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&v.getAttribute("charset")===(u.charSet==null?null:u.charSet)){b.splice(D,1);break t}}v=p.createElement(f),Pt(v,f,u),p.head.appendChild(v);break;default:throw Error(i(468,f))}v[wt]=n,Dt(v),f=v}n.stateNode=f}else Up(p,n.type,n.stateNode);else n.stateNode=kp(p,f,n.memoizedProps);else v!==f?(v===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):v.count--,f===null?Up(p,n.type,n.stateNode):kp(p,f,n.memoizedProps)):f===null&&n.stateNode!==null&&of(n,n.memoizedProps,u.memoizedProps)}break;case 27:Wt(r,n),Zt(n),f&512&&(xt||u===null||Ki(u,u.return)),u!==null&&f&4&&of(n,n.memoizedProps,u.memoizedProps);break;case 5:if(Wt(r,n),Zt(n),f&512&&(xt||u===null||Ki(u,u.return)),n.flags&32){p=n.stateNode;try{Zs(p,"")}catch(pe){Ke(n,n.return,pe)}}f&4&&n.stateNode!=null&&(p=n.memoizedProps,of(n,p,u!==null?u.memoizedProps:p)),f&1024&&(ff=!0);break;case 6:if(Wt(r,n),Zt(n),f&4){if(n.stateNode===null)throw Error(i(162));f=n.memoizedProps,u=n.stateNode;try{u.nodeValue=f}catch(pe){Ke(n,n.return,pe)}}break;case 3:if(So=null,p=Pi,Pi=vo(r.containerInfo),Wt(r,n),Pi=p,Zt(n),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Ir(r.containerInfo)}catch(pe){Ke(n,n.return,pe)}ff&&(ff=!1,U0(n));break;case 4:f=Pi,Pi=vo(n.stateNode.containerInfo),Wt(r,n),Zt(n),Pi=f;break;case 12:Wt(r,n),Zt(n);break;case 31:Wt(r,n),Zt(n),f&4&&(f=n.updateQueue,f!==null&&(n.updateQueue=null,no(n,f)));break;case 13:Wt(r,n),Zt(n),n.child.flags&8192&&n.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(ro=Xe()),f&4&&(f=n.updateQueue,f!==null&&(n.updateQueue=null,no(n,f)));break;case 22:p=n.memoizedState!==null;var N=u!==null&&u.memoizedState!==null,K=Sn,te=xt;if(Sn=K||p,xt=te||N,Wt(r,n),xt=te,Sn=K,Zt(n),f&8192)e:for(r=n.stateNode,r._visibility=p?r._visibility&-2:r._visibility|1,p&&(u===null||N||Sn||xt||ks(n)),u=null,r=n;;){if(r.tag===5||r.tag===26){if(u===null){N=u=r;try{if(v=N.stateNode,p)b=v.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{D=N.stateNode;var se=N.memoizedProps.style,Y=se!=null&&se.hasOwnProperty("display")?se.display:null;D.style.display=Y==null||typeof Y=="boolean"?"":(""+Y).trim()}}catch(pe){Ke(N,N.return,pe)}}}else if(r.tag===6){if(u===null){N=r;try{N.stateNode.nodeValue=p?"":N.memoizedProps}catch(pe){Ke(N,N.return,pe)}}}else if(r.tag===18){if(u===null){N=r;try{var Z=N.stateNode;p?Lp(Z,!0):Lp(N.stateNode,!1)}catch(pe){Ke(N,N.return,pe)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===n)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break e;for(;r.sibling===null;){if(r.return===null||r.return===n)break e;u===r&&(u=null),r=r.return}u===r&&(u=null),r.sibling.return=r.return,r=r.sibling}f&4&&(f=n.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,no(n,u))));break;case 19:Wt(r,n),Zt(n),f&4&&(f=n.updateQueue,f!==null&&(n.updateQueue=null,no(n,f)));break;case 30:break;case 21:break;default:Wt(r,n),Zt(n)}}function Zt(n){var r=n.flags;if(r&2){try{for(var u,f=n.return;f!==null;){if(D0(f)){u=f;break}f=f.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var p=u.stateNode,v=uf(n);io(n,v,p);break;case 5:var b=u.stateNode;u.flags&32&&(Zs(b,""),u.flags&=-33);var D=uf(n);io(n,D,b);break;case 3:case 4:var N=u.stateNode.containerInfo,K=uf(n);cf(n,K,N);break;default:throw Error(i(161))}}catch(te){Ke(n,n.return,te)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function U0(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var r=n;U0(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),n=n.sibling}}function xn(n,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)O0(n,r.alternate,r),r=r.sibling}function ks(n){for(n=n.child;n!==null;){var r=n;switch(r.tag){case 0:case 11:case 14:case 15:Xn(4,r,r.return),ks(r);break;case 1:Ki(r,r.return);var u=r.stateNode;typeof u.componentWillUnmount=="function"&&L0(r,r.return,u),ks(r);break;case 27:Pa(r.stateNode);case 26:case 5:Ki(r,r.return),ks(r);break;case 22:r.memoizedState===null&&ks(r);break;case 30:ks(r);break;default:ks(r)}n=n.sibling}}function bn(n,r,u){for(u=u&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var f=r.alternate,p=n,v=r,b=v.flags;switch(v.tag){case 0:case 11:case 15:bn(p,v,u),La(4,v);break;case 1:if(bn(p,v,u),f=v,p=f.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(K){Ke(f,f.return,K)}if(f=v,p=f.updateQueue,p!==null){var D=f.stateNode;try{var N=p.shared.hiddenCallbacks;if(N!==null)for(p.shared.hiddenCallbacks=null,p=0;p<N.length;p++)mg(N[p],D)}catch(K){Ke(f,f.return,K)}}u&&b&64&&R0(v),_a(v,v.return);break;case 27:I0(v);case 26:case 5:bn(p,v,u),u&&f===null&&b&4&&_0(v),_a(v,v.return);break;case 12:bn(p,v,u);break;case 31:bn(p,v,u),u&&b&4&&N0(p,v);break;case 13:bn(p,v,u),u&&b&4&&k0(p,v);break;case 22:v.memoizedState===null&&bn(p,v,u),_a(v,v.return);break;case 30:break;default:bn(p,v,u)}r=r.sibling}}function df(n,r){var u=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),n=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(n=r.memoizedState.cachePool.pool),n!==u&&(n!=null&&n.refCount++,u!=null&&ha(u))}function hf(n,r){n=null,r.alternate!==null&&(n=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==n&&(r.refCount++,n!=null&&ha(n))}function Ui(n,r,u,f){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)F0(n,r,u,f),r=r.sibling}function F0(n,r,u,f){var p=r.flags;switch(r.tag){case 0:case 11:case 15:Ui(n,r,u,f),p&2048&&La(9,r);break;case 1:Ui(n,r,u,f);break;case 3:Ui(n,r,u,f),p&2048&&(n=null,r.alternate!==null&&(n=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==n&&(r.refCount++,n!=null&&ha(n)));break;case 12:if(p&2048){Ui(n,r,u,f),n=r.stateNode;try{var v=r.memoizedProps,b=v.id,D=v.onPostCommit;typeof D=="function"&&D(b,r.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(N){Ke(r,r.return,N)}}else Ui(n,r,u,f);break;case 31:Ui(n,r,u,f);break;case 13:Ui(n,r,u,f);break;case 23:break;case 22:v=r.stateNode,b=r.alternate,r.memoizedState!==null?v._visibility&2?Ui(n,r,u,f):Da(n,r):v._visibility&2?Ui(n,r,u,f):(v._visibility|=2,vr(n,r,u,f,(r.subtreeFlags&10256)!==0||!1)),p&2048&&df(b,r);break;case 24:Ui(n,r,u,f),p&2048&&hf(r.alternate,r);break;default:Ui(n,r,u,f)}}function vr(n,r,u,f,p){for(p=p&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var v=n,b=r,D=u,N=f,K=b.flags;switch(b.tag){case 0:case 11:case 15:vr(v,b,D,N,p),La(8,b);break;case 23:break;case 22:var te=b.stateNode;b.memoizedState!==null?te._visibility&2?vr(v,b,D,N,p):Da(v,b):(te._visibility|=2,vr(v,b,D,N,p)),p&&K&2048&&df(b.alternate,b);break;case 24:vr(v,b,D,N,p),p&&K&2048&&hf(b.alternate,b);break;default:vr(v,b,D,N,p)}r=r.sibling}}function Da(n,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var u=n,f=r,p=f.flags;switch(f.tag){case 22:Da(u,f),p&2048&&df(f.alternate,f);break;case 24:Da(u,f),p&2048&&hf(f.alternate,f);break;default:Da(u,f)}r=r.sibling}}var Ia=8192;function Er(n,r,u){if(n.subtreeFlags&Ia)for(n=n.child;n!==null;)B0(n,r,u),n=n.sibling}function B0(n,r,u){switch(n.tag){case 26:Er(n,r,u),n.flags&Ia&&n.memoizedState!==null&&Yb(u,Pi,n.memoizedState,n.memoizedProps);break;case 5:Er(n,r,u);break;case 3:case 4:var f=Pi;Pi=vo(n.stateNode.containerInfo),Er(n,r,u),Pi=f;break;case 22:n.memoizedState===null&&(f=n.alternate,f!==null&&f.memoizedState!==null?(f=Ia,Ia=16777216,Er(n,r,u),Ia=f):Er(n,r,u));break;default:Er(n,r,u)}}function $0(n){var r=n.alternate;if(r!==null&&(n=r.child,n!==null)){r.child=null;do r=n.sibling,n.sibling=null,n=r;while(n!==null)}}function Ca(n){var r=n.deletions;if((n.flags&16)!==0){if(r!==null)for(var u=0;u<r.length;u++){var f=r[u];It=f,j0(f,n)}$0(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)G0(n),n=n.sibling}function G0(n){switch(n.tag){case 0:case 11:case 15:Ca(n),n.flags&2048&&Xn(9,n,n.return);break;case 3:Ca(n);break;case 12:Ca(n);break;case 22:var r=n.stateNode;n.memoizedState!==null&&r._visibility&2&&(n.return===null||n.return.tag!==13)?(r._visibility&=-3,so(n)):Ca(n);break;default:Ca(n)}}function so(n){var r=n.deletions;if((n.flags&16)!==0){if(r!==null)for(var u=0;u<r.length;u++){var f=r[u];It=f,j0(f,n)}$0(n)}for(n=n.child;n!==null;){switch(r=n,r.tag){case 0:case 11:case 15:Xn(8,r,r.return),so(r);break;case 22:u=r.stateNode,u._visibility&2&&(u._visibility&=-3,so(r));break;default:so(r)}n=n.sibling}}function j0(n,r){for(;It!==null;){var u=It;switch(u.tag){case 0:case 11:case 15:Xn(8,u,r);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:ha(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,It=f;else e:for(u=n;It!==null;){f=It;var p=f.sibling,v=f.return;if(w0(f),f===u){It=null;break e}if(p!==null){p.return=v,It=p;break e}It=v}}}var ob={getCacheForType:function(n){var r=Nt(Et),u=r.data.get(n);return u===void 0&&(u=n(),r.data.set(n,u)),u},cacheSignal:function(){return Nt(Et).controller.signal}},ub=typeof WeakMap=="function"?WeakMap:Map,ze=0,it=null,Me=null,Pe=0,Ve=0,di=null,Qn=!1,Sr=!1,mf=!1,An=0,dt=0,Wn=0,Ps=0,gf=0,hi=0,Tr=0,Oa=null,Jt=null,pf=!1,ro=0,H0=0,ao=1/0,lo=null,Zn=null,Rt=0,Jn=null,xr=null,Rn=0,yf=0,vf=null,z0=null,wa=0,Ef=null;function mi(){return(ze&2)!==0&&Pe!==0?Pe&-Pe:k.T!==null?Rf():am()}function V0(){if(hi===0)if((Pe&536870912)===0||Be){var n=gl;gl<<=1,(gl&3932160)===0&&(gl=262144),hi=n}else hi=536870912;return n=ci.current,n!==null&&(n.flags|=32),hi}function ei(n,r,u){(n===it&&(Ve===2||Ve===9)||n.cancelPendingCommit!==null)&&(br(n,0),es(n,Pe,hi,!1)),Jr(n,u),((ze&2)===0||n!==it)&&(n===it&&((ze&2)===0&&(Ps|=u),dt===4&&es(n,Pe,hi,!1)),Yi(n))}function K0(n,r,u){if((ze&6)!==0)throw Error(i(327));var f=!u&&(r&127)===0&&(r&n.expiredLanes)===0||Zr(n,r),p=f?db(n,r):Tf(n,r,!0),v=f;do{if(p===0){Sr&&!f&&es(n,r,0,!1);break}else{if(u=n.current.alternate,v&&!cb(u)){p=Tf(n,r,!1),v=!1;continue}if(p===2){if(v=r,n.errorRecoveryDisabledLanes&v)var b=0;else b=n.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){r=b;e:{var D=n;p=Oa;var N=D.current.memoizedState.isDehydrated;if(N&&(br(D,b).flags|=256),b=Tf(D,b,!1),b!==2){if(mf&&!N){D.errorRecoveryDisabledLanes|=v,Ps|=v,p=4;break e}v=Jt,Jt=p,v!==null&&(Jt===null?Jt=v:Jt.push.apply(Jt,v))}p=b}if(v=!1,p!==2)continue}}if(p===1){br(n,0),es(n,r,0,!0);break}e:{switch(f=n,v=p,v){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:es(f,r,hi,!Qn);break e;case 2:Jt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(p=ro+300-Xe(),10<p)){if(es(f,r,hi,!Qn),yl(f,0,!0)!==0)break e;Rn=r,f.timeoutHandle=bp(Y0.bind(null,f,u,Jt,lo,pf,r,hi,Ps,Tr,Qn,v,"Throttled",-0,0),p);break e}Y0(f,u,Jt,lo,pf,r,hi,Ps,Tr,Qn,v,null,-0,0)}}break}while(!0);Yi(n)}function Y0(n,r,u,f,p,v,b,D,N,K,te,se,Y,Z){if(n.timeoutHandle=-1,se=r.subtreeFlags,se&8192||(se&16785408)===16785408){se={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:cn},B0(r,v,se);var pe=(v&62914560)===v?ro-Xe():(v&4194048)===v?H0-Xe():0;if(pe=qb(se,pe),pe!==null){Rn=v,n.cancelPendingCommit=pe(tp.bind(null,n,r,v,u,f,p,b,D,N,te,se,null,Y,Z)),es(n,v,b,!K);return}}tp(n,r,v,u,f,p,b,D,N)}function cb(n){for(var r=n;;){var u=r.tag;if((u===0||u===11||u===15)&&r.flags&16384&&(u=r.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var p=u[f],v=p.getSnapshot;p=p.value;try{if(!oi(v(),p))return!1}catch{return!1}}if(u=r.child,r.subtreeFlags&16384&&u!==null)u.return=r,r=u;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function es(n,r,u,f){r&=~gf,r&=~Ps,n.suspendedLanes|=r,n.pingedLanes&=~r,f&&(n.warmLanes|=r),f=n.expirationTimes;for(var p=r;0<p;){var v=31-li(p),b=1<<v;f[v]=-1,p&=~b}u!==0&&nm(n,u,r)}function oo(){return(ze&6)===0?(Ma(0),!1):!0}function Sf(){if(Me!==null){if(Ve===0)var n=Me.return;else n=Me,mn=_s=null,kc(n),hr=null,ga=0,n=Me;for(;n!==null;)A0(n.alternate,n),n=n.return;Me=null}}function br(n,r){var u=n.timeoutHandle;u!==-1&&(n.timeoutHandle=-1,Cb(u)),u=n.cancelPendingCommit,u!==null&&(n.cancelPendingCommit=null,u()),Rn=0,Sf(),it=n,Me=u=dn(n.current,null),Pe=r,Ve=0,di=null,Qn=!1,Sr=Zr(n,r),mf=!1,Tr=hi=gf=Ps=Wn=dt=0,Jt=Oa=null,pf=!1,(r&8)!==0&&(r|=r&32);var f=n.entangledLanes;if(f!==0)for(n=n.entanglements,f&=r;0<f;){var p=31-li(f),v=1<<p;r|=n[p],f&=~v}return An=r,Il(),u}function q0(n,r){Le=null,k.H=ba,r===dr||r===Ul?(r=cg(),Ve=3):r===bc?(r=cg(),Ve=4):Ve=r===Wc?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,di=r,Me===null&&(dt=1,Wl(n,Ri(r,n.current)))}function X0(){var n=ci.current;return n===null?!0:(Pe&4194048)===Pe?Ii===null:(Pe&62914560)===Pe||(Pe&536870912)!==0?n===Ii:!1}function Q0(){var n=k.H;return k.H=ba,n===null?ba:n}function W0(){var n=k.A;return k.A=ob,n}function uo(){dt=4,Qn||(Pe&4194048)!==Pe&&ci.current!==null||(Sr=!0),(Wn&134217727)===0&&(Ps&134217727)===0||it===null||es(it,Pe,hi,!1)}function Tf(n,r,u){var f=ze;ze|=2;var p=Q0(),v=W0();(it!==n||Pe!==r)&&(lo=null,br(n,r)),r=!1;var b=dt;e:do try{if(Ve!==0&&Me!==null){var D=Me,N=di;switch(Ve){case 8:Sf(),b=6;break e;case 3:case 2:case 9:case 6:ci.current===null&&(r=!0);var K=Ve;if(Ve=0,di=null,Ar(n,D,N,K),u&&Sr){b=0;break e}break;default:K=Ve,Ve=0,di=null,Ar(n,D,N,K)}}fb(),b=dt;break}catch(te){q0(n,te)}while(!0);return r&&n.shellSuspendCounter++,mn=_s=null,ze=f,k.H=p,k.A=v,Me===null&&(it=null,Pe=0,Il()),b}function fb(){for(;Me!==null;)Z0(Me)}function db(n,r){var u=ze;ze|=2;var f=Q0(),p=W0();it!==n||Pe!==r?(lo=null,ao=Xe()+500,br(n,r)):Sr=Zr(n,r);e:do try{if(Ve!==0&&Me!==null){r=Me;var v=di;t:switch(Ve){case 1:Ve=0,di=null,Ar(n,r,v,1);break;case 2:case 9:if(og(v)){Ve=0,di=null,J0(r);break}r=function(){Ve!==2&&Ve!==9||it!==n||(Ve=7),Yi(n)},v.then(r,r);break e;case 3:Ve=7;break e;case 4:Ve=5;break e;case 7:og(v)?(Ve=0,di=null,J0(r)):(Ve=0,di=null,Ar(n,r,v,7));break;case 5:var b=null;switch(Me.tag){case 26:b=Me.memoizedState;case 5:case 27:var D=Me;if(b?Fp(b):D.stateNode.complete){Ve=0,di=null;var N=D.sibling;if(N!==null)Me=N;else{var K=D.return;K!==null?(Me=K,co(K)):Me=null}break t}}Ve=0,di=null,Ar(n,r,v,5);break;case 6:Ve=0,di=null,Ar(n,r,v,6);break;case 8:Sf(),dt=6;break e;default:throw Error(i(462))}}hb();break}catch(te){q0(n,te)}while(!0);return mn=_s=null,k.H=f,k.A=p,ze=u,Me!==null?0:(it=null,Pe=0,Il(),dt)}function hb(){for(;Me!==null&&!tt();)Z0(Me)}function Z0(n){var r=x0(n.alternate,n,An);n.memoizedProps=n.pendingProps,r===null?co(n):Me=r}function J0(n){var r=n,u=r.alternate;switch(r.tag){case 15:case 0:r=p0(u,r,r.pendingProps,r.type,void 0,Pe);break;case 11:r=p0(u,r,r.pendingProps,r.type.render,r.ref,Pe);break;case 5:kc(r);default:A0(u,r),r=Me=Wm(r,An),r=x0(u,r,An)}n.memoizedProps=n.pendingProps,r===null?co(n):Me=r}function Ar(n,r,u,f){mn=_s=null,kc(r),hr=null,ga=0;var p=r.return;try{if(tb(n,p,r,u,Pe)){dt=1,Wl(n,Ri(u,n.current)),Me=null;return}}catch(v){if(p!==null)throw Me=p,v;dt=1,Wl(n,Ri(u,n.current)),Me=null;return}r.flags&32768?(Be||f===1?n=!0:Sr||(Pe&536870912)!==0?n=!1:(Qn=n=!0,(f===2||f===9||f===3||f===6)&&(f=ci.current,f!==null&&f.tag===13&&(f.flags|=16384))),ep(r,n)):co(r)}function co(n){var r=n;do{if((r.flags&32768)!==0){ep(r,Qn);return}n=r.return;var u=sb(r.alternate,r,An);if(u!==null){Me=u;return}if(r=r.sibling,r!==null){Me=r;return}Me=r=n}while(r!==null);dt===0&&(dt=5)}function ep(n,r){do{var u=rb(n.alternate,n);if(u!==null){u.flags&=32767,Me=u;return}if(u=n.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!r&&(n=n.sibling,n!==null)){Me=n;return}Me=n=u}while(n!==null);dt=6,Me=null}function tp(n,r,u,f,p,v,b,D,N){n.cancelPendingCommit=null;do fo();while(Rt!==0);if((ze&6)!==0)throw Error(i(327));if(r!==null){if(r===n.current)throw Error(i(177));if(v=r.lanes|r.childLanes,v|=oc,KT(n,u,v,b,D,N),n===it&&(Me=it=null,Pe=0),xr=r,Jn=n,Rn=u,yf=v,vf=p,z0=f,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,yb(At,function(){return ap(),null})):(n.callbackNode=null,n.callbackPriority=0),f=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||f){f=k.T,k.T=null,p=X.p,X.p=2,b=ze,ze|=4;try{ab(n,r,u)}finally{ze=b,X.p=p,k.T=f}}Rt=1,ip(),np(),sp()}}function ip(){if(Rt===1){Rt=0;var n=Jn,r=xr,u=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||u){u=k.T,k.T=null;var f=X.p;X.p=2;var p=ze;ze|=4;try{P0(r,n);var v=Mf,b=jm(n.containerInfo),D=v.focusedElem,N=v.selectionRange;if(b!==D&&D&&D.ownerDocument&&Gm(D.ownerDocument.documentElement,D)){if(N!==null&&nc(D)){var K=N.start,te=N.end;if(te===void 0&&(te=K),"selectionStart"in D)D.selectionStart=K,D.selectionEnd=Math.min(te,D.value.length);else{var se=D.ownerDocument||document,Y=se&&se.defaultView||window;if(Y.getSelection){var Z=Y.getSelection(),pe=D.textContent.length,xe=Math.min(N.start,pe),Ze=N.end===void 0?xe:Math.min(N.end,pe);!Z.extend&&xe>Ze&&(b=Ze,Ze=xe,xe=b);var j=$m(D,xe),B=$m(D,Ze);if(j&&B&&(Z.rangeCount!==1||Z.anchorNode!==j.node||Z.anchorOffset!==j.offset||Z.focusNode!==B.node||Z.focusOffset!==B.offset)){var V=se.createRange();V.setStart(j.node,j.offset),Z.removeAllRanges(),xe>Ze?(Z.addRange(V),Z.extend(B.node,B.offset)):(V.setEnd(B.node,B.offset),Z.addRange(V))}}}}for(se=[],Z=D;Z=Z.parentNode;)Z.nodeType===1&&se.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<se.length;D++){var ne=se[D];ne.element.scrollLeft=ne.left,ne.element.scrollTop=ne.top}}Ao=!!wf,Mf=wf=null}finally{ze=p,X.p=f,k.T=u}}n.current=r,Rt=2}}function np(){if(Rt===2){Rt=0;var n=Jn,r=xr,u=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||u){u=k.T,k.T=null;var f=X.p;X.p=2;var p=ze;ze|=4;try{O0(n,r.alternate,r)}finally{ze=p,X.p=f,k.T=u}}Rt=3}}function sp(){if(Rt===4||Rt===3){Rt=0,vt();var n=Jn,r=xr,u=Rn,f=z0;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?Rt=5:(Rt=0,xr=Jn=null,rp(n,n.pendingLanes));var p=n.pendingLanes;if(p===0&&(Zn=null),Fu(u),r=r.stateNode,ai&&typeof ai.onCommitFiberRoot=="function")try{ai.onCommitFiberRoot(Wr,r,void 0,(r.current.flags&128)===128)}catch{}if(f!==null){r=k.T,p=X.p,X.p=2,k.T=null;try{for(var v=n.onRecoverableError,b=0;b<f.length;b++){var D=f[b];v(D.value,{componentStack:D.stack})}}finally{k.T=r,X.p=p}}(Rn&3)!==0&&fo(),Yi(n),p=n.pendingLanes,(u&261930)!==0&&(p&42)!==0?n===Ef?wa++:(wa=0,Ef=n):wa=0,Ma(0)}}function rp(n,r){(n.pooledCacheLanes&=r)===0&&(r=n.pooledCache,r!=null&&(n.pooledCache=null,ha(r)))}function fo(){return ip(),np(),sp(),ap()}function ap(){if(Rt!==5)return!1;var n=Jn,r=yf;yf=0;var u=Fu(Rn),f=k.T,p=X.p;try{X.p=32>u?32:u,k.T=null,u=vf,vf=null;var v=Jn,b=Rn;if(Rt=0,xr=Jn=null,Rn=0,(ze&6)!==0)throw Error(i(331));var D=ze;if(ze|=4,G0(v.current),F0(v,v.current,b,u),ze=D,Ma(0,!1),ai&&typeof ai.onPostCommitFiberRoot=="function")try{ai.onPostCommitFiberRoot(Wr,v)}catch{}return!0}finally{X.p=p,k.T=f,rp(n,r)}}function lp(n,r,u){r=Ri(u,r),r=Qc(n.stateNode,r,2),n=Kn(n,r,2),n!==null&&(Jr(n,2),Yi(n))}function Ke(n,r,u){if(n.tag===3)lp(n,n,u);else for(;r!==null;){if(r.tag===3){lp(r,n,u);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Zn===null||!Zn.has(f))){n=Ri(u,n),u=o0(2),f=Kn(r,u,2),f!==null&&(u0(u,f,r,n),Jr(f,2),Yi(f));break}}r=r.return}}function xf(n,r,u){var f=n.pingCache;if(f===null){f=n.pingCache=new ub;var p=new Set;f.set(r,p)}else p=f.get(r),p===void 0&&(p=new Set,f.set(r,p));p.has(u)||(mf=!0,p.add(u),n=mb.bind(null,n,r,u),r.then(n,n))}function mb(n,r,u){var f=n.pingCache;f!==null&&f.delete(r),n.pingedLanes|=n.suspendedLanes&u,n.warmLanes&=~u,it===n&&(Pe&u)===u&&(dt===4||dt===3&&(Pe&62914560)===Pe&&300>Xe()-ro?(ze&2)===0&&br(n,0):gf|=u,Tr===Pe&&(Tr=0)),Yi(n)}function op(n,r){r===0&&(r=im()),n=As(n,r),n!==null&&(Jr(n,r),Yi(n))}function gb(n){var r=n.memoizedState,u=0;r!==null&&(u=r.retryLane),op(n,u)}function pb(n,r){var u=0;switch(n.tag){case 31:case 13:var f=n.stateNode,p=n.memoizedState;p!==null&&(u=p.retryLane);break;case 19:f=n.stateNode;break;case 22:f=n.stateNode._retryCache;break;default:throw Error(i(314))}f!==null&&f.delete(r),op(n,u)}function yb(n,r){return et(n,r)}var ho=null,Rr=null,bf=!1,mo=!1,Af=!1,ts=0;function Yi(n){n!==Rr&&n.next===null&&(Rr===null?ho=Rr=n:Rr=Rr.next=n),mo=!0,bf||(bf=!0,Eb())}function Ma(n,r){if(!Af&&mo){Af=!0;do for(var u=!1,f=ho;f!==null;){if(n!==0){var p=f.pendingLanes;if(p===0)var v=0;else{var b=f.suspendedLanes,D=f.pingedLanes;v=(1<<31-li(42|n)+1)-1,v&=p&~(b&~D),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(u=!0,dp(f,v))}else v=Pe,v=yl(f,f===it?v:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(v&3)===0||Zr(f,v)||(u=!0,dp(f,v));f=f.next}while(u);Af=!1}}function vb(){up()}function up(){mo=bf=!1;var n=0;ts!==0&&Ib()&&(n=ts);for(var r=Xe(),u=null,f=ho;f!==null;){var p=f.next,v=cp(f,r);v===0?(f.next=null,u===null?ho=p:u.next=p,p===null&&(Rr=u)):(u=f,(n!==0||(v&3)!==0)&&(mo=!0)),f=p}Rt!==0&&Rt!==5||Ma(n),ts!==0&&(ts=0)}function cp(n,r){for(var u=n.suspendedLanes,f=n.pingedLanes,p=n.expirationTimes,v=n.pendingLanes&-62914561;0<v;){var b=31-li(v),D=1<<b,N=p[b];N===-1?((D&u)===0||(D&f)!==0)&&(p[b]=VT(D,r)):N<=r&&(n.expiredLanes|=D),v&=~D}if(r=it,u=Pe,u=yl(n,n===r?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),f=n.callbackNode,u===0||n===r&&(Ve===2||Ve===9)||n.cancelPendingCommit!==null)return f!==null&&f!==null&&Ot(f),n.callbackNode=null,n.callbackPriority=0;if((u&3)===0||Zr(n,u)){if(r=u&-u,r===n.callbackPriority)return r;switch(f!==null&&Ot(f),Fu(u)){case 2:case 8:u=Pn;break;case 32:u=At;break;case 268435456:u=ln;break;default:u=At}return f=fp.bind(null,n),u=et(u,f),n.callbackPriority=r,n.callbackNode=u,r}return f!==null&&f!==null&&Ot(f),n.callbackPriority=2,n.callbackNode=null,2}function fp(n,r){if(Rt!==0&&Rt!==5)return n.callbackNode=null,n.callbackPriority=0,null;var u=n.callbackNode;if(fo()&&n.callbackNode!==u)return null;var f=Pe;return f=yl(n,n===it?f:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),f===0?null:(K0(n,f,r),cp(n,Xe()),n.callbackNode!=null&&n.callbackNode===u?fp.bind(null,n):null)}function dp(n,r){if(fo())return null;K0(n,r,!0)}function Eb(){Ob(function(){(ze&6)!==0?et(Ni,vb):up()})}function Rf(){if(ts===0){var n=cr;n===0&&(n=ml,ml<<=1,(ml&261888)===0&&(ml=256)),ts=n}return ts}function hp(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Tl(""+n)}function mp(n,r){var u=r.ownerDocument.createElement("input");return u.name=r.name,u.value=r.value,n.id&&u.setAttribute("form",n.id),r.parentNode.insertBefore(u,r),n=new FormData(n),u.parentNode.removeChild(u),n}function Sb(n,r,u,f,p){if(r==="submit"&&u&&u.stateNode===p){var v=hp((p[qt]||null).action),b=f.submitter;b&&(r=(r=b[qt]||null)?hp(r.formAction):b.getAttribute("formAction"),r!==null&&(v=r,b=null));var D=new Rl("action","action",null,f,p);n.push({event:D,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(ts!==0){var N=b?mp(p,b):new FormData(p);zc(u,{pending:!0,data:N,method:p.method,action:v},null,N)}}else typeof v=="function"&&(D.preventDefault(),N=b?mp(p,b):new FormData(p),zc(u,{pending:!0,data:N,method:p.method,action:v},v,N))},currentTarget:p}]})}}for(var Lf=0;Lf<lc.length;Lf++){var _f=lc[Lf],Tb=_f.toLowerCase(),xb=_f[0].toUpperCase()+_f.slice(1);ki(Tb,"on"+xb)}ki(Vm,"onAnimationEnd"),ki(Km,"onAnimationIteration"),ki(Ym,"onAnimationStart"),ki("dblclick","onDoubleClick"),ki("focusin","onFocus"),ki("focusout","onBlur"),ki(Fx,"onTransitionRun"),ki(Bx,"onTransitionStart"),ki($x,"onTransitionCancel"),ki(qm,"onTransitionEnd"),Qs("onMouseEnter",["mouseout","mouseover"]),Qs("onMouseLeave",["mouseout","mouseover"]),Qs("onPointerEnter",["pointerout","pointerover"]),Qs("onPointerLeave",["pointerout","pointerover"]),Ss("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ss("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ss("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ss("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ss("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ss("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Na="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Na));function gp(n,r){r=(r&4)!==0;for(var u=0;u<n.length;u++){var f=n[u],p=f.event;f=f.listeners;e:{var v=void 0;if(r)for(var b=f.length-1;0<=b;b--){var D=f[b],N=D.instance,K=D.currentTarget;if(D=D.listener,N!==v&&p.isPropagationStopped())break e;v=D,p.currentTarget=K;try{v(p)}catch(te){Dl(te)}p.currentTarget=null,v=N}else for(b=0;b<f.length;b++){if(D=f[b],N=D.instance,K=D.currentTarget,D=D.listener,N!==v&&p.isPropagationStopped())break e;v=D,p.currentTarget=K;try{v(p)}catch(te){Dl(te)}p.currentTarget=null,v=N}}}}function Ne(n,r){var u=r[Bu];u===void 0&&(u=r[Bu]=new Set);var f=n+"__bubble";u.has(f)||(pp(r,n,2,!1),u.add(f))}function Df(n,r,u){var f=0;r&&(f|=4),pp(u,n,f,r)}var go="_reactListening"+Math.random().toString(36).slice(2);function If(n){if(!n[go]){n[go]=!0,um.forEach(function(u){u!=="selectionchange"&&(bb.has(u)||Df(u,!1,n),Df(u,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[go]||(r[go]=!0,Df("selectionchange",!1,r))}}function pp(n,r,u,f){switch(Vp(r)){case 2:var p=Wb;break;case 8:p=Zb;break;default:p=zf}u=p.bind(null,r,u,n),p=void 0,!qu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),f?p!==void 0?n.addEventListener(r,u,{capture:!0,passive:p}):n.addEventListener(r,u,!0):p!==void 0?n.addEventListener(r,u,{passive:p}):n.addEventListener(r,u,!1)}function Cf(n,r,u,f,p){var v=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var b=f.tag;if(b===3||b===4){var D=f.stateNode.containerInfo;if(D===p)break;if(b===4)for(b=f.return;b!==null;){var N=b.tag;if((N===3||N===4)&&b.stateNode.containerInfo===p)return;b=b.return}for(;D!==null;){if(b=Ys(D),b===null)return;if(N=b.tag,N===5||N===6||N===26||N===27){f=v=b;continue e}D=D.parentNode}}f=f.return}Tm(function(){var K=v,te=Ku(u),se=[];e:{var Y=Xm.get(n);if(Y!==void 0){var Z=Rl,pe=n;switch(n){case"keypress":if(bl(u)===0)break e;case"keydown":case"keyup":Z=px;break;case"focusin":pe="focus",Z=Zu;break;case"focusout":pe="blur",Z=Zu;break;case"beforeblur":case"afterblur":Z=Zu;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=Am;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=sx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=Ex;break;case Vm:case Km:case Ym:Z=lx;break;case qm:Z=Tx;break;case"scroll":case"scrollend":Z=ix;break;case"wheel":Z=bx;break;case"copy":case"cut":case"paste":Z=ux;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=Lm;break;case"toggle":case"beforetoggle":Z=Rx}var xe=(r&4)!==0,Ze=!xe&&(n==="scroll"||n==="scrollend"),j=xe?Y!==null?Y+"Capture":null:Y;xe=[];for(var B=K,V;B!==null;){var ne=B;if(V=ne.stateNode,ne=ne.tag,ne!==5&&ne!==26&&ne!==27||V===null||j===null||(ne=ia(B,j),ne!=null&&xe.push(ka(B,ne,V))),Ze)break;B=B.return}0<xe.length&&(Y=new Z(Y,pe,null,u,te),se.push({event:Y,listeners:xe}))}}if((r&7)===0){e:{if(Y=n==="mouseover"||n==="pointerover",Z=n==="mouseout"||n==="pointerout",Y&&u!==Vu&&(pe=u.relatedTarget||u.fromElement)&&(Ys(pe)||pe[Ks]))break e;if((Z||Y)&&(Y=te.window===te?te:(Y=te.ownerDocument)?Y.defaultView||Y.parentWindow:window,Z?(pe=u.relatedTarget||u.toElement,Z=K,pe=pe?Ys(pe):null,pe!==null&&(Ze=l(pe),xe=pe.tag,pe!==Ze||xe!==5&&xe!==27&&xe!==6)&&(pe=null)):(Z=null,pe=K),Z!==pe)){if(xe=Am,ne="onMouseLeave",j="onMouseEnter",B="mouse",(n==="pointerout"||n==="pointerover")&&(xe=Lm,ne="onPointerLeave",j="onPointerEnter",B="pointer"),Ze=Z==null?Y:ta(Z),V=pe==null?Y:ta(pe),Y=new xe(ne,B+"leave",Z,u,te),Y.target=Ze,Y.relatedTarget=V,ne=null,Ys(te)===K&&(xe=new xe(j,B+"enter",pe,u,te),xe.target=V,xe.relatedTarget=Ze,ne=xe),Ze=ne,Z&&pe)t:{for(xe=Ab,j=Z,B=pe,V=0,ne=j;ne;ne=xe(ne))V++;ne=0;for(var Te=B;Te;Te=xe(Te))ne++;for(;0<V-ne;)j=xe(j),V--;for(;0<ne-V;)B=xe(B),ne--;for(;V--;){if(j===B||B!==null&&j===B.alternate){xe=j;break t}j=xe(j),B=xe(B)}xe=null}else xe=null;Z!==null&&yp(se,Y,Z,xe,!1),pe!==null&&Ze!==null&&yp(se,Ze,pe,xe,!0)}}e:{if(Y=K?ta(K):window,Z=Y.nodeName&&Y.nodeName.toLowerCase(),Z==="select"||Z==="input"&&Y.type==="file")var je=Nm;else if(wm(Y))if(km)je=kx;else{je=Mx;var ve=wx}else Z=Y.nodeName,!Z||Z.toLowerCase()!=="input"||Y.type!=="checkbox"&&Y.type!=="radio"?K&&zu(K.elementType)&&(je=Nm):je=Nx;if(je&&(je=je(n,K))){Mm(se,je,u,te);break e}ve&&ve(n,Y,K),n==="focusout"&&K&&Y.type==="number"&&K.memoizedProps.value!=null&&Hu(Y,"number",Y.value)}switch(ve=K?ta(K):window,n){case"focusin":(wm(ve)||ve.contentEditable==="true")&&(ir=ve,sc=K,ca=null);break;case"focusout":ca=sc=ir=null;break;case"mousedown":rc=!0;break;case"contextmenu":case"mouseup":case"dragend":rc=!1,Hm(se,u,te);break;case"selectionchange":if(Ux)break;case"keydown":case"keyup":Hm(se,u,te)}var Ie;if(ec)e:{switch(n){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else tr?Cm(n,u)&&(Ue="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(Ue="onCompositionStart");Ue&&(_m&&u.locale!=="ko"&&(tr||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&tr&&(Ie=xm()):(Bn=te,Xu="value"in Bn?Bn.value:Bn.textContent,tr=!0)),ve=po(K,Ue),0<ve.length&&(Ue=new Rm(Ue,n,null,u,te),se.push({event:Ue,listeners:ve}),Ie?Ue.data=Ie:(Ie=Om(u),Ie!==null&&(Ue.data=Ie)))),(Ie=_x?Dx(n,u):Ix(n,u))&&(Ue=po(K,"onBeforeInput"),0<Ue.length&&(ve=new Rm("onBeforeInput","beforeinput",null,u,te),se.push({event:ve,listeners:Ue}),ve.data=Ie)),Sb(se,n,K,u,te)}gp(se,r)})}function ka(n,r,u){return{instance:n,listener:r,currentTarget:u}}function po(n,r){for(var u=r+"Capture",f=[];n!==null;){var p=n,v=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||v===null||(p=ia(n,u),p!=null&&f.unshift(ka(n,p,v)),p=ia(n,r),p!=null&&f.push(ka(n,p,v))),n.tag===3)return f;n=n.return}return[]}function Ab(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function yp(n,r,u,f,p){for(var v=r._reactName,b=[];u!==null&&u!==f;){var D=u,N=D.alternate,K=D.stateNode;if(D=D.tag,N!==null&&N===f)break;D!==5&&D!==26&&D!==27||K===null||(N=K,p?(K=ia(u,v),K!=null&&b.unshift(ka(u,K,N))):p||(K=ia(u,v),K!=null&&b.push(ka(u,K,N)))),u=u.return}b.length!==0&&n.push({event:r,listeners:b})}var Rb=/\r\n?/g,Lb=/\u0000|\uFFFD/g;function vp(n){return(typeof n=="string"?n:""+n).replace(Rb,`
`).replace(Lb,"")}function Ep(n,r){return r=vp(r),vp(n)===r}function We(n,r,u,f,p,v){switch(u){case"children":typeof f=="string"?r==="body"||r==="textarea"&&f===""||Zs(n,f):(typeof f=="number"||typeof f=="bigint")&&r!=="body"&&Zs(n,""+f);break;case"className":El(n,"class",f);break;case"tabIndex":El(n,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":El(n,u,f);break;case"style":Em(n,f,v);break;case"data":if(r!=="object"){El(n,"data",f);break}case"src":case"href":if(f===""&&(r!=="a"||u!=="href")){n.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){n.removeAttribute(u);break}f=Tl(""+f),n.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){n.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(u==="formAction"?(r!=="input"&&We(n,r,"name",p.name,p,null),We(n,r,"formEncType",p.formEncType,p,null),We(n,r,"formMethod",p.formMethod,p,null),We(n,r,"formTarget",p.formTarget,p,null)):(We(n,r,"encType",p.encType,p,null),We(n,r,"method",p.method,p,null),We(n,r,"target",p.target,p,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){n.removeAttribute(u);break}f=Tl(""+f),n.setAttribute(u,f);break;case"onClick":f!=null&&(n.onclick=cn);break;case"onScroll":f!=null&&Ne("scroll",n);break;case"onScrollEnd":f!=null&&Ne("scrollend",n);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(u=f.__html,u!=null){if(p.children!=null)throw Error(i(60));n.innerHTML=u}}break;case"multiple":n.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":n.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){n.removeAttribute("xlink:href");break}u=Tl(""+f),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?n.setAttribute(u,""+f):n.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?n.setAttribute(u,""):n.removeAttribute(u);break;case"capture":case"download":f===!0?n.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?n.setAttribute(u,f):n.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?n.setAttribute(u,f):n.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?n.removeAttribute(u):n.setAttribute(u,f);break;case"popover":Ne("beforetoggle",n),Ne("toggle",n),vl(n,"popover",f);break;case"xlinkActuate":un(n,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":un(n,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":un(n,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":un(n,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":un(n,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":un(n,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":un(n,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":un(n,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":un(n,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":vl(n,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=ex.get(u)||u,vl(n,u,f))}}function Of(n,r,u,f,p,v){switch(u){case"style":Em(n,f,v);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(u=f.__html,u!=null){if(p.children!=null)throw Error(i(60));n.innerHTML=u}}break;case"children":typeof f=="string"?Zs(n,f):(typeof f=="number"||typeof f=="bigint")&&Zs(n,""+f);break;case"onScroll":f!=null&&Ne("scroll",n);break;case"onScrollEnd":f!=null&&Ne("scrollend",n);break;case"onClick":f!=null&&(n.onclick=cn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!cm.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(p=u.endsWith("Capture"),r=u.slice(2,p?u.length-7:void 0),v=n[qt]||null,v=v!=null?v[u]:null,typeof v=="function"&&n.removeEventListener(r,v,p),typeof f=="function")){typeof v!="function"&&v!==null&&(u in n?n[u]=null:n.hasAttribute(u)&&n.removeAttribute(u)),n.addEventListener(r,f,p);break e}u in n?n[u]=f:f===!0?n.setAttribute(u,""):vl(n,u,f)}}}function Pt(n,r,u){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ne("error",n),Ne("load",n);var f=!1,p=!1,v;for(v in u)if(u.hasOwnProperty(v)){var b=u[v];if(b!=null)switch(v){case"src":f=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:We(n,r,v,b,u,null)}}p&&We(n,r,"srcSet",u.srcSet,u,null),f&&We(n,r,"src",u.src,u,null);return;case"input":Ne("invalid",n);var D=v=b=p=null,N=null,K=null;for(f in u)if(u.hasOwnProperty(f)){var te=u[f];if(te!=null)switch(f){case"name":p=te;break;case"type":b=te;break;case"checked":N=te;break;case"defaultChecked":K=te;break;case"value":v=te;break;case"defaultValue":D=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(i(137,r));break;default:We(n,r,f,te,u,null)}}gm(n,v,D,N,K,b,p,!1);return;case"select":Ne("invalid",n),f=b=v=null;for(p in u)if(u.hasOwnProperty(p)&&(D=u[p],D!=null))switch(p){case"value":v=D;break;case"defaultValue":b=D;break;case"multiple":f=D;default:We(n,r,p,D,u,null)}r=v,u=b,n.multiple=!!f,r!=null?Ws(n,!!f,r,!1):u!=null&&Ws(n,!!f,u,!0);return;case"textarea":Ne("invalid",n),v=p=f=null;for(b in u)if(u.hasOwnProperty(b)&&(D=u[b],D!=null))switch(b){case"value":f=D;break;case"defaultValue":p=D;break;case"children":v=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(i(91));break;default:We(n,r,b,D,u,null)}ym(n,f,p,v);return;case"option":for(N in u)if(u.hasOwnProperty(N)&&(f=u[N],f!=null))switch(N){case"selected":n.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:We(n,r,N,f,u,null)}return;case"dialog":Ne("beforetoggle",n),Ne("toggle",n),Ne("cancel",n),Ne("close",n);break;case"iframe":case"object":Ne("load",n);break;case"video":case"audio":for(f=0;f<Na.length;f++)Ne(Na[f],n);break;case"image":Ne("error",n),Ne("load",n);break;case"details":Ne("toggle",n);break;case"embed":case"source":case"link":Ne("error",n),Ne("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(K in u)if(u.hasOwnProperty(K)&&(f=u[K],f!=null))switch(K){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:We(n,r,K,f,u,null)}return;default:if(zu(r)){for(te in u)u.hasOwnProperty(te)&&(f=u[te],f!==void 0&&Of(n,r,te,f,u,void 0));return}}for(D in u)u.hasOwnProperty(D)&&(f=u[D],f!=null&&We(n,r,D,f,u,null))}function _b(n,r,u,f){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,v=null,b=null,D=null,N=null,K=null,te=null;for(Z in u){var se=u[Z];if(u.hasOwnProperty(Z)&&se!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":N=se;default:f.hasOwnProperty(Z)||We(n,r,Z,null,f,se)}}for(var Y in f){var Z=f[Y];if(se=u[Y],f.hasOwnProperty(Y)&&(Z!=null||se!=null))switch(Y){case"type":v=Z;break;case"name":p=Z;break;case"checked":K=Z;break;case"defaultChecked":te=Z;break;case"value":b=Z;break;case"defaultValue":D=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,r));break;default:Z!==se&&We(n,r,Y,Z,f,se)}}ju(n,b,D,N,K,te,v,p);return;case"select":Z=b=D=Y=null;for(v in u)if(N=u[v],u.hasOwnProperty(v)&&N!=null)switch(v){case"value":break;case"multiple":Z=N;default:f.hasOwnProperty(v)||We(n,r,v,null,f,N)}for(p in f)if(v=f[p],N=u[p],f.hasOwnProperty(p)&&(v!=null||N!=null))switch(p){case"value":Y=v;break;case"defaultValue":D=v;break;case"multiple":b=v;default:v!==N&&We(n,r,p,v,f,N)}r=D,u=b,f=Z,Y!=null?Ws(n,!!u,Y,!1):!!f!=!!u&&(r!=null?Ws(n,!!u,r,!0):Ws(n,!!u,u?[]:"",!1));return;case"textarea":Z=Y=null;for(D in u)if(p=u[D],u.hasOwnProperty(D)&&p!=null&&!f.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:We(n,r,D,null,f,p)}for(b in f)if(p=f[b],v=u[b],f.hasOwnProperty(b)&&(p!=null||v!=null))switch(b){case"value":Y=p;break;case"defaultValue":Z=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==v&&We(n,r,b,p,f,v)}pm(n,Y,Z);return;case"option":for(var pe in u)if(Y=u[pe],u.hasOwnProperty(pe)&&Y!=null&&!f.hasOwnProperty(pe))switch(pe){case"selected":n.selected=!1;break;default:We(n,r,pe,null,f,Y)}for(N in f)if(Y=f[N],Z=u[N],f.hasOwnProperty(N)&&Y!==Z&&(Y!=null||Z!=null))switch(N){case"selected":n.selected=Y&&typeof Y!="function"&&typeof Y!="symbol";break;default:We(n,r,N,Y,f,Z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var xe in u)Y=u[xe],u.hasOwnProperty(xe)&&Y!=null&&!f.hasOwnProperty(xe)&&We(n,r,xe,null,f,Y);for(K in f)if(Y=f[K],Z=u[K],f.hasOwnProperty(K)&&Y!==Z&&(Y!=null||Z!=null))switch(K){case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(i(137,r));break;default:We(n,r,K,Y,f,Z)}return;default:if(zu(r)){for(var Ze in u)Y=u[Ze],u.hasOwnProperty(Ze)&&Y!==void 0&&!f.hasOwnProperty(Ze)&&Of(n,r,Ze,void 0,f,Y);for(te in f)Y=f[te],Z=u[te],!f.hasOwnProperty(te)||Y===Z||Y===void 0&&Z===void 0||Of(n,r,te,Y,f,Z);return}}for(var j in u)Y=u[j],u.hasOwnProperty(j)&&Y!=null&&!f.hasOwnProperty(j)&&We(n,r,j,null,f,Y);for(se in f)Y=f[se],Z=u[se],!f.hasOwnProperty(se)||Y===Z||Y==null&&Z==null||We(n,r,se,Y,f,Z)}function Sp(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Db(){if(typeof performance.getEntriesByType=="function"){for(var n=0,r=0,u=performance.getEntriesByType("resource"),f=0;f<u.length;f++){var p=u[f],v=p.transferSize,b=p.initiatorType,D=p.duration;if(v&&D&&Sp(b)){for(b=0,D=p.responseEnd,f+=1;f<u.length;f++){var N=u[f],K=N.startTime;if(K>D)break;var te=N.transferSize,se=N.initiatorType;te&&Sp(se)&&(N=N.responseEnd,b+=te*(N<D?1:(D-K)/(N-K)))}if(--f,r+=8*(v+b)/(p.duration/1e3),n++,10<n)break}}if(0<n)return r/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var wf=null,Mf=null;function yo(n){return n.nodeType===9?n:n.ownerDocument}function Tp(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xp(n,r){if(n===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&r==="foreignObject"?0:n}function Nf(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var kf=null;function Ib(){var n=window.event;return n&&n.type==="popstate"?n===kf?!1:(kf=n,!0):(kf=null,!1)}var bp=typeof setTimeout=="function"?setTimeout:void 0,Cb=typeof clearTimeout=="function"?clearTimeout:void 0,Ap=typeof Promise=="function"?Promise:void 0,Ob=typeof queueMicrotask=="function"?queueMicrotask:typeof Ap<"u"?function(n){return Ap.resolve(null).then(n).catch(wb)}:bp;function wb(n){setTimeout(function(){throw n})}function is(n){return n==="head"}function Rp(n,r){var u=r,f=0;do{var p=u.nextSibling;if(n.removeChild(u),p&&p.nodeType===8)if(u=p.data,u==="/$"||u==="/&"){if(f===0){n.removeChild(p),Ir(r);return}f--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")f++;else if(u==="html")Pa(n.ownerDocument.documentElement);else if(u==="head"){u=n.ownerDocument.head,Pa(u);for(var v=u.firstChild;v;){var b=v.nextSibling,D=v.nodeName;v[ea]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&v.rel.toLowerCase()==="stylesheet"||u.removeChild(v),v=b}}else u==="body"&&Pa(n.ownerDocument.body);u=p}while(u);Ir(r)}function Lp(n,r){var u=n;n=0;do{var f=u.nextSibling;if(u.nodeType===1?r?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(r?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),f&&f.nodeType===8)if(u=f.data,u==="/$"){if(n===0)break;n--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||n++;u=f}while(u)}function Pf(n){var r=n.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var u=r;switch(r=r.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Pf(u),$u(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}n.removeChild(u)}}function Mb(n,r,u,f){for(;n.nodeType===1;){var p=u;if(n.nodeName.toLowerCase()!==r.toLowerCase()){if(!f&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(f){if(!n[ea])switch(r){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(v=n.getAttribute("rel"),v==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(v!==p.rel||n.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||n.getAttribute("title")!==(p.title==null?null:p.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(v=n.getAttribute("src"),(v!==(p.src==null?null:p.src)||n.getAttribute("type")!==(p.type==null?null:p.type)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&v&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(r==="input"&&n.type==="hidden"){var v=p.name==null?null:""+p.name;if(p.type==="hidden"&&n.getAttribute("name")===v)return n}else return n;if(n=Ci(n.nextSibling),n===null)break}return null}function Nb(n,r,u){if(r==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!u||(n=Ci(n.nextSibling),n===null))return null;return n}function _p(n,r){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!r||(n=Ci(n.nextSibling),n===null))return null;return n}function Uf(n){return n.data==="$?"||n.data==="$~"}function Ff(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function kb(n,r){var u=n.ownerDocument;if(n.data==="$~")n._reactRetry=r;else if(n.data!=="$?"||u.readyState!=="loading")r();else{var f=function(){r(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),n._reactRetry=f}}function Ci(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return n}var Bf=null;function Dp(n){n=n.nextSibling;for(var r=0;n;){if(n.nodeType===8){var u=n.data;if(u==="/$"||u==="/&"){if(r===0)return Ci(n.nextSibling);r--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||r++}n=n.nextSibling}return null}function Ip(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(r===0)return n;r--}else u!=="/$"&&u!=="/&"||r++}n=n.previousSibling}return null}function Cp(n,r,u){switch(r=yo(u),n){case"html":if(n=r.documentElement,!n)throw Error(i(452));return n;case"head":if(n=r.head,!n)throw Error(i(453));return n;case"body":if(n=r.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function Pa(n){for(var r=n.attributes;r.length;)n.removeAttributeNode(r[0]);$u(n)}var Oi=new Map,Op=new Set;function vo(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Ln=X.d;X.d={f:Pb,r:Ub,D:Fb,C:Bb,L:$b,m:Gb,X:Hb,S:jb,M:zb};function Pb(){var n=Ln.f(),r=oo();return n||r}function Ub(n){var r=qs(n);r!==null&&r.tag===5&&r.type==="form"?qg(r):Ln.r(n)}var Lr=typeof document>"u"?null:document;function wp(n,r,u){var f=Lr;if(f&&typeof r=="string"&&r){var p=bi(r);p='link[rel="'+n+'"][href="'+p+'"]',typeof u=="string"&&(p+='[crossorigin="'+u+'"]'),Op.has(p)||(Op.add(p),n={rel:n,crossOrigin:u,href:r},f.querySelector(p)===null&&(r=f.createElement("link"),Pt(r,"link",n),Dt(r),f.head.appendChild(r)))}}function Fb(n){Ln.D(n),wp("dns-prefetch",n,null)}function Bb(n,r){Ln.C(n,r),wp("preconnect",n,r)}function $b(n,r,u){Ln.L(n,r,u);var f=Lr;if(f&&n&&r){var p='link[rel="preload"][as="'+bi(r)+'"]';r==="image"&&u&&u.imageSrcSet?(p+='[imagesrcset="'+bi(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(p+='[imagesizes="'+bi(u.imageSizes)+'"]')):p+='[href="'+bi(n)+'"]';var v=p;switch(r){case"style":v=_r(n);break;case"script":v=Dr(n)}Oi.has(v)||(n=g({rel:"preload",href:r==="image"&&u&&u.imageSrcSet?void 0:n,as:r},u),Oi.set(v,n),f.querySelector(p)!==null||r==="style"&&f.querySelector(Ua(v))||r==="script"&&f.querySelector(Fa(v))||(r=f.createElement("link"),Pt(r,"link",n),Dt(r),f.head.appendChild(r)))}}function Gb(n,r){Ln.m(n,r);var u=Lr;if(u&&n){var f=r&&typeof r.as=="string"?r.as:"script",p='link[rel="modulepreload"][as="'+bi(f)+'"][href="'+bi(n)+'"]',v=p;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Dr(n)}if(!Oi.has(v)&&(n=g({rel:"modulepreload",href:n},r),Oi.set(v,n),u.querySelector(p)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Fa(v)))return}f=u.createElement("link"),Pt(f,"link",n),Dt(f),u.head.appendChild(f)}}}function jb(n,r,u){Ln.S(n,r,u);var f=Lr;if(f&&n){var p=Xs(f).hoistableStyles,v=_r(n);r=r||"default";var b=p.get(v);if(!b){var D={loading:0,preload:null};if(b=f.querySelector(Ua(v)))D.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":r},u),(u=Oi.get(v))&&$f(n,u);var N=b=f.createElement("link");Dt(N),Pt(N,"link",n),N._p=new Promise(function(K,te){N.onload=K,N.onerror=te}),N.addEventListener("load",function(){D.loading|=1}),N.addEventListener("error",function(){D.loading|=2}),D.loading|=4,Eo(b,r,f)}b={type:"stylesheet",instance:b,count:1,state:D},p.set(v,b)}}}function Hb(n,r){Ln.X(n,r);var u=Lr;if(u&&n){var f=Xs(u).hoistableScripts,p=Dr(n),v=f.get(p);v||(v=u.querySelector(Fa(p)),v||(n=g({src:n,async:!0},r),(r=Oi.get(p))&&Gf(n,r),v=u.createElement("script"),Dt(v),Pt(v,"link",n),u.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},f.set(p,v))}}function zb(n,r){Ln.M(n,r);var u=Lr;if(u&&n){var f=Xs(u).hoistableScripts,p=Dr(n),v=f.get(p);v||(v=u.querySelector(Fa(p)),v||(n=g({src:n,async:!0,type:"module"},r),(r=Oi.get(p))&&Gf(n,r),v=u.createElement("script"),Dt(v),Pt(v,"link",n),u.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},f.set(p,v))}}function Mp(n,r,u,f){var p=(p=he.current)?vo(p):null;if(!p)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(r=_r(u.href),u=Xs(p).hoistableStyles,f=u.get(r),f||(f={type:"style",instance:null,count:0,state:null},u.set(r,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){n=_r(u.href);var v=Xs(p).hoistableStyles,b=v.get(n);if(b||(p=p.ownerDocument||p,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(n,b),(v=p.querySelector(Ua(n)))&&!v._p&&(b.instance=v,b.state.loading=5),Oi.has(n)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Oi.set(n,u),v||Vb(p,n,u,b.state))),r&&f===null)throw Error(i(528,""));return b}if(r&&f!==null)throw Error(i(529,""));return null;case"script":return r=u.async,u=u.src,typeof u=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Dr(u),u=Xs(p).hoistableScripts,f=u.get(r),f||(f={type:"script",instance:null,count:0,state:null},u.set(r,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function _r(n){return'href="'+bi(n)+'"'}function Ua(n){return'link[rel="stylesheet"]['+n+"]"}function Np(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function Vb(n,r,u,f){n.querySelector('link[rel="preload"][as="style"]['+r+"]")?f.loading=1:(r=n.createElement("link"),f.preload=r,r.addEventListener("load",function(){return f.loading|=1}),r.addEventListener("error",function(){return f.loading|=2}),Pt(r,"link",u),Dt(r),n.head.appendChild(r))}function Dr(n){return'[src="'+bi(n)+'"]'}function Fa(n){return"script[async]"+n}function kp(n,r,u){if(r.count++,r.instance===null)switch(r.type){case"style":var f=n.querySelector('style[data-href~="'+bi(u.href)+'"]');if(f)return r.instance=f,Dt(f),f;var p=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(n.ownerDocument||n).createElement("style"),Dt(f),Pt(f,"style",p),Eo(f,u.precedence,n),r.instance=f;case"stylesheet":p=_r(u.href);var v=n.querySelector(Ua(p));if(v)return r.state.loading|=4,r.instance=v,Dt(v),v;f=Np(u),(p=Oi.get(p))&&$f(f,p),v=(n.ownerDocument||n).createElement("link"),Dt(v);var b=v;return b._p=new Promise(function(D,N){b.onload=D,b.onerror=N}),Pt(v,"link",f),r.state.loading|=4,Eo(v,u.precedence,n),r.instance=v;case"script":return v=Dr(u.src),(p=n.querySelector(Fa(v)))?(r.instance=p,Dt(p),p):(f=u,(p=Oi.get(v))&&(f=g({},u),Gf(f,p)),n=n.ownerDocument||n,p=n.createElement("script"),Dt(p),Pt(p,"link",f),n.head.appendChild(p),r.instance=p);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(f=r.instance,r.state.loading|=4,Eo(f,u.precedence,n));return r.instance}function Eo(n,r,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=f.length?f[f.length-1]:null,v=p,b=0;b<f.length;b++){var D=f[b];if(D.dataset.precedence===r)v=D;else if(v!==p)break}v?v.parentNode.insertBefore(n,v.nextSibling):(r=u.nodeType===9?u.head:u,r.insertBefore(n,r.firstChild))}function $f(n,r){n.crossOrigin==null&&(n.crossOrigin=r.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=r.referrerPolicy),n.title==null&&(n.title=r.title)}function Gf(n,r){n.crossOrigin==null&&(n.crossOrigin=r.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=r.referrerPolicy),n.integrity==null&&(n.integrity=r.integrity)}var So=null;function Pp(n,r,u){if(So===null){var f=new Map,p=So=new Map;p.set(u,f)}else p=So,f=p.get(u),f||(f=new Map,p.set(u,f));if(f.has(n))return f;for(f.set(n,null),u=u.getElementsByTagName(n),p=0;p<u.length;p++){var v=u[p];if(!(v[ea]||v[wt]||n==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var b=v.getAttribute(r)||"";b=n+b;var D=f.get(b);D?D.push(v):f.set(b,[v])}}return f}function Up(n,r,u){n=n.ownerDocument||n,n.head.insertBefore(u,r==="title"?n.querySelector("head > title"):null)}function Kb(n,r,u){if(u===1||r.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return n=r.disabled,typeof r.precedence=="string"&&n==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Fp(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function Yb(n,r,u,f){if(u.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var p=_r(f.href),v=r.querySelector(Ua(p));if(v){r=v._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(n.count++,n=To.bind(n),r.then(n,n)),u.state.loading|=4,u.instance=v,Dt(v);return}v=r.ownerDocument||r,f=Np(f),(p=Oi.get(p))&&$f(f,p),v=v.createElement("link"),Dt(v);var b=v;b._p=new Promise(function(D,N){b.onload=D,b.onerror=N}),Pt(v,"link",f),u.instance=v}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(u,r),(r=u.state.preload)&&(u.state.loading&3)===0&&(n.count++,u=To.bind(n),r.addEventListener("load",u),r.addEventListener("error",u))}}var jf=0;function qb(n,r){return n.stylesheets&&n.count===0&&bo(n,n.stylesheets),0<n.count||0<n.imgCount?function(u){var f=setTimeout(function(){if(n.stylesheets&&bo(n,n.stylesheets),n.unsuspend){var v=n.unsuspend;n.unsuspend=null,v()}},6e4+r);0<n.imgBytes&&jf===0&&(jf=62500*Db());var p=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&bo(n,n.stylesheets),n.unsuspend)){var v=n.unsuspend;n.unsuspend=null,v()}},(n.imgBytes>jf?50:800)+r);return n.unsuspend=u,function(){n.unsuspend=null,clearTimeout(f),clearTimeout(p)}}:null}function To(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)bo(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var xo=null;function bo(n,r){n.stylesheets=null,n.unsuspend!==null&&(n.count++,xo=new Map,r.forEach(Xb,n),xo=null,To.call(n))}function Xb(n,r){if(!(r.state.loading&4)){var u=xo.get(n);if(u)var f=u.get(null);else{u=new Map,xo.set(n,u);for(var p=n.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<p.length;v++){var b=p[v];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(u.set(b.dataset.precedence,b),f=b)}f&&u.set(null,f)}p=r.instance,b=p.getAttribute("data-precedence"),v=u.get(b)||f,v===f&&u.set(null,p),u.set(b,p),this.count++,f=To.bind(this),p.addEventListener("load",f),p.addEventListener("error",f),v?v.parentNode.insertBefore(p,v.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(p,n.firstChild)),r.state.loading|=4}}var Ba={$$typeof:_,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function Qb(n,r,u,f,p,v,b,D,N){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Pu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pu(0),this.hiddenUpdates=Pu(null),this.identifierPrefix=f,this.onUncaughtError=p,this.onCaughtError=v,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=N,this.incompleteTransitions=new Map}function Bp(n,r,u,f,p,v,b,D,N,K,te,se){return n=new Qb(n,r,u,b,N,K,te,se,D),r=1,v===!0&&(r|=24),v=ui(3,null,null,r),n.current=v,v.stateNode=n,r=Sc(),r.refCount++,n.pooledCache=r,r.refCount++,v.memoizedState={element:f,isDehydrated:u,cache:r},Ac(v),n}function $p(n){return n?(n=rr,n):rr}function Gp(n,r,u,f,p,v){p=$p(p),f.context===null?f.context=p:f.pendingContext=p,f=Vn(r),f.payload={element:u},v=v===void 0?null:v,v!==null&&(f.callback=v),u=Kn(n,f,r),u!==null&&(ei(u,n,r),ya(u,n,r))}function jp(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<r?u:r}}function Hf(n,r){jp(n,r),(n=n.alternate)&&jp(n,r)}function Hp(n){if(n.tag===13||n.tag===31){var r=As(n,67108864);r!==null&&ei(r,n,67108864),Hf(n,67108864)}}function zp(n){if(n.tag===13||n.tag===31){var r=mi();r=Uu(r);var u=As(n,r);u!==null&&ei(u,n,r),Hf(n,r)}}var Ao=!0;function Wb(n,r,u,f){var p=k.T;k.T=null;var v=X.p;try{X.p=2,zf(n,r,u,f)}finally{X.p=v,k.T=p}}function Zb(n,r,u,f){var p=k.T;k.T=null;var v=X.p;try{X.p=8,zf(n,r,u,f)}finally{X.p=v,k.T=p}}function zf(n,r,u,f){if(Ao){var p=Vf(f);if(p===null)Cf(n,r,f,Ro,u),Kp(n,f);else if(eA(p,n,r,u,f))f.stopPropagation();else if(Kp(n,f),r&4&&-1<Jb.indexOf(n)){for(;p!==null;){var v=qs(p);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var b=Es(v.pendingLanes);if(b!==0){var D=v;for(D.pendingLanes|=2,D.entangledLanes|=2;b;){var N=1<<31-li(b);D.entanglements[1]|=N,b&=~N}Yi(v),(ze&6)===0&&(ao=Xe()+500,Ma(0))}}break;case 31:case 13:D=As(v,2),D!==null&&ei(D,v,2),oo(),Hf(v,2)}if(v=Vf(f),v===null&&Cf(n,r,f,Ro,u),v===p)break;p=v}p!==null&&f.stopPropagation()}else Cf(n,r,f,null,u)}}function Vf(n){return n=Ku(n),Kf(n)}var Ro=null;function Kf(n){if(Ro=null,n=Ys(n),n!==null){var r=l(n);if(r===null)n=null;else{var u=r.tag;if(u===13){if(n=o(r),n!==null)return n;n=null}else if(u===31){if(n=c(r),n!==null)return n;n=null}else if(u===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}return Ro=n,null}function Vp(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vs()){case Ni:return 2;case Pn:return 8;case At:case Yt:return 32;case ln:return 268435456;default:return 32}default:return 32}}var Yf=!1,ns=null,ss=null,rs=null,$a=new Map,Ga=new Map,as=[],Jb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Kp(n,r){switch(n){case"focusin":case"focusout":ns=null;break;case"dragenter":case"dragleave":ss=null;break;case"mouseover":case"mouseout":rs=null;break;case"pointerover":case"pointerout":$a.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ga.delete(r.pointerId)}}function ja(n,r,u,f,p,v){return n===null||n.nativeEvent!==v?(n={blockedOn:r,domEventName:u,eventSystemFlags:f,nativeEvent:v,targetContainers:[p]},r!==null&&(r=qs(r),r!==null&&Hp(r)),n):(n.eventSystemFlags|=f,r=n.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),n)}function eA(n,r,u,f,p){switch(r){case"focusin":return ns=ja(ns,n,r,u,f,p),!0;case"dragenter":return ss=ja(ss,n,r,u,f,p),!0;case"mouseover":return rs=ja(rs,n,r,u,f,p),!0;case"pointerover":var v=p.pointerId;return $a.set(v,ja($a.get(v)||null,n,r,u,f,p)),!0;case"gotpointercapture":return v=p.pointerId,Ga.set(v,ja(Ga.get(v)||null,n,r,u,f,p)),!0}return!1}function Yp(n){var r=Ys(n.target);if(r!==null){var u=l(r);if(u!==null){if(r=u.tag,r===13){if(r=o(u),r!==null){n.blockedOn=r,lm(n.priority,function(){zp(u)});return}}else if(r===31){if(r=c(u),r!==null){n.blockedOn=r,lm(n.priority,function(){zp(u)});return}}else if(r===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Lo(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var u=Vf(n.nativeEvent);if(u===null){u=n.nativeEvent;var f=new u.constructor(u.type,u);Vu=f,u.target.dispatchEvent(f),Vu=null}else return r=qs(u),r!==null&&Hp(r),n.blockedOn=u,!1;r.shift()}return!0}function qp(n,r,u){Lo(n)&&u.delete(r)}function tA(){Yf=!1,ns!==null&&Lo(ns)&&(ns=null),ss!==null&&Lo(ss)&&(ss=null),rs!==null&&Lo(rs)&&(rs=null),$a.forEach(qp),Ga.forEach(qp)}function _o(n,r){n.blockedOn===r&&(n.blockedOn=null,Yf||(Yf=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,tA)))}var Do=null;function Xp(n){Do!==n&&(Do=n,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){Do===n&&(Do=null);for(var r=0;r<n.length;r+=3){var u=n[r],f=n[r+1],p=n[r+2];if(typeof f!="function"){if(Kf(f||u)===null)continue;break}var v=qs(u);v!==null&&(n.splice(r,3),r-=3,zc(v,{pending:!0,data:p,method:u.method,action:f},f,p))}}))}function Ir(n){function r(N){return _o(N,n)}ns!==null&&_o(ns,n),ss!==null&&_o(ss,n),rs!==null&&_o(rs,n),$a.forEach(r),Ga.forEach(r);for(var u=0;u<as.length;u++){var f=as[u];f.blockedOn===n&&(f.blockedOn=null)}for(;0<as.length&&(u=as[0],u.blockedOn===null);)Yp(u),u.blockedOn===null&&as.shift();if(u=(n.ownerDocument||n).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var p=u[f],v=u[f+1],b=p[qt]||null;if(typeof v=="function")b||Xp(u);else if(b){var D=null;if(v&&v.hasAttribute("formAction")){if(p=v,b=v[qt]||null)D=b.formAction;else if(Kf(p)!==null)continue}else D=b.action;typeof D=="function"?u[f+1]=D:(u.splice(f,3),f-=3),Xp(u)}}}function Qp(){function n(v){v.canIntercept&&v.info==="react-transition"&&v.intercept({handler:function(){return new Promise(function(b){return p=b})},focusReset:"manual",scroll:"manual"})}function r(){p!==null&&(p(),p=null),f||setTimeout(u,20)}function u(){if(!f&&!navigation.transition){var v=navigation.currentEntry;v&&v.url!=null&&navigation.navigate(v.url,{state:v.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,p=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(u,100),function(){f=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),p!==null&&(p(),p=null)}}}function qf(n){this._internalRoot=n}Io.prototype.render=qf.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(i(409));var u=r.current,f=mi();Gp(u,f,n,r,null,null)},Io.prototype.unmount=qf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;Gp(n.current,2,null,n,null,null),oo(),r[Ks]=null}};function Io(n){this._internalRoot=n}Io.prototype.unstable_scheduleHydration=function(n){if(n){var r=am();n={blockedOn:null,target:n,priority:r};for(var u=0;u<as.length&&r!==0&&r<as[u].priority;u++);as.splice(u,0,n),u===0&&Yp(n)}};var Wp=e.version;if(Wp!=="19.2.1")throw Error(i(527,Wp,"19.2.1"));X.findDOMNode=function(n){var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=d(r),n=n!==null?m(n):null,n=n===null?null:n.stateNode,n};var iA={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Co=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Co.isDisabled&&Co.supportsFiber)try{Wr=Co.inject(iA),ai=Co}catch{}}return za.createRoot=function(n,r){if(!a(n))throw Error(i(299));var u=!1,f="",p=s0,v=r0,b=a0;return r!=null&&(r.unstable_strictMode===!0&&(u=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(v=r.onCaughtError),r.onRecoverableError!==void 0&&(b=r.onRecoverableError)),r=Bp(n,1,!1,null,null,u,f,null,p,v,b,Qp),n[Ks]=r.current,If(n),new qf(r)},za.hydrateRoot=function(n,r,u){if(!a(n))throw Error(i(299));var f=!1,p="",v=s0,b=r0,D=a0,N=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(p=u.identifierPrefix),u.onUncaughtError!==void 0&&(v=u.onUncaughtError),u.onCaughtError!==void 0&&(b=u.onCaughtError),u.onRecoverableError!==void 0&&(D=u.onRecoverableError),u.formState!==void 0&&(N=u.formState)),r=Bp(n,1,!0,r,u??null,f,p,N,v,b,D,Qp),r.context=$p(null),u=r.current,f=mi(),f=Uu(f),p=Vn(f),p.callback=null,Kn(u,p,f),u=f,r.current.lanes=u,Jr(r,u),Yi(r),n[Ks]=r.current,If(n),new Io(r)},za.version="19.2.1",za}var ly;function hA(){if(ly)return Wf.exports;ly=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Wf.exports=dA(),Wf.exports}var mA=hA();var oy="popstate";function gA(s={}){function e(i,a){let{pathname:l,search:o,hash:c}=i.location;return Bd("",{pathname:l,search:o,hash:c},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(i,a){return typeof a=="string"?a:Za(a)}return yA(e,t,null,s)}function ct(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function $i(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function pA(){return Math.random().toString(36).substring(2,10)}function uy(s,e){return{usr:s.state,key:s.key,idx:e}}function Bd(s,e,t=null,i){return{pathname:typeof s=="string"?s:s.pathname,search:"",hash:"",...typeof e=="string"?Vr(e):e,state:t,key:e&&e.key||i||pA()}}function Za({pathname:s="/",search:e="",hash:t=""}){return e&&e!=="?"&&(s+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(s+=t.charAt(0)==="#"?t:"#"+t),s}function Vr(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substring(t),s=s.substring(0,t));let i=s.indexOf("?");i>=0&&(e.search=s.substring(i),s=s.substring(0,i)),s&&(e.pathname=s)}return e}function yA(s,e,t,i={}){let{window:a=document.defaultView,v5Compat:l=!1}=i,o=a.history,c="POP",h=null,d=m();d==null&&(d=0,o.replaceState({...o.state,idx:d},""));function m(){return(o.state||{idx:null}).idx}function g(){c="POP";let T=m(),R=T==null?null:T-d;d=T,h&&h({action:c,location:x.location,delta:R})}function y(T,R){c="PUSH";let L=Bd(x.location,T,R);d=m()+1;let _=uy(L,d),O=x.createHref(L);try{o.pushState(_,"",O)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;a.location.assign(O)}l&&h&&h({action:c,location:x.location,delta:1})}function S(T,R){c="REPLACE";let L=Bd(x.location,T,R);d=m();let _=uy(L,d),O=x.createHref(L);o.replaceState(_,"",O),l&&h&&h({action:c,location:x.location,delta:0})}function E(T){return vA(T)}let x={get action(){return c},get location(){return s(a,o)},listen(T){if(h)throw new Error("A history only accepts one active listener");return a.addEventListener(oy,g),h=T,()=>{a.removeEventListener(oy,g),h=null}},createHref(T){return e(a,T)},createURL:E,encodeLocation(T){let R=E(T);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:y,replace:S,go(T){return o.go(T)}};return x}function vA(s,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),ct(t,"No window.location.(origin|href) available to create URL");let i=typeof s=="string"?s:Za(s);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function fE(s,e,t="/"){return EA(s,e,t,!1)}function EA(s,e,t,i){let a=typeof e=="string"?Vr(e):e,l=kn(a.pathname||"/",t);if(l==null)return null;let o=dE(s);SA(o);let c=null;for(let h=0;c==null&&h<o.length;++h){let d=OA(l);c=IA(o[h],d,i)}return c}function dE(s,e=[],t=[],i="",a=!1){let l=(o,c,h=a,d)=>{let m={relativePath:d===void 0?o.path||"":d,caseSensitive:o.caseSensitive===!0,childrenIndex:c,route:o};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(i)&&h)return;ct(m.relativePath.startsWith(i),`Absolute route path "${m.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(i.length)}let g=Mn([i,m.relativePath]),y=t.concat(m);o.children&&o.children.length>0&&(ct(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),dE(o.children,e,y,g,h)),!(o.path==null&&!o.index)&&e.push({path:g,score:_A(g,o.index),routesMeta:y})};return s.forEach((o,c)=>{if(o.path===""||!o.path?.includes("?"))l(o,c);else for(let h of hE(o.path))l(o,c,!0,h)}),e}function hE(s){let e=s.split("/");if(e.length===0)return[];let[t,...i]=e,a=t.endsWith("?"),l=t.replace(/\?$/,"");if(i.length===0)return a?[l,""]:[l];let o=hE(i.join("/")),c=[];return c.push(...o.map(h=>h===""?l:[l,h].join("/"))),a&&c.push(...o),c.map(h=>s.startsWith("/")&&h===""?"/":h)}function SA(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:DA(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var TA=/^:[\w-]+$/,xA=3,bA=2,AA=1,RA=10,LA=-2,cy=s=>s==="*";function _A(s,e){let t=s.split("/"),i=t.length;return t.some(cy)&&(i+=LA),e&&(i+=bA),t.filter(a=>!cy(a)).reduce((a,l)=>a+(TA.test(l)?xA:l===""?AA:RA),i)}function DA(s,e){return s.length===e.length&&s.slice(0,-1).every((i,a)=>i===e[a])?s[s.length-1]-e[e.length-1]:0}function IA(s,e,t=!1){let{routesMeta:i}=s,a={},l="/",o=[];for(let c=0;c<i.length;++c){let h=i[c],d=c===i.length-1,m=l==="/"?e:e.slice(l.length)||"/",g=uu({path:h.relativePath,caseSensitive:h.caseSensitive,end:d},m),y=h.route;if(!g&&d&&t&&!i[i.length-1].route.index&&(g=uu({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},m)),!g)return null;Object.assign(a,g.params),o.push({params:a,pathname:Mn([l,g.pathname]),pathnameBase:PA(Mn([l,g.pathnameBase])),route:y}),g.pathnameBase!=="/"&&(l=Mn([l,g.pathnameBase]))}return o}function uu(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,i]=CA(s.path,s.caseSensitive,s.end),a=e.match(t);if(!a)return null;let l=a[0],o=l.replace(/(.)\/+$/,"$1"),c=a.slice(1);return{params:i.reduce((d,{paramName:m,isOptional:g},y)=>{if(m==="*"){let E=c[y]||"";o=l.slice(0,l.length-E.length).replace(/(.)\/+$/,"$1")}const S=c[y];return g&&!S?d[m]=void 0:d[m]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:l,pathnameBase:o,pattern:s}}function CA(s,e=!1,t=!0){$i(s==="*"||!s.endsWith("*")||s.endsWith("/*"),`Route path "${s}" will be treated as if it were "${s.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${s.replace(/\*$/,"/*")}".`);let i=[],a="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,c,h)=>(i.push({paramName:c,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return s.endsWith("*")?(i.push({paramName:"*"}),a+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?a+="\\/*$":s!==""&&s!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),i]}function OA(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return $i(!1,`The URL path "${s}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),s}}function kn(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=s.charAt(t);return i&&i!=="/"?null:s.slice(t)||"/"}var wA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,MA=s=>wA.test(s);function NA(s,e="/"){let{pathname:t,search:i="",hash:a=""}=typeof s=="string"?Vr(s):s,l;if(t)if(MA(t))l=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),$i(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${t}`)}t.startsWith("/")?l=fy(t.substring(1),"/"):l=fy(t,e)}else l=e;return{pathname:l,search:UA(i),hash:FA(a)}}function fy(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(a=>{a===".."?t.length>1&&t.pop():a!=="."&&t.push(a)}),t.length>1?t.join("/"):"/"}function td(s,e,t,i){return`Cannot include a '${s}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function kA(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function mE(s){let e=kA(s);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function gE(s,e,t,i=!1){let a;typeof s=="string"?a=Vr(s):(a={...s},ct(!a.pathname||!a.pathname.includes("?"),td("?","pathname","search",a)),ct(!a.pathname||!a.pathname.includes("#"),td("#","pathname","hash",a)),ct(!a.search||!a.search.includes("#"),td("#","search","hash",a)));let l=s===""||a.pathname==="",o=l?"/":a.pathname,c;if(o==null)c=t;else{let g=e.length-1;if(!i&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),g-=1;a.pathname=y.join("/")}c=g>=0?e[g]:"/"}let h=NA(a,c),d=o&&o!=="/"&&o.endsWith("/"),m=(l||o===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(d||m)&&(h.pathname+="/"),h}var Mn=s=>s.join("/").replace(/\/\/+/g,"/"),PA=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),UA=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,FA=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function BA(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}function $A(s){return s.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var pE=["POST","PUT","PATCH","DELETE"];new Set(pE);var GA=["GET",...pE];new Set(GA);var Kr=W.createContext(null);Kr.displayName="DataRouter";var Ru=W.createContext(null);Ru.displayName="DataRouterState";W.createContext(!1);var yE=W.createContext({isTransitioning:!1});yE.displayName="ViewTransition";var jA=W.createContext(new Map);jA.displayName="Fetchers";var HA=W.createContext(null);HA.displayName="Await";var Gi=W.createContext(null);Gi.displayName="Navigation";var al=W.createContext(null);al.displayName="Location";var ji=W.createContext({outlet:null,matches:[],isDataRoute:!1});ji.displayName="Route";var Eh=W.createContext(null);Eh.displayName="RouteError";function zA(s,{relative:e}={}){ct(ll(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=W.useContext(Gi),{hash:a,pathname:l,search:o}=ol(s,{relative:e}),c=l;return t!=="/"&&(c=l==="/"?t:Mn([t,l])),i.createHref({pathname:c,search:o,hash:a})}function ll(){return W.useContext(al)!=null}function ps(){return ct(ll(),"useLocation() may be used only in the context of a <Router> component."),W.useContext(al).location}var vE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function EE(s){W.useContext(Gi).static||W.useLayoutEffect(s)}function Lu(){let{isDataRoute:s}=W.useContext(ji);return s?a1():VA()}function VA(){ct(ll(),"useNavigate() may be used only in the context of a <Router> component.");let s=W.useContext(Kr),{basename:e,navigator:t}=W.useContext(Gi),{matches:i}=W.useContext(ji),{pathname:a}=ps(),l=JSON.stringify(mE(i)),o=W.useRef(!1);return EE(()=>{o.current=!0}),W.useCallback((h,d={})=>{if($i(o.current,vE),!o.current)return;if(typeof h=="number"){t.go(h);return}let m=gE(h,JSON.parse(l),a,d.relative==="path");s==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Mn([e,m.pathname])),(d.replace?t.replace:t.push)(m,d.state,d)},[e,t,l,a,s])}var KA=W.createContext(null);function YA(s){let e=W.useContext(ji).outlet;return W.useMemo(()=>e&&W.createElement(KA.Provider,{value:s},e),[e,s])}function qA(){let{matches:s}=W.useContext(ji),e=s[s.length-1];return e?e.params:{}}function ol(s,{relative:e}={}){let{matches:t}=W.useContext(ji),{pathname:i}=ps(),a=JSON.stringify(mE(t));return W.useMemo(()=>gE(s,JSON.parse(a),i,e==="path"),[s,a,i,e])}function XA(s,e){return SE(s,e)}function SE(s,e,t,i,a){ct(ll(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=W.useContext(Gi),{matches:o}=W.useContext(ji),c=o[o.length-1],h=c?c.params:{},d=c?c.pathname:"/",m=c?c.pathnameBase:"/",g=c&&c.route;{let L=g&&g.path||"";TE(d,!g||L.endsWith("*")||L.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${L}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${L}"> to <Route path="${L==="/"?"*":`${L}/*`}">.`)}let y=ps(),S;if(e){let L=typeof e=="string"?Vr(e):e;ct(m==="/"||L.pathname?.startsWith(m),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${L.pathname}" was given in the \`location\` prop.`),S=L}else S=y;let E=S.pathname||"/",x=E;if(m!=="/"){let L=m.replace(/^\//,"").split("/");x="/"+E.replace(/^\//,"").split("/").slice(L.length).join("/")}let T=fE(s,{pathname:x});$i(g||T!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),$i(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let R=e1(T&&T.map(L=>Object.assign({},L,{params:Object.assign({},h,L.params),pathname:Mn([m,l.encodeLocation?l.encodeLocation(L.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:L.pathname]),pathnameBase:L.pathnameBase==="/"?m:Mn([m,l.encodeLocation?l.encodeLocation(L.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:L.pathnameBase])})),o,t,i,a);return e&&R?W.createElement(al.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...S},navigationType:"POP"}},R):R}function QA(){let s=r1(),e=BA(s)?`${s.status} ${s.statusText}`:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},l={padding:"2px 4px",backgroundColor:i},o=null;return console.error("Error handled by React Router default ErrorBoundary:",s),o=W.createElement(W.Fragment,null,W.createElement("p",null," Hey developer "),W.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",W.createElement("code",{style:l},"ErrorBoundary")," or"," ",W.createElement("code",{style:l},"errorElement")," prop on your route.")),W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},e),t?W.createElement("pre",{style:a},t):null,o)}var WA=W.createElement(QA,null),ZA=class extends W.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,e){return e.location!==s.location||e.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:e.error,location:e.location,revalidation:s.revalidation||e.revalidation}}componentDidCatch(s,e){this.props.onError?this.props.onError(s,e):console.error("React Router caught the following error during render",s)}render(){return this.state.error!==void 0?W.createElement(ji.Provider,{value:this.props.routeContext},W.createElement(Eh.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function JA({routeContext:s,match:e,children:t}){let i=W.useContext(Kr);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),W.createElement(ji.Provider,{value:s},t)}function e1(s,e=[],t=null,i=null,a=null){if(s==null){if(!t)return null;if(t.errors)s=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let l=s,o=t?.errors;if(o!=null){let m=l.findIndex(g=>g.route.id&&o?.[g.route.id]!==void 0);ct(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),l=l.slice(0,Math.min(l.length,m+1))}let c=!1,h=-1;if(t)for(let m=0;m<l.length;m++){let g=l[m];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=m),g.route.id){let{loaderData:y,errors:S}=t,E=g.route.loader&&!y.hasOwnProperty(g.route.id)&&(!S||S[g.route.id]===void 0);if(g.route.lazy||E){c=!0,h>=0?l=l.slice(0,h+1):l=[l[0]];break}}}let d=t&&i?(m,g)=>{i(m,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:$A(t.matches),errorInfo:g})}:void 0;return l.reduceRight((m,g,y)=>{let S,E=!1,x=null,T=null;t&&(S=o&&g.route.id?o[g.route.id]:void 0,x=g.route.errorElement||WA,c&&(h<0&&y===0?(TE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),E=!0,T=null):h===y&&(E=!0,T=g.route.hydrateFallbackElement||null)));let R=e.concat(l.slice(0,y+1)),L=()=>{let _;return S?_=x:E?_=T:g.route.Component?_=W.createElement(g.route.Component,null):g.route.element?_=g.route.element:_=m,W.createElement(JA,{match:g,routeContext:{outlet:m,matches:R,isDataRoute:t!=null},children:_})};return t&&(g.route.ErrorBoundary||g.route.errorElement||y===0)?W.createElement(ZA,{location:t.location,revalidation:t.revalidation,component:x,error:S,children:L(),routeContext:{outlet:null,matches:R,isDataRoute:!0},onError:d}):L()},null)}function Sh(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function t1(s){let e=W.useContext(Kr);return ct(e,Sh(s)),e}function i1(s){let e=W.useContext(Ru);return ct(e,Sh(s)),e}function n1(s){let e=W.useContext(ji);return ct(e,Sh(s)),e}function Th(s){let e=n1(s),t=e.matches[e.matches.length-1];return ct(t.route.id,`${s} can only be used on routes that contain a unique "id"`),t.route.id}function s1(){return Th("useRouteId")}function r1(){let s=W.useContext(Eh),e=i1("useRouteError"),t=Th("useRouteError");return s!==void 0?s:e.errors?.[t]}function a1(){let{router:s}=t1("useNavigate"),e=Th("useNavigate"),t=W.useRef(!1);return EE(()=>{t.current=!0}),W.useCallback(async(a,l={})=>{$i(t.current,vE),t.current&&(typeof a=="number"?await s.navigate(a):await s.navigate(a,{fromRouteId:e,...l}))},[s,e])}var dy={};function TE(s,e,t){!e&&!dy[s]&&(dy[s]=!0,$i(!1,t))}W.memo(l1);function l1({routes:s,future:e,state:t,unstable_onError:i}){return SE(s,void 0,t,i,e)}function o1(s){return YA(s.context)}function Wi(s){ct(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function u1({basename:s="/",children:e=null,location:t,navigationType:i="POP",navigator:a,static:l=!1,unstable_useTransitions:o}){ct(!ll(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=s.replace(/^\/*/,"/"),h=W.useMemo(()=>({basename:c,navigator:a,static:l,unstable_useTransitions:o,future:{}}),[c,a,l,o]);typeof t=="string"&&(t=Vr(t));let{pathname:d="/",search:m="",hash:g="",state:y=null,key:S="default"}=t,E=W.useMemo(()=>{let x=kn(d,c);return x==null?null:{location:{pathname:x,search:m,hash:g,state:y,key:S},navigationType:i}},[c,d,m,g,y,S,i]);return $i(E!=null,`<Router basename="${c}"> is not able to match the URL "${d}${m}${g}" because it does not start with the basename, so the <Router> won't render anything.`),E==null?null:W.createElement(Gi.Provider,{value:h},W.createElement(al.Provider,{children:e,value:E}))}function c1({children:s,location:e}){return XA($d(s),e)}function $d(s,e=[]){let t=[];return W.Children.forEach(s,(i,a)=>{if(!W.isValidElement(i))return;let l=[...e,a];if(i.type===W.Fragment){t.push.apply(t,$d(i.props.children,l));return}ct(i.type===Wi,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ct(!i.props.index||!i.props.children,"An index route cannot have child routes.");let o={id:i.props.id||l.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=$d(i.props.children,l)),t.push(o)}),t}var Qo="get",Wo="application/x-www-form-urlencoded";function _u(s){return typeof HTMLElement<"u"&&s instanceof HTMLElement}function f1(s){return _u(s)&&s.tagName.toLowerCase()==="button"}function d1(s){return _u(s)&&s.tagName.toLowerCase()==="form"}function h1(s){return _u(s)&&s.tagName.toLowerCase()==="input"}function m1(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function g1(s,e){return s.button===0&&(!e||e==="_self")&&!m1(s)}var Oo=null;function p1(){if(Oo===null)try{new FormData(document.createElement("form"),0),Oo=!1}catch{Oo=!0}return Oo}var y1=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function id(s){return s!=null&&!y1.has(s)?($i(!1,`"${s}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Wo}"`),null):s}function v1(s,e){let t,i,a,l,o;if(d1(s)){let c=s.getAttribute("action");i=c?kn(c,e):null,t=s.getAttribute("method")||Qo,a=id(s.getAttribute("enctype"))||Wo,l=new FormData(s)}else if(f1(s)||h1(s)&&(s.type==="submit"||s.type==="image")){let c=s.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=s.getAttribute("formaction")||c.getAttribute("action");if(i=h?kn(h,e):null,t=s.getAttribute("formmethod")||c.getAttribute("method")||Qo,a=id(s.getAttribute("formenctype"))||id(c.getAttribute("enctype"))||Wo,l=new FormData(c,s),!p1()){let{name:d,type:m,value:g}=s;if(m==="image"){let y=d?`${d}.`:"";l.append(`${y}x`,"0"),l.append(`${y}y`,"0")}else d&&l.append(d,g)}}else{if(_u(s))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Qo,i=null,a=Wo,o=s}return l&&a==="text/plain"&&(o=l,l=void 0),{action:i,method:t.toLowerCase(),encType:a,formData:l,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function xh(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function E1(s,e,t){let i=typeof s=="string"?new URL(s,typeof window>"u"?"server://singlefetch/":window.location.origin):s;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&kn(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function S1(s,e){if(s.id in e)return e[s.id];try{let t=await import(s.module);return e[s.id]=t,t}catch(t){return console.error(`Error loading route module \`${s.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function T1(s){return s==null?!1:s.href==null?s.rel==="preload"&&typeof s.imageSrcSet=="string"&&typeof s.imageSizes=="string":typeof s.rel=="string"&&typeof s.href=="string"}async function x1(s,e,t){let i=await Promise.all(s.map(async a=>{let l=e.routes[a.route.id];if(l){let o=await S1(l,t);return o.links?o.links():[]}return[]}));return L1(i.flat(1).filter(T1).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function hy(s,e,t,i,a,l){let o=(h,d)=>t[d]?h.route.id!==t[d].route.id:!0,c=(h,d)=>t[d].pathname!==h.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==h.params["*"];return l==="assets"?e.filter((h,d)=>o(h,d)||c(h,d)):l==="data"?e.filter((h,d)=>{let m=i.routes[h.route.id];if(!m||!m.hasLoader)return!1;if(o(h,d)||c(h,d))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(s,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function b1(s,e,{includeHydrateFallback:t}={}){return A1(s.map(i=>{let a=e.routes[i.route.id];if(!a)return[];let l=[a.module];return a.clientActionModule&&(l=l.concat(a.clientActionModule)),a.clientLoaderModule&&(l=l.concat(a.clientLoaderModule)),t&&a.hydrateFallbackModule&&(l=l.concat(a.hydrateFallbackModule)),a.imports&&(l=l.concat(a.imports)),l}).flat(1))}function A1(s){return[...new Set(s)]}function R1(s){let e={},t=Object.keys(s).sort();for(let i of t)e[i]=s[i];return e}function L1(s,e){let t=new Set;return new Set(e),s.reduce((i,a)=>{let l=JSON.stringify(R1(a));return t.has(l)||(t.add(l),i.push({key:l,link:a})),i},[])}function xE(){let s=W.useContext(Kr);return xh(s,"You must render this element inside a <DataRouterContext.Provider> element"),s}function _1(){let s=W.useContext(Ru);return xh(s,"You must render this element inside a <DataRouterStateContext.Provider> element"),s}var bh=W.createContext(void 0);bh.displayName="FrameworkContext";function bE(){let s=W.useContext(bh);return xh(s,"You must render this element inside a <HydratedRouter> element"),s}function D1(s,e){let t=W.useContext(bh),[i,a]=W.useState(!1),[l,o]=W.useState(!1),{onFocus:c,onBlur:h,onMouseEnter:d,onMouseLeave:m,onTouchStart:g}=e,y=W.useRef(null);W.useEffect(()=>{if(s==="render"&&o(!0),s==="viewport"){let x=R=>{R.forEach(L=>{o(L.isIntersecting)})},T=new IntersectionObserver(x,{threshold:.5});return y.current&&T.observe(y.current),()=>{T.disconnect()}}},[s]),W.useEffect(()=>{if(i){let x=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(x)}}},[i]);let S=()=>{a(!0)},E=()=>{a(!1),o(!1)};return t?s!=="intent"?[l,y,{}]:[l,y,{onFocus:Va(c,S),onBlur:Va(h,E),onMouseEnter:Va(d,S),onMouseLeave:Va(m,E),onTouchStart:Va(g,S)}]:[!1,y,{}]}function Va(s,e){return t=>{s&&s(t),t.defaultPrevented||e(t)}}function I1({page:s,...e}){let{router:t}=xE(),i=W.useMemo(()=>fE(t.routes,s,t.basename),[t.routes,s,t.basename]);return i?W.createElement(O1,{page:s,matches:i,...e}):null}function C1(s){let{manifest:e,routeModules:t}=bE(),[i,a]=W.useState([]);return W.useEffect(()=>{let l=!1;return x1(s,e,t).then(o=>{l||a(o)}),()=>{l=!0}},[s,e,t]),i}function O1({page:s,matches:e,...t}){let i=ps(),{manifest:a,routeModules:l}=bE(),{basename:o}=xE(),{loaderData:c,matches:h}=_1(),d=W.useMemo(()=>hy(s,e,h,a,i,"data"),[s,e,h,a,i]),m=W.useMemo(()=>hy(s,e,h,a,i,"assets"),[s,e,h,a,i]),g=W.useMemo(()=>{if(s===i.pathname+i.search+i.hash)return[];let E=new Set,x=!1;if(e.forEach(R=>{let L=a.routes[R.route.id];!L||!L.hasLoader||(!d.some(_=>_.route.id===R.route.id)&&R.route.id in c&&l[R.route.id]?.shouldRevalidate||L.hasClientLoader?x=!0:E.add(R.route.id))}),E.size===0)return[];let T=E1(s,o,"data");return x&&E.size>0&&T.searchParams.set("_routes",e.filter(R=>E.has(R.route.id)).map(R=>R.route.id).join(",")),[T.pathname+T.search]},[o,c,i,a,d,e,s,l]),y=W.useMemo(()=>b1(m,a),[m,a]),S=C1(m);return W.createElement(W.Fragment,null,g.map(E=>W.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...t})),y.map(E=>W.createElement("link",{key:E,rel:"modulepreload",href:E,...t})),S.map(({key:E,link:x})=>W.createElement("link",{key:E,nonce:t.nonce,...x})))}function w1(...s){return e=>{s.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var AE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{AE&&(window.__reactRouterVersion="7.10.1")}catch{}function M1({basename:s,children:e,unstable_useTransitions:t,window:i}){let a=W.useRef();a.current==null&&(a.current=gA({window:i,v5Compat:!0}));let l=a.current,[o,c]=W.useState({action:l.action,location:l.location}),h=W.useCallback(d=>{t===!1?c(d):W.startTransition(()=>c(d))},[t]);return W.useLayoutEffect(()=>l.listen(h),[l,h]),W.createElement(u1,{basename:s,children:e,location:o.location,navigationType:o.action,navigator:l,unstable_useTransitions:t===!0})}var RE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,LE=W.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:a,reloadDocument:l,replace:o,state:c,target:h,to:d,preventScrollReset:m,viewTransition:g,...y},S){let{basename:E,unstable_useTransitions:x}=W.useContext(Gi),T=typeof d=="string"&&RE.test(d),R,L=!1;if(typeof d=="string"&&T&&(R=d,AE))try{let P=new URL(window.location.href),q=d.startsWith("//")?new URL(P.protocol+d):new URL(d),re=kn(q.pathname,E);q.origin===P.origin&&re!=null?d=re+q.search+q.hash:L=!0}catch{$i(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let _=zA(d,{relative:a}),[O,M,G]=D1(i,y),w=P1(d,{replace:o,state:c,target:h,preventScrollReset:m,relative:a,viewTransition:g,unstable_useTransitions:x});function $(P){e&&e(P),P.defaultPrevented||w(P)}let U=W.createElement("a",{...y,...G,href:R||_,onClick:L||l?e:$,ref:w1(S,M),target:h,"data-discover":!T&&t==="render"?"true":void 0});return O&&!T?W.createElement(W.Fragment,null,U,W.createElement(I1,{page:_})):U});LE.displayName="Link";var Bs=W.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:a=!1,style:l,to:o,viewTransition:c,children:h,...d},m){let g=ol(o,{relative:d.relative}),y=ps(),S=W.useContext(Ru),{navigator:E,basename:x}=W.useContext(Gi),T=S!=null&&G1(g)&&c===!0,R=E.encodeLocation?E.encodeLocation(g).pathname:g.pathname,L=y.pathname,_=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;t||(L=L.toLowerCase(),_=_?_.toLowerCase():null,R=R.toLowerCase()),_&&x&&(_=kn(_,x)||_);const O=R!=="/"&&R.endsWith("/")?R.length-1:R.length;let M=L===R||!a&&L.startsWith(R)&&L.charAt(O)==="/",G=_!=null&&(_===R||!a&&_.startsWith(R)&&_.charAt(R.length)==="/"),w={isActive:M,isPending:G,isTransitioning:T},$=M?e:void 0,U;typeof i=="function"?U=i(w):U=[i,M?"active":null,G?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let P=typeof l=="function"?l(w):l;return W.createElement(LE,{...d,"aria-current":$,className:U,ref:m,style:P,to:o,viewTransition:c},typeof h=="function"?h(w):h)});Bs.displayName="NavLink";var N1=W.forwardRef(({discover:s="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:a,state:l,method:o=Qo,action:c,onSubmit:h,relative:d,preventScrollReset:m,viewTransition:g,...y},S)=>{let{unstable_useTransitions:E}=W.useContext(Gi),x=B1(),T=$1(c,{relative:d}),R=o.toLowerCase()==="get"?"get":"post",L=typeof c=="string"&&RE.test(c),_=O=>{if(h&&h(O),O.defaultPrevented)return;O.preventDefault();let M=O.nativeEvent.submitter,G=M?.getAttribute("formmethod")||o,w=()=>x(M||O.currentTarget,{fetcherKey:e,method:G,navigate:t,replace:a,state:l,relative:d,preventScrollReset:m,viewTransition:g});E&&t!==!1?W.startTransition(()=>w()):w()};return W.createElement("form",{ref:S,method:R,action:T,onSubmit:i?h:_,...y,"data-discover":!L&&s==="render"?"true":void 0})});N1.displayName="Form";function k1(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function _E(s){let e=W.useContext(Kr);return ct(e,k1(s)),e}function P1(s,{target:e,replace:t,state:i,preventScrollReset:a,relative:l,viewTransition:o,unstable_useTransitions:c}={}){let h=Lu(),d=ps(),m=ol(s,{relative:l});return W.useCallback(g=>{if(g1(g,e)){g.preventDefault();let y=t!==void 0?t:Za(d)===Za(m),S=()=>h(s,{replace:y,state:i,preventScrollReset:a,relative:l,viewTransition:o});c?W.startTransition(()=>S()):S()}},[d,h,m,t,i,e,s,a,l,o,c])}var U1=0,F1=()=>`__${String(++U1)}__`;function B1(){let{router:s}=_E("useSubmit"),{basename:e}=W.useContext(Gi),t=s1(),i=s.fetch,a=s.navigate;return W.useCallback(async(l,o={})=>{let{action:c,method:h,encType:d,formData:m,body:g}=v1(l,e);if(o.navigate===!1){let y=o.fetcherKey||F1();await i(y,t,o.action||c,{preventScrollReset:o.preventScrollReset,formData:m,body:g,formMethod:o.method||h,formEncType:o.encType||d,flushSync:o.flushSync})}else await a(o.action||c,{preventScrollReset:o.preventScrollReset,formData:m,body:g,formMethod:o.method||h,formEncType:o.encType||d,replace:o.replace,state:o.state,fromRouteId:t,flushSync:o.flushSync,viewTransition:o.viewTransition})},[i,a,e,t])}function $1(s,{relative:e}={}){let{basename:t}=W.useContext(Gi),i=W.useContext(ji);ct(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),l={...ol(s||".",{relative:e})},o=ps();if(s==null){l.search=o.search;let c=new URLSearchParams(l.search),h=c.getAll("index");if(h.some(m=>m==="")){c.delete("index"),h.filter(g=>g).forEach(g=>c.append("index",g));let m=c.toString();l.search=m?`?${m}`:""}}return(!s||s===".")&&a.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(l.pathname=l.pathname==="/"?t:Mn([t,l.pathname])),Za(l)}function G1(s,{relative:e}={}){let t=W.useContext(yE);ct(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=_E("useViewTransitionState"),a=ol(s,{relative:e});if(!t.isTransitioning)return!1;let l=kn(t.currentLocation.pathname,i)||t.currentLocation.pathname,o=kn(t.nextLocation.pathname,i)||t.nextLocation.pathname;return uu(a.pathname,o)!=null||uu(a.pathname,l)!=null}function j1(){const s=t=>`px-4 sm:px-6 py-2 text-sm rounded-full font-semibold shadow-md hover:shadow-lg transition-all duration-200 whitespace-nowrap text-white ${t?"bg-gradient-to-r from-slate-600 to-slate-400 hover:from-slate-700 hover:to-slate-500 scale-105":"bg-gradient-to-r from-blue-600 to-blue-400 hover:from-blue-700 hover:to-blue-500 hover:-translate-y-0.5"}`,e=()=>I.jsxs(I.Fragment,{children:[I.jsx(Bs,{to:"/",className:({isActive:t})=>s(t),children:"Home"}),I.jsx(Bs,{to:"/ouradults",className:({isActive:t})=>s(t),children:"Our Adults"}),I.jsx(Bs,{to:"/nursery",className:({isActive:t})=>s(t),children:"Nursery"}),I.jsx(Bs,{to:"/live",className:({isActive:t})=>s(t),children:I.jsxs("div",{className:"flex items-center gap-2",children:["Live Puppy Cam",I.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"})]})}),I.jsx(Bs,{to:"/pastlitters",className:({isActive:t})=>s(t),children:"Past Litters"}),I.jsx(Bs,{to:"/gallery",className:({isActive:t})=>s(t),children:"Gallery"})]});return I.jsxs("nav",{className:"w-full mt-4",children:[I.jsxs("div",{className:"sm:hidden w-full relative",children:[I.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-8 bg-gradient-to-r from-slate-900/95 to-transparent pointer-events-none z-10"}),I.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-slate-900/95 to-transparent pointer-events-none z-10"}),I.jsx("div",{className:"overflow-x-auto scrollbar-none",children:I.jsx("div",{className:"flex gap-2 px-8 pb-2 w-max",children:I.jsx(e,{})})})]}),I.jsx("div",{className:"hidden sm:flex flex-wrap justify-center gap-3 px-4",children:I.jsx(e,{})})]})}function H1(){const s=ps();return W.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[s.pathname]),I.jsx("header",{className:"bg-slate-900/95 backdrop-blur-sm border-b border-slate-800/50 sticky top-0 z-50 mb-4",children:I.jsx("div",{className:"container mx-auto px-4 max-w-7xl py-6",children:I.jsxs("div",{className:"flex flex-col items-center",children:[I.jsx("a",{href:"/",className:"group",children:I.jsxs("h1",{className:"flex items-center justify-center text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 text-3xl sm:text-4xl font-extrabold text-center tracking-wider px-4 transition-transform duration-300",children:["April's Lil Pugs",I.jsx("img",{src:"/logo.jpg",alt:"Logo",className:"w-9 h-9 ml-8 transform rotate-[-10deg]"})]})}),I.jsx(j1,{})]})})})}var DE={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},my=sn.createContext&&sn.createContext(DE),z1=["attr","size","title"];function V1(s,e){if(s==null)return{};var t=K1(s,e),i,a;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(a=0;a<l.length;a++)i=l[a],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(s,i)&&(t[i]=s[i])}return t}function K1(s,e){if(s==null)return{};var t={};for(var i in s)if(Object.prototype.hasOwnProperty.call(s,i)){if(e.indexOf(i)>=0)continue;t[i]=s[i]}return t}function cu(){return cu=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i])}return s},cu.apply(this,arguments)}function gy(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);e&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),t.push.apply(t,i)}return t}function fu(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gy(Object(t),!0).forEach(function(i){Y1(s,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):gy(Object(t)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(t,i))})}return s}function Y1(s,e,t){return e=q1(e),e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function q1(s){var e=X1(s,"string");return typeof e=="symbol"?e:e+""}function X1(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var i=t.call(s,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function IE(s){return s&&s.map((e,t)=>sn.createElement(e.tag,fu({key:t},e.attr),IE(e.child)))}function ri(s){return e=>sn.createElement(Q1,cu({attr:fu({},s.attr)},e),IE(s.child))}function Q1(s){var e=t=>{var{attr:i,size:a,title:l}=s,o=V1(s,z1),c=a||t.size||"1em",h;return t.className&&(h=t.className),s.className&&(h=(h?h+" ":"")+s.className),sn.createElement("svg",cu({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,o,{className:h,style:fu(fu({color:s.color||t.color},t.style),s.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),l&&sn.createElement("title",null,l),s.children)};return my!==void 0?sn.createElement(my.Consumer,null,t=>e(t)):e(DE)}function CE(s){return ri({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(s)}function W1(s){return ri({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"},child:[]}]})(s)}function Z1(s){return ri({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(s)}function J1(s){return ri({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 384c-28.02 0-31.26-32-74.5-32-43.43 0-46.825 32-74.75 32-27.695 0-31.454-32-74.75-32-42.842 0-47.218 32-74.5 32-28.148 0-31.202-32-74.75-32-43.547 0-46.653 32-74.75 32v-80c0-26.5 21.5-48 48-48h16V112h64v144h64V112h64v144h64V112h64v144h16c26.5 0 48 21.5 48 48v80zm0 128H0v-96c43.356 0 46.767-32 74.75-32 27.951 0 31.253 32 74.75 32 42.843 0 47.217-32 74.5-32 28.148 0 31.201 32 74.75 32 43.357 0 46.767-32 74.75-32 27.488 0 31.252 32 74.5 32v96zM96 96c-17.75 0-32-14.25-32-32 0-31 32-23 32-64 12 0 32 29.5 32 56s-14.25 40-32 40zm128 0c-17.75 0-32-14.25-32-32 0-31 32-23 32-64 12 0 32 29.5 32 56s-14.25 40-32 40zm128 0c-17.75 0-32-14.25-32-32 0-31 32-23 32-64 12 0 32 29.5 32 56s-14.25 40-32 40z"},child:[]}]})(s)}function eR(s){return ri({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M436 160H12c-6.627 0-12-5.373-12-12v-36c0-26.51 21.49-48 48-48h48V12c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v52h128V12c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v52h48c26.51 0 48 21.49 48 48v36c0 6.627-5.373 12-12 12zM12 192h424c6.627 0 12 5.373 12 12v260c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V204c0-6.627 5.373-12 12-12zm333.296 95.947l-28.169-28.398c-4.667-4.705-12.265-4.736-16.97-.068L194.12 364.665l-45.98-46.352c-4.667-4.705-12.266-4.736-16.971-.068l-28.397 28.17c-4.705 4.667-4.736 12.265-.068 16.97l82.601 83.269c4.667 4.705 12.265 4.736 16.97.068l142.953-141.805c4.705-4.667 4.736-12.265.068-16.97z"},child:[]}]})(s)}function tR(s){return ri({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},child:[]}]})(s)}function iR(s){return ri({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(s)}function nR(s){return ri({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(s)}function sR(s){return ri({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(s)}function rR(s){return ri({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(s)}function aR(s){return ri({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M372 64h-79c-10.7 0-16 12.9-8.5 20.5l16.9 16.9-80.7 80.7c-22.2-14-48.5-22.1-76.7-22.1C64.5 160 0 224.5 0 304s64.5 144 144 144 144-64.5 144-144c0-28.2-8.1-54.5-22.1-76.7l80.7-80.7 16.9 16.9c7.6 7.6 20.5 2.2 20.5-8.5V76c0-6.6-5.4-12-12-12zM144 384c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(s)}function lR(s){return ri({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"},child:[]}]})(s)}function oR(s){return ri({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"},child:[]}]})(s)}function uR(s){return ri({attr:{viewBox:"0 0 288 512"},child:[{tag:"path",attr:{d:"M288 176c0-79.5-64.5-144-144-144S0 96.5 0 176c0 68.5 47.9 125.9 112 140.4V368H76c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h36v36c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12v-36h36c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-36v-51.6c64.1-14.5 112-71.9 112-140.4zm-224 0c0-44.1 35.9-80 80-80s80 35.9 80 80-35.9 80-80 80-80-35.9-80-80z"},child:[]}]})(s)}function cR(){return I.jsx("footer",{className:"bg-slate-900/95 backdrop-blur-sm border-t border-slate-800/50 mt-4 py-6",children:I.jsxs("div",{className:"container mx-auto px-4 max-w-7xl relative flex flex-col items-center justify-center",children:[I.jsxs("p",{className:"text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 text-center",children:[" ",new Date().getFullYear()," April's Lil Pugs. All rights reserved."]}),I.jsxs("div",{className:"flex gap-4 items-center mt-4 md:mt-0 md:absolute md:right-4",children:[I.jsx("a",{href:"https://github.com/jonahgcarpenter",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-white transition-colors",children:I.jsx(W1,{size:24})}),I.jsx("a",{href:"https://www.facebook.com/AprilsLilPugs",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-400 transition-colors",children:I.jsx(CE,{size:24})})]})]})})}function fR(){return I.jsxs("div",{className:"min-h-screen flex flex-col",children:[I.jsx(H1,{}),I.jsx("main",{className:"flex-grow container mx-auto px-4 max-w-7xl w-full",children:I.jsx(o1,{})}),I.jsx(cR,{})]})}const dR=({breeder:s,isLoading:e,error:t})=>e?I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-12 border border-slate-800/50 shadow-xl flex justify-center",children:I.jsx("span",{className:"text-blue-400 font-semibold animate-pulse",children:"Loading..."})}):t?I.jsx("div",{className:"text-center text-red-400 p-8 bg-slate-900/80 rounded-xl",children:"Failed to load breeder profile."}):s?I.jsxs("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-6 sm:p-8 border border-slate-800/50 shadow-xl",children:[I.jsx("div",{className:"relative mb-8",children:I.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-center",children:[I.jsxs("div",{className:"relative w-48 h-48 md:w-64 md:h-64",children:[I.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl transform rotate-6 opacity-20"}),s.profilePicture?I.jsx("img",{src:s.profilePicture,alt:`${s.firstName} ${s.lastName}`,className:"relative w-full h-full object-cover rounded-xl border-2 border-white/10 shadow-xl"}):I.jsx("div",{className:"relative w-full h-full rounded-xl border-2 border-white/10 shadow-xl bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center",children:I.jsxs("span",{className:"text-4xl text-white/20",children:[s.firstName?.[0],s.lastName?.[0]]})})]}),I.jsxs("div",{className:"flex-1 text-center md:text-left",children:[I.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 mb-4",children:[s.firstName," ",s.lastName]}),I.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white/5 rounded-full border border-white/10 mb-4",children:[I.jsx(sR,{className:"text-blue-400"}),I.jsx("span",{className:"text-white/90",children:"Passionate Pug Breeder"})]})]})]})}),I.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[s.location&&I.jsxs("a",{href:`https://maps.google.com/?q=${encodeURIComponent(s.location)}`,target:"_blank",rel:"noopener noreferrer",className:"group bg-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/10 hover:border-white/20 transition-all duration-300 flex flex-col items-center justify-center gap-2",children:[I.jsx(rR,{className:"text-2xl text-blue-400 group-hover:scale-110 transition-transform duration-300"}),I.jsx("span",{className:"text-white/80 text-sm text-center",children:s.location})]}),s.email&&I.jsxs("a",{href:`mailto:${s.email}`,className:"group bg-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/10 hover:border-white/20 transition-all duration-300 flex flex-col items-center justify-center gap-2",children:[I.jsx(iR,{className:"text-2xl text-blue-400 group-hover:scale-110 transition-transform duration-300"}),I.jsx("span",{className:"text-white/80 text-sm text-center",children:"Email Me"})]}),s.phone&&I.jsxs("a",{href:`tel:${s.phone}`,className:"group bg-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/10 hover:border-white/20 transition-all duration-300 flex flex-col items-center justify-center gap-2",children:[I.jsx(oR,{className:"text-2xl text-blue-400 group-hover:scale-110 transition-transform duration-300"}),I.jsx("span",{className:"text-white/80 text-sm text-center",children:"Call Me"})]}),I.jsxs("a",{href:"https://www.facebook.com/AprilsLilPugs/",target:"_blank",rel:"noopener noreferrer",className:"group bg-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/10 hover:border-white/20 transition-all duration-300 flex flex-col items-center justify-center gap-2",children:[I.jsx(CE,{className:"text-2xl text-blue-400 group-hover:scale-110 transition-transform duration-300"}),I.jsx("span",{className:"text-white/80 text-sm text-center",children:"Facebook"})]})]}),s.description&&I.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[I.jsx("h2",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 mb-6",children:"My Journey with Pugs"}),I.jsx("div",{className:"prose prose-invert max-w-none",children:I.jsx("p",{className:"text-white/90 whitespace-pre-line leading-relaxed text-base",children:s.description})})]}),s.images&&s.images.length>0&&I.jsxs("div",{className:"mt-8",children:[I.jsx("h2",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 mb-6",children:"My Gallery"}),I.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:s.images.map((i,a)=>i?I.jsxs("div",{className:"relative group",children:[I.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl transform rotate-3 opacity-20"}),I.jsx("img",{src:i,alt:`Breeder gallery ${a+1}`,className:"relative w-full h-64 sm:h-80 md:h-96 object-cover rounded-xl border-2 border-white/10 shadow-xl"})]},a):null)})]})]}):null;var nd={exports:{}},sd={};var py;function hR(){if(py)return sd;py=1;var s=Au();function e(g,y){return g===y&&(g!==0||1/g===1/y)||g!==g&&y!==y}var t=typeof Object.is=="function"?Object.is:e,i=s.useState,a=s.useEffect,l=s.useLayoutEffect,o=s.useDebugValue;function c(g,y){var S=y(),E=i({inst:{value:S,getSnapshot:y}}),x=E[0].inst,T=E[1];return l(function(){x.value=S,x.getSnapshot=y,h(x)&&T({inst:x})},[g,S,y]),a(function(){return h(x)&&T({inst:x}),g(function(){h(x)&&T({inst:x})})},[g]),o(S),S}function h(g){var y=g.getSnapshot;g=g.value;try{var S=y();return!t(g,S)}catch{return!0}}function d(g,y){return y()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:c;return sd.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:m,sd}var yy;function mR(){return yy||(yy=1,nd.exports=hR()),nd.exports}var vy=mR();const OE=0,wE=1,ME=2,Ey=3;var Sy=Object.prototype.hasOwnProperty;function Gd(s,e){var t,i;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((i=s.length)===e.length)for(;i--&&Gd(s[i],e[i]););return i===-1}if(!t||typeof s=="object"){i=0;for(t in s)if(Sy.call(s,t)&&++i&&!Sy.call(e,t)||!(t in e)||!Gd(s[t],e[t]))return!1;return Object.keys(e).length===i}}return s!==s&&e!==e}const On=new WeakMap,wn=()=>{},Gt=wn(),jd=Object,Ge=s=>s===Gt,en=s=>typeof s=="function",hs=(s,e)=>({...s,...e}),NE=s=>en(s.then),rd={},wo={},Ah="undefined",ul=typeof window!=Ah,Hd=typeof document!=Ah,gR=ul&&"Deno"in window,pR=()=>ul&&typeof window.requestAnimationFrame!=Ah,kE=(s,e)=>{const t=On.get(s);return[()=>!Ge(e)&&s.get(e)||rd,i=>{if(!Ge(e)){const a=s.get(e);e in wo||(wo[e]=a),t[5](e,hs(a,i),a||rd)}},t[6],()=>!Ge(e)&&e in wo?wo[e]:!Ge(e)&&s.get(e)||rd]};let zd=!0;const yR=()=>zd,[Vd,Kd]=ul&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[wn,wn],vR=()=>{const s=Hd&&document.visibilityState;return Ge(s)||s!=="hidden"},ER=s=>(Hd&&document.addEventListener("visibilitychange",s),Vd("focus",s),()=>{Hd&&document.removeEventListener("visibilitychange",s),Kd("focus",s)}),SR=s=>{const e=()=>{zd=!0,s()},t=()=>{zd=!1};return Vd("online",e),Vd("offline",t),()=>{Kd("online",e),Kd("offline",t)}},TR={isOnline:yR,isVisible:vR},xR={initFocus:ER,initReconnect:SR},Ty=!sn.useId,Ur=!ul||gR,bR=s=>pR()?window.requestAnimationFrame(s):setTimeout(s,1),ad=Ur?W.useEffect:W.useLayoutEffect,ld=typeof navigator<"u"&&navigator.connection,xy=!Ur&&ld&&(["slow-2g","2g"].includes(ld.effectiveType)||ld.saveData),Mo=new WeakMap,AR=s=>jd.prototype.toString.call(s),od=(s,e)=>s===`[object ${e}]`;let RR=0;const Yd=s=>{const e=typeof s,t=AR(s),i=od(t,"Date"),a=od(t,"RegExp"),l=od(t,"Object");let o,c;if(jd(s)===s&&!i&&!a){if(o=Mo.get(s),o)return o;if(o=++RR+"~",Mo.set(s,o),Array.isArray(s)){for(o="@",c=0;c<s.length;c++)o+=Yd(s[c])+",";Mo.set(s,o)}if(l){o="#";const h=jd.keys(s).sort();for(;!Ge(c=h.pop());)Ge(s[c])||(o+=c+":"+Yd(s[c])+",");Mo.set(s,o)}}else o=i?s.toJSON():e=="symbol"?s.toString():e=="string"?JSON.stringify(s):""+s;return o},Rh=s=>{if(en(s))try{s=s()}catch{s=""}const e=s;return s=typeof s=="string"?s:(Array.isArray(s)?s.length:s)?Yd(s):"",[s,e]};let LR=0;const qd=()=>++LR;async function PE(...s){const[e,t,i,a]=s,l=hs({populateCache:!0,throwOnError:!0},typeof a=="boolean"?{revalidate:a}:a||{});let o=l.populateCache;const c=l.rollbackOnError;let h=l.optimisticData;const d=y=>typeof c=="function"?c(y):c!==!1,m=l.throwOnError;if(en(t)){const y=t,S=[],E=e.keys();for(const x of E)!/^\$(inf|sub)\$/.test(x)&&y(e.get(x)._k)&&S.push(x);return Promise.all(S.map(g))}return g(t);async function g(y){const[S]=Rh(y);if(!S)return;const[E,x]=kE(e,S),[T,R,L,_]=On.get(e),O=()=>{const oe=T[S];return(en(l.revalidate)?l.revalidate(E().data,y):l.revalidate!==!1)&&(delete L[S],delete _[S],oe&&oe[0])?oe[0](ME).then(()=>E().data):E().data};if(s.length<3)return O();let M=i,G,w=!1;const $=qd();R[S]=[$,0];const U=!Ge(h),P=E(),q=P.data,re=P._c,ce=Ge(re)?q:re;if(U&&(h=en(h)?h(ce,q):h,x({data:h,_c:ce})),en(M))try{M=M(ce)}catch(oe){G=oe,w=!0}if(M&&NE(M))if(M=await M.catch(oe=>{G=oe,w=!0}),$!==R[S][0]){if(w)throw G;return M}else w&&U&&d(G)&&(o=!0,x({data:ce,_c:Gt}));if(o&&!w)if(en(o)){const oe=o(M,ce);x({data:oe,error:Gt,_c:Gt})}else x({data:M,error:Gt,_c:Gt});if(R[S][1]=qd(),Promise.resolve(O()).then(()=>{x({_c:Gt})}),w){if(m)throw G;return}return M}}const by=(s,e)=>{for(const t in s)s[t][0]&&s[t][0](e)},_R=(s,e)=>{if(!On.has(s)){const t=hs(xR,e),i=Object.create(null),a=PE.bind(Gt,s);let l=wn;const o=Object.create(null),c=(m,g)=>{const y=o[m]||[];return o[m]=y,y.push(g),()=>y.splice(y.indexOf(g),1)},h=(m,g,y)=>{s.set(m,g);const S=o[m];if(S)for(const E of S)E(g,y)},d=()=>{if(!On.has(s)&&(On.set(s,[i,Object.create(null),Object.create(null),Object.create(null),a,h,c]),!Ur)){const m=t.initFocus(setTimeout.bind(Gt,by.bind(Gt,i,OE))),g=t.initReconnect(setTimeout.bind(Gt,by.bind(Gt,i,wE)));l=()=>{m&&m(),g&&g(),On.delete(s)}}};return d(),[s,a,d,l]}return[s,On.get(s)[4]]},DR=(s,e,t,i,a)=>{const l=t.errorRetryCount,o=a.retryCount,c=~~((Math.random()+.5)*(1<<(o<8?o:8)))*t.errorRetryInterval;!Ge(l)&&o>l||setTimeout(i,c,a)},IR=Gd,[UE,CR]=_R(new Map),OR=hs({onLoadingSlow:wn,onSuccess:wn,onError:wn,onErrorRetry:DR,onDiscarded:wn,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:xy?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:xy?5e3:3e3,compare:IR,isPaused:()=>!1,cache:UE,mutate:CR,fallback:{}},TR),wR=(s,e)=>{const t=hs(s,e);if(e){const{use:i,fallback:a}=s,{use:l,fallback:o}=e;i&&l&&(t.use=i.concat(l)),a&&o&&(t.fallback=hs(a,o))}return t},MR=W.createContext({}),NR="$inf$",FE=ul&&window.__SWR_DEVTOOLS_USE__,kR=FE?window.__SWR_DEVTOOLS_USE__:[],PR=()=>{FE&&(window.__SWR_DEVTOOLS_REACT__=sn)},UR=s=>en(s[1])?[s[0],s[1],s[2]||{}]:[s[0],null,(s[1]===null?s[2]:s[1])||{}],FR=()=>{const s=W.useContext(MR);return W.useMemo(()=>hs(OR,s),[s])},BR=s=>(e,t,i)=>s(e,t&&((...l)=>{const[o]=Rh(e),[,,,c]=On.get(UE);if(o.startsWith(NR))return t(...l);const h=c[o];return Ge(h)?t(...l):(delete c[o],h)}),i),$R=kR.concat(BR),GR=s=>function(...t){const i=FR(),[a,l,o]=UR(t),c=wR(i,o);let h=s;const{use:d}=c,m=(d||[]).concat($R);for(let g=m.length;g--;)h=m[g](h);return h(a,l||c.fetcher||null,c)},jR=(s,e,t)=>{const i=e[s]||(e[s]=[]);return i.push(t),()=>{const a=i.indexOf(t);a>=0&&(i[a]=i[i.length-1],i.pop())}};PR();const ud=sn.use||(s=>{switch(s.status){case"pending":throw s;case"fulfilled":return s.value;case"rejected":throw s.reason;default:throw s.status="pending",s.then(e=>{s.status="fulfilled",s.value=e},e=>{s.status="rejected",s.reason=e}),s}}),cd={dedupe:!0},Ay=Promise.resolve(Gt),HR=(s,e,t)=>{const{cache:i,compare:a,suspense:l,fallbackData:o,revalidateOnMount:c,revalidateIfStale:h,refreshInterval:d,refreshWhenHidden:m,refreshWhenOffline:g,keepPreviousData:y,strictServerPrefetchWarning:S}=t,[E,x,T,R]=On.get(i),[L,_]=Rh(s),O=W.useRef(!1),M=W.useRef(!1),G=W.useRef(L),w=W.useRef(e),$=W.useRef(t),U=()=>$.current,P=()=>U().isVisible()&&U().isOnline(),[q,re,ce,oe]=kE(i,L),fe=W.useRef({}).current,k=Ge(o)?Ge(t.fallback)?Gt:t.fallback[L]:o,X=(ye,De)=>{for(const ke in fe){const $e=ke;if($e==="data"){if(!a(ye[$e],De[$e])&&(!Ge(ye[$e])||!a(he,De[$e])))return!1}else if(De[$e]!==ye[$e])return!1}return!0},J=W.useMemo(()=>{const ye=!L||!e?!1:Ge(c)?U().isPaused()||l?!1:h!==!1:c,De=vt=>{const Xe=hs(vt);return delete Xe._k,ye?{isValidating:!0,isLoading:!0,...Xe}:Xe},ke=q(),$e=oe(),et=De(ke),Ot=ke===$e?et:De($e);let tt=et;return[()=>{const vt=De(q());return X(vt,tt)?(tt.data=vt.data,tt.isLoading=vt.isLoading,tt.isValidating=vt.isValidating,tt.error=vt.error,tt):(tt=vt,vt)},()=>Ot]},[i,L]),le=vy.useSyncExternalStore(W.useCallback(ye=>ce(L,(De,ke)=>{X(ke,De)||ye()}),[i,L]),J[0],J[1]),de=!O.current,C=E[L]&&E[L].length>0,F=le.data,ee=Ge(F)?k&&NE(k)?ud(k):k:F,ae=le.error,ue=W.useRef(ee),he=y?Ge(F)?Ge(ue.current)?ee:ue.current:F:ee,Se=L&&Ge(ee),Fe=!Ur&&vy.useSyncExternalStore(()=>wn,()=>!1,()=>!0);S&&Fe&&!l&&Se&&console.warn(`Missing pre-initiated data for serialized key "${L}" during server-side rendering. Data fethcing should be initiated on the server and provided to SWR via fallback data. You can set "strictServerPrefetchWarning: false" to disable this warning.`);const we=C&&!Ge(ae)?!1:de&&!Ge(c)?c:U().isPaused()?!1:l?Ge(ee)?!1:h:Ge(ee)||h,bt=!!(L&&e&&de&&we),Vt=Ge(le.isValidating)?bt:le.isValidating,ys=Ge(le.isLoading)?bt:le.isLoading,Ti=W.useCallback(async ye=>{const De=w.current;if(!L||!De||M.current||U().isPaused())return!1;let ke,$e,et=!0;const Ot=ye||{},tt=!T[L]||!Ot.dedupe,vt=()=>Ty?!M.current&&L===G.current&&O.current:L===G.current,Xe={isValidating:!1,isLoading:!1},vs=()=>{re(Xe)},Ni=()=>{const At=T[L];At&&At[1]===$e&&delete T[L]},Pn={isValidating:!0};Ge(q().data)&&(Pn.isLoading=!0);try{if(tt&&(re(Pn),t.loadingTimeout&&Ge(q().data)&&setTimeout(()=>{et&&vt()&&U().onLoadingSlow(L,t)},t.loadingTimeout),T[L]=[De(_),qd()]),[ke,$e]=T[L],ke=await ke,tt&&setTimeout(Ni,t.dedupingInterval),!T[L]||T[L][1]!==$e)return tt&&vt()&&U().onDiscarded(L),!1;Xe.error=Gt;const At=x[L];if(!Ge(At)&&($e<=At[0]||$e<=At[1]||At[1]===0))return vs(),tt&&vt()&&U().onDiscarded(L),!1;const Yt=q().data;Xe.data=a(Yt,ke)?Yt:ke,tt&&vt()&&U().onSuccess(ke,L,t)}catch(At){Ni();const Yt=U(),{shouldRetryOnError:ln}=Yt;Yt.isPaused()||(Xe.error=At,tt&&vt()&&(Yt.onError(At,L,Yt),(ln===!0||en(ln)&&ln(At))&&(!U().revalidateOnFocus||!U().revalidateOnReconnect||P())&&Yt.onErrorRetry(At,L,Yt,on=>{const Qr=E[L];Qr&&Qr[0]&&Qr[0](Ey,on)},{retryCount:(Ot.retryCount||0)+1,dedupe:!0})))}return et=!1,vs(),!0},[L,i]),Kt=W.useCallback((...ye)=>PE(i,G.current,...ye),[]);if(ad(()=>{w.current=e,$.current=t,Ge(F)||(ue.current=F)}),ad(()=>{if(!L)return;const ye=Ti.bind(Gt,cd);let De=0;U().revalidateOnFocus&&(De=Date.now()+U().focusThrottleInterval);const $e=jR(L,E,(et,Ot={})=>{if(et==OE){const tt=Date.now();U().revalidateOnFocus&&tt>De&&P()&&(De=tt+U().focusThrottleInterval,ye())}else if(et==wE)U().revalidateOnReconnect&&P()&&ye();else{if(et==ME)return Ti();if(et==Ey)return Ti(Ot)}});return M.current=!1,G.current=L,O.current=!0,re({_k:_}),we&&(T[L]||(Ge(ee)||Ur?ye():bR(ye))),()=>{M.current=!0,$e()}},[L]),ad(()=>{let ye;function De(){const $e=en(d)?d(q().data):d;$e&&ye!==-1&&(ye=setTimeout(ke,$e))}function ke(){!q().error&&(m||U().isVisible())&&(g||U().isOnline())?Ti(cd).then(De):De()}return De(),()=>{ye&&(clearTimeout(ye),ye=-1)}},[d,m,g,L]),W.useDebugValue(he),l){if(!Ty&&Ur&&Se)throw new Error("Fallback data is required when using Suspense in SSR.");Se&&(w.current=e,$.current=t,M.current=!1);const ye=R[L],De=!Ge(ye)&&Se?Kt(ye):Ay;if(ud(De),!Ge(ae)&&Se)throw ae;const ke=Se?Ti(cd):Ay;!Ge(he)&&Se&&(ke.status="fulfilled",ke.value=!0),ud(ke)}return{mutate:Kt,get data(){return fe.data=!0,he},get error(){return fe.error=!0,ae},get isValidating(){return fe.isValidating=!0,Vt},get isLoading(){return fe.isLoading=!0,ys}}},Lh=GR(HR),zR={id:"breeder-april",firstname:"April",lastname:"Carpenter",email:"contact@aprilslilpugs.com",password:"hashed_password_placeholder",phone:"(662) 555-0199",location:"Tupelo,MS",description:"Welcome to April's Lil Pugs! Located in Tupelo, MS, we have been passionately raising happy, healthy pugs for over 15 years. All our dogs are AKC registered and raised right in our living room.",profile_picture_id:"img-breeder",image_ids:"img-gallery-1,img-gallery-2"},Nn=[{id:"img-pug-1",filename:"pug.svg",description:"Pug 1 looking regal in the garden"},{id:"img-pug-2",filename:"pug.svg",description:"Pug 2 resting on a blanket"},{id:"img-pug-3",filename:"pug.svg",description:"Pug 3 playing fetch"},{id:"img-litter-1",filename:"litter.svg",description:"Litter 1 puppy pile"},{id:"img-litter-2",filename:"litter.svg",description:"Litter 2 in the basket"},{id:"img-litter-3",filename:"litter.svg",description:"Litter 3 in the basket"},{id:"img-pup-1",filename:"puppy.svg",description:"Puppy 1 standing tall"},{id:"img-pup-2",filename:"puppy.svg",description:"Puppy 2 chewing on a toy"},{id:"img-pup-3",filename:"puppy.svg",description:"Puppy 3 sleeping"},{id:"img-breeder",filename:"april.svg",description:"Breeder with two puppies"},{id:"img-gallery-1",filename:"gallery.svg",description:"Gallery photo 1"},{id:"img-gallery-2",filename:"gallery.svg",description:"Gallery photo 2"},{id:"img-gallery-3",filename:"gallery.svg",description:"Gallery photo 3"},{id:"img-gallery-1",filename:"gallery.svg",description:"Gallery photo 1"},{id:"img-gallery-2",filename:"gallery.svg",description:"Gallery photo 2"},{id:"img-gallery-3",filename:"gallery.svg",description:"Gallery photo 3"},{id:"img-pug-1-side",filename:"pug.svg",description:"Pug 1 side profile"},{id:"img-pup-1-play",filename:"puppy.svg",description:"Puppy 1 playing outside"}],VR="https://placehold.co/400x400/2563eb/white?text=April",KR="https://placehold.co/600x400/1e293b/white?text=April-Image",YR=async()=>(await new Promise(s=>setTimeout(s,300)),zR),qR=()=>{const{data:s,error:e,isLoading:t}=Lh("/api/breeder",YR);let i=null;if(s){const a=Nn.find(c=>c.id===s.profile_picture_id),l=a?`/assets/images/${a.filename}`:VR;let o=[];s.image_ids&&(o=s.image_ids.split(",").map(c=>{const h=Nn.find(d=>d.id===c.trim());return h?`/assets/images/${h.filename}`:KR})),i={id:s.id,firstName:s.firstname,lastName:s.lastname,email:s.email,phone:s.phone,location:s.location,description:s.description,profilePicture:l,images:o}}return{breeder:i,isLoading:t,error:e}},XR=()=>{const{breeder:s,isLoading:e,error:t}=qR();return I.jsx(dR,{breeder:s,isLoading:e,error:t})},fd=s=>{if(!s)return 0;const[e,t,i]=s.split("-").map(Number),a=new Date,l=a.getFullYear(),o=a.getMonth()+1,c=a.getDate();let h=l-e;return(o<t||o===t&&c<i)&&h--,h},QR=({grumbles:s,isLoading:e,error:t})=>e?I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-12 border border-slate-800/50 shadow-xl flex justify-center",children:I.jsx("span",{className:"text-blue-400 font-semibold animate-pulse",children:"Loading..."})}):t?I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-8 text-center border border-slate-800/50 text-red-400",children:"Failed to load the Grumble. Please try again later."}):I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-6 sm:p-8 border border-slate-800/50 shadow-xl",children:I.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8 sm:space-y-12",children:[I.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 text-center tracking-wider px-4",children:"Meet my Grumble"}),s&&s.length>0?I.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:[...s].sort((i,a)=>fd(a.birthDate)-fd(i.birthDate)).map(i=>I.jsxs("div",{className:"bg-slate-800/50 rounded-xl overflow-hidden border border-slate-700/50 shadow-lg hover:shadow-blue-500/10 transition-all duration-300",children:[I.jsx("div",{className:"aspect-square w-full overflow-hidden",children:i.profilePicture?I.jsx("img",{src:i.profilePicture,alt:i.name,className:"w-full h-full object-cover transform hover:scale-105 transition-transform duration-500"}):I.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center text-slate-600",children:"No Image"})}),I.jsxs("div",{className:"p-6 space-y-4",children:[I.jsxs("div",{className:"space-y-2",children:[I.jsx("h3",{className:"text-2xl font-semibold text-slate-100",children:i.name}),I.jsxs("div",{className:"flex justify-between items-center",children:[I.jsx("p",{className:"text-blue-400 font-medium",children:i.gender}),I.jsxs("p",{className:"text-slate-400 text-sm",children:[fd(i.birthDate)," years old"]})]})]}),I.jsx("p",{className:"text-slate-300 leading-relaxed line-clamp-4",children:i.description})]})]},i.id))}):I.jsx("div",{className:"text-center text-slate-400 py-12",children:"No pugs found in the grumble yet!"})]})}),Xd=[{id:"pug-1",name:"Pug 1",gender:"Male",description:"Generic description for Pug 1. He is the main stud with a classic fawn coat and a temperament that is both calm and playful.",profile_picture_id:"img-pug-1",image_ids:["img-pug-1","img-pug-1-side"],birth_date:"2019-05-15"},{id:"pug-2",name:"Pug 2",gender:"Female",description:"Generic description for Pug 2. She is an attentive and gentle mother who passes lovely traits to her puppies.",profile_picture_id:"img-pug-2",image_ids:["img-pug-2"],birth_date:"2020-11-20"},{id:"pug-3",name:"Pug 3",gender:"Female",description:"Generic description for Pug 3. She is full of energy, spunk, and has a very big personality.",profile_picture_id:"img-pug-3",image_ids:["img-pug-3","img-gallery-2"],birth_date:"2021-03-10"}],Ry="https://placehold.co/400x400/2563eb/white?text=Pug",WR=async()=>(await new Promise(s=>setTimeout(s,500)),Xd),BE=()=>{const{data:s,error:e,isLoading:t}=Lh("/api/pugs",WR);let i=[];return s&&(i=s.map(a=>{const l=Nn.find(h=>h.id===a.profile_picture_id),o=l?`/assets/images/${l.filename}`:Ry;let c=[];return a.image_ids&&Array.isArray(a.image_ids)&&(c=a.image_ids.map(h=>{const d=Nn.find(m=>m.id===h);return d?`/assets/images/${d.filename}`:Ry})),{id:a.id,name:a.name,gender:a.gender,description:a.description||"",birthDate:a.birth_date,profilePicture:o,images:c}})),{pugs:i,isLoading:t,error:e}},ZR=()=>{const{pugs:s,isLoading:e,error:t}=BE();return I.jsx(QR,{grumbles:s,isLoading:e,error:t})},Ly=s=>new Date(s).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"2-digit",timeZone:"UTC"}),JR=s=>new Date(s)>new Date,eL=s=>{switch(s){case"Planned":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";case"Available":return"bg-green-500/20 text-green-300 border-green-500/30";case"Sold":return"bg-red-500/20 text-red-300 border-red-500/30";default:return"bg-slate-500/20 text-slate-300 border-slate-500/30"}},$E=({title:s,litters:e,isLoading:t,error:i})=>{const a=Lu();return t?I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-12 border border-slate-800/50 shadow-xl flex justify-center",children:I.jsx("span",{className:"text-blue-400 font-semibold animate-pulse",children:"Loading..."})}):i?I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-8 text-center border border-slate-800/50 text-red-400",children:"Failed to load litters. Please try again later."}):I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-6 sm:p-8 border border-slate-800/50 shadow-xl",children:I.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8 sm:space-y-12",children:[I.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 text-center tracking-wider px-4",children:s}),I.jsx("div",{className:"space-y-8",children:e.map(l=>I.jsx("div",{className:"bg-slate-800/50 rounded-xl overflow-hidden border border-slate-700/50 transition-all hover:border-slate-600/50",children:I.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2",children:[I.jsx("div",{className:"aspect-square w-full overflow-hidden",children:I.jsx("img",{src:l.profilePicture,alt:l.name,className:"w-full h-full object-cover transition-transform duration-500 hover:scale-105"})}),I.jsxs("div",{className:"p-8 flex flex-col justify-center",children:[I.jsxs("div",{className:"flex justify-between items-start mb-6",children:[I.jsx("h2",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600",children:l.name}),I.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide border ${eL(l.status)}`,children:l.status})]}),I.jsxs("div",{className:"space-y-4 text-lg text-slate-300",children:[I.jsxs("p",{className:"flex items-center gap-2",children:[I.jsx(J1,{className:"w-5 h-5 text-blue-400 flex-shrink-0"}),I.jsxs("span",{children:[JR(l.birthDate)?"Expected By: ":"Born on: ",Ly(l.birthDate)]})]}),I.jsxs("p",{className:"flex items-center gap-2",children:[I.jsx(eR,{className:"w-5 h-5 text-blue-400 flex-shrink-0"}),I.jsxs("span",{children:["Available on: ",Ly(l.availableDate)]})]}),I.jsxs("p",{className:"flex items-center gap-2",children:[I.jsx(uR,{className:"w-5 h-5 text-pink-400 flex-shrink-0"}),I.jsxs("span",{children:["Mother: ",l.motherName]})]}),I.jsxs("p",{className:"flex items-center gap-2",children:[I.jsx(aR,{className:"w-5 h-5 text-blue-400 flex-shrink-0"}),I.jsxs("span",{children:["Father: ",l.fatherName]})]})]}),I.jsx("button",{onClick:()=>a(`/litter/${l.id}`),className:"mt-8 w-full sm:w-auto px-8 py-4 bg-gradient-to-r from-blue-600/20 to-blue-500/20 hover:from-blue-600/30 hover:to-blue-500/30 text-blue-400 rounded-xl border border-blue-500/20 transition-all duration-300 hover:scale-105 active:scale-95 cursor-pointer",children:"More Info"})]})]})},l.id))})]})})};function GE(s,e){return function(){return s.apply(e,arguments)}}const{toString:tL}=Object.prototype,{getPrototypeOf:_h}=Object,{iterator:Du,toStringTag:jE}=Symbol,Iu=(s=>e=>{const t=tL.call(e);return s[t]||(s[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Hi=s=>(s=s.toLowerCase(),e=>Iu(e)===s),Cu=s=>e=>typeof e===s,{isArray:Yr}=Array,jr=Cu("undefined");function cl(s){return s!==null&&!jr(s)&&s.constructor!==null&&!jr(s.constructor)&&ni(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const HE=Hi("ArrayBuffer");function iL(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&HE(s.buffer),e}const nL=Cu("string"),ni=Cu("function"),zE=Cu("number"),fl=s=>s!==null&&typeof s=="object",sL=s=>s===!0||s===!1,Zo=s=>{if(Iu(s)!=="object")return!1;const e=_h(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(jE in s)&&!(Du in s)},rL=s=>{if(!fl(s)||cl(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},aL=Hi("Date"),lL=Hi("File"),oL=Hi("Blob"),uL=Hi("FileList"),cL=s=>fl(s)&&ni(s.pipe),fL=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||ni(s.append)&&((e=Iu(s))==="formdata"||e==="object"&&ni(s.toString)&&s.toString()==="[object FormData]"))},dL=Hi("URLSearchParams"),[hL,mL,gL,pL]=["ReadableStream","Request","Response","Headers"].map(Hi),yL=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function dl(s,e,{allOwnKeys:t=!1}={}){if(s===null||typeof s>"u")return;let i,a;if(typeof s!="object"&&(s=[s]),Yr(s))for(i=0,a=s.length;i<a;i++)e.call(null,s[i],i,s);else{if(cl(s))return;const l=t?Object.getOwnPropertyNames(s):Object.keys(s),o=l.length;let c;for(i=0;i<o;i++)c=l[i],e.call(null,s[c],c,s)}}function VE(s,e){if(cl(s))return null;e=e.toLowerCase();const t=Object.keys(s);let i=t.length,a;for(;i-- >0;)if(a=t[i],e===a.toLowerCase())return a;return null}const Gs=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,KE=s=>!jr(s)&&s!==Gs;function Qd(){const{caseless:s,skipUndefined:e}=KE(this)&&this||{},t={},i=(a,l)=>{const o=s&&VE(t,l)||l;Zo(t[o])&&Zo(a)?t[o]=Qd(t[o],a):Zo(a)?t[o]=Qd({},a):Yr(a)?t[o]=a.slice():(!e||!jr(a))&&(t[o]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&dl(arguments[a],i);return t}const vL=(s,e,t,{allOwnKeys:i}={})=>(dl(e,(a,l)=>{t&&ni(a)?s[l]=GE(a,t):s[l]=a},{allOwnKeys:i}),s),EL=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),SL=(s,e,t,i)=>{s.prototype=Object.create(e.prototype,i),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:e.prototype}),t&&Object.assign(s.prototype,t)},TL=(s,e,t,i)=>{let a,l,o;const c={};if(e=e||{},s==null)return e;do{for(a=Object.getOwnPropertyNames(s),l=a.length;l-- >0;)o=a[l],(!i||i(o,s,e))&&!c[o]&&(e[o]=s[o],c[o]=!0);s=t!==!1&&_h(s)}while(s&&(!t||t(s,e))&&s!==Object.prototype);return e},xL=(s,e,t)=>{s=String(s),(t===void 0||t>s.length)&&(t=s.length),t-=e.length;const i=s.indexOf(e,t);return i!==-1&&i===t},bL=s=>{if(!s)return null;if(Yr(s))return s;let e=s.length;if(!zE(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=s[e];return t},AL=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&_h(Uint8Array)),RL=(s,e)=>{const i=(s&&s[Du]).call(s);let a;for(;(a=i.next())&&!a.done;){const l=a.value;e.call(s,l[0],l[1])}},LL=(s,e)=>{let t;const i=[];for(;(t=s.exec(e))!==null;)i.push(t);return i},_L=Hi("HTMLFormElement"),DL=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,a){return i.toUpperCase()+a}),_y=(({hasOwnProperty:s})=>(e,t)=>s.call(e,t))(Object.prototype),IL=Hi("RegExp"),YE=(s,e)=>{const t=Object.getOwnPropertyDescriptors(s),i={};dl(t,(a,l)=>{let o;(o=e(a,l,s))!==!1&&(i[l]=o||a)}),Object.defineProperties(s,i)},CL=s=>{YE(s,(e,t)=>{if(ni(s)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=s[t];if(ni(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},OL=(s,e)=>{const t={},i=a=>{a.forEach(l=>{t[l]=!0})};return Yr(s)?i(s):i(String(s).split(e)),t},wL=()=>{},ML=(s,e)=>s!=null&&Number.isFinite(s=+s)?s:e;function NL(s){return!!(s&&ni(s.append)&&s[jE]==="FormData"&&s[Du])}const kL=s=>{const e=new Array(10),t=(i,a)=>{if(fl(i)){if(e.indexOf(i)>=0)return;if(cl(i))return i;if(!("toJSON"in i)){e[a]=i;const l=Yr(i)?[]:{};return dl(i,(o,c)=>{const h=t(o,a+1);!jr(h)&&(l[c]=h)}),e[a]=void 0,l}}return i};return t(s,0)},PL=Hi("AsyncFunction"),UL=s=>s&&(fl(s)||ni(s))&&ni(s.then)&&ni(s.catch),qE=((s,e)=>s?setImmediate:e?((t,i)=>(Gs.addEventListener("message",({source:a,data:l})=>{a===Gs&&l===t&&i.length&&i.shift()()},!1),a=>{i.push(a),Gs.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",ni(Gs.postMessage)),FL=typeof queueMicrotask<"u"?queueMicrotask.bind(Gs):typeof process<"u"&&process.nextTick||qE,BL=s=>s!=null&&ni(s[Du]),Q={isArray:Yr,isArrayBuffer:HE,isBuffer:cl,isFormData:fL,isArrayBufferView:iL,isString:nL,isNumber:zE,isBoolean:sL,isObject:fl,isPlainObject:Zo,isEmptyObject:rL,isReadableStream:hL,isRequest:mL,isResponse:gL,isHeaders:pL,isUndefined:jr,isDate:aL,isFile:lL,isBlob:oL,isRegExp:IL,isFunction:ni,isStream:cL,isURLSearchParams:dL,isTypedArray:AL,isFileList:uL,forEach:dl,merge:Qd,extend:vL,trim:yL,stripBOM:EL,inherits:SL,toFlatObject:TL,kindOf:Iu,kindOfTest:Hi,endsWith:xL,toArray:bL,forEachEntry:RL,matchAll:LL,isHTMLForm:_L,hasOwnProperty:_y,hasOwnProp:_y,reduceDescriptors:YE,freezeMethods:CL,toObjectSet:OL,toCamelCase:DL,noop:wL,toFiniteNumber:ML,findKey:VE,global:Gs,isContextDefined:KE,isSpecCompliantForm:NL,toJSONObject:kL,isAsyncFn:PL,isThenable:UL,setImmediate:qE,asap:FL,isIterable:BL};function _e(s,e,t,i,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),a&&(this.response=a,this.status=a.status?a.status:null)}Q.inherits(_e,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Q.toJSONObject(this.config),code:this.code,status:this.status}}});const XE=_e.prototype,QE={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{QE[s]={value:s}});Object.defineProperties(_e,QE);Object.defineProperty(XE,"isAxiosError",{value:!0});_e.from=(s,e,t,i,a,l)=>{const o=Object.create(XE);Q.toFlatObject(s,o,function(m){return m!==Error.prototype},d=>d!=="isAxiosError");const c=s&&s.message?s.message:"Error",h=e==null&&s?s.code:e;return _e.call(o,c,h,t,i,a),s&&o.cause==null&&Object.defineProperty(o,"cause",{value:s,configurable:!0}),o.name=s&&s.name||"Error",l&&Object.assign(o,l),o};const $L=null;function Wd(s){return Q.isPlainObject(s)||Q.isArray(s)}function WE(s){return Q.endsWith(s,"[]")?s.slice(0,-2):s}function Dy(s,e,t){return s?s.concat(e).map(function(a,l){return a=WE(a),!t&&l?"["+a+"]":a}).join(t?".":""):e}function GL(s){return Q.isArray(s)&&!s.some(Wd)}const jL=Q.toFlatObject(Q,{},null,function(e){return/^is[A-Z]/.test(e)});function Ou(s,e,t){if(!Q.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,t=Q.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,T){return!Q.isUndefined(T[x])});const i=t.metaTokens,a=t.visitor||m,l=t.dots,o=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&Q.isSpecCompliantForm(e);if(!Q.isFunction(a))throw new TypeError("visitor must be a function");function d(E){if(E===null)return"";if(Q.isDate(E))return E.toISOString();if(Q.isBoolean(E))return E.toString();if(!h&&Q.isBlob(E))throw new _e("Blob is not supported. Use a Buffer instead.");return Q.isArrayBuffer(E)||Q.isTypedArray(E)?h&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function m(E,x,T){let R=E;if(E&&!T&&typeof E=="object"){if(Q.endsWith(x,"{}"))x=i?x:x.slice(0,-2),E=JSON.stringify(E);else if(Q.isArray(E)&&GL(E)||(Q.isFileList(E)||Q.endsWith(x,"[]"))&&(R=Q.toArray(E)))return x=WE(x),R.forEach(function(_,O){!(Q.isUndefined(_)||_===null)&&e.append(o===!0?Dy([x],O,l):o===null?x:x+"[]",d(_))}),!1}return Wd(E)?!0:(e.append(Dy(T,x,l),d(E)),!1)}const g=[],y=Object.assign(jL,{defaultVisitor:m,convertValue:d,isVisitable:Wd});function S(E,x){if(!Q.isUndefined(E)){if(g.indexOf(E)!==-1)throw Error("Circular reference detected in "+x.join("."));g.push(E),Q.forEach(E,function(R,L){(!(Q.isUndefined(R)||R===null)&&a.call(e,R,Q.isString(L)?L.trim():L,x,y))===!0&&S(R,x?x.concat(L):[L])}),g.pop()}}if(!Q.isObject(s))throw new TypeError("data must be an object");return S(s),e}function Iy(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function Dh(s,e){this._pairs=[],s&&Ou(s,this,e)}const ZE=Dh.prototype;ZE.append=function(e,t){this._pairs.push([e,t])};ZE.toString=function(e){const t=e?function(i){return e.call(this,i,Iy)}:Iy;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function HL(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function JE(s,e,t){if(!e)return s;const i=t&&t.encode||HL;Q.isFunction(t)&&(t={serialize:t});const a=t&&t.serialize;let l;if(a?l=a(e,t):l=Q.isURLSearchParams(e)?e.toString():new Dh(e,t).toString(i),l){const o=s.indexOf("#");o!==-1&&(s=s.slice(0,o)),s+=(s.indexOf("?")===-1?"?":"&")+l}return s}class Cy{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Q.forEach(this.handlers,function(i){i!==null&&e(i)})}}const eS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zL=typeof URLSearchParams<"u"?URLSearchParams:Dh,VL=typeof FormData<"u"?FormData:null,KL=typeof Blob<"u"?Blob:null,YL={isBrowser:!0,classes:{URLSearchParams:zL,FormData:VL,Blob:KL},protocols:["http","https","file","blob","url","data"]},Ih=typeof window<"u"&&typeof document<"u",Zd=typeof navigator=="object"&&navigator||void 0,qL=Ih&&(!Zd||["ReactNative","NativeScript","NS"].indexOf(Zd.product)<0),XL=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",QL=Ih&&window.location.href||"http://localhost",WL=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ih,hasStandardBrowserEnv:qL,hasStandardBrowserWebWorkerEnv:XL,navigator:Zd,origin:QL},Symbol.toStringTag,{value:"Module"})),jt={...WL,...YL};function ZL(s,e){return Ou(s,new jt.classes.URLSearchParams,{visitor:function(t,i,a,l){return jt.isNode&&Q.isBuffer(t)?(this.append(i,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...e})}function JL(s){return Q.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function e_(s){const e={},t=Object.keys(s);let i;const a=t.length;let l;for(i=0;i<a;i++)l=t[i],e[l]=s[l];return e}function tS(s){function e(t,i,a,l){let o=t[l++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),h=l>=t.length;return o=!o&&Q.isArray(a)?a.length:o,h?(Q.hasOwnProp(a,o)?a[o]=[a[o],i]:a[o]=i,!c):((!a[o]||!Q.isObject(a[o]))&&(a[o]=[]),e(t,i,a[o],l)&&Q.isArray(a[o])&&(a[o]=e_(a[o])),!c)}if(Q.isFormData(s)&&Q.isFunction(s.entries)){const t={};return Q.forEachEntry(s,(i,a)=>{e(JL(i),a,t,0)}),t}return null}function t_(s,e,t){if(Q.isString(s))try{return(e||JSON.parse)(s),Q.trim(s)}catch(i){if(i.name!=="SyntaxError")throw i}return(t||JSON.stringify)(s)}const hl={transitional:eS,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",a=i.indexOf("application/json")>-1,l=Q.isObject(e);if(l&&Q.isHTMLForm(e)&&(e=new FormData(e)),Q.isFormData(e))return a?JSON.stringify(tS(e)):e;if(Q.isArrayBuffer(e)||Q.isBuffer(e)||Q.isStream(e)||Q.isFile(e)||Q.isBlob(e)||Q.isReadableStream(e))return e;if(Q.isArrayBufferView(e))return e.buffer;if(Q.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(l){if(i.indexOf("application/x-www-form-urlencoded")>-1)return ZL(e,this.formSerializer).toString();if((c=Q.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return Ou(c?{"files[]":e}:e,h&&new h,this.formSerializer)}}return l||a?(t.setContentType("application/json",!1),t_(e)):e}],transformResponse:[function(e){const t=this.transitional||hl.transitional,i=t&&t.forcedJSONParsing,a=this.responseType==="json";if(Q.isResponse(e)||Q.isReadableStream(e))return e;if(e&&Q.isString(e)&&(i&&!this.responseType||a)){const o=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(c){if(o)throw c.name==="SyntaxError"?_e.from(c,_e.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:jt.classes.FormData,Blob:jt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Q.forEach(["delete","get","head","post","put","patch"],s=>{hl.headers[s]={}});const i_=Q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),n_=s=>{const e={};let t,i,a;return s&&s.split(`
`).forEach(function(o){a=o.indexOf(":"),t=o.substring(0,a).trim().toLowerCase(),i=o.substring(a+1).trim(),!(!t||e[t]&&i_[t])&&(t==="set-cookie"?e[t]?e[t].push(i):e[t]=[i]:e[t]=e[t]?e[t]+", "+i:i)}),e},Oy=Symbol("internals");function Ka(s){return s&&String(s).trim().toLowerCase()}function Jo(s){return s===!1||s==null?s:Q.isArray(s)?s.map(Jo):String(s)}function s_(s){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=t.exec(s);)e[i[1]]=i[2];return e}const r_=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function dd(s,e,t,i,a){if(Q.isFunction(i))return i.call(this,e,t);if(a&&(e=t),!!Q.isString(e)){if(Q.isString(i))return e.indexOf(i)!==-1;if(Q.isRegExp(i))return i.test(e)}}function a_(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function l_(s,e){const t=Q.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(s,i+t,{value:function(a,l,o){return this[i].call(this,e,a,l,o)},configurable:!0})})}let si=class{constructor(e){e&&this.set(e)}set(e,t,i){const a=this;function l(c,h,d){const m=Ka(h);if(!m)throw new Error("header name must be a non-empty string");const g=Q.findKey(a,m);(!g||a[g]===void 0||d===!0||d===void 0&&a[g]!==!1)&&(a[g||h]=Jo(c))}const o=(c,h)=>Q.forEach(c,(d,m)=>l(d,m,h));if(Q.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(Q.isString(e)&&(e=e.trim())&&!r_(e))o(n_(e),t);else if(Q.isObject(e)&&Q.isIterable(e)){let c={},h,d;for(const m of e){if(!Q.isArray(m))throw TypeError("Object iterator must return a key-value pair");c[d=m[0]]=(h=c[d])?Q.isArray(h)?[...h,m[1]]:[h,m[1]]:m[1]}o(c,t)}else e!=null&&l(t,e,i);return this}get(e,t){if(e=Ka(e),e){const i=Q.findKey(this,e);if(i){const a=this[i];if(!t)return a;if(t===!0)return s_(a);if(Q.isFunction(t))return t.call(this,a,i);if(Q.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ka(e),e){const i=Q.findKey(this,e);return!!(i&&this[i]!==void 0&&(!t||dd(this,this[i],i,t)))}return!1}delete(e,t){const i=this;let a=!1;function l(o){if(o=Ka(o),o){const c=Q.findKey(i,o);c&&(!t||dd(i,i[c],c,t))&&(delete i[c],a=!0)}}return Q.isArray(e)?e.forEach(l):l(e),a}clear(e){const t=Object.keys(this);let i=t.length,a=!1;for(;i--;){const l=t[i];(!e||dd(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const t=this,i={};return Q.forEach(this,(a,l)=>{const o=Q.findKey(i,l);if(o){t[o]=Jo(a),delete t[l];return}const c=e?a_(l):String(l).trim();c!==l&&delete t[l],t[c]=Jo(a),i[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Q.forEach(this,(i,a)=>{i!=null&&i!==!1&&(t[a]=e&&Q.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(a=>i.set(a)),i}static accessor(e){const i=(this[Oy]=this[Oy]={accessors:{}}).accessors,a=this.prototype;function l(o){const c=Ka(o);i[c]||(l_(a,o),i[c]=!0)}return Q.isArray(e)?e.forEach(l):l(e),this}};si.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Q.reduceDescriptors(si.prototype,({value:s},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(i){this[t]=i}}});Q.freezeMethods(si);function hd(s,e){const t=this||hl,i=e||t,a=si.from(i.headers);let l=i.data;return Q.forEach(s,function(c){l=c.call(t,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function iS(s){return!!(s&&s.__CANCEL__)}function qr(s,e,t){_e.call(this,s??"canceled",_e.ERR_CANCELED,e,t),this.name="CanceledError"}Q.inherits(qr,_e,{__CANCEL__:!0});function nS(s,e,t){const i=t.config.validateStatus;!t.status||!i||i(t.status)?s(t):e(new _e("Request failed with status code "+t.status,[_e.ERR_BAD_REQUEST,_e.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function o_(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function u_(s,e){s=s||10;const t=new Array(s),i=new Array(s);let a=0,l=0,o;return e=e!==void 0?e:1e3,function(h){const d=Date.now(),m=i[l];o||(o=d),t[a]=h,i[a]=d;let g=l,y=0;for(;g!==a;)y+=t[g++],g=g%s;if(a=(a+1)%s,a===l&&(l=(l+1)%s),d-o<e)return;const S=m&&d-m;return S?Math.round(y*1e3/S):void 0}}function c_(s,e){let t=0,i=1e3/e,a,l;const o=(d,m=Date.now())=>{t=m,a=null,l&&(clearTimeout(l),l=null),s(...d)};return[(...d)=>{const m=Date.now(),g=m-t;g>=i?o(d,m):(a=d,l||(l=setTimeout(()=>{l=null,o(a)},i-g)))},()=>a&&o(a)]}const du=(s,e,t=3)=>{let i=0;const a=u_(50,250);return c_(l=>{const o=l.loaded,c=l.lengthComputable?l.total:void 0,h=o-i,d=a(h),m=o<=c;i=o;const g={loaded:o,total:c,progress:c?o/c:void 0,bytes:h,rate:d||void 0,estimated:d&&c&&m?(c-o)/d:void 0,event:l,lengthComputable:c!=null,[e?"download":"upload"]:!0};s(g)},t)},wy=(s,e)=>{const t=s!=null;return[i=>e[0]({lengthComputable:t,total:s,loaded:i}),e[1]]},My=s=>(...e)=>Q.asap(()=>s(...e)),f_=jt.hasStandardBrowserEnv?((s,e)=>t=>(t=new URL(t,jt.origin),s.protocol===t.protocol&&s.host===t.host&&(e||s.port===t.port)))(new URL(jt.origin),jt.navigator&&/(msie|trident)/i.test(jt.navigator.userAgent)):()=>!0,d_=jt.hasStandardBrowserEnv?{write(s,e,t,i,a,l,o){if(typeof document>"u")return;const c=[`${s}=${encodeURIComponent(e)}`];Q.isNumber(t)&&c.push(`expires=${new Date(t).toUTCString()}`),Q.isString(i)&&c.push(`path=${i}`),Q.isString(a)&&c.push(`domain=${a}`),l===!0&&c.push("secure"),Q.isString(o)&&c.push(`SameSite=${o}`),document.cookie=c.join("; ")},read(s){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+s+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(s){this.write(s,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function h_(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function m_(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function sS(s,e,t){let i=!h_(e);return s&&(i||t==!1)?m_(s,e):e}const Ny=s=>s instanceof si?{...s}:s;function zs(s,e){e=e||{};const t={};function i(d,m,g,y){return Q.isPlainObject(d)&&Q.isPlainObject(m)?Q.merge.call({caseless:y},d,m):Q.isPlainObject(m)?Q.merge({},m):Q.isArray(m)?m.slice():m}function a(d,m,g,y){if(Q.isUndefined(m)){if(!Q.isUndefined(d))return i(void 0,d,g,y)}else return i(d,m,g,y)}function l(d,m){if(!Q.isUndefined(m))return i(void 0,m)}function o(d,m){if(Q.isUndefined(m)){if(!Q.isUndefined(d))return i(void 0,d)}else return i(void 0,m)}function c(d,m,g){if(g in e)return i(d,m);if(g in s)return i(void 0,d)}const h={url:l,method:l,data:l,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(d,m,g)=>a(Ny(d),Ny(m),g,!0)};return Q.forEach(Object.keys({...s,...e}),function(m){const g=h[m]||a,y=g(s[m],e[m],m);Q.isUndefined(y)&&g!==c||(t[m]=y)}),t}const rS=s=>{const e=zs({},s);let{data:t,withXSRFToken:i,xsrfHeaderName:a,xsrfCookieName:l,headers:o,auth:c}=e;if(e.headers=o=si.from(o),e.url=JE(sS(e.baseURL,e.url,e.allowAbsoluteUrls),s.params,s.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),Q.isFormData(t)){if(jt.hasStandardBrowserEnv||jt.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(Q.isFunction(t.getHeaders)){const h=t.getHeaders(),d=["content-type","content-length"];Object.entries(h).forEach(([m,g])=>{d.includes(m.toLowerCase())&&o.set(m,g)})}}if(jt.hasStandardBrowserEnv&&(i&&Q.isFunction(i)&&(i=i(e)),i||i!==!1&&f_(e.url))){const h=a&&l&&d_.read(l);h&&o.set(a,h)}return e},g_=typeof XMLHttpRequest<"u",p_=g_&&function(s){return new Promise(function(t,i){const a=rS(s);let l=a.data;const o=si.from(a.headers).normalize();let{responseType:c,onUploadProgress:h,onDownloadProgress:d}=a,m,g,y,S,E;function x(){S&&S(),E&&E(),a.cancelToken&&a.cancelToken.unsubscribe(m),a.signal&&a.signal.removeEventListener("abort",m)}let T=new XMLHttpRequest;T.open(a.method.toUpperCase(),a.url,!0),T.timeout=a.timeout;function R(){if(!T)return;const _=si.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),M={data:!c||c==="text"||c==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:_,config:s,request:T};nS(function(w){t(w),x()},function(w){i(w),x()},M),T=null}"onloadend"in T?T.onloadend=R:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(R)},T.onabort=function(){T&&(i(new _e("Request aborted",_e.ECONNABORTED,s,T)),T=null)},T.onerror=function(O){const M=O&&O.message?O.message:"Network Error",G=new _e(M,_e.ERR_NETWORK,s,T);G.event=O||null,i(G),T=null},T.ontimeout=function(){let O=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const M=a.transitional||eS;a.timeoutErrorMessage&&(O=a.timeoutErrorMessage),i(new _e(O,M.clarifyTimeoutError?_e.ETIMEDOUT:_e.ECONNABORTED,s,T)),T=null},l===void 0&&o.setContentType(null),"setRequestHeader"in T&&Q.forEach(o.toJSON(),function(O,M){T.setRequestHeader(M,O)}),Q.isUndefined(a.withCredentials)||(T.withCredentials=!!a.withCredentials),c&&c!=="json"&&(T.responseType=a.responseType),d&&([y,E]=du(d,!0),T.addEventListener("progress",y)),h&&T.upload&&([g,S]=du(h),T.upload.addEventListener("progress",g),T.upload.addEventListener("loadend",S)),(a.cancelToken||a.signal)&&(m=_=>{T&&(i(!_||_.type?new qr(null,s,T):_),T.abort(),T=null)},a.cancelToken&&a.cancelToken.subscribe(m),a.signal&&(a.signal.aborted?m():a.signal.addEventListener("abort",m)));const L=o_(a.url);if(L&&jt.protocols.indexOf(L)===-1){i(new _e("Unsupported protocol "+L+":",_e.ERR_BAD_REQUEST,s));return}T.send(l||null)})},y_=(s,e)=>{const{length:t}=s=s?s.filter(Boolean):[];if(e||t){let i=new AbortController,a;const l=function(d){if(!a){a=!0,c();const m=d instanceof Error?d:this.reason;i.abort(m instanceof _e?m:new qr(m instanceof Error?m.message:m))}};let o=e&&setTimeout(()=>{o=null,l(new _e(`timeout ${e} of ms exceeded`,_e.ETIMEDOUT))},e);const c=()=>{s&&(o&&clearTimeout(o),o=null,s.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),s=null)};s.forEach(d=>d.addEventListener("abort",l));const{signal:h}=i;return h.unsubscribe=()=>Q.asap(c),h}},v_=function*(s,e){let t=s.byteLength;if(t<e){yield s;return}let i=0,a;for(;i<t;)a=i+e,yield s.slice(i,a),i=a},E_=async function*(s,e){for await(const t of S_(s))yield*v_(t,e)},S_=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const e=s.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},ky=(s,e,t,i)=>{const a=E_(s,e);let l=0,o,c=h=>{o||(o=!0,i&&i(h))};return new ReadableStream({async pull(h){try{const{done:d,value:m}=await a.next();if(d){c(),h.close();return}let g=m.byteLength;if(t){let y=l+=g;t(y)}h.enqueue(new Uint8Array(m))}catch(d){throw c(d),d}},cancel(h){return c(h),a.return()}},{highWaterMark:2})},Py=64*1024,{isFunction:No}=Q,T_=(({Request:s,Response:e})=>({Request:s,Response:e}))(Q.global),{ReadableStream:Uy,TextEncoder:Fy}=Q.global,By=(s,...e)=>{try{return!!s(...e)}catch{return!1}},x_=s=>{s=Q.merge.call({skipUndefined:!0},T_,s);const{fetch:e,Request:t,Response:i}=s,a=e?No(e):typeof fetch=="function",l=No(t),o=No(i);if(!a)return!1;const c=a&&No(Uy),h=a&&(typeof Fy=="function"?(E=>x=>E.encode(x))(new Fy):async E=>new Uint8Array(await new t(E).arrayBuffer())),d=l&&c&&By(()=>{let E=!1;const x=new t(jt.origin,{body:new Uy,method:"POST",get duplex(){return E=!0,"half"}}).headers.has("Content-Type");return E&&!x}),m=o&&c&&By(()=>Q.isReadableStream(new i("").body)),g={stream:m&&(E=>E.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(E=>{!g[E]&&(g[E]=(x,T)=>{let R=x&&x[E];if(R)return R.call(x);throw new _e(`Response type '${E}' is not supported`,_e.ERR_NOT_SUPPORT,T)})});const y=async E=>{if(E==null)return 0;if(Q.isBlob(E))return E.size;if(Q.isSpecCompliantForm(E))return(await new t(jt.origin,{method:"POST",body:E}).arrayBuffer()).byteLength;if(Q.isArrayBufferView(E)||Q.isArrayBuffer(E))return E.byteLength;if(Q.isURLSearchParams(E)&&(E=E+""),Q.isString(E))return(await h(E)).byteLength},S=async(E,x)=>{const T=Q.toFiniteNumber(E.getContentLength());return T??y(x)};return async E=>{let{url:x,method:T,data:R,signal:L,cancelToken:_,timeout:O,onDownloadProgress:M,onUploadProgress:G,responseType:w,headers:$,withCredentials:U="same-origin",fetchOptions:P}=rS(E),q=e||fetch;w=w?(w+"").toLowerCase():"text";let re=y_([L,_&&_.toAbortSignal()],O),ce=null;const oe=re&&re.unsubscribe&&(()=>{re.unsubscribe()});let fe;try{if(G&&d&&T!=="get"&&T!=="head"&&(fe=await S($,R))!==0){let C=new t(x,{method:"POST",body:R,duplex:"half"}),F;if(Q.isFormData(R)&&(F=C.headers.get("content-type"))&&$.setContentType(F),C.body){const[ee,ae]=wy(fe,du(My(G)));R=ky(C.body,Py,ee,ae)}}Q.isString(U)||(U=U?"include":"omit");const k=l&&"credentials"in t.prototype,X={...P,signal:re,method:T.toUpperCase(),headers:$.normalize().toJSON(),body:R,duplex:"half",credentials:k?U:void 0};ce=l&&new t(x,X);let J=await(l?q(ce,P):q(x,X));const le=m&&(w==="stream"||w==="response");if(m&&(M||le&&oe)){const C={};["status","statusText","headers"].forEach(ue=>{C[ue]=J[ue]});const F=Q.toFiniteNumber(J.headers.get("content-length")),[ee,ae]=M&&wy(F,du(My(M),!0))||[];J=new i(ky(J.body,Py,ee,()=>{ae&&ae(),oe&&oe()}),C)}w=w||"text";let de=await g[Q.findKey(g,w)||"text"](J,E);return!le&&oe&&oe(),await new Promise((C,F)=>{nS(C,F,{data:de,headers:si.from(J.headers),status:J.status,statusText:J.statusText,config:E,request:ce})})}catch(k){throw oe&&oe(),k&&k.name==="TypeError"&&/Load failed|fetch/i.test(k.message)?Object.assign(new _e("Network Error",_e.ERR_NETWORK,E,ce),{cause:k.cause||k}):_e.from(k,k&&k.code,E,ce)}}},b_=new Map,aS=s=>{let e=s&&s.env||{};const{fetch:t,Request:i,Response:a}=e,l=[i,a,t];let o=l.length,c=o,h,d,m=b_;for(;c--;)h=l[c],d=m.get(h),d===void 0&&m.set(h,d=c?new Map:x_(e)),m=d;return d};aS();const Ch={http:$L,xhr:p_,fetch:{get:aS}};Q.forEach(Ch,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const $y=s=>`- ${s}`,A_=s=>Q.isFunction(s)||s===null||s===!1;function R_(s,e){s=Q.isArray(s)?s:[s];const{length:t}=s;let i,a;const l={};for(let o=0;o<t;o++){i=s[o];let c;if(a=i,!A_(i)&&(a=Ch[(c=String(i)).toLowerCase()],a===void 0))throw new _e(`Unknown adapter '${c}'`);if(a&&(Q.isFunction(a)||(a=a.get(e))))break;l[c||"#"+o]=a}if(!a){const o=Object.entries(l).map(([h,d])=>`adapter ${h} `+(d===!1?"is not supported by the environment":"is not available in the build"));let c=t?o.length>1?`since :
`+o.map($y).join(`
`):" "+$y(o[0]):"as no adapter specified";throw new _e("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return a}const lS={getAdapter:R_,adapters:Ch};function md(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new qr(null,s)}function Gy(s){return md(s),s.headers=si.from(s.headers),s.data=hd.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),lS.getAdapter(s.adapter||hl.adapter,s)(s).then(function(i){return md(s),i.data=hd.call(s,s.transformResponse,i),i.headers=si.from(i.headers),i},function(i){return iS(i)||(md(s),i&&i.response&&(i.response.data=hd.call(s,s.transformResponse,i.response),i.response.headers=si.from(i.response.headers))),Promise.reject(i)})}const oS="1.13.2",wu={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{wu[s]=function(i){return typeof i===s||"a"+(e<1?"n ":" ")+s}});const jy={};wu.transitional=function(e,t,i){function a(l,o){return"[Axios v"+oS+"] Transitional option '"+l+"'"+o+(i?". "+i:"")}return(l,o,c)=>{if(e===!1)throw new _e(a(o," has been removed"+(t?" in "+t:"")),_e.ERR_DEPRECATED);return t&&!jy[o]&&(jy[o]=!0,console.warn(a(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,o,c):!0}};wu.spelling=function(e){return(t,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};function L_(s,e,t){if(typeof s!="object")throw new _e("options must be an object",_e.ERR_BAD_OPTION_VALUE);const i=Object.keys(s);let a=i.length;for(;a-- >0;){const l=i[a],o=e[l];if(o){const c=s[l],h=c===void 0||o(c,l,s);if(h!==!0)throw new _e("option "+l+" must be "+h,_e.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new _e("Unknown option "+l,_e.ERR_BAD_OPTION)}}const eu={assertOptions:L_,validators:wu},qi=eu.validators;let js=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Cy,response:new Cy}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{i.stack?l&&!String(i.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+l):i.stack=l}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=zs(this.defaults,t);const{transitional:i,paramsSerializer:a,headers:l}=t;i!==void 0&&eu.assertOptions(i,{silentJSONParsing:qi.transitional(qi.boolean),forcedJSONParsing:qi.transitional(qi.boolean),clarifyTimeoutError:qi.transitional(qi.boolean)},!1),a!=null&&(Q.isFunction(a)?t.paramsSerializer={serialize:a}:eu.assertOptions(a,{encode:qi.function,serialize:qi.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),eu.assertOptions(t,{baseUrl:qi.spelling("baseURL"),withXsrfToken:qi.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=l&&Q.merge(l.common,l[t.method]);l&&Q.forEach(["delete","get","head","post","put","patch","common"],E=>{delete l[E]}),t.headers=si.concat(o,l);const c=[];let h=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(t)===!1||(h=h&&x.synchronous,c.unshift(x.fulfilled,x.rejected))});const d=[];this.interceptors.response.forEach(function(x){d.push(x.fulfilled,x.rejected)});let m,g=0,y;if(!h){const E=[Gy.bind(this),void 0];for(E.unshift(...c),E.push(...d),y=E.length,m=Promise.resolve(t);g<y;)m=m.then(E[g++],E[g++]);return m}y=c.length;let S=t;for(;g<y;){const E=c[g++],x=c[g++];try{S=E(S)}catch(T){x.call(this,T);break}}try{m=Gy.call(this,S)}catch(E){return Promise.reject(E)}for(g=0,y=d.length;g<y;)m=m.then(d[g++],d[g++]);return m}getUri(e){e=zs(this.defaults,e);const t=sS(e.baseURL,e.url,e.allowAbsoluteUrls);return JE(t,e.params,e.paramsSerializer)}};Q.forEach(["delete","get","head","options"],function(e){js.prototype[e]=function(t,i){return this.request(zs(i||{},{method:e,url:t,data:(i||{}).data}))}});Q.forEach(["post","put","patch"],function(e){function t(i){return function(l,o,c){return this.request(zs(c||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:l,data:o}))}}js.prototype[e]=t(),js.prototype[e+"Form"]=t(!0)});let __=class uS{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const i=this;this.promise.then(a=>{if(!i._listeners)return;let l=i._listeners.length;for(;l-- >0;)i._listeners[l](a);i._listeners=null}),this.promise.then=a=>{let l;const o=new Promise(c=>{i.subscribe(c),l=c}).then(a);return o.cancel=function(){i.unsubscribe(l)},o},e(function(l,o,c){i.reason||(i.reason=new qr(l,o,c),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=i=>{e.abort(i)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new uS(function(a){e=a}),cancel:e}}};function D_(s){return function(t){return s.apply(null,t)}}function I_(s){return Q.isObject(s)&&s.isAxiosError===!0}const Jd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Jd).forEach(([s,e])=>{Jd[e]=s});function cS(s){const e=new js(s),t=GE(js.prototype.request,e);return Q.extend(t,js.prototype,e,{allOwnKeys:!0}),Q.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return cS(zs(s,a))},t}const yt=cS(hl);yt.Axios=js;yt.CanceledError=qr;yt.CancelToken=__;yt.isCancel=iS;yt.VERSION=oS;yt.toFormData=Ou;yt.AxiosError=_e;yt.Cancel=yt.CanceledError;yt.all=function(e){return Promise.all(e)};yt.spread=D_;yt.isAxiosError=I_;yt.mergeConfig=zs;yt.AxiosHeaders=si;yt.formToJSON=s=>tS(Q.isHTMLForm(s)?new FormData(s):s);yt.getAdapter=lS.getAdapter;yt.HttpStatusCode=Jd;yt.default=yt;const{Axios:tw,AxiosError:iw,CanceledError:nw,isCancel:sw,CancelToken:rw,VERSION:aw,all:lw,Cancel:ow,isAxiosError:uw,spread:cw,toFormData:fw,AxiosHeaders:dw,HttpStatusCode:hw,formToJSON:mw,getAdapter:gw,mergeConfig:pw}=yt,C_=()=>{const[s,e]=W.useState({firstname:"",lastname:"",email:"",phone:"",preferences:""}),[t,i]=W.useState("idle"),[a,l]=W.useState(""),o=h=>{e({...s,[h.target.name]:h.target.value})},c=async h=>{h.preventDefault(),i("submitting"),l("");try{const d={firstName:s.firstname,lastName:s.lastname,phoneNumber:s.phone,notes:s.preferences,email:s.email};await yt.post("/api/waitlist",d),i("success"),e({firstname:"",lastname:"",email:"",phone:"",preferences:""}),setTimeout(()=>i("idle"),5e3)}catch(d){console.error("Error adding to waitlist:",d),i("error"),l(d.response?.data?.error||"Something went wrong. Please try again.")}};return I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-6 sm:p-8 border border-slate-800/50 shadow-xl",children:I.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:I.jsxs("div",{className:"max-w-2xl mx-auto",children:[I.jsxs("div",{className:"text-center mb-8",children:[I.jsx("h2",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 mb-2",children:"Join the Waitlist"}),I.jsx("p",{className:"text-slate-400",children:"Interested in a future puppy? Fill out the form below to get in line!"})]}),t==="success"?I.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-xl p-8 text-center flex flex-col items-center animate-fade-in",children:[I.jsx(tR,{className:"text-5xl text-green-400 mb-4"}),I.jsx("h3",{className:"text-xl font-semibold text-green-300 mb-2",children:"You're on the list!"}),I.jsx("p",{className:"text-green-200/80",children:"Thank you for your interest. We have received your information and will contact you when a puppy becomes available."}),I.jsx("button",{onClick:()=>i("idle"),className:"mt-6 text-sm text-green-400 hover:text-green-300 underline underline-offset-4",children:"Add another entry"})]}):I.jsxs("form",{onSubmit:c,className:"space-y-6",children:[I.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[I.jsxs("div",{className:"space-y-2",children:[I.jsxs("label",{htmlFor:"firstname",className:"text-sm font-medium text-slate-300",children:["First Name ",I.jsx("span",{className:"text-red-400",children:"*"})]}),I.jsx("input",{type:"text",id:"firstname",name:"firstname",required:!0,value:s.firstname,onChange:o,className:"w-full bg-slate-800/50 border border-slate-700/50 rounded-lg px-4 py-3 text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors",placeholder:"Jane"})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs("label",{htmlFor:"lastname",className:"text-sm font-medium text-slate-300",children:["Last Name ",I.jsx("span",{className:"text-red-400",children:"*"})]}),I.jsx("input",{type:"text",id:"lastname",name:"lastname",required:!0,value:s.lastname,onChange:o,className:"w-full bg-slate-800/50 border border-slate-700/50 rounded-lg px-4 py-3 text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors",placeholder:"Doe"})]})]}),I.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[I.jsxs("div",{className:"space-y-2",children:[I.jsxs("label",{htmlFor:"email",className:"text-sm font-medium text-slate-300",children:["Email Address ",I.jsx("span",{className:"text-red-400",children:"*"})]}),I.jsx("input",{type:"email",id:"email",name:"email",required:!0,value:s.email,onChange:o,className:"w-full bg-slate-800/50 border border-slate-700/50 rounded-lg px-4 py-3 text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors",placeholder:"jane@example.com"})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsxs("label",{htmlFor:"phone",className:"text-sm font-medium text-slate-300",children:["Phone Number ",I.jsx("span",{className:"text-red-400",children:"*"})]}),I.jsx("input",{type:"tel",id:"phone",name:"phone",required:!0,value:s.phone,onChange:o,className:"w-full bg-slate-800/50 border border-slate-700/50 rounded-lg px-4 py-3 text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors",placeholder:"(555) 123-4567"})]})]}),I.jsxs("div",{className:"space-y-2",children:[I.jsx("label",{htmlFor:"preferences",className:"text-sm font-medium text-slate-300",children:"Puppy Preferences"}),I.jsx("textarea",{id:"preferences",name:"preferences",rows:4,value:s.preferences,onChange:o,className:"w-full bg-slate-800/50 border border-slate-700/50 rounded-lg px-4 py-3 text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors resize-none",placeholder:"Tell us what you're looking for (e.g., gender, color preference)..."})]}),t==="error"&&I.jsxs("div",{className:"flex items-center gap-2 text-red-400 bg-red-400/10 p-3 rounded-lg border border-red-400/20 text-sm",children:[I.jsx(nR,{}),I.jsx("span",{children:a})]}),I.jsx("button",{type:"submit",disabled:t==="submitting",className:"w-full py-4 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold rounded-xl shadow-lg shadow-blue-500/20 transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:t==="submitting"?I.jsx("span",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):I.jsxs(I.Fragment,{children:[I.jsx(lR,{className:"text-sm"}),"Submit Request"]})})]})]})})})},O_=[{id:"litter-1",name:"Litter 1",mother_id:"pug-2",father_id:"pug-1",birth_date:"2023-10-01",available_date:"2023-12-01",profile_picture_id:"img-litter-1",image_ids:["img-litter-1","img-gallery-1"],status:"Sold"},{id:"litter-2",name:"Litter 2",mother_id:"pug-3",father_name:"External Stud",birth_date:"2024-02-15",available_date:"2024-04-15",profile_picture_id:"img-litter-2",image_ids:["img-litter-2","img-pup-1","img-pup-2"],status:"Available"},{id:"litter-3",name:"Litter 3",mother_id:"pug-2",father_id:"pug-1",birth_date:"2024-05-20",available_date:"2024-07-20",profile_picture_id:"img-litter-3",image_ids:[],status:"Planned"}],Hy="https://placehold.co/400x400/2563eb/white?text=Litter",w_=async()=>(await new Promise(s=>setTimeout(s,500)),O_),Oh=()=>{const{data:s,error:e,isLoading:t}=Lh("/api/litters",w_);let i=[];s&&(i=s.map(o=>{const c=Nn.find(y=>y.id===o.profile_picture_id),h=c?`/assets/images/${c.filename}`:Hy;let d=[];o.image_ids&&Array.isArray(o.image_ids)&&(d=o.image_ids.map(y=>{const S=Nn.find(E=>E.id===y);return S?`/assets/images/${S.filename}`:Hy}));const m=o.mother_name||Xd.find(y=>y.id===o.mother_id)?.name||"Unknown Mother",g=o.father_name||Xd.find(y=>y.id===o.father_id)?.name||"Unknown Father";return{id:o.id,name:o.name,motherId:o.mother_id,motherName:m,fatherId:o.father_id,fatherName:g,birthDate:o.birth_date,availableDate:o.available_date,profilePicture:h,images:d,status:o.status}}));const a=i.filter(o=>o.status!=="Sold"),l=i.filter(o=>o.status==="Sold");return{litters:i,currentLitters:a,pastLitters:l,isLoading:t,error:e}},M_=()=>{const{currentLitters:s,isLoading:e,error:t}=Oh();return I.jsxs("div",{className:"space-y-6",children:[I.jsx(C_,{}),I.jsx($E,{title:"Current Litters",litters:s,isLoading:e,error:t})]})},me=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},N_=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=k_},k_=Number.MAX_SAFE_INTEGER||9007199254740991;let Ee=(function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s})({}),z=(function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",s.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",s.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.ASSET_LIST_LOAD_ERROR="assetListLoadError",s.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",s.ASSET_LIST_PARSING_ERROR="assetListParsingError",s.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.ATTACH_MEDIA_ERROR="attachMediaError",s.UNKNOWN="unknown",s})({}),A=(function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.MEDIA_ENDED="hlsMediaEnded",s.STALL_RESOLVED="hlsStallResolved",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFERED_TO_END="hlsBufferedToEnd",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",s.ASSET_LIST_LOADING="hlsAssetListLoading",s.ASSET_LIST_LOADED="hlsAssetListLoaded",s.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",s.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",s.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",s.INTERSTITIAL_STARTED="hlsInterstitialStarted",s.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",s.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",s.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",s.INTERSTITIAL_ENDED="hlsInterstitialEnded",s.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",s.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",s.EVENT_CUE_ENTER="hlsEventCueEnter",s})({});var Oe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ge={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Cr{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class P_{constructor(e,t,i,a=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Cr(e),this.fast_=new Cr(t),this.defaultTTFB_=a,this.ttfb_=new Cr(e)}update(e,t){const{slow_:i,fast_:a,ttfb_:l}=this;i.halfLife!==e&&(this.slow_=new Cr(e,i.getEstimate(),i.getTotalWeight())),a.halfLife!==t&&(this.fast_=new Cr(t,a.getEstimate(),a.getTotalWeight())),l.halfLife!==e&&(this.ttfb_=new Cr(e,l.getEstimate(),l.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,a=e/1e3,l=i/a;this.fast_.sample(a,l),this.slow_.sample(a,l)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function U_(s,e,t){return(e=B_(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Je(){return Je=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(s[i]=t[i])}return s},Je.apply(null,arguments)}function zy(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);e&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),t.push.apply(t,i)}return t}function Ye(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zy(Object(t),!0).forEach(function(i){U_(s,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):zy(Object(t)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(t,i))})}return s}function F_(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var i=t.call(s,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function B_(s){var e=F_(s,"string");return typeof e=="symbol"?e:e+""}class Mi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=cs,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const cs=function(){},$_={trace:cs,debug:cs,log:cs,warn:cs,info:cs,error:cs};function eh(){return Je({},$_)}function G_(s,e){const t=self.console[s];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${s}] >`):cs}function Vy(s,e,t){return e[s]?e[s].bind(e):G_(s,t)}const th=eh();function j_(s,e,t){const i=eh();if(typeof console=="object"&&s===!0||typeof s=="object"){const a=["debug","log","info","warn","error"];a.forEach(l=>{i[l]=Vy(l,s,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return eh()}a.forEach(l=>{th[l]=Vy(l,s)})}else Je(th,i);return i}const qe=th;function ms(s=!0){return typeof self>"u"?void 0:(s||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function H_(s){return typeof self<"u"&&s===self.ManagedMediaSource}function fS(s,e){const t=Object.keys(s),i=Object.keys(e),a=t.length,l=i.length;return!a||!l||a===l&&!t.some(o=>i.indexOf(o)===-1)}function Si(s,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(s);if(e){const m=d.indexOf("\0");return m!==-1?d.substring(0,m):d}return d.replace(/\0/g,"")}const t=s.length;let i,a,l,o="",c=0;for(;c<t;){if(i=s[c++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:a=s[c++],o+=String.fromCharCode((i&31)<<6|a&63);break;case 14:a=s[c++],l=s[c++],o+=String.fromCharCode((i&15)<<12|(a&63)<<6|(l&63)<<0);break}}return o}function Ft(s){let e="";for(let t=0;t<s.length;t++){let i=s[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function dS(s){return Uint8Array.from(s.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function z_(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var gd={exports:{}},Ky;function V_(){return Ky||(Ky=1,(function(s,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,a=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(h,d,m){if(m=m||{},h=h.trim(),d=d.trim(),!d){if(!m.alwaysNormalize)return h;var g=c.parseURL(h);if(!g)throw new Error("Error trying to parse base URL.");return g.path=c.normalizePath(g.path),c.buildURLFromParts(g)}var y=c.parseURL(d);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return m.alwaysNormalize?(y.path=c.normalizePath(y.path),c.buildURLFromParts(y)):d;var S=c.parseURL(h);if(!S)throw new Error("Error trying to parse base URL.");if(!S.netLoc&&S.path&&S.path[0]!=="/"){var E=a.exec(S.path);S.netLoc=E[1],S.path=E[2]}S.netLoc&&!S.path&&(S.path="/");var x={scheme:S.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(x.netLoc=S.netLoc,y.path[0]!=="/"))if(!y.path)x.path=S.path,y.params||(x.params=S.params,y.query||(x.query=S.query));else{var T=S.path,R=T.substring(0,T.lastIndexOf("/")+1)+y.path;x.path=c.normalizePath(R)}return x.path===null&&(x.path=m.alwaysNormalize?c.normalizePath(y.path):y.path),c.buildURLFromParts(x)},parseURL:function(h){var d=i.exec(h);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(l,"");h.length!==(h=h.replace(o,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};s.exports=c})()})(gd)),gd.exports}var wh=V_();class Mh{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var nt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class hS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,Y_(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let a;i.length===1?a=t?.byteRangeEndOffset||0:a=parseInt(i[1]),this._byteRange=[a,parseInt(i[0])+a]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[nt.AUDIO]:null,[nt.VIDEO]:null,[nt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Mh),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=wh.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[nt.AUDIO]=null,e[nt.VIDEO]=null,e[nt.AUDIOVIDEO]=null}}function pt(s){return s.sn!=="initSegment"}class pd extends hS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(me(e)&&me(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(t);if(i.length===1){const a=this._decryptdata=t[i[0]]||null;a&&(this._decryptdata=a.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=me(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const i=Object.keys(this.levelkeys),a=i.length;if(a>1||a===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!me(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return pt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var i;const a=t[e];a&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=a.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,a,l,o=!1){const{elementaryStreams:c}=this,h=c[e];if(!h){c[e]={startPTS:t,endPTS:i,startDTS:a,endDTS:l,partial:o};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,i),h.startDTS=Math.min(h.startDTS,a),h.endDTS=Math.max(h.endDTS,l)}}class K_ extends hS{constructor(e,t,i,a,l){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=a;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,l),l&&(this.fragOffset=l.fragOffset+l.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function mS(s,e){const t=Object.getPrototypeOf(s);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||mS(t,e)}}function Y_(s,e){const t=mS(s,e);t&&(t.enumerable=!0,Object.defineProperty(s,e,t))}const Yy=Math.pow(2,32)-1,q_=[].push,gS={video:1,audio:2,id3:3,text:4};function Lt(s){return String.fromCharCode.apply(null,s)}function pS(s,e){const t=s[e]<<8|s[e+1];return t<0?65536+t:t}function be(s,e){const t=yS(s,e);return t<0?4294967296+t:t}function qy(s,e){let t=be(s,e);return t*=Math.pow(2,32),t+=be(s,e+4),t}function yS(s,e){return s[e]<<24|s[e+1]<<16|s[e+2]<<8|s[e+3]}function X_(s){const e=s.byteLength;for(let t=0;t<e;){const i=be(s,t);if(i>8&&s[t+4]===109&&s[t+5]===111&&s[t+6]===111&&s[t+7]===102)return!0;t=i>1?t+i:e}return!1}function Ce(s,e){const t=[];if(!e.length)return t;const i=s.byteLength;for(let a=0;a<i;){const l=be(s,a),o=Lt(s.subarray(a+4,a+8)),c=l>1?a+l:i;if(o===e[0])if(e.length===1)t.push(s.subarray(a+8,c));else{const h=Ce(s.subarray(a+8,c),e.slice(1));h.length&&q_.apply(t,h)}a=c}return t}function Q_(s){const e=[],t=s[0];let i=8;const a=be(s,i);i+=4;let l=0,o=0;t===0?(l=be(s,i),o=be(s,i+4),i+=8):(l=qy(s,i),o=qy(s,i+8),i+=16),i+=2;let c=s.length+o;const h=pS(s,i);i+=2;for(let d=0;d<h;d++){let m=i;const g=be(s,m);m+=4;const y=g&2147483647;if((g&2147483648)>>>31===1)return qe.warn("SIDX has hierarchical references (not supported)"),null;const E=be(s,m);m+=4,e.push({referenceSize:y,subsegmentDuration:E,info:{duration:E/a,start:c,end:c+y-1}}),c+=y,m+=4,i=m}return{earliestPresentationTime:l,timescale:a,version:t,referencesCount:h,references:e}}function vS(s){const e=[],t=Ce(s,["moov","trak"]);for(let a=0;a<t.length;a++){const l=t[a],o=Ce(l,["tkhd"])[0];if(o){let c=o[0];const h=be(o,c===0?12:20),d=Ce(l,["mdia","mdhd"])[0];if(d){c=d[0];const m=be(d,c===0?12:20),g=Ce(l,["mdia","hdlr"])[0];if(g){const y=Lt(g.subarray(8,12)),S={soun:nt.AUDIO,vide:nt.VIDEO}[y],E=Ce(l,["mdia","minf","stbl","stsd"])[0],x=W_(E);S?(e[h]={timescale:m,type:S,stsd:x},e[S]=Ye({timescale:m,id:h},x)):e[h]={timescale:m,type:y,stsd:x}}}}}return Ce(s,["moov","mvex","trex"]).forEach(a=>{const l=be(a,4),o=e[l];o&&(o.default={duration:be(a,12),flags:be(a,20)})}),e}function W_(s){const e=s.subarray(8),t=e.subarray(86),i=Lt(e.subarray(4,8));let a=i,l;const o=i==="enca"||i==="encv";if(o){const d=Ce(e,[i])[0].subarray(i==="enca"?28:78);Ce(d,["sinf"]).forEach(g=>{const y=Ce(g,["schm"])[0];if(y){const S=Lt(y.subarray(4,8));if(S==="cbcs"||S==="cenc"){const E=Ce(g,["frma"])[0];E&&(a=Lt(E))}}})}const c=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{const h=Ce(t,["avcC"])[0];h&&h.length>3&&(a+="."+Po(h[1])+Po(h[2])+Po(h[3]),l=ko(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=Ce(e,[i])[0],d=Ce(h.subarray(28),["esds"])[0];if(d&&d.length>7){let m=4;if(d[m++]!==3)break;m=yd(d,m),m+=2;const g=d[m++];if(g&128&&(m+=2),g&64&&(m+=d[m++]),d[m++]!==4)break;m=yd(d,m);const y=d[m++];if(y===64)a+="."+Po(y);else break;if(m+=12,d[m++]!==5)break;m=yd(d,m);const S=d[m++];let E=(S&248)>>3;E===31&&(E+=1+((S&7)<<3)+((d[m]&224)>>5)),a+="."+E}break}case"hvc1":case"hev1":{const h=Ce(t,["hvcC"])[0];if(h&&h.length>12){const d=h[1],m=["","A","B","C"][d>>6],g=d&31,y=be(h,2),S=(d&32)>>5?"H":"L",E=h[12],x=h.subarray(6,12);a+="."+m+g,a+="."+Z_(y).toString(16).toUpperCase(),a+="."+S+E;let T="";for(let R=x.length;R--;){const L=x[R];(L||T)&&(T="."+L.toString(16).toUpperCase()+T)}a+=T}l=ko(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{a=ko(a,t)||a;break}case"vp09":{const h=Ce(t,["vpcC"])[0];if(h&&h.length>6){const d=h[4],m=h[5],g=h[6]>>4&15;a+="."+Zi(d)+"."+Zi(m)+"."+Zi(g)}break}case"av01":{const h=Ce(t,["av1C"])[0];if(h&&h.length>2){const d=h[1]>>>5,m=h[1]&31,g=h[2]>>>7?"H":"M",y=(h[2]&64)>>6,S=(h[2]&32)>>5,E=d===2&&y?S?12:10:y?10:8,x=(h[2]&16)>>4,T=(h[2]&8)>>3,R=(h[2]&4)>>2,L=h[2]&3;a+="."+d+"."+Zi(m)+g+"."+Zi(E)+"."+x+"."+T+R+L+"."+Zi(1)+"."+Zi(1)+"."+Zi(1)+"."+0,l=ko("dav1",t)}break}}return{codec:a,encrypted:o,supplemental:l}}function ko(s,e){const t=Ce(e,["dvvC"]),i=t.length?t[0]:Ce(e,["dvcC"])[0];if(i){const a=i[2]>>1&127,l=i[2]<<5&32|i[3]>>3&31;return s+"."+Zi(a)+"."+Zi(l)}}function Z_(s){let e=0;for(let t=0;t<32;t++)e|=(s>>t&1)<<31-t;return e>>>0}function yd(s,e){const t=e+5;for(;s[e++]&128&&e<t;);return e}function Po(s){return("0"+s.toString(16).toUpperCase()).slice(-2)}function Zi(s){return(s<10?"0":"")+s}function J_(s,e){if(!s||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&ES(s,(i,a)=>{const l=i.subarray(8,24);l.some(o=>o!==0)||(qe.log(`[eme] Patching keyId in 'enc${a?"a":"v"}>sinf>>tenc' box: ${Ft(l)} -> ${Ft(t)}`),i.set(t,8))})}function eD(s){const e=[];return ES(s,t=>e.push(t.subarray(8,24))),e}function ES(s,e){Ce(s,["moov","trak"]).forEach(i=>{const a=Ce(i,["mdia","minf","stbl","stsd"])[0];if(!a)return;const l=a.subarray(8);let o=Ce(l,["enca"]);const c=o.length>0;c||(o=Ce(l,["encv"])),o.forEach(h=>{const d=c?h.subarray(28):h.subarray(78);Ce(d,["sinf"]).forEach(g=>{const y=SS(g);y&&e(y,c)})})})}function SS(s){const e=Ce(s,["schm"])[0];if(e){const t=Lt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const i=Ce(s,["schi","tenc"])[0];if(i)return i}}}function tD(s,e,t){const i={},a=Ce(s,["moof","traf"]);for(let l=0;l<a.length;l++){const o=a[l],c=Ce(o,["tfhd"])[0],h=be(c,4),d=e[h];if(!d)continue;i[h]||(i[h]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const m=i[h],g=Ce(o,["tfdt"])[0];if(g){const _=g[0];let O=be(g,4);_===1&&(O===Yy?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(O*=Yy+1,O+=be(g,8))),me(O)&&(!me(m.start)||O<m.start)&&(m.start=O)}const y=d.default,S=be(c,0)|y?.flags;let E=y?.duration||0;S&8&&(S&2?E=be(c,12):E=be(c,8));const x=Ce(o,["trun"]);let T=m.start||0,R=0,L=E;for(let _=0;_<x.length;_++){const O=x[_],M=be(O,4),G=m.sampleCount;m.sampleCount+=M;const w=O[3]&1,$=O[3]&4,U=O[2]&1,P=O[2]&2,q=O[2]&4,re=O[2]&8;let ce=8,oe=M;for(w&&(ce+=4),$&&M&&(!(O[ce+1]&1)&&m.keyFrameIndex===void 0&&(m.keyFrameIndex=G),ce+=4,U?(L=be(O,ce),ce+=4):L=E,P&&(ce+=4),re&&(ce+=4),T+=L,R+=L,oe--);oe--;)U?(L=be(O,ce),ce+=4):L=E,P&&(ce+=4),q&&(O[ce+1]&1||m.keyFrameIndex===void 0&&(m.keyFrameIndex=m.sampleCount-(oe+1),m.keyFrameStart=T),ce+=4),re&&(ce+=4),T+=L,R+=L;!R&&E&&(R+=E*M)}m.duration+=R}if(!Object.keys(i).some(l=>i[l].duration)){let l=1/0,o=0;const c=Ce(s,["sidx"]);for(let h=0;h<c.length;h++){const d=Q_(c[h]);if(d!=null&&d.references){l=Math.min(l,d.earliestPresentationTime/d.timescale);const m=d.references.reduce((g,y)=>g+y.info.duration||0,0);o=Math.max(o,m+d.earliestPresentationTime/d.timescale)}}o&&me(o)&&Object.keys(i).forEach(h=>{i[h].duration||(i[h].duration=o*i[h].timescale-i[h].start)})}return i}function iD(s){const e={valid:null,remainder:null},t=Ce(s,["moof"]);if(t.length<2)return e.remainder=s,e;const i=t[t.length-1];return e.valid=s.slice(0,i.byteOffset-8),e.remainder=s.slice(i.byteOffset-8),e}function wi(s,e){const t=new Uint8Array(s.length+e.length);return t.set(s),t.set(e,s.length),t}function Xy(s,e){const t=[],i=e.samples,a=e.timescale,l=e.id;let o=!1;return Ce(i,["moof"]).map(h=>{const d=h.byteOffset-8;Ce(h,["traf"]).map(g=>{const y=Ce(g,["tfdt"]).map(S=>{const E=S[0];let x=be(S,4);return E===1&&(x*=Math.pow(2,32),x+=be(S,8)),x/a})[0];return y!==void 0&&(s=y),Ce(g,["tfhd"]).map(S=>{const E=be(S,4),x=be(S,0)&16777215,T=(x&1)!==0,R=(x&2)!==0,L=(x&8)!==0;let _=0;const O=(x&16)!==0;let M=0;const G=(x&32)!==0;let w=8;E===l&&(T&&(w+=8),R&&(w+=4),L&&(_=be(S,w),w+=4),O&&(M=be(S,w),w+=4),G&&(w+=4),e.type==="video"&&(o=Mu(e.codec)),Ce(g,["trun"]).map($=>{const U=$[0],P=be($,0)&16777215,q=(P&1)!==0;let re=0;const ce=(P&4)!==0,oe=(P&256)!==0;let fe=0;const k=(P&512)!==0;let X=0;const J=(P&1024)!==0,le=(P&2048)!==0;let de=0;const C=be($,4);let F=8;q&&(re=be($,F),F+=4),ce&&(F+=4);let ee=re+d;for(let ae=0;ae<C;ae++){if(oe?(fe=be($,F),F+=4):fe=_,k?(X=be($,F),F+=4):X=M,J&&(F+=4),le&&(U===0?de=be($,F):de=yS($,F),F+=4),e.type===nt.VIDEO){let ue=0;for(;ue<X;){const he=be(i,ee);if(ee+=4,nD(o,i[ee])){const Se=i.subarray(ee,ee+he);Nh(Se,o?2:1,s+de/a,t)}ee+=he,ue+=he+4}}s+=fe/a}}))})})}),t}function Mu(s){if(!s)return!1;const e=s.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function nD(s,e){if(s){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Nh(s,e,t,i){const a=TS(s);let l=0;l+=e;let o=0,c=0,h=0;for(;l<a.length;){o=0;do{if(l>=a.length)break;h=a[l++],o+=h}while(h===255);c=0;do{if(l>=a.length)break;h=a[l++],c+=h}while(h===255);const d=a.length-l;let m=l;if(c<d)l+=c;else if(c>d){qe.error(`Malformed SEI payload. ${c} is too small, only ${d} bytes left to parse.`);break}if(o===4){if(a[m++]===181){const y=pS(a,m);if(m+=2,y===49){const S=be(a,m);if(m+=4,S===1195456820){const E=a[m++];if(E===3){const x=a[m++],T=31&x,R=64&x,L=R?2+T*3:0,_=new Uint8Array(L);if(R){_[0]=x;for(let O=1;O<L;O++)_[O]=a[m++]}i.push({type:E,payloadType:o,pts:t,bytes:_})}}}}}else if(o===5&&c>16){const g=[];for(let E=0;E<16;E++){const x=a[m++].toString(16);g.push(x.length==1?"0"+x:x),(E===3||E===5||E===7||E===9)&&g.push("-")}const y=c-16,S=new Uint8Array(y);for(let E=0;E<y;E++)S[E]=a[m++];i.push({payloadType:o,pts:t,uuid:g.join(""),userData:Si(S),userDataBytes:S})}}}function TS(s){const e=s.byteLength,t=[];let i=1;for(;i<e-2;)s[i]===0&&s[i+1]===0&&s[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return s;const a=e-t.length,l=new Uint8Array(a);let o=0;for(i=0;i<a;o++,i++)o===t[0]&&(o++,t.shift()),l[i]=s[o];return l}function sD(s){const e=s[0];let t="",i="",a=0,l=0,o=0,c=0,h=0,d=0;if(e===0){for(;Lt(s.subarray(d,d+1))!=="\0";)t+=Lt(s.subarray(d,d+1)),d+=1;for(t+=Lt(s.subarray(d,d+1)),d+=1;Lt(s.subarray(d,d+1))!=="\0";)i+=Lt(s.subarray(d,d+1)),d+=1;i+=Lt(s.subarray(d,d+1)),d+=1,a=be(s,12),l=be(s,16),c=be(s,20),h=be(s,24),d=28}else if(e===1){d+=4,a=be(s,d),d+=4;const g=be(s,d);d+=4;const y=be(s,d);for(d+=4,o=2**32*g+y,N_(o)||(o=Number.MAX_SAFE_INTEGER,qe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=be(s,d),d+=4,h=be(s,d),d+=4;Lt(s.subarray(d,d+1))!=="\0";)t+=Lt(s.subarray(d,d+1)),d+=1;for(t+=Lt(s.subarray(d,d+1)),d+=1;Lt(s.subarray(d,d+1))!=="\0";)i+=Lt(s.subarray(d,d+1)),d+=1;i+=Lt(s.subarray(d,d+1)),d+=1}const m=s.subarray(d,s.byteLength);return{schemeIdUri:t,value:i,timeScale:a,presentationTime:o,presentationTimeDelta:l,eventDuration:c,id:h,payload:m}}function rD(s,...e){const t=e.length;let i=8,a=t;for(;a--;)i+=e[a].byteLength;const l=new Uint8Array(i);for(l[0]=i>>24&255,l[1]=i>>16&255,l[2]=i>>8&255,l[3]=i&255,l.set(s,4),a=0,i=8;a<t;a++)l.set(e[a],i),i+=e[a].byteLength;return l}function aD(s,e,t){if(s.byteLength!==16)throw new RangeError("Invalid system id");let i,a;i=0,a=new Uint8Array;let l;i>0?(l=new Uint8Array(4),e.length>0&&new DataView(l.buffer).setUint32(0,e.length,!1)):l=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),rD([112,115,115,104],new Uint8Array([i,0,0,0]),s,l,a,o,t)}function lD(s){const e=[];if(s instanceof ArrayBuffer){const t=s.byteLength;let i=0;for(;i+32<t;){const a=new DataView(s,i),l=oD(a);e.push(l),i+=l.size}}return e}function oD(s){const e=s.getUint32(0),t=s.byteOffset,i=s.byteLength;if(i<e)return{offset:t,size:i};if(s.getUint32(4)!==1886614376)return{offset:t,size:e};const l=s.getUint32(8)>>>24;if(l!==0&&l!==1)return{offset:t,size:e};const o=s.buffer,c=Ft(new Uint8Array(o,t+12,16));let h=null,d=null,m=0;if(l===0)m=28;else{const y=s.getUint32(28);if(!y||i<32+y*16)return{offset:t,size:e};h=[];for(let S=0;S<y;S++)h.push(new Uint8Array(o,t+32+S*16,16));m=32+y*16}if(!m)return{offset:t,size:e};const g=s.getUint32(m);return e-32<g?{offset:t,size:e}:(d=new Uint8Array(o,t+m+4,g),{version:l,systemId:c,kids:h,data:d,offset:t,size:e})}const xS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Hr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function kh(s,e){const t=Hr[e];return!!t&&!!t[s.slice(0,4)]}function Ja(s,e,t=!0){return!s.split(",").some(i=>!Ph(i,e,t))}function Ph(s,e,t=!0){var i;const a=ms(t);return(i=a?.isTypeSupported(el(s,e)))!=null?i:!1}function el(s,e){return`${e}/mp4;codecs=${s}`}function Qy(s){if(s){const e=s.substring(0,4);return Hr.video[e]}return 2}function hu(s){const e=xS();return s.split(",").reduce((t,i)=>{const l=e&&Mu(i)?9:Hr.video[i];return l?(l*2+t)/(t?3:2):(Hr.audio[i]+t)/(t?2:1)},0)}const vd={};function uD(s,e=!0){if(vd[s])return vd[s];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[s];for(let a=0;a<t.length;a++){var i;if(Ph(t[a],"audio",e))return vd[s]=t[a],t[a];if(t[a]==="mp3"&&(i=ms(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return s}const cD=/flac|opus|mp4a\.40\.34/i;function mu(s,e=!0){return s.replace(cD,t=>uD(t.toLowerCase(),e))}function fD(s,e){const t=[];if(s){const i=s.split(",");for(let a=0;a<i.length;a++)kh(i[a],"video")||t.push(i[a])}return e&&t.push(e),t.join(",")}function tu(s,e){if(s&&(s.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(s)!==-1)&&(Wy(s,"audio")||Wy(s,"video")))return s;if(e){const t=e.split(",");if(t.length>1){if(s){for(let i=t.length;i--;)if(t[i].substring(0,4)===s.substring(0,4))return t[i]}return t[0]}}return e||s}function Wy(s,e){return kh(s,e)&&Ph(s,e)}function dD(s){const e=s.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function hD(s){if(s.startsWith("av01.")){const e=s.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return s}function Zy(s){const e=ms(s)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function ih(s){return s.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const mD={supported:!0,powerEfficient:!0,smooth:!0},gD={supported:!1,smooth:!1,powerEfficient:!1},bS={supported:!0,configurations:[],decodingInfoResults:[mD]};function AS(s,e){return{supported:!1,configurations:e,decodingInfoResults:[gD],error:s}}function pD(s,e,t,i,a,l){const o=s.videoCodec,c=s.audioCodec?s.audioGroups:null,h=l?.audioCodec,d=l?.channels,m=d?parseInt(d):h?1/0:2;let g=null;if(c!=null&&c.length)try{c.length===1&&c[0]?g=e.groups[c[0]].channels:g=c.reduce((y,S)=>{if(S){const E=e.groups[S];if(!E)throw new Error(`Audio track group ${S} not found`);Object.keys(E.channels).forEach(x=>{y[x]=(y[x]||0)+E.channels[x]})}return y},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(y=>Mu(y))||s.width>1920&&s.height>1088||s.height>1920&&s.width>1088||s.frameRate>Math.max(i,30)||s.videoRange!=="SDR"&&s.videoRange!==t||s.bitrate>Math.max(a,8e6))||!!g&&me(m)&&Object.keys(g).some(y=>parseInt(y)>m)}function RS(s,e,t,i={}){const a=s.videoCodec;if(!a&&!s.audioCodec||!t)return Promise.resolve(bS);const l=[],o=yD(s),c=o.length,h=vD(s,e,c>0),d=h.length;for(let m=c||1*d||1;m--;){const g={type:"media-source"};if(c&&(g.video=o[m%c]),d){g.audio=h[m%d];const y=g.audio.bitrate;g.video&&y&&(g.video.bitrate-=y)}l.push(g)}if(a){const m=navigator.userAgent;if(a.split(",").some(g=>Mu(g))&&xS())return Promise.resolve(AS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${m})`),l))}return Promise.all(l.map(m=>{const g=SD(m);return i[g]||(i[g]=t.decodingInfo(m))})).then(m=>({supported:!m.some(g=>!g.supported),configurations:l,decodingInfoResults:m})).catch(m=>({supported:!1,configurations:l,decodingInfoResults:[],error:m}))}function yD(s){var e;const t=(e=s.videoCodec)==null?void 0:e.split(","),i=LS(s),a=s.width||640,l=s.height||480,o=s.frameRate||30,c=s.videoRange.toLowerCase();return t?t.map(h=>{const d={contentType:el(hD(h),"video"),width:a,height:l,bitrate:i,framerate:o};return c!=="sdr"&&(d.transferFunction=c),d}):[]}function vD(s,e,t){var i;const a=(i=s.audioCodec)==null?void 0:i.split(","),l=LS(s);return a&&s.audioGroups?s.audioGroups.reduce((o,c)=>{var h;const d=c?(h=e.groups[c])==null?void 0:h.tracks:null;return d?d.reduce((m,g)=>{if(g.groupId===c){const y=parseFloat(g.channels||"");a.forEach(S=>{const E={contentType:el(S,"audio"),bitrate:t?ED(S,l):l};y&&(E.channels=""+y),m.push(E)})}return m},o):o},[]):[]}function ED(s,e){if(e<=1)return 1;let t=128e3;return s==="ec-3"?t=768e3:s==="ac-3"&&(t=64e4),Math.min(e/2,t)}function LS(s){return Math.ceil(Math.max(s.bitrate*.9,s.averageBitrate)/1e3)*1e3||1}function SD(s){let e="";const{audio:t,video:i}=s;if(i){const a=ih(i.contentType);e+=`${a}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const a=ih(t.contentType);e+=`${i?"_":""}${a}_c${t.channels}`}return e}const nh=["NONE","TYPE-0","TYPE-1",null];function TD(s){return nh.indexOf(s)>-1}const gu=["SDR","PQ","HLG"];function xD(s){return!!s&&gu.indexOf(s)>-1}var iu={No:"",Yes:"YES",v2:"v2"};function Jy(s){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=s,a=i<e/2;return e&&a?t?iu.v2:iu.Yes:iu.No}class ev{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class tl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return tv(this._audioGroups,e)}hasSubtitleGroup(e){return tv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function tv(s,e){return!e||!s?!1:s.indexOf(e)!==-1}function bD(){if(typeof matchMedia=="function"){const s=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(s.media!==e.media)return s.matches===!0}return!1}function AD(s,e){let t=!1,i=[];if(s&&(t=s!=="SDR",i=[s]),e){i=e.allowedVideoRanges||gu.slice(0);const a=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:a&&bD(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const RD=s=>{const e=new WeakSet;return(t,i)=>{if(s&&(i=s(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},st=(s,e)=>JSON.stringify(s,RD(e));function LD(s,e,t,i,a){const l=Object.keys(s),o=i?.channels,c=i?.audioCodec,h=a?.videoCodec,d=o&&parseInt(o)===2;let m=!1,g=!1,y=1/0,S=1/0,E=1/0,x=1/0,T=0,R=[];const{preferHDR:L,allowedVideoRanges:_}=AD(e,a);for(let $=l.length;$--;){const U=s[l[$]];m||(m=U.channels[2]>0),y=Math.min(y,U.minHeight),S=Math.min(S,U.minFramerate),E=Math.min(E,U.minBitrate),_.filter(q=>U.videoRanges[q]>0).length>0&&(g=!0)}y=me(y)?y:0,S=me(S)?S:0;const O=Math.max(1080,y),M=Math.max(30,S);E=me(E)?E:t,t=Math.max(E,t),g||(e=void 0);const G=l.length>1;return{codecSet:l.reduce(($,U)=>{const P=s[U];if(U===$)return $;if(R=g?_.filter(q=>P.videoRanges[q]>0):[],G){if(P.minBitrate>t)return Xi(U,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),$;if(!P.hasDefaultAudio)return Xi(U,"no renditions with default or auto-select sound found"),$;if(c&&U.indexOf(c.substring(0,4))%5!==0)return Xi(U,`audio codec preference "${c}" not found`),$;if(o&&!d){if(!P.channels[o])return Xi(U,`no renditions with ${o} channel sound found (channels options: ${Object.keys(P.channels)})`),$}else if((!c||d)&&m&&P.channels[2]===0)return Xi(U,"no renditions with stereo sound found"),$;if(P.minHeight>O)return Xi(U,`min resolution of ${P.minHeight} > maximum of ${O}`),$;if(P.minFramerate>M)return Xi(U,`min framerate of ${P.minFramerate} > maximum of ${M}`),$;if(!R.some(q=>P.videoRanges[q]>0))return Xi(U,`no variants with VIDEO-RANGE of ${st(R)} found`),$;if(h&&U.indexOf(h.substring(0,4))%5!==0)return Xi(U,`video codec preference "${h}" not found`),$;if(P.maxScore<T)return Xi(U,`max score of ${P.maxScore} < selected max of ${T}`),$}return $&&(hu(U)>=hu($)||P.fragmentError>s[$].fragmentError)?$:(x=P.minIndex,T=P.maxScore,U)},void 0),videoRanges:R,preferHDR:L,minFramerate:S,minBitrate:E,minIndex:x}}function Xi(s,e){qe.log(`[abr] start candidates with "${s}" ignored because ${e}`)}function _S(s){return s.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const a=t.channels||"2";return i.channels[a]=(i.channels[a]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function _D(s,e,t,i){return s.slice(t,i+1).reduce((a,l,o)=>{if(!l.codecSet)return a;const c=l.audioGroups;let h=a[l.codecSet];h||(a[l.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,l.bitrate);const d=Math.min(l.height,l.width);return h.minHeight=Math.min(h.minHeight,d),h.minFramerate=Math.min(h.minFramerate,l.frameRate),h.minIndex=Math.min(h.minIndex,o),h.maxScore=Math.max(h.maxScore,l.score),h.fragmentError+=l.fragmentError,h.videoRanges[l.videoRange]=(h.videoRanges[l.videoRange]||0)+1,c&&c.forEach(m=>{if(!m)return;const g=e.groups[m];g&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(y=>{h.channels[y]=(h.channels[y]||0)+g.channels[y]}))}),a},{})}function iv(s){if(!s)return s;const{lang:e,assocLang:t,characteristics:i,channels:a,audioCodec:l}=s;return{lang:e,assocLang:t,characteristics:i,channels:a,audioCodec:l}}function tn(s,e,t){if("attrs"in s){const i=e.indexOf(s);if(i!==-1)return i}for(let i=0;i<e.length;i++){const a=e[i];if(Hs(s,a,t))return i}return-1}function Hs(s,e,t){const{groupId:i,name:a,lang:l,assocLang:o,default:c}=s,h=s.forced;return(i===void 0||e.groupId===i)&&(a===void 0||e.name===a)&&(l===void 0||DD(l,e.lang))&&(l===void 0||e.assocLang===o)&&(c===void 0||e.default===c)&&(h===void 0||e.forced===h)&&(!("characteristics"in s)||ID(s.characteristics||"",e.characteristics))&&(t===void 0||t(s,e))}function DD(s,e="--"){return s.length===e.length?s===e:s.startsWith(e)||e.startsWith(s)}function ID(s,e=""){const t=s.split(","),i=e.split(",");return t.length===i.length&&!t.some(a=>i.indexOf(a)===-1)}function $s(s,e){const{audioCodec:t,channels:i}=s;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function CD(s,e,t,i,a){const l=e[i],c=e.reduce((y,S,E)=>{const x=S.uri;return(y[x]||(y[x]=[])).push(E),y},{})[l.uri];c.length>1&&(i=Math.max.apply(Math,c));const h=l.videoRange,d=l.frameRate,m=l.codecSet.substring(0,4),g=nv(e,i,y=>{if(y.videoRange!==h||y.frameRate!==d||y.codecSet.substring(0,4)!==m)return!1;const S=y.audioGroups,E=t.filter(x=>!S||S.indexOf(x.groupId)!==-1);return tn(s,E,a)>-1});return g>-1?g:nv(e,i,y=>{const S=y.audioGroups,E=t.filter(x=>!S||S.indexOf(x.groupId)!==-1);return tn(s,E,a)>-1})}function nv(s,e,t){for(let i=e;i>-1;i--)if(t(s[i]))return i;for(let i=e+1;i<s.length;i++)if(t(s[i]))return i;return-1}function pu(s,e){var t;return!!s&&s!==((t=e.loadLevelObj)==null?void 0:t.uri)}class OD extends Mi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:a,partCurrent:l,hls:o}=this,{autoLevelEnabled:c,media:h}=o;if(!a||!h)return;const d=performance.now(),m=l?l.stats:a.stats,g=l?l.duration:a.duration,y=d-m.loading.start,S=o.minAutoLevel,E=a.level,x=this._nextAutoLevel;if(m.aborted||m.loaded&&m.loaded===m.total||E<=S){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const T=x>-1&&x!==E,R=!!t||T;if(!R&&(h.paused||!h.playbackRate||!h.readyState))return;const L=o.mainForwardBufferInfo;if(!R&&L===null)return;const _=this.bwEstimator.getEstimateTTFB(),O=Math.abs(h.playbackRate);if(y<=Math.max(_,1e3*(g/(O*2))))return;const M=L?L.len/O:0,G=m.loading.first?m.loading.first-m.loading.start:-1,w=m.loaded&&G>-1,$=this.getBwEstimate(),U=o.levels,P=U[E],q=Math.max(m.loaded,Math.round(g*(a.bitrate||P.averageBitrate)/8));let re=w?y-G:y;re<1&&w&&(re=Math.min(y,m.loaded*8/$));const ce=w?m.loaded*1e3/re:0,oe=_/1e3,fe=ce?(q-m.loaded)/ce:q*8/$+oe;if(fe<=M)return;const k=ce?ce*8:$,X=((i=t?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,J=this.hls.config.abrBandWidthUpFactor;let le=Number.POSITIVE_INFINITY,de;for(de=E-1;de>S;de--){const ae=U[de].maxBitrate,ue=!U[de].details||X;if(le=this.getTimeToLoadFrag(oe,k,g*ae,ue),le<Math.min(M,g+oe))break}if(le>=fe||le>g*10)return;w?this.bwEstimator.sample(y-Math.min(_,G),m.loaded):this.bwEstimator.sampleTTFB(y);const C=U[de].maxBitrate;this.getBwEstimate()*J>C&&this.resetEstimator(C);const F=this.findBestLevel(C,S,de,0,M,1,1);F>-1&&(de=F),this.warn(`Fragment ${a.sn}${l?" part "+l.index:""} of level ${E} is loading too slowly;
      Fragment duration: ${a.duration.toFixed(3)}
      Time to underbuffer: ${M.toFixed(3)} s
      Estimated load time for current fragment: ${fe.toFixed(3)} s
      Estimated load time for down switch fragment: ${le.toFixed(3)} s
      TTFB estimate: ${G|0} ms
      Current BW estimate: ${me($)?$|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${de} @ ${C|0} bps`),o.nextLoadLevel=o.nextAutoLevel=de,this.clearTimer();const ee=()=>{if(this.clearTimer(),this.fragCurrent===a&&this.hls.loadLevel===de&&de>0){const ae=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${de>0?"and switching down":""}
      Fragment duration: ${a.duration.toFixed(3)} s
      Time to underbuffer: ${ae.toFixed(3)} s`),a.abortRequests(),this.fragCurrent=this.partCurrent=null,de>S){let ue=this.findBestLevel(this.hls.levels[S].bitrate,S,de,0,ae,1,1);ue===-1&&(ue=S),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ue,this.resetEstimator(this.hls.levels[ue].bitrate)}}};T||fe>le*2?ee():this.timer=self.setInterval(ee,le*1e3),o.trigger(A.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,part:l,stats:m})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new P_(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(A.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var a;this.fragCurrent=i,this.partCurrent=(a=t.part)!=null?a:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case z.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:a,partCurrent:l}=this;if(i&&a&&i.sn===a.sn&&i.level===a.level){const o=performance.now(),c=l?l.stats:i.stats,h=o-c.loading.start,d=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&d>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(g,d),c.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,i,a){const l=e+i/t,o=a?e+this.lastLevelLoadSec:0;return l+o}onLevelLoaded(e,t){const i=this.hls.config,{loading:a}=t.stats,l=a.end-a.first;me(l)&&(this.lastLevelLoadSec=l/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const a=i?i.stats:t.stats;if(t.type===ge.MAIN&&this.bwEstimator.sampleTTFB(a.loading.first-a.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const l=i?i.duration:t.duration,o=this.hls.levels[t.level],c=(o.loaded?o.loaded.bytes:0)+a.loaded,h=(o.loaded?o.loaded.duration:0)+l;o.loaded={bytes:c,duration:h},o.realBitrate=Math.round(8*c/h)}if(t.bitrateTest){const l={stats:a,frag:t,part:i,id:t.type};this.onFragBuffered(A.FRAG_BUFFERED,l),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:a}=t,l=a!=null&&a.stats.loaded?a.stats:i.stats;if(l.aborted||this.ignoreFragment(i))return;const o=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,l.loaded),l.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ge.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),a=this.hls.config.maxStarvationDelay,l=this.findBestLevel(i,t,e,0,a,1,1);if(l>-1)return l;const o=this.hls.firstLevel,c=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),a=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!a||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const l=i&&a?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,l)&&o[e].loadError<=o[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:a,config:l,minAutoLevel:o}=i,c=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),d=this.getStarvationDelay();let m=l.abrBandWidthFactor,g=l.abrBandWidthUpFactor;if(d){const T=this.findBestLevel(h,o,a,d,0,m,g);if(T>=0)return this.rebufferNotice=-1,T}let y=c?Math.min(c,l.maxStarvationDelay):l.maxStarvationDelay;if(!d){const T=this.bitrateTestDelay;T&&(y=(c?Math.min(c,l.maxLoadingDelay):l.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),m=g=1)}const S=this.findBestLevel(h,o,a,d,y,m,g);if(this.rebufferNotice!==S&&(this.rebufferNotice=S,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${S}`)),S>-1)return S;const E=i.levels[o],x=i.loadLevelObj;return x&&E?.bitrate<x.bitrate?o:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,a=e.mainForwardBufferInfo;return(a?a.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,a,l,o,c){var h;const d=a+l,m=this.lastLoadedFragLevel,g=m===-1?this.hls.firstLevel:m,{fragCurrent:y,partCurrent:S}=this,{levels:E,allAudioTracks:x,loadLevel:T,config:R}=this.hls;if(E.length===1)return 0;const L=E[g],_=!!((h=this.hls.latestLevelDetails)!=null&&h.live),O=T===-1||m===-1;let M,G="SDR",w=L?.frameRate||0;const{audioPreference:$,videoPreference:U}=R,P=this.audioTracksByGroup||(this.audioTracksByGroup=_S(x));let q=-1;if(O){if(this.firstSelection!==-1)return this.firstSelection;const k=this.codecTiers||(this.codecTiers=_D(E,P,t,i)),X=LD(k,G,e,$,U),{codecSet:J,videoRanges:le,minFramerate:de,minBitrate:C,minIndex:F,preferHDR:ee}=X;q=F,M=J,G=ee?le[le.length-1]:le[0],w=de,e=Math.max(e,C),this.log(`picked start tier ${st(X)}`)}else M=L?.codecSet,G=L?.videoRange;const re=S?S.duration:y?y.duration:0,ce=this.bwEstimator.getEstimateTTFB()/1e3,oe=[];for(let k=i;k>=t;k--){var fe;const X=E[k],J=k>g;if(!X)continue;if(R.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const ue=navigator.mediaCapabilities;typeof ue?.decodingInfo=="function"&&pD(X,P,G,w,e,$)?(X.supportedPromise=RS(X,P,ue,this.supportedCache),X.supportedPromise.then(he=>{if(!this.hls)return;X.supportedResult=he;const Se=this.hls.levels,Fe=Se.indexOf(X);he.error?this.warn(`MediaCapabilities decodingInfo error: "${he.error}" for level ${Fe} ${st(he)}`):he.supported?he.decodingInfoResults.some(we=>we.smooth===!1||we.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Fe} not smooth or powerEfficient: ${st(he)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Fe} ${st(he)}`),Fe>-1&&Se.length>1&&(this.log(`Removing unsupported level ${Fe}`),this.hls.removeLevel(Fe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(he=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${he}`)})):X.supportedResult=bS}if((M&&X.codecSet!==M||G&&X.videoRange!==G||J&&w>X.frameRate||!J&&w>0&&w<X.frameRate||(fe=X.supportedResult)!=null&&(fe=fe.decodingInfoResults)!=null&&fe.some(ue=>ue.smooth===!1))&&(!O||k!==q)){oe.push(k);continue}const le=X.details,de=(S?le?.partTarget:le?.averagetargetduration)||re;let C;J?C=c*e:C=o*e;const F=re&&a>=re*2&&l===0?X.averageBitrate:X.maxBitrate,ee=this.getTimeToLoadFrag(ce,C,F*de,le===void 0);if(C>=F&&(k===m||X.loadError===0&&X.fragmentError===0)&&(ee<=ce||!me(ee)||_&&!this.bitrateTestDelay||ee<d)){const ue=this.forcedAutoLevel;return k!==T&&(ue===-1||ue!==T)&&(oe.length&&this.trace(`Skipped level(s) ${oe.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${E[oe[0]].codecs}" ${E[oe[0]].videoRange}; not compatible with "${M}" ${G}`),this.info(`switch candidate:${g}->${k} adjustedbw(${Math.round(C)})-bitrate=${Math.round(C-F)} ttfb:${ce.toFixed(1)} avgDuration:${de.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${ee.toFixed(1)} firstSelection:${O} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${T}`)),O&&(this.firstSelection=k),k}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const DS={search:function(s,e){let t=0,i=s.length-1,a=null,l=null;for(;t<=i;){a=(t+i)/2|0,l=s[a];const o=e(l);if(o>0)t=a+1;else if(o<0)i=a-1;else return l}return null}};function wD(s,e,t){if(e===null||!Array.isArray(s)||!s.length||!me(e))return null;const i=s[0].programDateTime;if(e<(i||0))return null;const a=s[s.length-1].endProgramDateTime;if(e>=(a||0))return null;for(let l=0;l<s.length;++l){const o=s[l];if(ND(e,t,o))return o}return null}function Vs(s,e,t=0,i=0,a=.005){let l=null;if(s){l=e[1+s.sn-e[0].sn]||null;const c=s.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),l&&s.level!==l.level&&l.end<=s.end&&(l=e[2+s.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(l=e[0]);if(l&&((!s||s.level===l.level)&&sv(t,i,l)===0||MD(l,s,Math.min(a,i))))return l;const o=DS.search(e,sv.bind(null,t,i));return o&&(o!==s||!l)?o:l}function MD(s,e,t){if(e&&e.start===0&&e.level<s.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((a,l)=>(l[0]==="INF"&&(a+=parseFloat(l[1])),a),t);return s.start<=i}return!1}function sv(s=0,e=0,t){if(t.start<=s&&t.start+t.duration>s)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=s?1:t.start-i>s&&t.start?-1:0}function ND(s,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>s}function IS(s,e,t){if(s&&s.startCC<=e&&s.endCC>=e){let i=s.fragments;const{fragmentHint:a}=s;a&&(i=i.concat(a));let l;return DS.search(i,o=>o.cc<e?1:o.cc>e?-1:(l=o,o.end<=t?1:o.start>t?-1:0)),l||null}return null}function yu(s){switch(s.details){case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_TIMEOUT:case z.LEVEL_LOAD_TIMEOUT:case z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function CS(s){return s.details.startsWith("key")}function OS(s){return CS(s)&&!!s.frag&&!s.frag.decryptdata}function rv(s,e){const t=yu(e);return s.default[`${t?"timeout":"error"}Retry`]}function Uh(s,e){const t=s.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*s.retryDelayMs,s.maxRetryDelayMs)}function av(s){return Ye(Ye({},s),{errorRetry:null,timeoutRetry:null})}function vu(s,e,t,i){if(!s)return!1;const a=i?.code,l=e<s.maxNumRetry&&(kD(a)||!!t);return s.shouldRetry?s.shouldRetry(s,e,t,i,l):l}function kD(s){return sh(s)||!!s&&(s<400||s>499)}function sh(s){return s===0&&navigator.onLine===!1}var Ut={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},pi={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class PD extends Mi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.ERROR,this.onError,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.ERROR,this.onError,this),e.off(A.ERROR,this.onErrorOut,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===ge.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;const a=e.audioGroups;if(a)return this.hls.allAudioTracks.filter(o=>a.indexOf(o.groupId)>=0).some(o=>{var c;return(c=o.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const a=this.hls,l=t.context;switch(t.details){case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case z.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Fr();return}case z.FRAG_GAP:case z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ut.SendAlternateToPenaltyBox;return}case z.LEVEL_EMPTY_ERROR:case z.LEVEL_PARSING_ERROR:{var o;const h=t.parent===ge.MAIN?t.level:a.loadLevel;t.details===z.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:typeof l?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.SUBTITLE_LOAD_ERROR:case z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){const h=a.loadLevelObj;if(h&&(l.type===Oe.AUDIO_TRACK&&h.hasAudioGroup(l.groupId)||l.type===Oe.SUBTITLE_TRACK&&h.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.loadLevel),t.errorAction.action=Ut.SendAlternateToPenaltyBox,t.errorAction.flags=pi.MoveAllAlternatesMatchingHost;return}}return;case z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Ut.SendAlternateToPenaltyBox,flags:pi.MoveAllAlternatesMatchingHDCP};return;case z.KEY_SYSTEM_SESSION_UPDATE_FAILED:case z.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case z.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Ut.SendAlternateToPenaltyBox,flags:pi.MoveAllAlternatesMatchingKey};return;case z.BUFFER_ADD_CODEC_ERROR:case z.REMUX_ALLOC_ERROR:case z.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:a.loadLevel)}return;case z.INTERNAL_EXCEPTION:case z.BUFFER_APPENDING_ERROR:case z.BUFFER_FULL_ERROR:case z.LEVEL_SWITCH_ERROR:case z.BUFFER_STALLED_ERROR:case z.BUFFER_SEEK_OVER_HOLE:case z.BUFFER_NUDGE_ON_STALL:t.errorAction=Fr();return}t.type===Ee.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Fr())}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,a=rv(i.config.playlistLoadPolicy,e),l=this.playlistError++;if(vu(a,l,yu(e),e.response))return{action:Ut.RetryRequest,flags:pi.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,t);return a&&(c.retryConfig=a,c.retryCount=l),c}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),a=t.levels[i],{fragLoadPolicy:l,keyLoadPolicy:o}=t.config,c=rv(CS(e)?o:l,e),h=t.levels.reduce((m,g)=>m+g.fragmentError,0);if(a&&(e.details!==z.FRAG_GAP&&a.fragmentError++,!OS(e)&&vu(c,h,yu(e),e.response)))return{action:Ut.RetryRequest,flags:pi.None,retryConfig:c,retryCount:h};const d=this.getLevelSwitchAction(e,i);return c&&(d.retryConfig=c,d.retryCount=h),d}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const a=this.hls.levels[t];if(a){var l,o;const d=e.details;a.loadError++,d===z.BUFFER_APPEND_ERROR&&a.fragmentError++;let m=-1;const{levels:g,loadLevel:y,minAutoLevel:S,maxAutoLevel:E}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const x=(l=e.frag)==null?void 0:l.type,R=(x===ge.AUDIO&&d===z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:G})=>a.audioCodec!==G),_=e.sourceBufferName==="video"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR)&&g.some(({codecSet:G,audioCodec:w})=>a.codecSet!==G&&a.audioCodec===w),{type:O,groupId:M}=(o=e.context)!=null?o:{};for(let G=g.length;G--;){const w=(G+y)%g.length;if(w!==y&&w>=S&&w<=E&&g[w].loadError===0){var c,h;const $=g[w];if(d===z.FRAG_GAP&&x===ge.MAIN&&e.frag){const U=g[w].details;if(U){const P=Vs(e.frag,U.fragments,e.frag.start);if(P!=null&&P.gap)continue}}else{if(O===Oe.AUDIO_TRACK&&$.hasAudioGroup(M)||O===Oe.SUBTITLE_TRACK&&$.hasSubtitleGroup(M))continue;if(x===ge.AUDIO&&(c=a.audioGroups)!=null&&c.some(U=>$.hasAudioGroup(U))||x===ge.SUBTITLE&&(h=a.subtitleGroups)!=null&&h.some(U=>$.hasSubtitleGroup(U))||R&&a.audioCodec===$.audioCodec||_&&a.codecSet===$.codecSet||!R&&a.codecSet!==$.codecSet)continue}m=w;break}}if(m>-1&&i.loadLevel!==m)return e.levelRetry=!0,this.playlistError=0,{action:Ut.SendAlternateToPenaltyBox,flags:pi.None,nextAutoLevel:m}}return{action:Ut.SendAlternateToPenaltyBox,flags:pi.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case Ut.DoNothing:break;case Ut.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:a}=i,l=i.nextAutoLevel;switch(a){case pi.None:this.switchLevel(e,l);break;case pi.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),d=t.levels[h],m=d?.attrs["HDCP-LEVEL"];if(i.hdcpLevel=m,m==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(m){t.maxHdcpLevel=nh[nh.indexOf(m)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case pi.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const d=this.hls.levels,m=d.length;for(let y=m;y--;)if(this.variantHasKey(d[y],h)){var o,c;this.log(`Banned key found in level ${y} (${d[y].bitrate}bps) or audio group "${(o=d[y].audioGroups)==null?void 0:o.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${Ft(h.keyId||[])}`),d[y].fragmentError++,d[y].loadError++,this.log(`Removing level ${y} with key error (${e.error})`),this.hls.removeLevel(y)}const g=e.frag;if(this.hls.levels.length<m)i.resolved=!0;else if(g&&g.type!==ge.MAIN){const y=g.decryptdata;y&&!h.matches(y)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,l)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=ih(e.mimeType),a=this.hls.levels;for(let l=a.length;l--;)a[l][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${l} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(l))}}}function Fr(s){const e={action:Ut.DoNothing,flags:pi.None};return s&&(e.resolved=!0),e}var _t={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class UD{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let a=i.length;a--;){const l=i[a];if(!l)break;if(l.start<=e&&e<=l.end&&l.loaded)return l}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:a}=this,l=Object.keys(a);for(let o=l.length;o--;){const c=a[l[o]];if(c?.body.type===t&&(!i||c.buffered)){const h=c.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,i,a,l){this.timeRanges&&(this.timeRanges[e]=t);const o=a?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const h=this.fragments[c];if(!h||o>=h.body.sn)return;if(!h.buffered&&(!h.loaded||l)){h.body.type===i&&this.removeFragment(h.body);return}const d=h.range[e];if(d){if(d.time.length===0){this.removeFragment(h.body);return}d.time.some(m=>{const g=!this.isTimeBuffered(m.startPTS,m.endPTS,t);return g&&this.removeFragment(h.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,a=Or(i),l=this.fragments[a];if(!l||l.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach(c=>{const h=i.elementaryStreams[c];if(!h)return;const d=t[c],m=o||h.partial===!0;l.range[c]=this.getBufferedTimes(i,e.part,m,d)}),l.loaded=null,Object.keys(l.range).length?(this.bufferedEnd(l,i),Uo(l)||this.removeParts(i.sn-1,i.type)):this.removeFragment(l.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=lv(i,a=>a.fragment.sn>=e))}fragBuffered(e,t){const i=Or(e);let a=this.fragments[i];!a&&t&&(a=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),a&&(a.loaded=null,this.bufferedEnd(a,e))}getBufferedTimes(e,t,i,a){const l={time:[],partial:i},o=e.start,c=e.end,h=e.minEndPTS||c,d=e.maxStartPTS||o;for(let m=0;m<a.length;m++){const g=a.start(m)-this.bufferPadding,y=a.end(m)+this.bufferPadding;if(d>=g&&h<=y){l.time.push({startPTS:Math.max(o,a.start(m)),endPTS:Math.min(c,a.end(m))});break}else if(o<y&&c>g){const S=Math.max(o,a.start(m)),E=Math.min(c,a.end(m));E>S&&(l.partial=!0,l.time.push({startPTS:S,endPTS:E}))}else if(c<=g)break}return l}getPartialFragment(e){let t=null,i,a,l,o=0;const{bufferPadding:c,fragments:h}=this;return Object.keys(h).forEach(d=>{const m=h[d];m&&Uo(m)&&(a=m.body.start-c,l=m.body.end+c,e>=a&&e<=l&&(i=Math.min(e-a,l-e),o<=i&&(t=m.body,o=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Uo(t))}getState(e){const t=Or(e),i=this.fragments[t];return i?i.buffered?Uo(i)?_t.PARTIAL:_t.OK:_t.APPENDING:_t.NOT_LOADED}isTimeBuffered(e,t,i){let a,l;for(let o=0;o<i.length;o++){if(a=i.start(o)-this.bufferPadding,l=i.end(o)+this.bufferPadding,e>=a&&t<=l)return!0;if(t<=a)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,a=t.part?null:t,l=Or(i);this.fragments[l]={body:i,appendedPTS:null,loaded:a,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:a,timeRanges:l,type:o}=t;if(i.sn==="initSegment")return;const c=i.type;if(a){let d=this.activePartLists[c];d||(this.activePartLists[c]=d=[]),d.push(a)}this.timeRanges=l;const h=l[o];this.detectEvictedFragments(o,h,c,a)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Or(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let a=i.length;a--;){const l=t[i[a]];if(l?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,a,l){a&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const c=this.fragments[o];if(!c)return;const h=c.body;h.type!==i||a&&!h.gap||h.start<t&&h.end>e&&(c.buffered||l)&&this.removeFragment(h)})}removeFragment(e){const t=Or(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const a=e.sn;this.activePartLists[e.type]=lv(i,l=>l.fragment.sn!==a)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}}function Uo(s){var e,t,i;return s.buffered&&!!(s.body.gap||(e=s.range.video)!=null&&e.partial||(t=s.range.audio)!=null&&t.partial||(i=s.range.audiovideo)!=null&&i.partial)}function Or(s){return`${s.type}_${s.level}_${s.sn}`}function lv(s,e){return s.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var gs={cbc:0,ctr:1};class FD{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case gs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case gs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function BD(s){const e=s.byteLength,t=e&&new DataView(s.buffer).getUint8(e-1);return t?s.slice(0,e-t):s}class $D{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let a=0;a<4;a++)i[a]=t.getUint32(a*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,a=i[0],l=i[1],o=i[2],c=i[3],h=this.invSubMix,d=h[0],m=h[1],g=h[2],y=h[3],S=new Uint32Array(256);let E=0,x=0,T=0;for(T=0;T<256;T++)T<128?S[T]=T<<1:S[T]=T<<1^283;for(T=0;T<256;T++){let R=x^x<<1^x<<2^x<<3^x<<4;R=R>>>8^R&255^99,e[E]=R,t[R]=E;const L=S[E],_=S[L],O=S[_];let M=S[R]*257^R*16843008;a[E]=M<<24|M>>>8,l[E]=M<<16|M>>>16,o[E]=M<<8|M>>>24,c[E]=M,M=O*16843009^_*65537^L*257^E*16843008,d[R]=M<<24|M>>>8,m[R]=M<<16|M>>>16,g[R]=M<<8|M>>>24,y[R]=M,E?(E=L^S[S[S[O^L]]],x^=S[S[x]]):E=x=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,a=0;for(;a<t.length&&i;)i=t[a]===this.key[a],a++;if(i)return;this.key=t;const l=this.keySize=t.length;if(l!==4&&l!==6&&l!==8)throw new Error("Invalid aes key size="+l);const o=this.ksRows=(l+6+1)*4;let c,h;const d=this.keySchedule=new Uint32Array(o),m=this.invKeySchedule=new Uint32Array(o),g=this.sBox,y=this.rcon,S=this.invSubMix,E=S[0],x=S[1],T=S[2],R=S[3];let L,_;for(c=0;c<o;c++){if(c<l){L=d[c]=t[c];continue}_=L,c%l===0?(_=_<<8|_>>>24,_=g[_>>>24]<<24|g[_>>>16&255]<<16|g[_>>>8&255]<<8|g[_&255],_^=y[c/l|0]<<24):l>6&&c%l===4&&(_=g[_>>>24]<<24|g[_>>>16&255]<<16|g[_>>>8&255]<<8|g[_&255]),d[c]=L=(d[c-l]^_)>>>0}for(h=0;h<o;h++)c=o-h,h&3?_=d[c]:_=d[c-4],h<4||c<=4?m[h]=_:m[h]=E[g[_>>>24]]^x[g[_>>>16&255]]^T[g[_>>>8&255]]^R[g[_&255]],m[h]=m[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const a=this.keySize+6,l=this.invKeySchedule,o=this.invSBox,c=this.invSubMix,h=c[0],d=c[1],m=c[2],g=c[3],y=this.uint8ArrayToUint32Array_(i);let S=y[0],E=y[1],x=y[2],T=y[3];const R=new Int32Array(e),L=new Int32Array(R.length);let _,O,M,G,w,$,U,P,q,re,ce,oe,fe,k;const X=this.networkToHostOrderSwap;for(;t<R.length;){for(q=X(R[t]),re=X(R[t+1]),ce=X(R[t+2]),oe=X(R[t+3]),w=q^l[0],$=oe^l[1],U=ce^l[2],P=re^l[3],fe=4,k=1;k<a;k++)_=h[w>>>24]^d[$>>16&255]^m[U>>8&255]^g[P&255]^l[fe],O=h[$>>>24]^d[U>>16&255]^m[P>>8&255]^g[w&255]^l[fe+1],M=h[U>>>24]^d[P>>16&255]^m[w>>8&255]^g[$&255]^l[fe+2],G=h[P>>>24]^d[w>>16&255]^m[$>>8&255]^g[U&255]^l[fe+3],w=_,$=O,U=M,P=G,fe=fe+4;_=o[w>>>24]<<24^o[$>>16&255]<<16^o[U>>8&255]<<8^o[P&255]^l[fe],O=o[$>>>24]<<24^o[U>>16&255]<<16^o[P>>8&255]<<8^o[w&255]^l[fe+1],M=o[U>>>24]<<24^o[P>>16&255]<<16^o[w>>8&255]<<8^o[$&255]^l[fe+2],G=o[P>>>24]<<24^o[w>>16&255]<<16^o[$>>8&255]<<8^o[U&255]^l[fe+3],L[t]=X(_^S),L[t+1]=X(G^E),L[t+2]=X(M^x),L[t+3]=X(O^T),S=q,E=re,x=ce,T=oe,t=t+4}return L.buffer}}class GD{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=jD(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function jD(s){switch(s){case gs.cbc:return"AES-CBC";case gs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${s}`)}}const HD=16;class Fh{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?BD(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,a){return this.useSoftware?new Promise((l,o)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,i,a);const h=this.flush();h?l(h.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,a)}softwareDecrypt(e,t,i,a){const{currentIV:l,currentResult:o,remainderData:c}=this;if(a!==gs.cbc||t.byteLength!==16)return qe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=wi(c,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;l&&(i=l);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new $D),d.expandKey(t);const m=o;return this.currentResult=d.decrypt(h.buffer,0,i),this.currentIV=h.slice(-16).buffer,m||null}webCryptoDecrypt(e,t,i,a){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,a));this.key=t,this.fastAesKey=new GD(this.subtle,t,a)}return this.fastAesKey.expandKey().then(l=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new FD(this.subtle,new Uint8Array(i),a).decrypt(e.buffer,l)):Promise.reject(new Error("web crypto not initialized"))).catch(l=>(qe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${l.name}: ${l.message}`),this.onWebCryptoError(e,t,i,a)))}onWebCryptoError(e,t,i,a){const l=this.enableSoftwareAES;if(l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,a);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(l?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%HD;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(qe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const ov=Math.pow(2,17);class zD{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new In({type:Ee.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const a=this.config,l=a.fLoader,o=a.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(E=>E[0]==="GAP")){h(cv(e));return}else e.gap=!1;const d=this.loader=l?new l(a):new o(a),m=uv(e);e.loader=d;const g=av(a.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:ov};e.stats=d.stats;const S={onSuccess:(E,x,T,R)=>{this.resetLoader(e,d);let L=E.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(L.slice(0,16)),L=L.slice(16)),c({frag:e,part:null,payload:L,networkDetails:R})},onError:(E,x,T,R)=>{this.resetLoader(e,d),h(new In({type:Ee.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ye({url:i,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:T,stats:R}))},onAbort:(E,x,T)=>{this.resetLoader(e,d),h(new In({type:Ee.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:E}))},onTimeout:(E,x,T)=>{this.resetLoader(e,d),h(new In({type:Ee.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:T,stats:E}))}};t&&(S.onProgress=(E,x,T,R)=>t({frag:e,part:null,payload:T,networkDetails:R})),d.load(m,y,S)})}loadPart(e,t,i){this.abort();const a=this.config,l=a.fLoader,o=a.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(cv(e,t));return}const d=this.loader=l?new l(a):new o(a),m=uv(e,t);e.loader=d;const g=av(a.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ov};t.stats=d.stats,d.load(m,y,{onSuccess:(S,E,x,T)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const R={frag:e,part:t,payload:S.data,networkDetails:T};i(R),c(R)},onError:(S,E,x,T)=>{this.resetLoader(e,d),h(new In({type:Ee.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ye({url:m.url,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:x,stats:T}))},onAbort:(S,E,x)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),h(new In({type:Ee.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:x,stats:S}))},onTimeout:(S,E,x)=>{this.resetLoader(e,d),h(new In({type:Ee.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:x,stats:S}))}})})}updateStatsFromPart(e,t){const i=e.stats,a=t.stats,l=a.total;if(i.loaded+=a.loaded,l){const h=Math.round(e.duration/t.duration),d=Math.min(Math.round(i.loaded/l),h),g=(h-d)*Math.round(i.loaded/d);i.total=i.loaded+g}else i.total=Math.max(i.loaded,i.total);const o=i.loading,c=a.loading;o.start?o.first+=c.first-c.start:(o.start=c.start,o.first=c.first),o.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function uv(s,e=null){const t=e||s,i={frag:s,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},a=t.byteRangeStartOffset,l=t.byteRangeEndOffset;if(me(a)&&me(l)){var o;let c=a,h=l;if(s.sn==="initSegment"&&VD((o=s.decryptdata)==null?void 0:o.method)){const d=l-a;d%16&&(h=l+(16-d%16)),a!==0&&(i.resetIV=!0,c=a-16)}i.rangeStart=c,i.rangeEnd=h}return i}function cv(s,e){const t=new Error(`GAP ${s.gap?"tag":"attribute"} found`),i={type:Ee.MEDIA_ERROR,details:z.FRAG_GAP,fatal:!1,frag:s,error:t,networkDetails:null};return e&&(i.part=e),(e||s).stats.aborted=!0,new In(i)}function VD(s){return s==="AES-128"||s==="AES-256"}class In extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class wS extends Mi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Bh{constructor(e,t,i,a=0,l=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Fo(),this.buffering={audio:Fo(),video:Fo(),audiovideo:Fo()},this.level=e,this.sn=t,this.id=i,this.size=a,this.part=l,this.partial=o}}function Fo(){return{start:0,executeStart:0,executeEnd:0,end:0}}const fv={length:0,start:()=>0,end:()=>0};class Ae{static isBuffered(e,t){if(e){const i=Ae.getBuffered(e);for(let a=i.length;a--;)if(t>=i.start(a)&&t<=i.end(a))return!0}return!1}static bufferedRanges(e){if(e){const t=Ae.getBuffered(e);return Ae.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const a=Ae.bufferedRanges(e);if(a.length)return Ae.bufferedInfo(a,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((m,g)=>m.start-g.start||g.end-m.end);let a=-1,l=[];if(i)for(let m=0;m<e.length;m++){t>=e[m].start&&t<=e[m].end&&(a=m);const g=l.length;if(g){const y=l[g-1].end;e[m].start-y<i?e[m].end>y&&(l[g-1].end=e[m].end):l.push(e[m])}else l.push(e[m])}else l=e;let o=0,c,h=t,d=t;for(let m=0;m<l.length;m++){const g=l[m].start,y=l[m].end;if(a===-1&&t>=g&&t<=y&&(a=m),t+i>=g&&t<y)h=g,d=y,o=d-t;else if(t+i<g){c=g;break}}return{len:o,start:h||0,end:d||0,nextStart:c,buffered:e,bufferedIndex:a}}static getBuffered(e){try{return e.buffered||fv}catch(t){return qe.log("failed to get media.buffered",t),fv}}}const MS=/\{\$([a-zA-Z0-9-_]+)\}/g;function dv(s){return MS.test(s)}function rh(s,e){if(s.variableList!==null||s.hasVariableRefs){const t=s.variableList;return e.replace(MS,i=>{const a=i.substring(2,i.length-1),l=t?.[a];return l===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${a}"`)),i):l})}return e}function hv(s,e,t){let i=s.variableList;i||(s.variableList=i={});let a,l;if("QUERYPARAM"in e){a=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(a))l=o.get(a);else throw new Error(`"${a}" does not match any query parameter in URI: "${t}"`)}catch(o){s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else a=e.NAME,l=e.VALUE;a in i?s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${a}"`)):i[a]=l||""}function KD(s,e,t){const i=e.IMPORT;if(t&&i in t){let a=s.variableList;a||(s.variableList=a={}),a[i]=t[i]}else s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const YD=/^(\d+)x(\d+)$/,mv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ot{constructor(e,t){typeof e=="string"&&(e=ot.parseAttrList(e,t)),Je(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let a=0;a<t.length/2;a++)i[a]=parseInt(t.slice(a*2,a*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((a,l)=>(a[l.toLowerCase()]=!0,a),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=YD.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const a={};for(mv.lastIndex=0;(i=mv.exec(e))!==null;){const o=i[1].trim();let c=i[2];const h=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let d=!1;if(h)c=c.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(h||d))c=rh(t,c);else if(!d&&!h)switch(o){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":qe.warn(`${e}: attribute ${o} is missing quotes`)}a[o]=c}return a}}const qD="com.apple.hls.interstitial";function XD(s){return s!=="ID"&&s!=="CLASS"&&s!=="CUE"&&s!=="START-DATE"&&s!=="DURATION"&&s!=="END-DATE"&&s!=="END-ON-NEXT"}function QD(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"||s==="SCTE35-CMD"}class NS{constructor(e,t,i=0){var a;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(a=t?.tagOrder)!=null?a:i,t){const l=t.attr;for(const o in l)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==l[o]){qe.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Je(new ot({}),l,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const l=t?.endDate||new Date(this.attr["END-DATE"]);me(l.getTime())&&(this._endDate=l)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(qe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(me(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===qD}get isValid(){return!!this.id&&!this._badValueForSameId&&me(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const WD=10;class ZD{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?me(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||WD}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Eu(s,e){return s.length===e.length?!s.some((t,i)=>t!==e[i]):!1}function gv(s,e){return!s&&!e?!0:!s||!e?!1:Eu(s,e)}function Br(s){return s==="AES-128"||s==="AES-256"||s==="AES-256-CTR"}function $h(s){switch(s){case"AES-128":case"AES-256":return gs.cbc;case"AES-256-CTR":return gs.ctr;default:throw new Error(`invalid full segment method ${s}`)}}function Gh(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0))}function ah(s){return Uint8Array.from(unescape(encodeURIComponent(s)),e=>e.charCodeAt(0))}function JD(s){const e=ah(s).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function kS(s){const e=function(i,a,l){const o=i[a];i[a]=i[l],i[l]=o};e(s,0,3),e(s,1,2),e(s,4,5),e(s,6,7)}function PS(s){const e=s.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),a=i[i.length-1].split(",");if(a.length===2){const l=a[0]==="base64",o=a[1];l?(i.splice(-1,1),t=Gh(o)):t=JD(o)}}return t}const Su=typeof self<"u"?self:void 0;var ut={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Bt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function nu(s){switch(s){case Bt.FAIRPLAY:return ut.FAIRPLAY;case Bt.PLAYREADY:return ut.PLAYREADY;case Bt.WIDEVINE:return ut.WIDEVINE;case Bt.CLEARKEY:return ut.CLEARKEY}}function Ed(s){switch(s){case ut.FAIRPLAY:return Bt.FAIRPLAY;case ut.PLAYREADY:return Bt.PLAYREADY;case ut.WIDEVINE:return Bt.WIDEVINE;case ut.CLEARKEY:return Bt.CLEARKEY}}function qa(s){const{drmSystems:e,widevineLicenseUrl:t}=s,i=e?[ut.FAIRPLAY,ut.WIDEVINE,ut.PLAYREADY,ut.CLEARKEY].filter(a=>!!e[a]):[];return!i[ut.WIDEVINE]&&t&&i.push(ut.WIDEVINE),i}const US=(function(s){return Su!=null&&(s=Su.navigator)!=null&&s.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function eI(s,e,t,i){let a;switch(s){case ut.FAIRPLAY:a=["cenc","sinf"];break;case ut.WIDEVINE:case ut.PLAYREADY:a=["cenc"];break;case ut.CLEARKEY:a=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${s}`)}return tI(a,e,t,i)}function tI(s,e,t,i){return[{initDataTypes:s,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(l=>({contentType:`audio/mp4; codecs=${l}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(l=>({contentType:`video/mp4; codecs=${l}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function iI(s){var e;return!!s&&(s.sessionType==="persistent-license"||!!((e=s.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function FS(s){const e=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const c=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(c){const h=Gh(c).subarray(0,16);return kS(h),h}}return null}let wr={};class ds{static clearKeyUriToKeyIdMap(){wr={}}static setKeyIdForUri(e,t){wr[e]=t}static addKeyIdForUri(e){const t=Object.keys(wr).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,t),wr[e]=i,i}constructor(e,t,i,a=[1],l=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=a,this.iv=l,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Br(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(dS(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Eu(e.keyFormatVersions,this.keyFormatVersions)&&gv(e.iv,this.iv)&&gv(e.keyId,this.keyId)}isSupported(){if(this.method){if(Br(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Bt.FAIRPLAY:case Bt.WIDEVINE:case Bt.PLAYREADY:case Bt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Br(this.method)){let l=this.iv;return l||(typeof e!="number"&&(qe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),l=sI(e)),new ds(this.method,this.uri,"identity",this.keyFormatVersions,l)}if(this.keyId){const l=wr[this.uri];if(l&&!Eu(this.keyId,l)&&ds.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=PS(this.uri);if(i)switch(this.keyFormat){case Bt.WIDEVINE:if(this.pssh=i,!this.keyId){const l=lD(i.buffer);if(l.length){var a;const o=l[0];this.keyId=(a=o.kids)!=null&&a.length?o.kids[0]:null}}this.keyId||(this.keyId=pv(t));break;case Bt.PLAYREADY:{const l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=aD(l,null,i),this.keyId=FS(i);break}default:{let l=i.subarray(0,16);if(l.length!==16){const o=new Uint8Array(16);o.set(l,16-l.length),l=o}this.keyId=l;break}}if(!this.keyId||this.keyId.byteLength!==16){let l;l=nI(t),l||(l=pv(t),l||(l=wr[this.uri])),l&&(this.keyId=l,ds.setKeyIdForUri(this.uri,l))}return this}}function nI(s){const e=s?.[Bt.WIDEVINE];return e?e.keyId:null}function pv(s){const e=s?.[Bt.PLAYREADY];if(e){const t=PS(e.uri);if(t)return FS(t)}return null}function sI(s){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=s>>8*(15-t)&255;return e}const yv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,vv=/#EXT-X-MEDIA:(.*)/g,rI=/^#EXT(?:INF|-X-TARGETDURATION):/m,Sd=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),aI=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class nn{static findGroup(e,t){for(let i=0;i<e.length;i++){const a=e[i];if(a.id===t)return a}}static resolve(e,t){return wh.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return rI.test(e)}static parseMasterPlaylist(e,t){const i=dv(e),a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},l=[];if(yv.lastIndex=0,!e.startsWith("#EXTM3U"))return a.playlistParsingError=new Error("no EXTM3U delimiter"),a;let o;for(;(o=yv.exec(e))!=null;)if(o[1]){var c;const d=new ot(o[1],a),m=rh(a,o[2]),g={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:nn.resolve(m,t)},y=d.decimalResolution("RESOLUTION");y&&(g.width=y.width,g.height=y.height),Tv(d.CODECS,g);const S=d["SUPPLEMENTAL-CODECS"];S&&(g.supplemental={},Tv(S,g.supplemental)),(c=g.unknownCodecs)!=null&&c.length||l.push(g),a.levels.push(g)}else if(o[3]){const d=o[3],m=o[4];switch(d){case"SESSION-DATA":{const g=new ot(m,a),y=g["DATA-ID"];y&&(a.sessionData===null&&(a.sessionData={}),a.sessionData[y]=g);break}case"SESSION-KEY":{const g=Ev(m,t,a);g.encrypted&&g.isSupported()?(a.sessionKeys===null&&(a.sessionKeys=[]),a.sessionKeys.push(g)):qe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${m}"`);break}case"DEFINE":{{const g=new ot(m,a);hv(a,g,t)}break}case"CONTENT-STEERING":{const g=new ot(m,a);a.contentSteering={uri:nn.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{a.startTimeOffset=Sv(m);break}}}const h=l.length>0&&l.length<a.levels.length;return a.levels=h?l:a.levels,a.levels.length===0&&(a.playlistParsingError=new Error("no levels found in manifest")),a}static parseMasterPlaylistMedia(e,t,i){let a;const l={},o=i.levels,c={AUDIO:o.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:o.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(vv.lastIndex=0;(a=vv.exec(e))!==null;){const d=new ot(a[1],i),m=d.TYPE;if(m){const g=c[m],y=l[m]||[];l[m]=y;const S=d.LANGUAGE,E=d["ASSOC-LANGUAGE"],x=d.CHANNELS,T=d.CHARACTERISTICS,R=d["INSTREAM-ID"],L={attrs:d,bitrate:0,id:h++,groupId:d["GROUP-ID"]||"",name:d.NAME||S||"",type:m,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:S,url:d.URI?nn.resolve(d.URI,t):""};if(E&&(L.assocLang=E),x&&(L.channels=x),T&&(L.characteristics=T),R&&(L.instreamId=R),g!=null&&g.length){const _=nn.findGroup(g,L.groupId)||g[0];xv(L,_,"audioCodec"),xv(L,_,"textCodec")}y.push(L)}}return l}static parseLevelPlaylist(e,t,i,a,l,o){var c;const h={url:t},d=new ZD(t),m=d.fragments,g=[];let y=null,S=0,E=0,x=0,T=0,R=0,L=null,_=new pd(a,h),O,M,G,w=-1,$=!1,U=null,P;if(Sd.lastIndex=0,d.m3u8=e,d.hasVariableRefs=dv(e),((c=Sd.exec(e))==null?void 0:c[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(O=Sd.exec(e))!==null;){$&&($=!1,_=new pd(a,h),_.playlistOffset=x,_.setStart(x),_.sn=S,_.cc=T,R&&(_.bitrate=R),_.level=i,y&&(_.initSegment=y,y.rawProgramDateTime&&(_.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),U&&(_.setByteRange(U),U=null)));const oe=O[1];if(oe){_.duration=parseFloat(oe);const fe=(" "+O[2]).slice(1);_.title=fe||null,_.tagList.push(fe?["INF",oe,fe]:["INF",oe])}else if(O[3]){if(me(_.duration)){_.playlistOffset=x,_.setStart(x),G&&Av(_,G,d),_.sn=S,_.level=i,_.cc=T,m.push(_);const fe=(" "+O[3]).slice(1);_.relurl=rh(d,fe),lh(_,L,g),L=_,x+=_.duration,S++,E=0,$=!0}}else{if(O=O[0].match(aI),!O){qe.warn("No matches on slow regex match for level playlist!");continue}for(M=1;M<O.length&&O[M]===void 0;M++);const fe=(" "+O[M]).slice(1),k=(" "+O[M+1]).slice(1),X=O[M+2]?(" "+O[M+2]).slice(1):null;switch(fe){case"BYTERANGE":L?_.setByteRange(k,L):_.setByteRange(k);break;case"PROGRAM-DATE-TIME":_.rawProgramDateTime=k,_.tagList.push(["PROGRAM-DATE-TIME",k]),w===-1&&(w=m.length);break;case"PLAYLIST-TYPE":d.type&&_n(d,fe,O),d.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?_n(d,fe,O):m.length>0&&Rv(d,fe,O),S=d.startSN=parseInt(k);break;case"SKIP":{d.skippedSegments&&_n(d,fe,O);const J=new ot(k,d),le=J.decimalInteger("SKIPPED-SEGMENTS");if(me(le)){d.skippedSegments+=le;for(let C=le;C--;)m.push(null);S+=le}const de=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");de&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(de.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&_n(d,fe,O),d.targetduration=Math.max(parseInt(k),1);break;case"VERSION":d.version!==null&&_n(d,fe,O),d.version=parseInt(k);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||_n(d,fe,O),d.live=!1;break;case"#":(k||X)&&_.tagList.push(X?[k,X]:[k]);break;case"DISCONTINUITY":T++,_.tagList.push(["DIS"]);break;case"GAP":_.gap=!0,_.tagList.push([fe]);break;case"BITRATE":_.tagList.push([fe,k]),R=parseInt(k)*1e3,me(R)?_.bitrate=R:R=0;break;case"DATERANGE":{const J=new ot(k,d),le=new NS(J,d.dateRanges[J.ID],d.dateRangeTagCount);d.dateRangeTagCount++,le.isValid||d.skippedSegments?d.dateRanges[le.id]=le:qe.warn(`Ignoring invalid DATERANGE tag: "${k}"`),_.tagList.push(["EXT-X-DATERANGE",k]);break}case"DEFINE":{{const J=new ot(k,d);"IMPORT"in J?KD(d,J,o):hv(d,J,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?_n(d,fe,O):m.length>0&&Rv(d,fe,O),d.startCC=T=parseInt(k);break;case"KEY":{const J=Ev(k,t,d);if(J.isSupported()){if(J.method==="NONE"){G=void 0;break}G||(G={});const le=G[J.keyFormat];le!=null&&le.matches(J)||(le&&(G=Je({},G)),G[J.keyFormat]=J)}else qe.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${k}"`);break}case"START":d.startTimeOffset=Sv(k);break;case"MAP":{const J=new ot(k,d);if(_.duration){const le=new pd(a,h);bv(le,J,i,G),y=le,_.initSegment=y,y.rawProgramDateTime&&!_.rawProgramDateTime&&(_.rawProgramDateTime=y.rawProgramDateTime)}else{const le=_.byteRangeEndOffset;if(le){const de=_.byteRangeStartOffset;U=`${le-de}@${de}`}else U=null;bv(_,J,i,G),y=_,$=!0}y.cc=T;break}case"SERVER-CONTROL":{P&&_n(d,fe,O),P=new ot(k),d.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&P.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),d.holdBack=P.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&_n(d,fe,O);const J=new ot(k);d.partTarget=J.decimalFloatingPoint("PART-TARGET");break}case"PART":{let J=d.partList;J||(J=d.partList=[]);const le=E>0?J[J.length-1]:void 0,de=E++,C=new ot(k,d),F=new K_(C,_,h,de,le);J.push(F),_.duration+=F.duration;break}case"PRELOAD-HINT":{const J=new ot(k,d);d.preloadHint=J;break}case"RENDITION-REPORT":{const J=new ot(k,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(J);break}default:qe.warn(`line parsed but not handled: ${O}`);break}}}L&&!L.relurl?(m.pop(),x-=L.duration,d.partList&&(d.fragmentHint=L)):d.partList&&(lh(_,L,g),_.cc=T,d.fragmentHint=_,G&&Av(_,G,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const q=m.length,re=m[0],ce=m[q-1];if(x+=d.skippedSegments*d.targetduration,x>0&&q&&ce){d.averagetargetduration=x/q;const oe=ce.sn;d.endSN=oe!=="initSegment"?oe:0,d.live||(ce.endList=!0),w>0&&(oI(m,w),re&&g.unshift(re))}return d.fragmentHint&&(x+=d.fragmentHint.duration),d.totalduration=x,g.length&&d.dateRangeTagCount&&re&&BS(g,d),d.endCC=T,d}}function BS(s,e){let t=s.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];s.push(c),t++}else return;const i=s[t-1],a=e.live?1/0:e.totalduration,l=Object.keys(e.dateRanges);for(let c=l.length;c--;){const h=e.dateRanges[l[c]],d=h.startDate.getTime();h.tagAnchor=i.ref;for(let m=t;m--;){var o;if(((o=s[m])==null?void 0:o.sn)<e.startSN)break;const g=lI(e,d,s,m,a);if(g!==-1){h.tagAnchor=e.fragments[g].ref;break}}}}function lI(s,e,t,i,a){const l=t[i];if(l){const c=l.programDateTime;if(e>=c||i===0){var o;const h=(((o=t[i+1])==null?void 0:o.start)||a)-l.start;if(e<=c+h*1e3){const d=t[i].sn-s.startSN;if(d<0)return-1;const m=s.fragments;if(m.length>t.length){const y=(t[i+1]||m[m.length-1]).sn-s.startSN;for(let S=y;S>d;S--){const E=m[S].programDateTime;if(e>=E&&e<E+m[S].duration*1e3)return S}}return d}}}return-1}function Ev(s,e,t){var i,a;const l=new ot(s,t),o=(i=l.METHOD)!=null?i:"",c=l.URI,h=l.hexadecimalInteger("IV"),d=l.KEYFORMATVERSIONS,m=(a=l.KEYFORMAT)!=null?a:"identity";c&&l.IV&&!h&&qe.error(`Invalid IV: ${l.IV}`);const g=c?nn.resolve(c,e):"",y=(d||"1").split("/").map(Number).filter(Number.isFinite);return new ds(o,g,m,y,h,l.KEYID)}function Sv(s){const t=new ot(s).decimalFloatingPoint("TIME-OFFSET");return me(t)?t:null}function Tv(s,e){let t=(s||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const a=t.filter(l=>kh(l,i));a.length&&(e[`${i}Codec`]=a.map(l=>l.split("/")[0]).join(","),t=t.filter(l=>a.indexOf(l)===-1))}),e.unknownCodecs=t}function xv(s,e,t){const i=e[t];i&&(s[t]=i)}function oI(s,e){let t=s[e];for(let i=e;i--;){const a=s[i];if(!a)return;a.programDateTime=t.programDateTime-a.duration*1e3,t=a}}function lh(s,e,t){s.rawProgramDateTime?t.push(s):e!=null&&e.programDateTime&&(s.programDateTime=e.endProgramDateTime)}function bv(s,e,t,i){s.relurl=e.URI,e.BYTERANGE&&s.setByteRange(e.BYTERANGE),s.level=t,s.sn="initSegment",i&&(s.levelkeys=i),s.initSegment=null}function Av(s,e,t){s.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(a=>e[a].isCommonEncryption)&&i.push(s)}function _n(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Rv(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Td(s,e){const t=e.startPTS;if(me(t)){let i=0,a;e.sn>s.sn?(i=t-s.start,a=s):(i=s.start-t,a=e),a.duration!==i&&a.setDuration(i)}else e.sn>s.sn?s.cc===e.cc&&s.minEndPTS?e.setStart(s.start+(s.minEndPTS-s.start)):e.setStart(s.start+s.duration):e.setStart(Math.max(s.start-e.duration,0))}function $S(s,e,t,i,a,l,o){i-t<=0&&(o.warn("Fragment should have a positive duration",e),i=t+e.duration,l=a+e.duration);let h=t,d=i;const m=e.startPTS,g=e.endPTS;if(me(m)){const R=Math.abs(m-t);s&&R>s.totalduration?o.warn(`media timestamps and playlist times differ by ${R}s for level ${e.level} ${s.url}`):me(e.deltaPTS)?e.deltaPTS=Math.max(R,e.deltaPTS):e.deltaPTS=R,h=Math.max(t,m),t=Math.min(t,m),a=e.startDTS!==void 0?Math.min(a,e.startDTS):a,d=Math.min(i,g),i=Math.max(i,g),l=e.endDTS!==void 0?Math.max(l,e.endDTS):l}const y=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=a,e.endPTS=i,e.minEndPTS=d,e.endDTS=l;const S=e.sn;if(!s||S<s.startSN||S>s.endSN)return 0;let E;const x=S-s.startSN,T=s.fragments;for(T[x]=e,E=x;E>0;E--)Td(T[E],T[E-1]);for(E=x;E<T.length-1;E++)Td(T[E],T[E+1]);return s.fragmentHint&&Td(T[T.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,y}function uI(s,e,t){if(s===e)return;let i=null;const a=s.fragments;for(let m=a.length-1;m>=0;m--){const g=a[m].initSegment;if(g){i=g;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;let l;dI(s,e,(m,g,y,S)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==m.cc){const E=m.cc-g.cc;for(let x=y;x<S.length;x++)S[x].cc+=E;e.endCC=S[S.length-1].cc}me(m.startPTS)&&me(m.endPTS)&&(g.setStart(g.startPTS=m.startPTS),g.startDTS=m.startDTS,g.maxStartPTS=m.maxStartPTS,g.endPTS=m.endPTS,g.endDTS=m.endDTS,g.minEndPTS=m.minEndPTS,g.setDuration(m.endPTS-m.startPTS),g.duration&&(l=g),e.PTSKnown=e.alignedSliding=!0),m.hasStreams&&(g.elementaryStreams=m.elementaryStreams),g.loader=m.loader,m.hasStats&&(g.stats=m.stats),m.initSegment&&(g.initSegment=m.initSegment,i=m.initSegment)});const o=e.fragments,c=e.fragmentHint?o.concat(e.fragmentHint):o;if(i&&c.forEach(m=>{var g;m&&(!m.initSegment||m.initSegment.relurl===((g=i)==null?void 0:g.relurl))&&(m.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(m=>!m),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let m=e.skippedSegments;m--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=cI(s.dateRanges,e,t));const m=s.fragments.filter(g=>g.rawProgramDateTime);if(s.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<c.length;g++)c[g].programDateTime===null&&lh(c[g],c[g-1],m);BS(m,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var h;const m=HS(s,e.startSN-1);e.startCC=(h=m?.cc)!=null?h:o[0].cc}fI(s.partList,e.partList,(m,g)=>{g.elementaryStreams=m.elementaryStreams,g.stats=m.stats}),l?$S(e,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS,t):GS(s,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=s.driftStartTime,e.driftStart=s.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const m=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=m),e.driftEndTime=d,e.driftEnd=m}else e.driftEndTime=s.driftEndTime,e.driftEnd=s.driftEnd,e.advancedDateTime=s.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=s.requestScheduled)}function cI(s,e,t){const{dateRanges:i,recentlyRemovedDateranges:a}=e,l=Je({},s);a&&a.forEach(h=>{delete l[h]});const c=Object.keys(l).length;return c?(Object.keys(i).forEach(h=>{const d=l[h],m=new NS(i[h].attr,d);m.isValid?(l[h]=m,d||(m.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${st(i[h].attr)}"`)}),l):i}function fI(s,e,t){if(s&&e){let i=0;for(let a=0,l=s.length;a<=l;a++){const o=s[a],c=e[a+i];o&&c&&o.index===c.index&&o.fragment.sn===c.fragment.sn?t(o,c):i--}}}function dI(s,e,t){const i=e.skippedSegments,a=Math.max(s.startSN,e.startSN)-e.startSN,l=(s.fragmentHint?1:0)+(i?e.endSN:Math.min(s.endSN,e.endSN))-e.startSN,o=e.startSN-s.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments;for(let d=a;d<=l;d++){const m=h[o+d];let g=c[d];if(i&&!g&&m&&(g=e.fragments[d]=m),m&&g){t(m,g,d,c);const y=m.relurl,S=g.relurl;if(y&&hI(y,S)){e.playlistParsingError=Lv(`media sequence mismatch ${g.sn}:`,s,e,m,g);return}else if(m.cc!==g.cc){e.playlistParsingError=Lv(`discontinuity sequence mismatch (${m.cc}!=${g.cc})`,s,e,m,g);return}}}}function Lv(s,e,t,i,a){return new Error(`${s} ${a.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function GS(s,e,t=!0){const i=e.startSN+e.skippedSegments-s.startSN,a=s.fragments,l=i>=0;let o=0;if(l&&i<a.length)o=a[i].start;else if(l&&e.startSN===s.endSN+1)o=s.fragmentEnd;else if(l&&t)o=s.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=s.fragmentStart;else return;oh(e,o)}function oh(s,e){if(e){const t=s.fragments;for(let i=s.skippedSegments;i<t.length;i++)t[i].addStart(e);s.fragmentHint&&s.fragmentHint.addStart(e)}}function jS(s,e=1/0){let t=1e3*s.targetduration;if(s.updated){const i=s.fragments;if(i.length&&t*4>e){const l=i[i.length-1].duration*1e3;l<t&&(t=l)}}else t/=2;return Math.round(t)}function HS(s,e,t){if(!s)return null;let i=s.fragments[e-s.startSN];return i||(i=s.fragmentHint,i&&i.sn===e)?i:e<s.startSN&&t&&t.sn===e?t:null}function _v(s,e,t){return s?zS(s.partList,e,t):null}function zS(s,e,t){if(s)for(let i=s.length;i--;){const a=s[i];if(a.index===t&&a.fragment.sn===e)return a}return null}function VS(s){s.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(a=>{a.level=t,a.initSegment&&(a.initSegment.level=t)})})}function hI(s,e){return s!==e&&e?Dv(s)!==Dv(e):!1}function Dv(s){return s.replace(/\?[^?]*$/,"")}function Xa(s,e){for(let i=0,a=s.length;i<a;i++){var t;if(((t=s[i])==null?void 0:t.cc)===e)return s[i]}return null}function mI(s,e){return!!(s&&e.startCC<s.endCC&&e.endCC>s.startCC)}function Iv(s,e){const t=s.start+e;s.startPTS=t,s.setStart(t),s.endPTS=t+s.duration}function KS(s,e){const t=e.fragments;for(let i=0,a=t.length;i<a;i++)Iv(t[i],s);e.fragmentHint&&Iv(e.fragmentHint,s),e.alignedSliding=!0}function gI(s,e){s&&(YS(e,s),e.alignedSliding||Tu(e,s),!e.alignedSliding&&!e.skippedSegments&&GS(s,e,!1))}function YS(s,e){if(!mI(e,s))return;const t=Math.min(e.endCC,s.endCC),i=Xa(e.fragments,t),a=Xa(s.fragments,t);if(!i||!a)return;qe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const l=i.start-a.start;KS(l,s)}function Tu(s,e){if(!s.hasProgramDateTime||!e.hasProgramDateTime)return;const t=s.fragments,i=e.fragments;if(!t.length||!i.length)return;let a,l;const o=Math.min(e.endCC,s.endCC);e.startCC<o&&s.startCC<o&&(a=Xa(i,o),l=Xa(t,o)),(!a||!l)&&(a=i[Math.floor(i.length/2)],l=Xa(t,a.cc)||t[Math.floor(t.length/2)]);const c=a.programDateTime,h=l.programDateTime;if(!c||!h)return;const d=(h-c)/1e3-(l.start-a.start);KS(d,s)}function zt(s,e,t){ii(s,e,t),s.addEventListener(e,t)}function ii(s,e,t){s.removeEventListener(e,t)}const pI={toString:function(s){let e="";const t=s.length;for(let i=0;i<t;i++)e+=`[${s.start(i).toFixed(3)}-${s.end(i).toFixed(3)}]`;return e}},ie={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class jh extends wS{constructor(e,t,i,a,l){super(a,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ie.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:c,media:h,mediaBuffer:d,state:m}=this,g=h?h.currentTime:0,y=Ae.bufferInfo(d||h,g,o.maxBufferHole),S=!y.len;if(this.log(`Media seeking to ${me(g)?g.toFixed(3):g}, state: ${m}, ${S?"out of":"in"} buffer`),this.state===ie.ENDED)this.resetLoadingState();else if(c){const E=o.maxFragLookUpTolerance,x=c.start-E,T=c.start+c.duration+E;if(S||T<y.start||x>y.end){const R=g>T;(g<x||R)&&(R&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const E=this.lastCurrentTime;if(g>E&&(this.lastCurrentTime=g),!this.loadingParts){const x=Math.max(y.end,g),T=this.shouldLoadParts(this.getLevelDetails(),x);T&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${x.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${S?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,S&&(this.startPosition=g)),S&&this.state===ie.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=l,this.hls=e,this.fragmentLoader=new zD(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Fh(e.config)}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ie.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ie.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,a=this.config.timelineOffset||0;if(i<=a)return!1;const l=e.buffered;this.config.maxBufferHole&&l&&l.length>1&&(e=Ae.bufferedInfo(l,e.start,0));const o=e.nextStart;if(o&&o>a&&o<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const m=h[h.length-1];return Ae.isBuffered(this.media,m.start+m.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;zt(i,"seeking",this.onMediaSeeking),zt(i,"ended",this.onMediaEnded);const a=this.config;this.levels&&a.autoStartLoad&&this.state===ie.STOPPED&&this.startLoad(a.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,a=this.media;if(a!==null){if(a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ii(a,"seeking",this.onMediaSeeking),ii(a,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ie.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const a=l=>{const o=l.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${l.part?" part: "+l.part.index:""} of ${this.fragInfo(o,!1,l.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(l)};this._doFragLoad(e,t,i,a).then(l=>{if(!l)return;const o=this.state,c=l.frag;if(this.fragContextChanged(c)){(o===ie.FRAG_LOADING||!this.fragCurrent&&o===ie.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=ie.IDLE);return}"payload"in l&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(A.FRAG_LOADED,l)),this._handleFragmentLoadComplete(l)}).catch(l=>{this.state===ie.STOPPED||this.state===ie.ERROR||(this.warn(`Frag error: ${l?.message||l}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===_t.APPENDING){const l=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,l),c=Math.max(e.duration,o?o.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===_t.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const a={startOffset:e,endOffset:t,type:i};this.hls.trigger(A.BUFFER_FLUSHING,a)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const a=i?.frag;if(!a||this.fragContextChanged(a)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:a}=this,{frag:l,payload:o}=i,c=l.decryptdata;if(o&&o.byteLength>0&&c!=null&&c.key&&c.iv&&Br(c.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),c.key.buffer,c.iv.buffer,$h(c.method)).catch(d=>{throw a.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:l}),d}).then(d=>{const m=self.performance.now();return a.trigger(A.FRAG_DECRYPTED,{frag:l,payload:d,stats:{tstart:h,tdecrypt:m}}),i.payload=d,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ie.STOPPED||this.state===ie.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ie.STOPPED&&(this.state=ie.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,a;const l=e.tracks;if(l&&!t.encrypted&&((i=l.audio)!=null&&i.encrypted||(a=l.video)!=null&&a.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(c.message),!o||o.mediaKeys?!1:(this.hls.trigger(A.ERROR,{type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?pI.toString(Ae.getBuffered(i)):"(detached)"})`),pt(e)){var a;if(e.type!==ge.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(c=>!!o[c])){this.state=ie.IDLE;return}}const l=(a=this.levels)==null?void 0:a[e.level];l!=null&&l.fragmentError&&(this.log(`Resetting level fragment error count of ${l.fragmentError} on frag buffered`),l.fragmentError=0)}this.state=ie.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:a,partsLoaded:l}=e,o=!l||l.length===0||l.some(h=>!h),c=new Bh(i.level,i.sn,i.stats.chunkCount+1,0,a?a.index:-1,!o);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,a){var l;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let c=null;if(e.encrypted&&!((l=e.decryptdata)!=null&&l.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ie.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(A.KEY_LOADED,y),this.state===ie.KEY_LOADING&&(this.state=ie.IDLE),y}),this.hls.trigger(A.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(pt(e)&&(!h||e.sn!==h.sn)){const y=this.shouldLoadParts(t.details,e.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${h?.sn}->${e.sn}`),this.loadingParts=y)}if(i=Math.max(e.start,i||0),this.loadingParts&&pt(e)){const y=o.partList;if(y&&a){i>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const S=this.getNextPart(y,e,i);if(S>-1){const E=y[S];e=this.fragCurrent=E.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${E.index} (${S}/${y.length-1}) of ${this.fragInfo(e,!1,E)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=E.start+E.duration,this.state=ie.FRAG_LOADING;let x;return c?x=c.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,E,t,a)).catch(T=>this.handleFragLoadError(T)):x=this.doFragPartsLoad(e,E,t,a).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(A.FRAG_LOADING,{frag:e,part:E,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):x}else if(!e.url||this.loadedEndOfParts(y,i))return Promise.resolve(null)}}if(pt(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=o.partList)==null?void 0:d.filter(y=>y.loaded).map(y=>`[${y.start}-${y.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),me(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ie.FRAG_LOADING;const m=this.config.progressive&&e.type!==ge.SUBTITLE;let g;return m&&c?g=c.then(y=>!y||this.fragContextChanged(y.frag)?null:this.fragmentLoader.load(e,a)).catch(y=>this.handleFragLoadError(y)):g=Promise.all([this.fragmentLoader.load(e,m?a:void 0),c]).then(([y])=>(!m&&a&&a(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(A.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,i,a){return new Promise((l,o)=>{var c;const h=[],d=(c=i.details)==null?void 0:c.partList,m=g=>{this.fragmentLoader.loadPart(e,g,a).then(y=>{h[g.index]=y;const S=y.part;this.hls.trigger(A.FRAG_LOADED,y);const E=_v(i.details,e.sn,g.index+1)||zS(d,e.sn,g.index+1);if(E)m(E);else return l({frag:e,part:S,partsLoaded:h})}).catch(o)};m(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Ee.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(A.ERROR,t)}else this.hls.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ie.PARSING){!this.fragCurrent&&this.state!==ie.STOPPED&&this.state!==ie.ERROR&&(this.state=ie.IDLE);return}const{frag:i,part:a,level:l}=t,o=self.performance.now();i.stats.parsing.end=o,a&&(a.stats.parsing.end=o);const c=this.getLevelDetails(),d=c&&i.sn>c.endSN||this.shouldLoadParts(c,i.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(i,a,l,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const l=e.partList[0];if(l.fragment.type===ge.SUBTITLE)return!1;const o=l.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=o){var a;if((this.hls.hasEnoughToStart?((a=this.media)==null?void 0:a.currentTime)||this.lastCurrentTime:this.getLoadPosition())>l.start-l.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:a,sn:l,part:o}=e;if(!(t!=null&&t[a]))return this.warn(`Levels object was unset while buffering fragment ${l} of ${this.playlistLabel()} ${a}. The current chunk will not be buffered.`),null;const c=t[a],h=c.details,d=o>-1?_v(h,l,o):null,m=d?d.fragment:HS(h,l,i);return m?(i&&i!==m&&(m.stats=i.stats),{frag:m,part:d,level:c}):null}bufferFragmentData(e,t,i,a,l){if(this.state!==ie.PARSING)return;const{data1:o,data2:c}=e;let h=o;if(c&&(h=wi(o,c)),!h.length)return;const d=this.initPTS[t.cc],m=d?-d.baseTime/d.timescale:void 0,g={type:e.type,frag:t,part:i,chunkMeta:a,offset:m,parent:t.type,data:h};if(this.hls.trigger(A.BUFFER_APPENDING,g),e.dropped&&e.independent&&!i){if(l)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ae.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,a=Ae.bufferInfo(t,i,0),l=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),c=Math.max(Math.min(e.start-o,a.end-o),i+o);e.start-c>o&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var i;const a=this.getLoadPosition();if(!me(a))return null;const o=this.lastCurrentTime>a||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,a,t,o)}getFwdBufferInfoAtPos(e,t,i,a){const l=Ae.bufferInfo(e,t,a);if(l.len===0&&l.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&(l.nextStart<=o.end||o.gap)){const c=Math.max(Math.min(l.nextStart,o.end)-t,a);return Ae.bufferInfo(e,t,c)}}return l}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,a=Math.max(Math.min(e-t,i.maxBufferLength),t),l=Math.max(e-t*3,i.maxMaxBufferLength/2,a);return l>=a?(i.maxMaxBufferLength=l,this.warn(`Reduce max buffer length to ${l}s`),!0):!1}getAppendedFrag(e,t=ge.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,a=i.length;if(!a)return null;const{config:l}=this,o=i[0].start,c=l.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const g=l.initialLiveManifestSize;if(a<g)return this.warn(`Not enough fragments to start playback (have: ${a}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var d;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const y=this.hls.startPosition,S=this.hls.liveSyncPosition,E=h?(y!==-1&&y>=o?y:S)||h.start:e;this.log(`Setting startPosition to ${E} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${S} frag.start: ${(d=h)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=E}}else e<=o&&(h=i[0]);if(!h){const g=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,g,t)}let m=this.filterReplacedPrimary(h,t);if(!m&&h){const g=h.sn-t.startSN;m=this.filterReplacedPrimary(i[g+1]||null,t)}return this.mapToInitFragWhenRequired(m)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===_t.OK||i===_t.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,a,l){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&i.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,a,0);if(c!==null&&i.len+c.len>=l){const h=o.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${a}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Cv(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Cv(this.config)&&e.type!==ge.SUBTITLE){const i=this.hls.interstitialsManager,a=i?.bufferingItem;if(a){const o=a.event;if(o){if(o.appendInPlace||Math.abs(e.start-a.start)>1||a.start===0)return null}else if(e.end<=a.start&&t?.live===!1||e.start>a.end&&a.nextEvent&&(a.nextEvent.appendInPlace||e.start-a.end>1))return null}const l=i?.playerQueue;if(l)for(let o=l.length;o--;){const c=l[o].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let a=-1,l=!1,o=!0;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(o=o&&!d.independent,a>-1&&i<d.start)break;const m=d.loaded;m?a=-1:(l||(d.independent||o)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${d.start}`),a=c),l=m}return a}loadedEndOfParts(e,t){let i;for(let a=e.length;a--;){if(i=e[a],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let a=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),a=wD(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){const l=i.sn+1;if(l>=e.startSN&&l<=e.endSN){const o=t[l-e.startSN];i.cc===o.cc&&(a=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${a.sn}`))}a||(a=IS(e,i.cc,i.end),a&&this.log(`Live playlist, switching playlist, load frag with same CC: ${a.sn}`))}}else{const l=this.hls.liveSyncPosition;l!==null&&(a=this.getFragmentAtPosition(l,this.bitrateTest?e.fragmentEnd:e.edge,e))}return a}getFragmentAtPosition(e,t,i){const{config:a}=this;let{fragPrevious:l}=this,{fragments:o,endSN:c}=i;const{fragmentHint:h}=i,{maxFragLookUpTolerance:d}=a,m=i.partList,g=!!(this.loadingParts&&m!=null&&m.length&&h);g&&!this.bitrateTest&&m[m.length-1].fragment.sn===h.sn&&(o=o.concat(h),c=h.sn);let y;if(e<t){var S;const x=e<this.lastCurrentTime||e>t-d||(S=this.media)!=null&&S.paused||!this.startFragRequested?0:d;y=Vs(l,o,e,x)}else y=o[o.length-1];if(y){const E=y.sn-i.startSN,x=this.fragmentTracker.getState(y);if((x===_t.OK||x===_t.PARTIAL&&y.gap)&&(l=y),l&&y.sn===l.sn&&(!g||m[0].fragment.sn>y.sn||!i.live)&&y.level===l.level){const R=o[E+1];y.sn<c&&this.fragmentTracker.getState(R)!==_t.OK?y=R:y=null}}return y}alignPlaylists(e,t,i){const a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const l=e.fragmentStart,o=!t,c=e.alignedSliding&&me(l);if(o||!c&&!l){gI(i,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${a}`),h}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const a=this.timelineOffset;if(i===-1){const l=this.startTimeOffset!==null,o=l?this.startTimeOffset:e.startTimeOffset;o!==null&&me(o)?(i=t+o,o<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${l?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+a}this.nextLoadPosition=i+a}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&pt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ie.FRAG_LOADING_WAITING_RETRY)&&(this.state=ie.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){const R=this.getCurrentContext(t.chunkMeta);R&&(t.frag=R.frag)}const a=t.frag;if(!a||a.type!==e||!this.levels)return;if(this.fragContextChanged(a)){var l;this.warn(`Frag load error must match current frag to retry ${a.url} > ${(l=this.fragCurrent)==null?void 0:l.url}`);return}const o=t.details===z.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(a,!0);const c=t.errorAction;if(!c){this.state=ie.ERROR;return}const{action:h,flags:d,retryCount:m=0,retryConfig:g}=c,y=!!g,S=y&&h===Ut.RetryRequest,E=y&&!c.resolved&&d===pi.MoveAllAlternatesMatchingHost,x=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!S&&E&&pt(a)&&!a.endList&&x&&!OS(t))this.resetFragmentErrors(e),this.treatAsGap(a),c.resolved=!0;else if((S||E)&&m<g.maxNumRetry){var T;const R=sh((T=t.response)==null?void 0:T.code),L=Uh(g,m);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+L,this.state=ie.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,R){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${a.sn} of ${e} ${a.level} errored with ${t.details}, retrying loading ${m+1}/${g.maxNumRetry} in ${L}ms`)}else if(g)if(this.resetFragmentErrors(e),m<g.maxNumRetry)!o&&h!==Ut.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${m})`);return}else h===Ut.SendAlternateToPenaltyBox?this.state=ie.WAITING_LEVEL:this.state=ie.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!sh(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ie.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ie.PARSING||this.state===ie.PARSED){const t=e.frag,i=e.parent,a=this.getFwdBufferInfo(this.mediaBuffer,i),l=a&&a.len>.5;l&&this.reduceMaxBufferLength(a.len,t?.duration||10);const o=!l;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===ge.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ie.STOPPED&&(this.state=ie.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const a=Ae.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,a,i),this.state===ie.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ie.STOPPED&&(this.state=ie.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,a){const l=i.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,d)=>{const m=e.elementaryStreams[d];if(m){const g=m.endPTS-m.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${g})`),h||!1;const y=a?0:$S(l,e,m.startPTS,m.endPTS,m.startDTS,m.endDTS,this);return this.hls.trigger(A.LEVEL_PTS_UPDATED,{details:l,level:i,drift:y,type:d,frag:e,start:m.startPTS,end:m.endPTS}),!0}return h},!1)){var c;const h=((c=this.transmuxer)==null?void 0:c.error)===null;if((i.fragmentError===0||h&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),h){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ie.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(A.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ge.MAIN?"level":"track"}fragInfo(e,t=!0,i){var a,l;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((a=t&&!i?e.startPTS:(i||e).start)!=null?a:NaN).toFixed(3)}-${((l=t&&!i?e.endPTS:(i||e).end)!=null?l:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Cv(s){return!!s.interstitialsController&&s.enableInterstitialPlayback!==!1}class qS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=yI(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function yI(s,e){const t=new Uint8Array(e);let i=0;for(let a=0;a<s.length;a++){const l=s[a];t.set(l,i),i+=l.length}return t}var xd={exports:{}},Ov;function vI(){return Ov||(Ov=1,(function(s){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function a(h,d,m){this.fn=h,this.context=d,this.once=m||!1}function l(h,d,m,g,y){if(typeof m!="function")throw new TypeError("The listener must be a function");var S=new a(m,g||h,y),E=t?t+d:d;return h._events[E]?h._events[E].fn?h._events[E]=[h._events[E],S]:h._events[E].push(S):(h._events[E]=S,h._eventsCount++),h}function o(h,d){--h._eventsCount===0?h._events=new i:delete h._events[d]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var d=[],m,g;if(this._eventsCount===0)return d;for(g in m=this._events)e.call(m,g)&&d.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(m)):d},c.prototype.listeners=function(d){var m=t?t+d:d,g=this._events[m];if(!g)return[];if(g.fn)return[g.fn];for(var y=0,S=g.length,E=new Array(S);y<S;y++)E[y]=g[y].fn;return E},c.prototype.listenerCount=function(d){var m=t?t+d:d,g=this._events[m];return g?g.fn?1:g.length:0},c.prototype.emit=function(d,m,g,y,S,E){var x=t?t+d:d;if(!this._events[x])return!1;var T=this._events[x],R=arguments.length,L,_;if(T.fn){switch(T.once&&this.removeListener(d,T.fn,void 0,!0),R){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,m),!0;case 3:return T.fn.call(T.context,m,g),!0;case 4:return T.fn.call(T.context,m,g,y),!0;case 5:return T.fn.call(T.context,m,g,y,S),!0;case 6:return T.fn.call(T.context,m,g,y,S,E),!0}for(_=1,L=new Array(R-1);_<R;_++)L[_-1]=arguments[_];T.fn.apply(T.context,L)}else{var O=T.length,M;for(_=0;_<O;_++)switch(T[_].once&&this.removeListener(d,T[_].fn,void 0,!0),R){case 1:T[_].fn.call(T[_].context);break;case 2:T[_].fn.call(T[_].context,m);break;case 3:T[_].fn.call(T[_].context,m,g);break;case 4:T[_].fn.call(T[_].context,m,g,y);break;default:if(!L)for(M=1,L=new Array(R-1);M<R;M++)L[M-1]=arguments[M];T[_].fn.apply(T[_].context,L)}}return!0},c.prototype.on=function(d,m,g){return l(this,d,m,g,!1)},c.prototype.once=function(d,m,g){return l(this,d,m,g,!0)},c.prototype.removeListener=function(d,m,g,y){var S=t?t+d:d;if(!this._events[S])return this;if(!m)return o(this,S),this;var E=this._events[S];if(E.fn)E.fn===m&&(!y||E.once)&&(!g||E.context===g)&&o(this,S);else{for(var x=0,T=[],R=E.length;x<R;x++)(E[x].fn!==m||y&&!E[x].once||g&&E[x].context!==g)&&T.push(E[x]);T.length?this._events[S]=T.length===1?T[0]:T:o(this,S)}return this},c.prototype.removeAllListeners=function(d){var m;return d?(m=t?t+d:d,this._events[m]&&o(this,m)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,s.exports=c})(xd)),xd.exports}var EI=vI(),Hh=z_(EI);const il="1.6.15",zr={};function SI(){return typeof __HLS_WORKER_BUNDLE__=="function"}function TI(){const s=zr[il];if(s)return s.clientCount++,s;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),a={worker:new self.Worker(t),objectURL:t,clientCount:1};return zr[il]=a,a}function xI(s){const e=zr[s];if(e)return e.clientCount++,e;const t=new self.URL(s,self.location.href).href,a={worker:new self.Worker(t),scriptURL:t,clientCount:1};return zr[s]=a,a}function bI(s){const e=zr[s||il];if(e&&e.clientCount--===1){const{worker:i,objectURL:a}=e;delete zr[s||il],a&&self.URL.revokeObjectURL(a),i.terminate()}}function XS(s,e){return e+10<=s.length&&s[e]===51&&s[e+1]===68&&s[e+2]===73&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function zh(s,e){return e+10<=s.length&&s[e]===73&&s[e+1]===68&&s[e+2]===51&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function Nu(s,e){let t=0;return t=(s[e]&127)<<21,t|=(s[e+1]&127)<<14,t|=(s[e+2]&127)<<7,t|=s[e+3]&127,t}function nl(s,e){const t=e;let i=0;for(;zh(s,e);){i+=10;const a=Nu(s,e+6);i+=a,XS(s,e+10)&&(i+=10),e+=i}if(i>0)return s.subarray(t,t+i)}function AI(s,e,t,i){const a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=e[t+2],o=l>>2&15;if(o>12){const S=new Error(`invalid ADTS sampling index:${o}`);s.emit(A.ERROR,A.ERROR,{type:Ee.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!0,error:S,reason:S.message});return}const c=(l>>6&3)+1,h=e[t+3]>>6&3|(l&1)<<2,d="mp4a.40."+c,m=a[o];let g=o;(c===5||c===29)&&(g-=3);const y=[c<<3|(g&14)>>1,(g&1)<<7|h<<3];return qe.log(`manifest codec:${i}, parsed codec:${d}, channels:${h}, rate:${m} (ADTS object type:${c} sampling index:${o})`),{config:y,samplerate:m,channelCount:h,codec:d,parsedCodec:d,manifestCodec:i}}function QS(s,e){return s[e]===255&&(s[e+1]&246)===240}function WS(s,e){return s[e+1]&1?7:9}function Vh(s,e){return(s[e+3]&3)<<11|s[e+4]<<3|(s[e+5]&224)>>>5}function RI(s,e){return e+5<s.length}function xu(s,e){return e+1<s.length&&QS(s,e)}function LI(s,e){return RI(s,e)&&QS(s,e)&&Vh(s,e)<=s.length-e}function _I(s,e){if(xu(s,e)){const t=WS(s,e);if(e+t>=s.length)return!1;const i=Vh(s,e);if(i<=t)return!1;const a=e+i;return a===s.length||xu(s,a)}return!1}function ZS(s,e,t,i,a){if(!s.samplerate){const l=AI(e,t,i,a);if(!l)return;Je(s,l)}}function JS(s){return 1024*9e4/s}function DI(s,e){const t=WS(s,e);if(e+t<=s.length){const i=Vh(s,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function eT(s,e,t,i,a){const l=JS(s.samplerate),o=i+a*l,c=DI(e,t);let h;if(c){const{frameLength:g,headerLength:y}=c,S=y+g,E=Math.max(0,t+S-e.length);E?(h=new Uint8Array(S-y),h.set(e.subarray(t+y,e.length),0)):h=e.subarray(t+y,t+S);const x={unit:h,pts:o};return E||s.samples.push(x),{sample:x,length:S,missing:E}}const d=e.length-t;return h=new Uint8Array(d),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:o},length:d,missing:-1}}function II(s,e){return zh(s,e)&&Nu(s,e+6)+10<=s.length-e}function CI(s){return s instanceof ArrayBuffer?s:s.byteOffset==0&&s.byteLength==s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer}function bd(s,e=0,t=1/0){return OI(s,e,t,Uint8Array)}function OI(s,e,t,i){const a=wI(s);let l=1;"BYTES_PER_ELEMENT"in i&&(l=i.BYTES_PER_ELEMENT);const o=MI(s)?s.byteOffset:0,c=(o+s.byteLength)/l,h=(o+e)/l,d=Math.floor(Math.max(0,Math.min(h,c))),m=Math.floor(Math.min(d+Math.max(t,0),c));return new i(a,d,m-d)}function wI(s){return s instanceof ArrayBuffer?s:s.buffer}function MI(s){return s&&s.buffer instanceof ArrayBuffer&&s.byteLength!==void 0&&s.byteOffset!==void 0}function NI(s){const e={key:s.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(s.size<2)return;if(s.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=s.data.subarray(1).indexOf(0);if(i===-1)return;const a=Si(bd(s.data,1,i)),l=s.data[2+i],o=s.data.subarray(3+i).indexOf(0);if(o===-1)return;const c=Si(bd(s.data,3+i,o));let h;return a==="-->"?h=Si(bd(s.data,4+i+o)):h=CI(s.data.subarray(4+i+o)),e.mimeType=a,e.pictureType=l,e.description=c,e.data=h,e}function kI(s){if(s.size<2)return;const e=Si(s.data,!0),t=new Uint8Array(s.data.subarray(e.length+1));return{key:s.type,info:e,data:t.buffer}}function PI(s){if(s.size<2)return;if(s.type==="TXXX"){let t=1;const i=Si(s.data.subarray(t),!0);t+=i.length+1;const a=Si(s.data.subarray(t));return{key:s.type,info:i,data:a}}const e=Si(s.data.subarray(1));return{key:s.type,info:"",data:e}}function UI(s){if(s.type==="WXXX"){if(s.size<2)return;let t=1;const i=Si(s.data.subarray(t),!0);t+=i.length+1;const a=Si(s.data.subarray(t));return{key:s.type,info:i,data:a}}const e=Si(s.data);return{key:s.type,info:"",data:e}}function FI(s){return s.type==="PRIV"?kI(s):s.type[0]==="W"?UI(s):s.type==="APIC"?NI(s):PI(s)}function BI(s){const e=String.fromCharCode(s[0],s[1],s[2],s[3]),t=Nu(s,4),i=10;return{type:e,size:t,data:s.subarray(i,i+t)}}const Bo=10,$I=10;function tT(s){let e=0;const t=[];for(;zh(s,e);){const i=Nu(s,e+6);s[e+5]>>6&1&&(e+=Bo),e+=Bo;const a=e+i;for(;e+$I<a;){const l=BI(s.subarray(e)),o=FI(l);o&&t.push(o),e+=l.size+Bo}XS(s,e)&&(e+=Bo)}return t}function iT(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"}function GI(s){if(s.data.byteLength===8){const e=new Uint8Array(s.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Kh(s){const e=tT(s);for(let t=0;t<e.length;t++){const i=e[t];if(iT(i))return GI(i)}}let vi=(function(s){return s.audioId3="org.id3",s.dateRange="com.apple.quicktime.HLS",s.emsg="https://aomedia.org/emsg/ID3",s.misbklv="urn:misb:KLV:bin:1910.1",s})({});function Ji(s="",e=9e4){return{type:s,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Yh{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,a){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=wi(this.cachedData,e),this.cachedData=null);let i=nl(e,0),a=i?i.length:0,l;const o=this._audioTrack,c=this._id3Track,h=i?Kh(i):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&me(h))&&(this.basePTS=jI(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:vi.audioId3,duration:Number.POSITIVE_INFINITY});a<d;){if(this.canParse(e,a)){const m=this.appendFrame(o,e,a);m?(this.frameIndex++,this.lastPTS=m.sample.pts,a+=m.length,l=a):a=d}else II(e,a)?(i=nl(e,a),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:vi.audioId3,duration:Number.POSITIVE_INFINITY}),a+=i.length,l=a):a++;if(a===d&&l!==d){const m=e.slice(l);this.cachedData?this.cachedData=wi(this.cachedData,m):this.cachedData=m}}return{audioTrack:o,videoTrack:Ji(),id3Track:c,textTrack:Ji()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ji(),id3Track:this._id3Track,textTrack:Ji()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const jI=(s,e,t)=>{if(me(s))return s*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let $o=null;const HI=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],zI=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],VI=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],KI=[0,1,1,4];function nT(s,e,t,i,a){if(t+24>e.length)return;const l=sT(e,t);if(l&&t+l.frameLength<=e.length){const o=l.samplesPerFrame*9e4/l.sampleRate,c=i+a*o,h={unit:e.subarray(t,t+l.frameLength),pts:c,dts:c};return s.config=[],s.channelCount=l.channelCount,s.samplerate=l.sampleRate,s.samples.push(h),{sample:h,length:l.frameLength,missing:0}}}function sT(s,e){const t=s[e+1]>>3&3,i=s[e+1]>>1&3,a=s[e+2]>>4&15,l=s[e+2]>>2&3;if(t!==1&&a!==0&&a!==15&&l!==3){const o=s[e+2]>>1&1,c=s[e+3]>>6,h=t===3?3-i:i===3?3:4,d=HI[h*14+a-1]*1e3,g=zI[(t===3?0:t===2?1:2)*3+l],y=c===3?1:2,S=VI[t][i],E=KI[i],x=S*8*E,T=Math.floor(S*d/g+o)*E;if($o===null){const _=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$o=_?parseInt(_[1]):0}return!!$o&&$o<=87&&i===2&&d>=224e3&&c===0&&(s[e+3]=s[e+3]|128),{sampleRate:g,channelCount:y,frameLength:T,samplesPerFrame:x}}}function qh(s,e){return s[e]===255&&(s[e+1]&224)===224&&(s[e+1]&6)!==0}function rT(s,e){return e+1<s.length&&qh(s,e)}function YI(s,e){return qh(s,e)&&4<=s.length-e}function aT(s,e){if(e+1<s.length&&qh(s,e)){const i=sT(s,e);let a=4;i!=null&&i.frameLength&&(a=i.frameLength);const l=e+a;return l===s.length||rT(s,l)}return!1}class qI extends Yh{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,a){super.resetInitSegment(e,t,i,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=nl(e,0);let a=i?.length||0;if(aT(e,a))return!1;for(let l=e.length;a<l;a++)if(_I(e,a))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return LI(e,t)}appendFrame(e,t,i){ZS(e,this.observer,t,i,e.manifestCodec);const a=eT(e,t,i,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a}}const lT=(s,e)=>{let t=0,i=5;e+=i;const a=new Uint32Array(1),l=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=s[e];const c=Math.min(i,8),h=8-c;l[0]=4278190080>>>24+h<<h,a[0]=(o[0]&l[0])>>h,t=t?t<<c|a[0]:a[0],e+=1,i-=c}return t};class XI extends Yh{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,a){super.resetInitSegment(e,t,i,a),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const a=oT(e,t,i,this.basePTS,this.frameIndex);if(a!==-1)return{sample:e.samples[e.samples.length-1],length:a,missing:0}}static probe(e){if(!e)return!1;const t=nl(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&Kh(t)!==void 0&&lT(e,i)<16}}function oT(s,e,t,i,a){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const l=e[t+4]>>6;if(l>=3)return-1;const c=[48e3,44100,32e3][l],h=e[t+4]&63,m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+l]*2;if(t+m>e.length)return-1;const g=e[t+6]>>5;let y=0;g===2?y+=2:(g&1&&g!==1&&(y+=2),g&4&&(y+=2));const S=(e[t+6]<<8|e[t+7])>>12-y&1,x=[2,1,2,3,3,4,4,5][g]+S,T=e[t+5]>>3,R=e[t+5]&7,L=new Uint8Array([l<<6|T<<1|R>>2,(R&3)<<6|g<<3|S<<2|h>>4,h<<4&224]),_=1536/c*9e4,O=i+a*_,M=e.subarray(t,t+m);return s.config=L,s.channelCount=x,s.samplerate=c,s.samples.push({unit:M,pts:O}),m}class QI extends Yh{resetInitSegment(e,t,i,a){super.resetInitSegment(e,t,i,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=nl(e,0);let i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&Kh(t)!==void 0&&lT(e,i)<=16)return!1;for(let a=e.length;i<a;i++)if(aT(e,i))return qe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return YI(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return nT(e,t,i,this.basePTS,this.frameIndex)}}const WI=/\/emsg[-/]ID3/i;class ZI{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,a){const l=this.videoTrack=Ji("video",1),o=this.audioTrack=Ji("audio",1),c=this.txtTrack=Ji("text",1);if(this.id3Track=Ji("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=vS(e);if(h.video){const{id:d,timescale:m,codec:g,supplemental:y}=h.video;l.id=d,l.timescale=c.timescale=m,l.codec=g,l.supplemental=y}if(h.audio){const{id:d,timescale:m,codec:g}=h.audio;o.id=d,o.timescale=m,o.codec=g}c.id=gS.text,l.sampleDuration=0,l.duration=o.duration=a}resetContiguity(){this.remainderData=null}static probe(e){return X_(e)}demux(e,t){this.timeOffset=t;let i=e;const a=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=wi(this.remainderData,e));const c=iD(i);this.remainderData=c.remainder,a.samples=c.valid||new Uint8Array}else a.samples=i;const o=this.extractID3Track(a,t);return l.samples=Xy(t,a),{videoTrack:a,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const a=this.extractID3Track(t,this.timeOffset);return i.samples=Xy(e,t),{videoTrack:t,audioTrack:Ji(),id3Track:a,textTrack:Ji()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const a=Ce(e.samples,["emsg"]);a&&a.forEach(l=>{const o=sD(l);if(WI.test(o.schemeIdUri)){const c=wv(o,t);let h=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const d=o.payload;i.samples.push({data:d,len:d.byteLength,dts:c,pts:c,type:vi.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=wv(o,t);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:c,pts:c,type:vi.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function wv(s,e){return me(s.presentationTime)?s.presentationTime/s.timeScale:e+s.presentationTimeDelta/s.timeScale}class JI{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Fh(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,gs.cbc)}decryptAacSample(e,t,i){const a=e[t].unit;if(a.length<=16)return;const l=a.subarray(16,a.length-a.length%16),o=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(o).then(c=>{const h=new Uint8Array(c);a.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let a=0;for(let l=32;l<e.length-16;l+=160,a+=16)i.set(e.subarray(l,l+16),a);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let a=0;for(let l=32;l<e.length-16;l+=160,a+=16)e.set(i.subarray(a,a+16),l);return e}decryptAvcSample(e,t,i,a,l){const o=TS(l.data),c=this.getAvcEncryptedData(o);this.decryptBuffer(c.buffer).then(h=>{l.data=this.getAvcDecryptedUnit(o,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,a)}).catch(a)}decryptAvcSamples(e,t,i,a){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){a();return}const l=e[t].units;for(;!(i>=l.length);i++){const o=l[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,a,o),!this.decrypter.isSync()))return}}}}class uT{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,a;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const l=i.units;a=l[l.length-1]}return a}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,a=i.length;if(a){const l=i[a-1];e.pts=l.pts,e.dts=l.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const a=t.byteLength;let l=e.naluState||0;const o=l,c=[];let h=0,d,m,g,y=-1,S=0;for(l===-1&&(y=0,S=this.getNALuType(t,0),l=0,h=1);h<a;){if(d=t[h++],!l){l=d?0:1;continue}if(l===1){l=d?0:2;continue}if(!d)l=3;else if(d===1){if(m=h-l-1,y>=0){const E={data:t.subarray(y,m),type:S};c.push(E)}else{const E=this.getLastNalUnit(e.samples);E&&(o&&h<=4-o&&E.state&&(E.data=E.data.subarray(0,E.data.byteLength-o)),m>0&&(E.data=wi(E.data,t.subarray(0,m)),E.state=0))}h<a?(g=this.getNALuType(t,h),y=h,S=g,l=0):l=-1}else l=0}if(y>=0&&l>=0){const E={data:t.subarray(y,a),type:S,state:l};c.push(E)}if(c.length===0){const E=this.getLastNalUnit(e.samples);E&&(E.data=wi(E.data,t))}return e.naluState=l,c}}class Qa{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,a=new Uint8Array(4),l=Math.min(4,t);if(l===0)throw new Error("no bytes available");a.set(e.subarray(i,i+l)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&qe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class eC extends uT{parsePES(e,t,i,a){const l=this.parseNALu(e,i.data,a);let o=this.VideoSample,c,h=!1;i.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.forEach(d=>{var m,g;switch(d.type){case 1:{let x=!1;c=!0;const T=d.data;if(h&&T.length>4){const R=this.readSliceType(T);(R===2||R===4||R===7||R===9)&&(x=!0)}if(x){var y;(y=o)!=null&&y.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=x;break}case 5:c=!0,(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{c=!0,Nh(d.data,1,i.pts,t.samples);break}case 7:{var S,E;c=!0,h=!0;const x=d.data,T=this.readSPS(x);if(!e.sps||e.width!==T.width||e.height!==T.height||((S=e.pixelRatio)==null?void 0:S[0])!==T.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[x];const R=x.subarray(1,4);let L="avc1.";for(let _=0;_<3;_++){let O=R[_].toString(16);O.length<2&&(O="0"+O),L+=O}e.codec=L}break}case 8:c=!0,e.pps=[d.data];break;case 9:c=!0,e.audFound=!0,(g=o)!=null&&g.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:c=!0;break;default:c=!1;break}o&&c&&o.units.push(d)}),a&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Qa(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,a=8,l;for(let o=0;o<e;o++)a!==0&&(l=t.readEG(),a=(i+l+256)%256),i=a===0?i:a}readSPS(e){const t=new Qa(e);let i=0,a=0,l=0,o=0,c,h,d;const m=t.readUByte.bind(t),g=t.readBits.bind(t),y=t.readUEG.bind(t),S=t.readBoolean.bind(t),E=t.skipBits.bind(t),x=t.skipEG.bind(t),T=t.skipUEG.bind(t),R=this.skipScalingList.bind(this);m();const L=m();if(g(5),E(3),m(),T(),L===100||L===110||L===122||L===244||L===44||L===83||L===86||L===118||L===128){const $=y();if($===3&&E(1),T(),T(),E(1),S())for(h=$!==3?8:12,d=0;d<h;d++)S()&&(d<6?R(16,t):R(64,t))}T();const _=y();if(_===0)y();else if(_===1)for(E(1),x(),x(),c=y(),d=0;d<c;d++)x();T(),E(1);const O=y(),M=y(),G=g(1);G===0&&E(1),E(1),S()&&(i=y(),a=y(),l=y(),o=y());let w=[1,1];if(S()&&S())switch(m()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[m()<<8|m(),m()<<8|m()];break}}return{width:Math.ceil((O+1)*16-i*2-a*2),height:(2-G)*(M+1)*16-(G?2:4)*(l+o),pixelRatio:w}}}class tC extends uT{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,a){const l=this.parseNALu(e,i.data,a);let o=this.VideoSample,c,h=!1;i.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.forEach(d=>{var m,g;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,h){var y;(y=o)!=null&&y.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:c=!0,(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:c=!0,Nh(d.data,2,i.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Je(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(c=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const S=this.readSPS(d.data);e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.codec=S.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const E in S.params)e.params[E]=S.params[E]}this.pushParameterSet(e.sps,d.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const S=this.readPPS(d.data);for(const E in S)e.params[E]=S[E]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(g=o)!=null&&g.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:c=!1;break}o&&c&&o.units.push(d)}),a&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let a=0;a<e.byteLength;a++)a>=2&&e[a]===3&&e[a-1]===0&&e[a-2]===0||(t[i]=e[a],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Qa(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),a=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:a}}readSPS(e){const t=new Qa(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const a=t.readBits(2),l=t.readBoolean(),o=t.readBits(5),c=t.readUByte(),h=t.readUByte(),d=t.readUByte(),m=t.readUByte(),g=t.readUByte(),y=t.readUByte(),S=t.readUByte(),E=t.readUByte(),x=t.readUByte(),T=t.readUByte(),R=t.readUByte(),L=[],_=[];for(let ye=0;ye<i;ye++)L.push(t.readBoolean()),_.push(t.readBoolean());if(i>0)for(let ye=i;ye<8;ye++)t.readBits(2);for(let ye=0;ye<i;ye++)L[ye]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),_[ye]&&t.readUByte();t.readUEG();const O=t.readUEG();O==3&&t.skipBits(1);const M=t.readUEG(),G=t.readUEG(),w=t.readBoolean();let $=0,U=0,P=0,q=0;w&&($+=t.readUEG(),U+=t.readUEG(),P+=t.readUEG(),q+=t.readUEG());const re=t.readUEG(),ce=t.readUEG(),oe=t.readUEG(),fe=t.readBoolean();for(let ye=fe?0:i;ye<=i;ye++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let De=0;De<4;De++)for(let ke=0;ke<(De===3?2:6);ke++)if(!t.readBoolean())t.readUEG();else{const et=Math.min(64,1<<4+(De<<1));De>1&&t.readEG();for(let Ot=0;Ot<et;Ot++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const J=t.readUEG();let le=0;for(let ye=0;ye<J;ye++){let De=!1;if(ye!==0&&(De=t.readBoolean()),De){ye===J&&t.readUEG(),t.readBoolean(),t.readUEG();let ke=0;for(let $e=0;$e<=le;$e++){const et=t.readBoolean();let Ot=!1;et||(Ot=t.readBoolean()),(et||Ot)&&ke++}le=ke}else{const ke=t.readUEG(),$e=t.readUEG();le=ke+$e;for(let et=0;et<ke;et++)t.readUEG(),t.readBoolean();for(let et=0;et<$e;et++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ye=t.readUEG();for(let De=0;De<ye;De++){for(let ke=0;ke<oe+4;ke++)t.readBits(1);t.readBits(1)}}let C=0,F=1,ee=1,ae=!0,ue=1,he=0;t.readBoolean(),t.readBoolean();let Se=!1;if(t.readBoolean()){if(t.readBoolean()){const tt=t.readUByte(),vt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Xe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];tt>0&&tt<16?(F=vt[tt-1],ee=Xe[tt-1]):tt===255&&(F=t.readBits(16),ee=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Se=t.readBoolean(),Se&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ue=t.readBits(32),he=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Xe=t.readBoolean(),vs=t.readBoolean();let Ni=!1;(Xe||vs)&&(Ni=t.readBoolean(),Ni&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ni&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Pn=0;Pn<=i;Pn++){ae=t.readBoolean();const At=ae||t.readBoolean();let Yt=!1;At?t.readEG():Yt=t.readBoolean();const ln=Yt?1:t.readUEG()+1;if(Xe)for(let on=0;on<ln;on++)t.readUEG(),t.readUEG(),Ni&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(vs)for(let on=0;on<ln;on++)t.readUEG(),t.readUEG(),Ni&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),C=t.readUEG())}let we=M,bt=G;if(w){let ye=1,De=1;O===1?ye=De=2:O==2&&(ye=2),we=M-ye*U-ye*$,bt=G-De*q-De*P}const Vt=a?["A","B","C"][a]:"",ys=c<<24|h<<16|d<<8|m;let Ti=0;for(let ye=0;ye<32;ye++)Ti=(Ti|(ys>>ye&1)<<31-ye)>>>0;let Kt=Ti.toString(16);return o===1&&Kt==="2"&&(Kt="6"),{codecString:`hvc1.${Vt}${o}.${Kt}.${l?"H":"L"}${R}.B0`,params:{general_tier_flag:l,general_profile_idc:o,general_profile_space:a,general_profile_compatibility_flags:[c,h,d,m],general_constraint_indicator_flags:[g,y,S,E,x,T],general_level_idc:R,bit_depth:re+8,bit_depth_luma_minus8:re,bit_depth_chroma_minus8:ce,min_spatial_segmentation_idc:C,chroma_format_idc:O,frame_rate:{fixed:ae,fps:he/ue}},width:we,height:bt,pixelRatio:[F,ee]}}readPPS(e){const t=new Qa(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const a=t.readBoolean(),l=t.readBoolean();let o=1;return l&&a?o=0:l?o=3:a&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ct=188;class fs{constructor(e,t,i,a){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=a,this.videoParser=null}static probe(e,t){const i=fs.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(Ct*5,t-Ct)+1,a=0;for(;a<i;){let l=!1,o=-1,c=0;for(let h=a;h<t;h+=Ct)if(e[h]===71&&(t-h===Ct||e[h+Ct]===71)){if(c++,o===-1&&(o=h,o!==0&&(i=Math.min(o+Ct*99,e.length-Ct)+1)),l||(l=uh(e,h)===0),l&&c>1&&(o===0&&c>2||h+Ct>i))return o}else{if(c)return-1;break}a++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:gS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,a){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=fs.createTrack("video"),this._videoTrack.duration=a,this._audioTrack=fs.createTrack("audio",a),this._id3Track=fs.createTrack("id3"),this._txtTrack=fs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,a=!1){i||(this.sampleAes=null);let l;const o=this._videoTrack,c=this._audioTrack,h=this._id3Track,d=this._txtTrack;let m=o.pid,g=o.pesData,y=c.pid,S=h.pid,E=c.pesData,x=h.pesData,T=null,R=this.pmtParsed,L=this._pmtId,_=e.length;if(this.remainderData&&(e=wi(this.remainderData,e),_=e.length,this.remainderData=null),_<Ct&&!a)return this.remainderData=e,{audioTrack:c,videoTrack:o,id3Track:h,textTrack:d};const O=Math.max(0,fs.syncOffset(e));_-=(_-O)%Ct,_<e.byteLength&&!a&&(this.remainderData=new Uint8Array(e.buffer,_,e.buffer.byteLength-_));let M=0;for(let w=O;w<_;w+=Ct)if(e[w]===71){const $=!!(e[w+1]&64),U=uh(e,w),P=(e[w+3]&48)>>4;let q;if(P>1){if(q=w+5+e[w+4],q===w+Ct)continue}else q=w+4;switch(U){case m:$&&(g&&(l=Mr(g,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,d,l,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray(q,w+Ct)),g.size+=w+Ct-q);break;case y:if($){if(E&&(l=Mr(E,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,l);break;case"mp3":this.parseMPEGPES(c,l);break;case"ac3":this.parseAC3PES(c,l);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(q,w+Ct)),E.size+=w+Ct-q);break;case S:$&&(x&&(l=Mr(x,this.logger))&&this.parseID3PES(h,l),x={data:[],size:0}),x&&(x.data.push(e.subarray(q,w+Ct)),x.size+=w+Ct-q);break;case 0:$&&(q+=e[q]+1),L=this._pmtId=iC(e,q);break;case L:{$&&(q+=e[q]+1);const re=nC(e,q,this.typeSupported,i,this.observer,this.logger);m=re.videoPid,m>0&&(o.pid=m,o.segmentCodec=re.segmentVideoCodec),y=re.audioPid,y>0&&(c.pid=y,c.segmentCodec=re.segmentAudioCodec),S=re.id3Pid,S>0&&(h.pid=S),T!==null&&!R&&(this.logger.warn(`MPEG-TS PMT found at ${w} after unknown PID '${T}'. Backtracking to sync byte @${O} to parse all TS packets.`),T=null,w=O-188),R=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=U;break}}else M++;M>0&&ch(this.observer,new Error(`Found ${M} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=g,c.pesData=E,h.pesData=x;const G={audioTrack:c,videoTrack:o,id3Track:h,textTrack:d};return a&&this.extractRemainingSamples(G),G}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:a,textTrack:l}=e,o=i.pesData,c=t.pesData,h=a.pesData;let d;if(o&&(d=Mr(o,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,l,d,!0),i.pesData=null)):i.pesData=o,c&&(d=Mr(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;h&&(d=Mr(h,this.logger))?(this.parseID3PES(a,d),a.pesData=null):a.pesData=h}demuxSampleAes(e,t,i){const a=this.demux(e,i,!0,!this.config.progressive),l=this.sampleAes=new JI(this.observer,this.config,t);return this.decrypt(a,l)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new eC:e==="hevc"&&(this.videoParser=new tC))}decrypt(e,t){return new Promise(i=>{const{audioTrack:a,videoTrack:l}=e;a.samples&&a.segmentCodec==="aac"?t.decryptAacSamples(a.samples,0,()=>{l.samples?t.decryptAvcSamples(l.samples,0,0,()=>{i(e)}):i(e)}):l.samples&&t.decryptAvcSamples(l.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const a=this.aacOverFlow;let l=t.data;if(a){this.aacOverFlow=null;const g=a.missing,y=a.sample.unit.byteLength;if(g===-1)l=wi(a.sample.unit,l);else{const S=y-g;a.sample.unit.set(l.subarray(0,g),S),e.samples.push(a.sample),i=a.missing}}let o,c;for(o=i,c=l.length;o<c-1&&!xu(l,o);o++);if(o!==i){let g;const y=o<c-1;if(y?g=`AAC PES did not start with ADTS header,offset:${o}`:g="No ADTS header found in AAC PES",ch(this.observer,new Error(g),y,this.logger),!y)return}ZS(e,this.observer,l,o,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(a){const g=JS(e.samplerate);h=a.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,m;for(;o<c;)if(m=eT(e,l,o,h,d),o+=m.length,m.missing){this.aacOverFlow=m;break}else for(d++;o<c-1&&!xu(l,o);o++);}parseMPEGPES(e,t){const i=t.data,a=i.length;let l=0,o=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<a;)if(rT(i,o)){const h=nT(e,i,o,c,l);if(h)o+=h.length,l++;else break}else o++}parseAC3PES(e,t){{const i=t.data,a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const l=i.length;let o=0,c=0,h;for(;c<l&&(h=oT(e,i,c,a,o++))>0;)c+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Je({},t,{type:this._videoTrack?vi.emsg:vi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function uh(s,e){return((s[e+1]&31)<<8)+s[e+2]}function iC(s,e){return(s[e+10]&31)<<8|s[e+11]}function nC(s,e,t,i,a,l){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(s[e+1]&15)<<8|s[e+2],h=e+3+c-4,d=(s[e+10]&15)<<8|s[e+11];for(e+=12+d;e<h;){const m=uh(s,e),g=(s[e+3]&15)<<8|s[e+4];switch(s[e]){case 207:if(!i){Ad("ADTS AAC",l);break}case 15:o.audioPid===-1&&(o.audioPid=m);break;case 21:o.id3Pid===-1&&(o.id3Pid=m);break;case 219:if(!i){Ad("H.264",l);break}case 27:o.videoPid===-1&&(o.videoPid=m);break;case 3:case 4:!t.mpeg&&!t.mp3?l.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=m,o.segmentAudioCodec="mp3");break;case 193:if(!i){Ad("AC-3",l);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=m,o.segmentAudioCodec="ac3"):l.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&g>0){let y=e+5,S=g;for(;S>2;){switch(s[y]){case 106:t.ac3!==!0?l.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=m,o.segmentAudioCodec="ac3");break}const x=s[y+1]+2;y+=x,S-=x}}break;case 194:case 135:return ch(a,new Error("Unsupported EC-3 in M2TS found"),void 0,l),o;case 36:o.videoPid===-1&&(o.videoPid=m,o.segmentVideoCodec="hevc",l.log("HEVC in M2TS found"));break}e+=g+5}return o}function ch(s,e,t,i){i.warn(`parsing error: ${e.message}`),s.emit(A.ERROR,A.ERROR,{type:Ee.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ad(s,e){e.log(`${s} with AES-128-CBC encryption found in unencrypted stream`)}function Mr(s,e){let t=0,i,a,l,o,c;const h=s.data;if(!s||s.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=wi(h[0],h[1]),h.splice(1,1);if(i=h[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(a=(i[4]<<8)+i[5],a&&a>s.size-6)return null;const m=i[7];m&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,m&64?(c=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-c>60*9e4&&(e.warn(`${Math.round((o-c)/9e4)}s delta between PTS and DTS, align them`),o=c)):c=o),l=i[8];let g=l+9;if(s.size<=g)return null;s.size-=g;const y=new Uint8Array(s.size);for(let S=0,E=h.length;S<E;S++){i=h[S];let x=i.byteLength;if(g)if(g>x){g-=x;continue}else i=i.subarray(g),x-=g,g=0;y.set(i,t),t+=x}return a&&(a-=l+3),{data:y,pts:o,dts:c,len:a}}return null}class sC{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const os=Math.pow(2,32)-1;class H{static init(){H.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in H.types)H.types.hasOwnProperty(e)&&(H.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);H.HDLR_TYPES={video:t,audio:i};const a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);H.STTS=H.STSC=H.STCO=l,H.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),H.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),H.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),H.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);H.FTYP=H.box(H.types.ftyp,o,h,o,c),H.DINF=H.box(H.types.dinf,H.box(H.types.dref,a))}static box(e,...t){let i=8,a=t.length;const l=a;for(;a--;)i+=t[a].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(e,4),a=0,i=8;a<l;a++)o.set(t[a],i),i+=t[a].byteLength;return o}static hdlr(e){return H.box(H.types.hdlr,H.HDLR_TYPES[e])}static mdat(e){return H.box(H.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(os+1)),a=Math.floor(t%(os+1));return H.box(H.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255,85,196,0,0]))}static mdia(e){return H.box(H.types.mdia,H.mdhd(e.timescale||0,e.duration||0),H.hdlr(e.type),H.minf(e))}static mfhd(e){return H.box(H.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?H.box(H.types.minf,H.box(H.types.smhd,H.SMHD),H.DINF,H.stbl(e)):H.box(H.types.minf,H.box(H.types.vmhd,H.VMHD),H.DINF,H.stbl(e))}static moof(e,t,i){return H.box(H.types.moof,H.mfhd(e),H.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=H.trak(e[t]);return H.box.apply(null,[H.types.moov,H.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(H.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=H.trex(e[t]);return H.box.apply(null,[H.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(os+1)),a=Math.floor(t%(os+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return H.box(H.types.mvhd,l)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let a,l;for(a=0;a<t.length;a++)l=t[a].flags,i[a+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return H.box(H.types.sdtp,i)}static stbl(e){return H.box(H.types.stbl,H.stsd(e),H.box(H.types.stts,H.STTS),H.box(H.types.stsc,H.STSC),H.box(H.types.stsz,H.STSZ),H.box(H.types.stco,H.STCO))}static avc1(e){let t=[],i=[],a,l,o;for(a=0;a<e.sps.length;a++)l=e.sps[a],o=l.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(l));for(a=0;a<e.pps.length;a++)l=e.pps[a],o=l.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(l));const c=H.box(H.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),h=e.width,d=e.height,m=e.pixelRatio[0],g=e.pixelRatio[1];return H.box(H.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return H.box(H.types.mp4a,H.audioStsd(e),H.box(H.types.esds,H.esds(e)))}static mp3(e){return H.box(H.types[".mp3"],H.audioStsd(e))}static ac3(e){return H.box(H.types["ac-3"],H.audioStsd(e),H.box(H.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return H.box(H.types.stsd,H.STSD,H.mp4a(e));if(t==="ac3"&&e.config)return H.box(H.types.stsd,H.STSD,H.ac3(e));if(t==="mp3"&&e.codec==="mp3")return H.box(H.types.stsd,H.STSD,H.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return H.box(H.types.stsd,H.STSD,H.avc1(e));if(t==="hevc"&&e.vps)return H.box(H.types.stsd,H.STSD,H.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),a=e.width||0,l=e.height||0,o=Math.floor(i/(os+1)),c=Math.floor(i%(os+1));return H.box(H.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,a&255,0,0,l>>8&255,l&255,0,0]))}static traf(e,t){const i=H.sdtp(e),a=e.id,l=Math.floor(t/(os+1)),o=Math.floor(t%(os+1));return H.box(H.types.traf,H.box(H.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255])),H.box(H.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255])),H.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,H.box(H.types.trak,H.tkhd(e),H.mdia(e))}static trex(e){const t=e.id;return H.box(H.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],a=i.length,l=12+16*a,o=new Uint8Array(l);let c,h,d,m,g,y;for(t+=8+l,o.set([e.type==="video"?1:0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,a&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<a;c++)h=i[c],d=h.duration,m=h.size,g=h.flags,y=h.cts,o.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*c);return H.box(H.types.trun,o)}static initSegment(e){H.types||H.init();const t=H.moov(e);return wi(H.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],a=4,l=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),a-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let o=l.length;for(let E=0;E<i.length;E+=1){o+=3;for(let x=0;x<i[E].length;x+=1)o+=2+i[E][x].length}const c=new Uint8Array(o);c.set(l,0),o=l.length;const h=i.length-1;for(let E=0;E<i.length;E+=1){c.set(new Uint8Array([32+E|(E===h?128:0),0,i[E].length]),o),o+=3;for(let x=0;x<i[E].length;x+=1)c.set(new Uint8Array([i[E][x].length>>8,i[E][x].length&255]),o),o+=2,c.set(i[E][x],o),o+=i[E][x].length}const d=H.box(H.types.hvcC,c),m=e.width,g=e.height,y=e.pixelRatio[0],S=e.pixelRatio[1];return H.box(H.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,S>>24,S>>16&255,S>>8&255,S&255])))}}H.types=void 0;H.HDLR_TYPES=void 0;H.STTS=void 0;H.STSC=void 0;H.STCO=void 0;H.STSZ=void 0;H.VMHD=void 0;H.SMHD=void 0;H.STSD=void 0;H.FTYP=void 0;H.DINF=void 0;const cT=9e4;function Xh(s,e,t=1,i=!1){const a=s*e*t;return i?Math.round(a):a}function rC(s,e,t=1,i=!1){return Xh(s,e,1/t,i)}function Ya(s,e=!1){return Xh(s,1e3,1/cT,e)}function aC(s,e=1){return Xh(s,cT,1/e)}function Mv(s){const{baseTime:e,timescale:t,trackId:i}=s;return`${e/t} (${e}/${t}) trackId: ${i}`}const lC=10*1e3,oC=1024,uC=1152,cC=1536;let Nr=null,Rd=null;function Nv(s,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}}}class su extends Mi{constructor(e,t,i,a){if(super("mp4-remuxer",a),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,Nr===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Nr=o?parseInt(o[1]):0}if(Rd===null){const l=navigator.userAgent.match(/Safari\/(\d+)/i);Rd=l?parseInt(l[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Mv(t)} > ${e&&Mv(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,a=e.reduce((l,o)=>{let c=o.pts,h=c-l;return h<-4294967296&&(t=!0,c=yi(c,i),h=c-l),h>0?l:c},i);return t&&this.debug("PTS rollover detected"),a}remux(e,t,i,a,l,o,c,h){let d,m,g,y,S,E,x=l,T=l;const R=e.pid>-1,L=t.pid>-1,_=t.samples.length,O=e.samples.length>0,M=c&&_>0||_>1;if((!R||O)&&(!L||M)||this.ISGenerated||c){if(this.ISGenerated){var w,$,U,P;const oe=this.videoTrackConfig;(oe&&(t.width!==oe.width||t.height!==oe.height||((w=t.pixelRatio)==null?void 0:w[0])!==(($=oe.pixelRatio)==null?void 0:$[0])||((U=t.pixelRatio)==null?void 0:U[1])!==((P=oe.pixelRatio)==null?void 0:P[1]))||!oe&&M||this.nextAudioTs===null&&O)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,l,o));const q=this.isVideoContiguous;let re=-1,ce;if(M&&(re=fC(t.samples),!q&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,re>0){this.warn(`Dropped ${re} out of ${_} video samples due to a missing keyframe`);const oe=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(re),t.dropped+=re,T+=(t.samples[0].pts-oe)/t.inputTimeScale,ce=T}else re===-1&&(this.warn(`No keyframe found out of ${_} video samples`),E=!1);if(this.ISGenerated){if(O&&M){const oe=this.getVideoStartPts(t.samples),k=(yi(e.samples[0].pts,oe)-oe)/t.inputTimeScale;x+=Math.max(0,k),T+=Math.max(0,-k)}if(O){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,t,l,o)),m=this.remuxAudio(e,x,this.isAudioContiguous,o,L||M||h===ge.AUDIO?T:void 0),M){const oe=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,t,l,o)),d=this.remuxVideo(t,T,q,oe)}}else M&&(d=this.remuxVideo(t,T,q,0));d&&(d.firstKeyFrame=re,d.independent=re!==-1,d.firstKeyFramePTS=ce)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(S=fT(i,l,this._initPTS,this._initDTS)),a.samples.length&&(y=dT(a,l,this._initPTS))),{audio:m,video:d,initSegment:g,independent:E,text:y,id3:S}}computeInitPts(e,t,i,a){const l=Math.round(i*t);let o=yi(e,l);if(o<l+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(l-o)/t} ${a}`);o<l+t;)o+=8589934592;return o-l}generateIS(e,t,i,a){const l=e.samples,o=t.samples,c=this.typeSupported,h={},d=this._initPTS;let m=!d||a,g="audio/mp4",y,S,E,x=-1;if(m&&(y=S=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(g="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):H.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(x=e.id,E=e.inputTimeScale,!d||E!==d.timescale?y=S=this.computeInitPts(l[0].pts,E,i,"audio"):m=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:H.initSegment([t]),metadata:{width:t.width,height:t.height}},m)if(x=t.id,E=t.inputTimeScale,!d||E!==d.timescale){const T=this.getVideoStartPts(o),R=yi(o[0].dts,T),L=this.computeInitPts(R,E,i,"video"),_=this.computeInitPts(T,E,i,"video");S=Math.min(S,L),y=Math.min(y,_)}else m=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,m?(d&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${i} ${y/E} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${y/E} (${y}/${E}) trackId: ${x}`),this._initPTS={baseTime:y,timescale:E,trackId:x},this._initDTS={baseTime:S,timescale:E,trackId:x}):y=E=void 0,{tracks:h,initPTS:y,timescale:E,trackId:x}}remuxVideo(e,t,i,a){const l=e.inputTimeScale,o=e.samples,c=[],h=o.length,d=this._initPTS,m=d.baseTime*l/d.timescale;let g=this.nextVideoTs,y=8,S=this.videoSampleDuration,E,x,T=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY,L=!1;if(!i||g===null){const C=m+t*l,F=o[0].pts-yi(o[0].dts,o[0].pts);Nr&&g!==null&&Math.abs(C-F-(g+m))<15e3?i=!0:g=C-F-m}const _=g+m;for(let C=0;C<h;C++){const F=o[C];F.pts=yi(F.pts,_),F.dts=yi(F.dts,_),F.dts<o[C>0?C-1:C].dts&&(L=!0)}L&&o.sort(function(C,F){const ee=C.dts-F.dts,ae=C.pts-F.pts;return ee||ae}),E=o[0].dts,x=o[o.length-1].dts;const O=x-E,M=O?Math.round(O/(h-1)):S||e.inputTimeScale/30;if(i){const C=E-_,F=C>M,ee=C<-1;if((F||ee)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ya(C,!0)} ms (${C}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ya(-C,!0)} ms (${C}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ee||_>=o[0].pts||Nr)){E=_;const ae=o[0].pts-C;if(F)o[0].dts=E,o[0].pts=ae;else{let ue=!0;for(let he=0;he<o.length&&!(o[he].dts>ae&&ue);he++){const Se=o[he].pts;if(o[he].dts-=C,o[he].pts-=C,he<o.length-1){const Fe=o[he+1].pts,we=o[he].pts,bt=Fe<=we,Vt=Fe<=Se;ue=bt==Vt}}}this.log(`Video: Initial PTS/DTS adjusted: ${Ya(ae,!0)}/${Ya(E,!0)}, delta: ${Ya(C,!0)} ms`)}}E=Math.max(0,E);let G=0,w=0,$=E;for(let C=0;C<h;C++){const F=o[C],ee=F.units,ae=ee.length;let ue=0;for(let he=0;he<ae;he++)ue+=ee[he].data.length;w+=ue,G+=ae,F.length=ue,F.dts<$?(F.dts=$,$+=M/4|0||1):$=F.dts,T=Math.min(F.pts,T),R=Math.max(F.pts,R)}x=o[h-1].dts;const U=w+4*G+8;let P;try{P=new Uint8Array(U)}catch(C){this.observer.emit(A.ERROR,A.ERROR,{type:Ee.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:U,reason:`fail allocating video mdat ${U}`});return}const q=new DataView(P.buffer);q.setUint32(0,U),P.set(H.types.mdat,4);let re=!1,ce=Number.POSITIVE_INFINITY,oe=Number.POSITIVE_INFINITY,fe=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let C=0;C<h;C++){const F=o[C],ee=F.units;let ae=0;for(let Se=0,Fe=ee.length;Se<Fe;Se++){const we=ee[Se],bt=we.data,Vt=we.data.byteLength;q.setUint32(y,Vt),y+=4,P.set(bt,y),y+=Vt,ae+=4+Vt}let ue;if(C<h-1)S=o[C+1].dts-F.dts,ue=o[C+1].pts-F.pts;else{const Se=this.config,Fe=C>0?F.dts-o[C-1].dts:M;if(ue=C>0?F.pts-o[C-1].pts:M,Se.stretchShortVideoTrack&&this.nextAudioTs!==null){const we=Math.floor(Se.maxBufferHole*l),bt=(a?T+a*l:this.nextAudioTs+m)-F.pts;bt>we?(S=bt-Fe,S<0?S=Fe:re=!0,this.log(`It is approximately ${bt/90} ms to the next segment; using duration ${S/90} ms for the last video frame.`)):S=Fe}else S=Fe}const he=Math.round(F.pts-F.dts);ce=Math.min(ce,S),fe=Math.max(fe,S),oe=Math.min(oe,ue),k=Math.max(k,ue),c.push(Nv(F.key,S,ae,he))}if(c.length){if(Nr){if(Nr<70){const C=c[0].flags;C.dependsOn=2,C.isNonSync=0}}else if(Rd&&k-oe<fe-ce&&M/fe<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let C=E;for(let F=0,ee=c.length;F<ee;F++){const ae=C+c[F].duration,ue=C+c[F].cts;if(F<ee-1){const he=ae+c[F+1].cts;c[F].duration=he-ue}else c[F].duration=F?c[F-1].duration:M;c[F].cts=0,C=ae}}}S=re||!S?M:S;const X=x+S;this.nextVideoTs=g=X-m,this.videoSampleDuration=S,this.isVideoContiguous=!0;const de={data1:H.moof(e.sequenceNumber++,E,Je(e,{samples:c})),data2:P,startPTS:(T-m)/l,endPTS:(R+S-m)/l,startDTS:(E-m)/l,endDTS:g/l,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,de}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return uC;case"ac3":return cC;default:return oC}}remuxAudio(e,t,i,a,l){const o=e.inputTimeScale,c=e.samplerate?e.samplerate:o,h=o/c,d=this.getSamplesPerFrame(e),m=d*h,g=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,S=[],E=l!==void 0;let x=e.samples,T=y?0:8,R=this.nextAudioTs||-1;const L=g.baseTime*o/g.timescale,_=L+t*o;if(this.isAudioContiguous=i=i||x.length&&R>0&&(a&&Math.abs(_-(R+L))<9e3||Math.abs(yi(x[0].pts,_)-(R+L))<20*m),x.forEach(function(k){k.pts=yi(k.pts,_)}),!i||R<0){const k=x.length;if(x=x.filter(X=>X.pts>=0),k!==x.length&&this.warn(`Removed ${x.length-k} of ${k} samples (initPTS ${L} / ${o})`),!x.length)return;l===0?R=0:a&&!E?R=Math.max(0,_-L):R=x[0].pts-L}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let X=0,J=R+L;X<x.length;X++){const le=x[X],de=le.pts,C=de-J,F=Math.abs(1e3*C/o);if(C<=-k*m&&E)X===0&&(this.warn(`Audio frame @ ${(de/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*C/o)} ms.`),this.nextAudioTs=R=de-L,J=de);else if(C>=k*m&&F<lC&&E){let ee=Math.round(C/m);for(J=de-ee*m;J<0&&ee&&m;)ee--,J+=m;X===0&&(this.nextAudioTs=R=J-L),this.warn(`Injecting ${ee} audio frames @ ${((J-L)/o).toFixed(3)}s due to ${Math.round(1e3*C/o)} ms gap.`);for(let ae=0;ae<ee;ae++){let ue=sC.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ue||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=le.unit.subarray()),x.splice(X,0,{unit:ue,pts:J}),J+=m,X++}}le.pts=J,J+=m}}let O=null,M=null,G,w=0,$=x.length;for(;$--;)w+=x[$].unit.byteLength;for(let k=0,X=x.length;k<X;k++){const J=x[k],le=J.unit;let de=J.pts;if(M!==null){const F=S[k-1];F.duration=Math.round((de-M)/h)}else if(i&&e.segmentCodec==="aac"&&(de=R+L),O=de,w>0){w+=T;try{G=new Uint8Array(w)}catch(F){this.observer.emit(A.ERROR,A.ERROR,{type:Ee.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:w,reason:`fail allocating audio mdat ${w}`});return}y||(new DataView(G.buffer).setUint32(0,w),G.set(H.types.mdat,4))}else return;G.set(le,T);const C=le.byteLength;T+=C,S.push(Nv(!0,d,C,0)),M=de}const U=S.length;if(!U)return;const P=S[S.length-1];R=M-L,this.nextAudioTs=R+h*P.duration;const q=y?new Uint8Array(0):H.moof(e.sequenceNumber++,O/h,Je({},e,{samples:S}));e.samples=[];const re=(O-L)/o,ce=this.nextAudioTs/o,fe={data1:q,data2:G,startPTS:re,endPTS:ce,startDTS:re,endDTS:ce,type:"audio",hasAudio:!0,hasVideo:!1,nb:U};return this.isAudioContiguous=!0,fe}}function yi(s,e){let t;if(e===null)return s;for(e<s?t=-8589934592:t=8589934592;Math.abs(s-e)>4294967296;)s+=t;return s}function fC(s){for(let e=0;e<s.length;e++)if(s[e].key)return e;return-1}function fT(s,e,t,i){const a=s.samples.length;if(!a)return;const l=s.inputTimeScale;for(let c=0;c<a;c++){const h=s.samples[c];h.pts=yi(h.pts-t.baseTime*l/t.timescale,e*l)/l,h.dts=yi(h.dts-i.baseTime*l/i.timescale,e*l)/l}const o=s.samples;return s.samples=[],{samples:o}}function dT(s,e,t){const i=s.samples.length;if(!i)return;const a=s.inputTimeScale;for(let o=0;o<i;o++){const c=s.samples[o];c.pts=yi(c.pts-t.baseTime*a/t.timescale,e*a)/a}s.samples.sort((o,c)=>o.pts-c.pts);const l=s.samples;return s.samples=[],{samples:l}}class dC extends Mi{constructor(e,t,i,a){super("passthrough-remuxer",a),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,a){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,a),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:a}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:l,video:o}=this.initData=vS(e);if(t)J_(e,t);else{const h=l||o;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}l&&(i=kv(l,nt.AUDIO,this)),o&&(a=kv(o,nt.VIDEO,this));const c={};l&&o?c.audiovideo={container:"video/mp4",codec:i+","+a,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:l?c.audio={container:"audio/mp4",codec:i,encrypted:l.encrypted,initSegment:e,id:"audio"}:o?c.video={container:"video/mp4",codec:a,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,i,a,l,o){var c,h;let{initPTS:d,lastEndTime:m}=this;const g={audio:void 0,video:void 0,text:a,id3:i,initSegment:void 0};me(m)||(m=this.lastEndTime=l||0);const y=t.samples;if(!y.length)return g;const S={initPTS:void 0,timescale:void 0,trackId:void 0};let E=this.initData;if((c=E)!=null&&c.length||(this.generateInitSegment(y),E=this.initData),!((h=E)!=null&&h.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(S.tracks=this.initTracks,this.emitInitSegment=!1);const x=tD(y,E,this),T=E.audio?x[E.audio.id]:null,R=E.video?x[E.video.id]:null,L=Go(R,1/0),_=Go(T,1/0),O=Go(R,0,!0),M=Go(T,0,!0);let G=l,w=0;const $=T&&(!R||!d&&_<L||d&&d.trackId===E.audio.id),U=$?T:R;if(U){const J=U.timescale,le=U.start-l*J,de=$?E.audio.id:E.video.id;G=U.start/J,w=$?M-_:O-L,(o||!d)&&(hC(d,G,l,w)||J!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${l} ${le/J} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${l} offset: ${G-l} (${le}/${J}) trackId: ${de}`),d=null,S.initPTS=le,S.timescale=J,S.trackId=de)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${l}`);d?(S.initPTS=d.baseTime,S.timescale=d.timescale,S.trackId=d.trackId):((!S.timescale||S.trackId===void 0||S.initPTS===void 0)&&(this.warn("Could not set initPTS"),S.initPTS=G,S.timescale=1,S.trackId=-1),this.initPTS=d={baseTime:S.initPTS,timescale:S.timescale,trackId:S.trackId});const P=G-d.baseTime/d.timescale,q=P+w;w>0?this.lastEndTime=q:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const re=!!E.audio,ce=!!E.video;let oe="";re&&(oe+="audio"),ce&&(oe+="video");const fe=(E.audio?E.audio.encrypted:!1)||(E.video?E.video.encrypted:!1),k={data1:y,startPTS:P,startDTS:P,endPTS:q,endDTS:q,type:oe,hasAudio:re,hasVideo:ce,nb:1,dropped:0,encrypted:fe};g.audio=re&&!ce?k:void 0,g.video=ce?k:void 0;const X=R?.sampleCount;if(X){const J=R.keyFrameIndex,le=J!==-1;k.nb=X,k.dropped=J===0||this.isVideoContiguous?0:le?J:X,k.independent=le,k.firstKeyFrame=J,le&&R.keyFrameStart&&(k.firstKeyFramePTS=(R.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(g.independent=le),this.isVideoContiguous||(this.isVideoContiguous=le),k.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${J}/${X} dropped: ${k.dropped} start: ${k.firstKeyFramePTS||"NA"}`)}return g.initSegment=S,g.id3=fT(i,l,d,d),a.samples.length&&(g.text=dT(a,l,d)),g}}function Go(s,e,t=!1){return s?.start!==void 0?(s.start+(t?s.duration:0))/s.timescale:e}function hC(s,e,t,i){if(s===null)return!0;const a=Math.max(i,1),l=e-s.baseTime/s.timescale;return Math.abs(l-t)>a}function kv(s,e,t){const i=s.codec;return i&&i.length>4?i:e===nt.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?mu(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let Cn;try{Cn=self.performance.now.bind(self.performance)}catch{Cn=Date.now}const ru=[{demux:ZI,remux:dC},{demux:fs,remux:su},{demux:qI,remux:su},{demux:QI,remux:su}];ru.splice(2,0,{demux:XI,remux:su});class Pv{constructor(e,t,i,a,l,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=l,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,a){const l=i.transmuxing;l.executeStart=Cn();let o=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:h}=this;a&&(this.currentTransmuxState=a);const{contiguous:d,discontinuity:m,trackSwitch:g,accurateTimeOffset:y,timeOffset:S,initSegmentChange:E}=a||c,{audioCodec:x,videoCodec:T,defaultInitPts:R,duration:L,initSegmentData:_}=h,O=mC(o,t);if(O&&Br(O.method)){const $=this.getDecrypter(),U=$h(O.method);if($.isSync()){let P=$.softwareDecrypt(o,O.key.buffer,O.iv.buffer,U);if(i.part>-1){const re=$.flush();P=re&&re.buffer}if(!P)return l.executeEnd=Cn(),Ld(i);o=new Uint8Array(P)}else return this.asyncResult=!0,this.decryptionPromise=$.webCryptoDecrypt(o,O.key.buffer,O.iv.buffer,U).then(P=>{const q=this.push(P,null,i);return this.decryptionPromise=null,q}),this.decryptionPromise}const M=this.needsProbing(m,g);if(M){const $=this.configureTransmuxer(o);if($)return this.logger.warn(`[transmuxer] ${$.message}`),this.observer.emit(A.ERROR,A.ERROR,{type:Ee.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:$,reason:$.message}),l.executeEnd=Cn(),Ld(i)}(m||g||E||M)&&this.resetInitSegment(_,x,T,L,t),(m||E||M)&&this.resetInitialTimestamp(R),d||this.resetContiguity();const G=this.transmux(o,O,S,y,i);this.asyncResult=sl(G);const w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,l.executeEnd=Cn(),G}flush(e){const t=e.transmuxing;t.executeStart=Cn();const{decrypter:i,currentTransmuxState:a,decryptionPromise:l}=this;if(l)return this.asyncResult=!0,l.then(()=>this.flush(e));const o=[],{timeOffset:c}=a;if(i){const g=i.flush();g&&o.push(this.push(g.buffer,null,e))}const{demuxer:h,remuxer:d}=this;if(!h||!d){t.executeEnd=Cn();const g=[Ld(e)];return this.asyncResult?Promise.resolve(g):g}const m=h.flush(c);return sl(m)?(this.asyncResult=!0,m.then(g=>(this.flushRemux(o,g,e),o))):(this.flushRemux(o,m,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,i){const{audioTrack:a,videoTrack:l,id3Track:o,textTrack:c}=t,{accurateTimeOffset:h,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===ge.MAIN?"level":"track"} ${i.level}`);const m=this.remuxer.remux(a,l,o,c,d,h,!0,this.id);e.push({remuxResult:m,chunkMeta:i}),i.transmuxing.executeEnd=Cn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,a,l){const{demuxer:o,remuxer:c}=this;!o||!c||(o.resetInitSegment(e,t,i,a),c.resetInitSegment(e,t,i,l))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,a,l){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,a,l):o=this.transmuxUnencrypted(e,i,a,l),o}transmuxUnencrypted(e,t,i,a){const{audioTrack:l,videoTrack:o,id3Track:c,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(l,o,c,h,t,i,!1,this.id),chunkMeta:a}}transmuxSampleAes(e,t,i,a,l){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,a,!1,this.id),chunkMeta:l}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:a}=this;let l;for(let g=0,y=ru.length;g<y;g++){var o;if((o=ru[g].demux)!=null&&o.probe(e,this.logger)){l=ru[g];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,d=l.remux,m=l.demux;(!h||!(h instanceof d))&&(this.remuxer=new d(i,t,a,this.logger)),(!c||!(c instanceof m))&&(this.demuxer=new m(i,t,a,this.logger),this.probe=m.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Fh(this.config)),e}}function mC(s,e){let t=null;return s.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Ld=s=>({remuxResult:{},chunkMeta:s});function sl(s){return"then"in s&&s.then instanceof Function}class gC{constructor(e,t,i,a,l){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=a,this.defaultInitPts=l||null}}class pC{constructor(e,t,i,a,l,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=a,this.timeOffset=l,this.initSegmentChange=o}}let Uv=0;class hT{constructor(e,t,i,a){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Uv++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const d=h.data,m=this.hls;if(!(!m||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var g;const y=(g=this.workerContext)==null?void 0:g.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{m.logger[d.data.logType]&&m.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,m.trigger(d.event,d.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const d=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const l=e.config;this.hls=e,this.id=t,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=i,this.onFlush=a;const o=(h,d)=>{d=d||{},d.frag=this.frag||void 0,h===A.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(h,d)};this.observer=new Hh,this.observer.on(A.FRAG_DECRYPTED,o),this.observer.on(A.ERROR,o);const c=Zy(l.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(l.workerPath||SI()){try{l.workerPath?(h.log(`loading Web Worker ${l.workerPath} for "${t}"`),this.workerContext=xI(l.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=TI());const{worker:m}=this.workerContext;m.addEventListener("message",this.onWorkerMessage),m.addEventListener("error",this.onWorkerError),m.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:st(l)})}catch(m){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,m),this.terminateWorker(),this.error=null,this.transmuxer=new Pv(this.observer,c,l,"",t,e.logger)}return}}this.transmuxer=new Pv(this.observer,c,l,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Uv++;const t=this.hls.config,i=Zy(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:st(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),bI(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,a,l,o,c,h,d,m){var g,y;d.transmuxing.start=self.performance.now();const{instanceNo:S,transmuxer:E}=this,x=o?o.start:l.start,T=l.decryptdata,R=this.frag,L=!(R&&l.cc===R.cc),_=!(R&&d.level===R.level),O=R?d.sn-R.sn:-1,M=this.part?d.part-this.part.index:-1,G=O===0&&d.id>1&&d.id===R?.stats.chunkCount,w=!_&&(O===1||O===0&&(M===1||G&&M<=0)),$=self.performance.now();(_||O||l.stats.parsing.start===0)&&(l.stats.parsing.start=$),o&&(M||!w)&&(o.stats.parsing.start=$);const U=!(R&&((g=l.initSegment)==null?void 0:g.url)===((y=R.initSegment)==null?void 0:y.url)),P=new pC(L,w,h,_,x,U);if(!w||L||U){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${l.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===ge.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${L}
        trackSwitch: ${_}
        contiguous: ${w}
        accurateTimeOffset: ${h}
        timeOffset: ${x}
        initSegmentChange: ${U}`);const q=new gC(i,a,t,c,m);this.configureTransmuxer(q)}if(this.frag=l,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:S,cmd:"demux",data:e,decryptdata:T,chunkMeta:d,state:P},e instanceof ArrayBuffer?[e]:[]);else if(E){const q=E.push(e,T,d,P);sl(q)?q.then(re=>{this.handleTransmuxComplete(re)}).catch(re=>{this.transmuxerError(re,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(q)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const a=i.flush(e);sl(a)?a.then(l=>{this.handleFlushResult(l,e)}).catch(l=>{this.transmuxerError(l,e,"transmuxer-interface flush error")}):this.handleFlushResult(a,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Fv=100;class yC extends jh{constructor(e,t,i){super(e,t,i,"audio-stream-controller",ge.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:a,timescale:l,trackId:o}){if(i===ge.MAIN){const c=t.cc,h=this.fragCurrent;if(this.initPTS[c]={baseTime:a,timescale:l,trackId:o},this.log(`InitPTS for cc: ${c} found from main: ${a/l} (${a}/${l}) trackId: ${o}`),this.mainAnchor=t,this.state===ie.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==c)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==c?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===ie.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const a=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&a?.cc===t.cc)return;const l=(a||e).cc,o=this.getLevelDetails(),c=this.getLoadPosition(),h=IS(o,l,c);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===ie.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ie.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(Fv),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ie.IDLE):this.state=ie.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ie.IDLE:this.doTickIdle();break;case ie.WAITING_TRACK:{const{levels:e,trackId:t}=this,i=e?.[t],a=i?.details;if(a&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(a))break;this.state=ie.WAITING_INIT_PTS}break}case ie.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ie.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:a,complete:l}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ie.FRAG_LOADING;const c=a.flush().buffer,h={frag:t,part:i,payload:c,networkDetails:null};this._handleFragmentLoadProgress(h),l&&super._handleFragmentLoadComplete(h)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=ie.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:a,trackId:l}=this,o=t.config;if(!this.buffering||!a&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[l]))return;const c=i[l],h=c.details;if(!h||this.waitForLive(c)||this.waitForCdnTuneIn(h)){this.state=ie.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,nt.AUDIO,ge.AUDIO));const m=this.getFwdBufferInfo(d,ge.AUDIO);if(m===null)return;if(!this.switchingTrack&&this._streamEnded(m,h)){t.trigger(A.BUFFER_EOS,{type:"audio"}),this.state=ie.ENDED;return}const g=m.len,y=t.maxBufferLength,S=h.fragments,E=S[0].start,x=this.getLoadPosition(),T=this.flushing?x:m.end;if(this.switchingTrack&&a){const _=x;h.PTSKnown&&_<E&&(m.end>E||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),a.currentTime=E+.05)}if(g>=y&&!this.switchingTrack&&T<S[S.length-1].start)return;let R=this.getNextFragment(T,h);if(R&&this.isLoopLoading(R,T)&&(R=this.getNextFragmentLoopLoading(R,h,m,ge.MAIN,y)),!R){this.bufferFlushed=!0;return}let L=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&L&&pt(R)&&!R.endList&&(!h.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(L)===_t.OK&&(this.mainFragLoading=L=null),L&&pt(L))){if(R.start>L.end){const O=this.fragmentTracker.getFragAtPos(T,ge.MAIN);O&&O.end>L.end&&(L=O,this.mainFragLoading={frag:O,targetBufferTime:null})}if(R.start>L.end)return}this.loadFragment(R,c,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new tl(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:a}=this;a&&(a.abortRequests(),this.removeUnbufferedFrags(a.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ie.STOPPED&&(this.setInterval(Fv),this.state=ie.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(A.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:a}=this,{details:l,id:o,groupId:c,track:h}=t;if(!a){this.warn(`Audio tracks reset while loading track ${o} "${h.name}" of "${c}"`);return}const d=this.mainDetails;if(!d||l.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==ie.STOPPED&&(this.state=ie.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${h.name}" of "${c}" loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`);const m=a[o];let g=0;if(l.live||(i=m.details)!=null&&i.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(m.details){var y;g=this.alignPlaylists(l,m.details,(y=this.levelLastLoaded)==null?void 0:y.details)}l.alignedSliding||(YS(l,d),l.alignedSliding||Tu(l,d),g=l.fragmentStart)}m.details=l,this.levelLastLoaded=m,this.startFragRequested||this.setStartPosition(d,g),this.hls.trigger(A.AUDIO_TRACK_UPDATED,{details:l,id:o,groupId:t.groupId}),this.state===ie.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=ie.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:a,payload:l}=e,{config:o,trackId:c,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const d=h[c];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const m=d.details;if(!m){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const g=o.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new hT(this.hls,ge.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const S=this.initPTS[i.cc],E=(t=i.initSegment)==null?void 0:t.data;if(S!==void 0){const T=a?a.index:-1,R=T!==-1,L=new Bh(i.level,i.sn,i.stats.chunkCount,l.byteLength,T,R);y.push(l,E,g,"",i,a,m.totalduration,!1,L,S)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${m.startSN} ,${m.endSN}],track ${c}`);const{cache:x}=this.waitingData=this.waitingData||{frag:i,part:a,cache:new qS,complete:!1};x.push(new Uint8Array(l)),this.state!==ie.STOPPED&&(this.state=ie.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ge.MAIN&&pt(t.frag)&&(this.mainFragLoading=t,this.state===ie.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:a}=t;if(i.type!==ge.AUDIO){!this.audioOnly&&i.type===ge.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${a?" p: "+a.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(pt(i)){this.fragPrevious=i;const l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(A.AUDIO_TRACK_SWITCHED,Ye({},l)))}this.fragBufferedComplete(i,a),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=ie.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.AUDIO,t);break;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ie.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===Oe.AUDIO_TRACK&&(this.state=ie.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==nt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==nt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ie.ENDED&&(this.state=ie.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,ge.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:a}=this,{remuxResult:l,chunkMeta:o}=e,c=this.getCurrentContext(o);if(!c){this.resetWhenMissingContext(o);return}const{frag:h,part:d,level:m}=c,{details:g}=m,{audio:y,text:S,id3:E,initSegment:x}=l;if(this.fragContextChanged(h)||!g){this.fragmentTracker.removeFragment(h);return}if(this.state=ie.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),x!=null&&x.tracks){const T=h.initSegment||h;if(this.unhandledEncryptionError(x,h))return;this._bufferInitSegment(m,x.tracks,T,o),a.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:x.tracks})}if(y){const{startPTS:T,endPTS:R,startDTS:L,endDTS:_}=y;d&&(d.elementaryStreams[nt.AUDIO]={startPTS:T,endPTS:R,startDTS:L,endDTS:_}),h.setElementaryStreamInfo(nt.AUDIO,T,R,L,_),this.bufferFragmentData(y,h,d,o)}if(E!=null&&(t=E.samples)!=null&&t.length){const T=Je({id:i,frag:h,details:g},E);a.trigger(A.FRAG_PARSING_METADATA,T)}if(S){const T=Je({id:i,frag:h,details:g},S);a.trigger(A.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,i,a){if(this.state!==ie.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const l=t.audio;l.id=ge.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${l.container}, codecs[level/parsed]=[${o}/${l.codec}]`),o&&o.split(",").length===1&&(l.levelCodec=o),this.hls.trigger(A.BUFFER_CODECS,t);const c=l.initSegment;if(c!=null&&c.byteLength){const h={type:"audio",frag:i,part:null,chunkMeta:a,parent:i.type,data:c};this.hls.trigger(A.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,i){const a=this.fragmentTracker.getState(e);if(this.switchingTrack||a===_t.NOT_LOADED||a===_t.PARTIAL){var l;if(!pt(e))this._loadInitSegment(e,t);else if((l=t.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ie.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Tu(t.details,o)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:a,characteristics:l,audioCodec:o,channels:c}=this.bufferedTrack;Hs({name:t,lang:i,assocLang:a,characteristics:l,audioCodec:o,channels:c},e,$s)||(pu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(A.AUDIO_TRACK_SWITCHED,Ye({},e))}}class Qh extends Mi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const a=t?.renditionReports;if(a){let l=-1;for(let o=0;o<a.length;o++){const c=a[o];let h;try{h=new self.URL(c.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),h=c.URI||""}if(h===e){l=o;break}else h===e.substring(0,h.length)&&(l=o)}if(l!==-1){const o=a[l],c=parseInt(o["LAST-MSN"])||t.lastPartSn;let h=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const m=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&m>t.partTarget&&(h+=1)}const d=i&&Jy(i);return new ev(c,h>=0?h:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:a,stats:l}=t,o=self.performance.now(),c=l.loading.first?Math.max(0,o-l.loading.first):0;a.advancedDateTime=Date.now()-c;const h=this.hls.config.timelineOffset;if(h!==a.appliedTimelineOffset){const m=Math.max(h||0,0);a.appliedTimelineOffset=m,a.fragments.forEach(g=>{g.setStart(g.playlistOffset+m)})}if(a.live||i!=null&&i.live){const m="levelInfo"in t?t.levelInfo:t.track;if(a.reloaded(i),i&&a.fragments.length>0){uI(i,a,this);const L=a.playlistParsingError;if(L){this.warn(L);const _=this.hls;if(!_.config.ignorePlaylistParsingErrors){var d;const{networkDetails:O}=t;_.trigger(A.ERROR,{type:Ee.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:a.url,error:L,reason:L.message,level:t.level||void 0,parent:(d=a.fragments[0])==null?void 0:d.type,networkDetails:O,stats:l});return}a.playlistParsingError=null}}a.requestScheduled===-1&&(a.requestScheduled=l.loading.start);const g=this.hls.mainForwardBufferInfo,y=g?g.end-g.len:0,S=(a.edge-y)*1e3,E=jS(a,S);if(a.requestScheduled+E<o?a.requestScheduled=o:a.requestScheduled+=E,this.log(`live playlist ${e} ${a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:a.updated?"UPDATED":"MISSED"}`),!this.canLoad||!a.live)return;let x,T,R;if(a.canBlockReload&&a.endSN&&a.advanced){const L=this.hls.config.lowLatencyMode,_=a.lastPartSn,O=a.endSN,M=a.lastPartIndex,G=M!==-1,w=_===O;G?w?(T=O+1,R=L?0:M):(T=_,R=L?M+1:a.maxPartIndex):T=O+1;const $=a.age,U=$+a.ageHeader;let P=Math.min(U-a.partTarget,a.targetduration*1.5);if(P>0){if(U>a.targetduration*3)this.log(`Playlist last advanced ${$.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,R=void 0;else if(i!=null&&i.tuneInGoal&&U-a.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${P} with playlist age: ${a.age}`),P=0;else{const q=Math.floor(P/a.targetduration);if(T+=q,R!==void 0){const re=Math.round(P%a.targetduration/a.partTarget);R+=re}this.log(`CDN Tune-in age: ${a.ageHeader}s last advanced ${$.toFixed(2)}s goal: ${P} skip sn ${q} to part ${R}`)}a.tuneInGoal=P}if(x=this.getDeliveryDirectives(a,t.deliveryDirectives,T,R),L||!w){a.requestScheduled=o,this.loadingPlaylist(m,x);return}}else(a.canBlockReload||a.canSkipUntil)&&(x=this.getDeliveryDirectives(a,t.deliveryDirectives,T,R));x&&T!==void 0&&a.canBlockReload&&(a.requestScheduled=l.loading.first+Math.max(E-c*2,E/2)),this.scheduleLoading(m,x,a)}else this.clearTimer()}scheduleLoading(e,t,i){const a=i||e.details;if(!a){this.loadingPlaylist(e,t);return}const l=self.performance.now(),o=a.requestScheduled;if(l>=o){this.loadingPlaylist(e,t);return}const c=o-l;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,i,a){let l=Jy(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,a=t.part,l=iu.No),new ev(i,a,l)}checkRetry(e){const t=e.details,i=yu(e),a=e.errorAction,{action:l,retryCount:o=0,retryConfig:c}=a||{},h=!!a&&!!c&&(l===Ut.RetryRequest||!a.resolved&&l===Ut.SendAlternateToPenaltyBox);if(h){var d;if(o>=c.maxNumRetry)return!1;if(i&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const m=Uh(c,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),m),this.warn(`Retrying playlist loading ${o+1}/${c.maxNumRetry} after "${t}" in ${m}ms`)}e.levelRetry=!0,a.resolved=!0}return h}}function mT(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(!rl(s[t].attrs,e[t].attrs))return!1;return!0}function rl(s,e,t){const i=s["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(a=>s[a]!==e[a])}function fh(s,e){return e.label.toLowerCase()===s.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(s.lang||"").toLowerCase())}class vC extends Qh{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:a,details:l}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==a){this.warn(`Audio track with id:${i} and group:${a} not found in active group ${o?.groupId}`);return}const c=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${a} loaded [${l.startSN}-${l.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,a=this.groupIds;let l=this.currentTrack;if(!i||a?.length!==i?.length||i!=null&&i.some(c=>a?.indexOf(c)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(y=>!i||i.indexOf(y.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(y=>y.default)&&(this.selectDefaultTrack=!1),c.forEach((y,S)=>{y.id=S});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const h=this.hls.config.audioPreference;if(!l&&h){const y=tn(h,c,$s);if(y>-1)l=c[y];else{const S=tn(h,this.tracks);l=this.tracks[S]}}let d=this.findTrackId(l);d===-1&&l&&(d=this.findTrackId(null));const m={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(A.AUDIO_TRACKS_UPDATED,m);const g=this.trackId;if(d!==-1&&g===-1)this.setAudioTrack(d);else if(c.length&&g===-1){var o;const y=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${c.length}`);this.warn(y.message),this.hls.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(e,t){t.fatal||!t.context||t.context.type===Oe.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const a=this.currentTrack;if(a&&Hs(e,a,$s))return a;const l=tn(e,this.tracksInGroup,$s);if(l>-1){const o=this.tracksInGroup[l];return this.setAudioTrack(l),o}else if(a){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const c=CD(e,t.levels,i,o,$s);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const o=tn(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,a=t[e],l=a.details&&!a.details.live;if(e===this.trackId&&a===i&&l||(this.log(`Switching to audio-track ${e} "${a.name}" lang:${a.lang} group:${a.groupId} channels:${a.channels}`),this.trackId=e,this.currentTrack=a,this.hls.trigger(A.AUDIO_TRACK_SWITCHING,Ye({},a)),l))return;const o=this.switchParams(a.url,i?.details,a.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const a=t[i];if(!(this.selectDefaultTrack&&!a.default)&&(!e||Hs(e,a,$s)))return i}if(e){const{name:i,lang:a,assocLang:l,characteristics:o,audioCodec:c,channels:h}=e;for(let d=0;d<t.length;d++){const m=t[d];if(Hs({name:i,lang:a,assocLang:l,characteristics:o,audioCodec:c,channels:h},m,$s))return d}for(let d=0;d<t.length;d++){const m=t[d];if(rl(e.attrs,m.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const m=t[d];if(rl(e.attrs,m.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&pu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,a=e.groupId,l=this.getUrlWithDirectives(e.url,t),o=e.details,c=o?.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${a}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(A.AUDIO_TRACK_LOADING,{url:l,id:i,groupId:a,deliveryDirectives:t||null,track:e})}}class EC{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const a=this.queues[t];a.push(e),a.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const a=t[0];try{a.execute()}catch(l){var i;if(a.onError(l),this.queues===null||this.tracks===null)return;const o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],a=i?.buffer;return a?`SourceBuffer${a.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const Bv=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,gT="HlsJsTrackRemovedError";class SC extends Error{constructor(e){super(e),this.name=gT}}class TC extends Mi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var a;this.hls&&((a=this.mediaSource)==null?void 0:a.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:a,mediaSource:l}=this;i&&this.log("Media source opened"),!(!a||!l)&&(l.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(A.MEDIA_ATTACHED,{media:a,mediaSource:l}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:a}=this;i!==a&&this.error(`Media element src was set while attaching MediaSource (${a} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=H_(ms(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_APPENDING,this.onBufferAppending,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.BUFFER_EOS,this.onBufferEos,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.FRAG_PARSED,this.onFragParsed,this),e.on(A.FRAG_CHANGED,this.onFragChanged,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_APPENDING,this.onBufferAppending,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_EOS,this.onBufferEos,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.FRAG_PARSED,this.onFragParsed,this),e.off(A.FRAG_CHANGED,this.onFragChanged,this),e.off(A.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const l=this.isUpdating();l||this.operationQueue.removeBlockers();const o=this.isQueued();(l||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${l?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const a=this.transferData;return!this.sourceBufferCount&&a&&a.mediaSource===t?Je(i,a.tracks):this.sourceBuffers.forEach(l=>{const[o]=l;o&&(i[o]=Je({},this.tracks[o]),this.removeBuffer(o)),l[0]=l[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let a=2;(t.audio&&!t.video||!t.altAudio)&&(a=1),this.bufferCodecEventsTotal=a,this.log(`${a} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&a&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media;this.transferData=this.overrides=void 0;const a=ms(this.appendSource);if(a){const l=!!t.mediaSource;(l||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new a;if(this.assignMediaSource(o),l)this._objectUrl=i.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const h=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||h&&o instanceof h,$v(i),xC(i,c),i.load()}catch{i.src=c}else i.src=c}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,a=t.tracks,l=a?Object.keys(a):null,o=l?l.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(a&&l&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${st(i,(h,d)=>h==="initSegment"?void 0:d)};
transfer tracks: ${st(a,(h,d)=>h==="initSegment"?void 0:d)}}`),!fS(a,i)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,d=this.details,m=Math.max(h,d?.fragments[0].start||0);if(m-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${m}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(a)}"->"${Object.keys(i)}") start time: ${m} currentTime: ${h}`),this.onMediaDetaching(A.MEDIA_DETACHING,{}),this.onMediaAttaching(A.MEDIA_ATTACHING,t),e.currentTime=m;return}this.transferData=void 0,l.forEach(h=>{const d=h,m=a[d];if(m){const g=m.buffer;if(g){const y=this.fragmentTracker,S=m.id;if(y.hasFragments(S)||y.hasParts(S)){const T=Ae.getBuffered(g);y.detectEvictedFragments(d,T,S,null,!0)}const E=_d(d),x=[d,g];this.sourceBuffers[E]=x,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,m)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:a,mediaSource:l,_objectUrl:o}=this;if(l){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=l.readyState==="open";try{const h=l.sourceBuffers;for(let d=h.length;d--;)c&&h[d].abort(),l.removeSourceBuffer(h[d]);c&&l.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}a&&(a.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(a.removeAttribute("src"),this.appendSource&&$v(a),a.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(A.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var a;(a=this.mediaSource)!=null&&a.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(l){this.warn(`onBufferReset ${e}`,l)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[_d(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new EC(this.tracks)}onBufferCodecs(e,t){var i;const a=this.tracks,l=Object.keys(t);this.log(`BUFFER_CODECS: "${l}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(a.audio||a.video)||a.audiovideo&&("audio"in t||"video"in t),c=!o&&this.sourceBufferCount&&this.media&&l.some(h=>!a[h]);if(o||c){this.warn(`Unsupported transition between "${Object.keys(a)}" and "${l}" SourceBuffers`);return}l.forEach(h=>{var d,m;const g=t[h],{id:y,codec:S,levelCodec:E,container:x,metadata:T,supplemental:R}=g;let L=a[h];const _=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[h],O=_!=null&&_.buffer?_:L,M=O?.pendingCodec||O?.codec,G=O?.levelCodec;L||(L=a[h]={buffer:void 0,listeners:[],codec:S,supplemental:R,container:x,levelCodec:E,metadata:T,id:y});const w=tu(M,G),$=w?.replace(Bv,"$1");let U=tu(S,E);const P=(m=U)==null?void 0:m.replace(Bv,"$1");U&&w&&$!==P&&(h.slice(0,5)==="audio"&&(U=mu(U,this.appendSource)),this.log(`switching codec ${M} to ${U}`),U!==(L.pendingCodec||L.codec)&&(L.pendingCodec=U),L.container=x,this.appendChangeType(h,x,U))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const a=`${t};codecs=${i}`,l={label:`change-type=${a}`,execute:()=>{const o=this.tracks[e];if(o){const c=o.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${a}`),c.changeType(a),o.codec=i,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(l,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,a=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,ge.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var c;const h=this.tracks.video;(this.lastVideoAppendEnd>a||h!=null&&h.buffer&&Ae.isBuffered(h.buffer,a)||((c=this.fragmentTracker.getAppendedFrag(a,ge.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:a,type:l,parent:o,frag:c,part:h,chunkMeta:d,offset:m}=t,g=d.buffering[l],{sn:y,cc:S}=c,E=self.performance.now();g.start=E;const x=c.stats.buffering,T=h?h.stats.buffering:null;x.start===0&&(x.start=E),T&&T.start===0&&(T.start=E);const R=i.audio;let L=!1;l==="audio"&&R?.container==="audio/mpeg"&&(L=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const _=i.video,O=_?.buffer;if(O&&y!=="initSegment"){const w=h||c,$=this.blockedAudioAppend;if(l==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(_.ending||_.ended)){const P=w.start+w.duration*.05,q=O.buffered,re=this.currentOp("video");!q.length&&!re?this.blockAudio(w):!re&&!Ae.isBuffered(O,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(w)}else if(l==="video"){const U=w.end;if($){const P=$.frag.start;(U>P||U<this.lastVideoAppendEnd||Ae.isBuffered(O,P))&&this.unblockAudio()}this.lastVideoAppendEnd=U}}const M=(h||c).start,G={label:`append-${l}`,execute:()=>{var w;g.executeStart=self.performance.now();const $=(w=this.tracks[l])==null?void 0:w.buffer;$&&(L?this.updateTimestampOffset($,M,.1,l,y,S):m!==void 0&&me(m)&&this.updateTimestampOffset($,m,1e-6,l,y,S)),this.appendExecutor(a,l)},onStart:()=>{},onComplete:()=>{const w=self.performance.now();g.executeEnd=g.end=w,x.first===0&&(x.first=w),T&&T.first===0&&(T.first=w);const $={};this.sourceBuffers.forEach(([U,P])=>{U&&($[U]=Ae.getBuffered(P))}),this.appendErrors[l]=0,l==="audio"||l==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(A.BUFFER_APPENDED,{type:l,frag:c,part:h,chunkMeta:d,parent:c.type,timeRanges:$})},onError:w=>{var $;const U={type:Ee.MEDIA_ERROR,parent:c.type,details:z.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:c,part:h,chunkMeta:d,error:w,err:w,fatal:!1},P=($=this.media)==null?void 0:$.error;if(w.code===DOMException.QUOTA_EXCEEDED_ERR||w.name=="QuotaExceededError"||"quota"in w)U.details=z.BUFFER_FULL_ERROR;else if(w.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!P)U.errorAction=Fr(!0);else if(w.name===gT&&this.sourceBufferCount===0)U.errorAction=Fr(!0);else{const q=++this.appendErrors[l];this.warn(`Failed ${q}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${l}" sourceBuffer (${P||"no media error"})`),(q>=this.hls.config.appendErrorMaxRetry||P)&&(U.fatal=!0)}this.hls.trigger(A.ERROR,U)}};this.log(`queuing "${l}" append sn: ${y}${h?" p: "+h.index:""} of ${c.type===ge.MAIN?"level":"track"} ${c.level} cc: ${S}`),this.append(G,l,this.isPending(this.tracks[l]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(A.BUFFER_FLUSHED,{type:e})},onError:a=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,a)}}}onBufferFlushing(e,t){const{type:i,startOffset:a,endOffset:l}=t;i?this.append(this.getFlushOp(i,a,l),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,a,l),o)})}onFragParsed(e,t){const{frag:i,part:a}=t,l=[],o=a?a.elementaryStreams:i.elementaryStreams;o[nt.AUDIOVIDEO]?l.push("audiovideo"):(o[nt.AUDIO]&&l.push("audio"),o[nt.VIDEO]&&l.push("video"));const c=()=>{const h=self.performance.now();i.stats.buffering.end=h,a&&(a.stats.buffering.end=h);const d=a?a.stats:i.stats;this.hls.trigger(A.FRAG_BUFFERED,{frag:i,part:a,stats:d,id:i.type})};l.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(c,l).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([o])=>{if(o){const c=this.tracks[o];(!t.type||t.type===o)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${o} buffer reached EOS`)))}});const a=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var c;return o&&!((c=this.tracks[o])!=null&&c.ended)})?a?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(A.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(A.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===z.BUFFER_APPEND_ERROR&&t.frag){var i;const a=(i=t.errorAction)==null?void 0:i.nextAutoLevel;me(a)&&a!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const a=e.config,l=i.currentTime,o=t.levelTargetDuration,c=t.live&&a.liveBackBufferLength!==null?a.liveBackBufferLength:a.backBufferLength;if(me(c)&&c>=0){const d=Math.max(c,o),m=Math.floor(l/o)*o-d;this.flushBackBuffer(l,o,m)}const h=a.frontBufferFlushThreshold;if(me(h)&&h>0){const d=Math.max(a.maxBufferLength,h),m=Math.max(d,o),g=Math.floor(l/o)*o+m;this.flushFrontBuffer(l,o,g)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([a,l])=>{if(l){const c=Ae.getBuffered(l);if(c.length>0&&i>c.start(0)){var o;this.hls.trigger(A.BACK_BUFFER_REACHED,{bufferEnd:i});const h=this.tracks[a];if((o=this.details)!=null&&o.live)this.hls.trigger(A.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(h!=null&&h.ended){this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:a})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([a,l])=>{if(l){const o=Ae.getBuffered(l),c=o.length;if(c<2)return;const h=o.start(c-1),d=o.end(c-1);if(i>h||e>=h&&e<=d)return;this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:a})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||i?.readyState!=="open")return null;const a=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),m=Math.max(d,a);return{duration:1/0,start:d,end:m}}return{duration:1/0}}const l=(e=this.overrides)==null?void 0:e.duration;if(l)return me(l)?{duration:l}:null;const o=this.media.duration,c=me(i.duration)?i.duration:0;return a>c&&a>o||!me(o)?{duration:a}:null}updateMediaSource({duration:e,start:t,end:i}){const a=this.mediaSource;!this.media||!a||a.readyState!=="open"||(a.duration!==e&&(me(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),a.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${a.duration}. Setting seekable range to ${t}-${i}.`),a.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${st(i)}`),this.tracksReady){var a;const l=(a=this.transferData)==null?void 0:a.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const a=this.tracks[t];e[t]={buffer:i,container:a.container,codec:a.codec,supplemental:a.supplemental,levelCodec:a.levelCodec,id:a.id,metadata:a.metadata}}}),this.hls.trigger(A.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const l in e){const o=l,c=e[o];if(this.isPending(c)){const h=this.getTrackCodec(c,o),d=`${c.container};codecs=${h}`;c.codec=h,this.log(`creating sourceBuffer(${d})${this.currentOp(o)?" Queued":""} ${st(c)}`);try{const m=i.addSourceBuffer(d),g=_d(o),y=[o,m];t[g]=y,c.buffer=m}catch(m){var a;this.error(`error while trying to add sourceBuffer: ${m.message}`),this.shiftAndExecuteNext(o),(a=this.operationQueue)==null||a.removeBlockers(),delete this.tracks[o],this.hls.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:o,mimeType:d,parent:c.id});return}this.trackSourceBuffer(o,c)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let a=e.codec;i&&(t==="video"||t==="audiovideo")&&Ja(i,"video")&&(a=fD(a,i));const l=tu(a,e.levelCodec);return l?t.slice(0,5)==="audio"?mu(l,this.appendSource):l:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const a=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:a,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(l,o)=>{const c=o.removedRanges;c!=null&&c.length&&this.hls.trigger(A.BUFFER_FLUSHED,{type:l})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const a=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${a}`,t),this.hls.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:a,fatal:!1});const l=this.currentOp(e);l&&l.onError(a)}updateTimestampOffset(e,t,i,a,l,o){const c=t-e.timestampOffset;Math.abs(c)>=i&&(this.log(`Updating ${a} SourceBuffer timestampOffset to ${t} (sn: ${l} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:a,mediaSource:l}=this,o=this.tracks[e],c=o?.buffer;if(!a||!l||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=me(a.duration)?a.duration:1/0,d=me(l.duration)?l.duration:1/0,m=Math.max(0,t),g=Math.min(i,h,d);g>m&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${m},${g}] from the ${e} SourceBuffer`),c.remove(m,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],a=i?.buffer;if(!a)throw new SC(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,a.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,a=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(a).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const a=(i=this.tracks[t])==null?void 0:i.buffer;!a||a.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const a=this.tracks[e];if(!a)return;const l=a.buffer;if(!l)return;const o=i.bind(this,e);a.listeners.push({event:t,listener:o}),l.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(a=>{i.removeEventListener(a.event,a.listener)}),t.listeners.length=0)}}function $v(s){const e=s.querySelectorAll("source");[].slice.call(e).forEach(t=>{s.removeChild(t)})}function xC(s,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,s.appendChild(t)}function _d(s){return s==="audio"?1:0}class Wh{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&me(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((a,l)=>this.isLevelAllowed(a)&&l<=e);return this.clientRect=null,Wh.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const a=(c,h)=>h?c.width!==h.width||c.height!==h.height:!0;let l=e.length-1;const o=Math.max(t,i);for(let c=0;c<e.length;c+=1){const h=e[c];if((h.width>=o||h.height>=o)&&a(h,e[c+1])){l=c;break}}return l}}const bC={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},ti=bC,AC={HLS:"h"},RC=AC;class rn{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof rn?i:new rn(i))),this.value=e,this.params=t}}const LC="Dict";function _C(s){return Array.isArray(s)?JSON.stringify(s):s instanceof Map?"Map{}":s instanceof Set?"Set{}":typeof s=="object"?JSON.stringify(s):String(s)}function DC(s,e,t,i){return new Error(`failed to ${s} "${_C(e)}" as ${t}`,{cause:i})}function an(s,e,t){return DC("serialize",s,e,t)}class pT{constructor(e){this.description=e}}const Gv="Bare Item",IC="Boolean";function CC(s){if(typeof s!="boolean")throw an(s,IC);return s?"?1":"?0"}function OC(s){return btoa(String.fromCharCode(...s))}const wC="Byte Sequence";function MC(s){if(ArrayBuffer.isView(s)===!1)throw an(s,wC);return`:${OC(s)}:`}const NC="Integer";function kC(s){return s<-999999999999999||999999999999999<s}function yT(s){if(kC(s))throw an(s,NC);return s.toString()}function PC(s){return`@${yT(s.getTime()/1e3)}`}function vT(s,e){if(s<0)return-vT(-s,e);const t=Math.pow(10,e);if(Math.abs(s*t%1-.5)<Number.EPSILON){const a=Math.floor(s*t);return(a%2===0?a:a+1)/t}else return Math.round(s*t)/t}const UC="Decimal";function FC(s){const e=vT(s,3);if(Math.floor(Math.abs(e)).toString().length>12)throw an(s,UC);const t=e.toString();return t.includes(".")?t:`${t}.0`}const BC="String",$C=/[\x00-\x1f\x7f]+/;function GC(s){if($C.test(s))throw an(s,BC);return`"${s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function jC(s){return s.description||s.toString().slice(7,-1)}const HC="Token";function jv(s){const e=jC(s);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw an(e,HC);return e}function dh(s){switch(typeof s){case"number":if(!me(s))throw an(s,Gv);return Number.isInteger(s)?yT(s):FC(s);case"string":return GC(s);case"symbol":return jv(s);case"boolean":return CC(s);case"object":if(s instanceof Date)return PC(s);if(s instanceof Uint8Array)return MC(s);if(s instanceof pT)return jv(s);default:throw an(s,Gv)}}const zC="Key";function hh(s){if(/^[a-z*][a-z0-9\-_.*]*$/.test(s)===!1)throw an(s,zC);return s}function Zh(s){return s==null?"":Object.entries(s).map(([e,t])=>t===!0?`;${hh(e)}`:`;${hh(e)}=${dh(t)}`).join("")}function ET(s){return s instanceof rn?`${dh(s.value)}${Zh(s.params)}`:dh(s)}function VC(s){return`(${s.value.map(ET).join(" ")})${Zh(s.params)}`}function KC(s,e={whitespace:!0}){if(typeof s!="object"||s==null)throw an(s,LC);const t=s instanceof Map?s.entries():Object.entries(s),i=e?.whitespace?" ":"";return Array.from(t).map(([a,l])=>{l instanceof rn||(l=new rn(l));let o=hh(a);return l.value===!0?o+=Zh(l.params):(o+="=",Array.isArray(l.value)?o+=VC(l):o+=ET(l)),o}).join(`,${i}`)}function ST(s,e){return KC(s,e)}const Qi="CMCD-Object",ht="CMCD-Request",Us="CMCD-Session",us="CMCD-Status",YC={br:Qi,ab:Qi,d:Qi,ot:Qi,tb:Qi,tpb:Qi,lb:Qi,tab:Qi,lab:Qi,url:Qi,pb:ht,bl:ht,tbl:ht,dl:ht,ltc:ht,mtp:ht,nor:ht,nrr:ht,rc:ht,sn:ht,sta:ht,su:ht,ttfb:ht,ttfbb:ht,ttlb:ht,cmsdd:ht,cmsds:ht,smrt:ht,df:ht,cs:ht,ts:ht,cid:Us,pr:Us,sf:Us,sid:Us,st:Us,v:Us,msd:Us,bs:us,bsd:us,cdn:us,rtp:us,bg:us,pt:us,ec:us,e:us},qC={REQUEST:ht};function XC(s){return Object.keys(s).reduce((e,t)=>{var i;return(i=s[t])===null||i===void 0||i.forEach(a=>e[a]=t),e},{})}function QC(s,e){const t={};if(!s)return t;const i=Object.keys(s),a=e?XC(e):{};return i.reduce((l,o)=>{var c;const h=YC[o]||a[o]||qC.REQUEST,d=(c=l[h])!==null&&c!==void 0?c:l[h]={};return d[o]=s[o],l},t)}function WC(s){return["ot","sf","st","e","sta"].includes(s)}function ZC(s){return typeof s=="number"?me(s):s!=null&&s!==""&&s!==!1}const TT="event";function JC(s,e){const t=new URL(s),i=new URL(e);if(t.origin!==i.origin)return s;const a=t.pathname.split("/").slice(1),l=i.pathname.split("/").slice(1,-1);for(;a[0]===l[0];)a.shift(),l.shift();for(;l.length;)l.shift(),a.unshift("..");return a.join("/")+t.search+t.hash}const au=s=>Math.round(s),mh=(s,e)=>Array.isArray(s)?s.map(t=>mh(t,e)):s instanceof rn&&typeof s.value=="string"?new rn(mh(s.value,e),s.params):(e.baseUrl&&(s=JC(s,e.baseUrl)),e.version===1?encodeURIComponent(s):s),jo=s=>au(s/100)*100,e2=(s,e)=>{let t=s;return e.version>=2&&(s instanceof rn&&typeof s.value=="string"?t=new rn([s]):typeof s=="string"&&(t=[s])),mh(t,e)},t2={br:au,d:au,bl:jo,dl:jo,mtp:jo,nor:e2,rtp:jo,tb:au},xT="request",bT="response",Jh=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],i2=["e"],n2=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function ku(s){return n2.test(s)}function s2(s){return Jh.includes(s)||i2.includes(s)||ku(s)}const AT=["d","dl","nor","ot","rtp","su"];function r2(s){return Jh.includes(s)||AT.includes(s)||ku(s)}const a2=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function l2(s){return Jh.includes(s)||AT.includes(s)||a2.includes(s)||ku(s)}const o2=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function u2(s){return o2.includes(s)||ku(s)}const c2={[bT]:l2,[TT]:s2,[xT]:r2};function RT(s,e={}){const t={};if(s==null||typeof s!="object")return t;const i=e.version||s.v||1,a=e.reportingMode||xT,l=i===1?u2:c2[a];let o=Object.keys(s).filter(l);const c=e.filter;typeof c=="function"&&(o=o.filter(c));const h=a===bT||a===TT;h&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");const d=Je({},t2,e.formatters),m={version:i,reportingMode:a,baseUrl:e.baseUrl};return o.sort().forEach(g=>{let y=s[g];const S=d[g];if(typeof S=="function"&&(y=S(y,m)),g==="v"){if(i===1)return;y=i}g=="pr"&&y===1||(h&&g==="ts"&&!me(y)&&(y=Date.now()),ZC(y)&&(WC(g)&&typeof y=="string"&&(y=new pT(y)),t[g]=y))}),t}function f2(s,e={}){const t={};if(!s)return t;const i=RT(s,e),a=QC(i,e?.customHeaderMap);return Object.entries(a).reduce((l,[o,c])=>{const h=ST(c,{whitespace:!1});return h&&(l[o]=h),l},t)}function d2(s,e,t){return Je(s,f2(e,t))}const h2="CMCD";function m2(s,e={}){return s?ST(RT(s,e),{whitespace:!1}):""}function g2(s,e={}){if(!s)return"";const t=m2(s,e);return encodeURIComponent(t)}function p2(s,e={}){if(!s)return"";const t=g2(s,e);return`${h2}=${t}`}const Hv=/CMCD=[^&#]+/;function y2(s,e,t){const i=p2(e,t);if(!i)return s;if(Hv.test(s))return s.replace(Hv,i);const a=s.includes("?")?"&":"?";return`${s}${a}${i}`}class v2{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=a=>{try{this.apply(a,{ot:ti.MANIFEST,su:!this.initialized})}catch(l){this.hls.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=a=>{try{const{frag:l,part:o}=a,c=this.hls.levels[l.level],h=this.getObjectType(l),d={d:(o||l).duration*1e3,ot:h};(h===ti.VIDEO||h===ti.AUDIO||h==ti.MUXED)&&(d.br=c.bitrate/1e3,d.tb=this.getTopBandwidth(h)/1e3,d.bl=this.getBufferLength(h));const m=o?this.getNextPart(o):this.getNextFrag(l);m!=null&&m.url&&m.url!==l.url&&(d.nor=m.url),this.apply(a,d)}catch(l){this.hls.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHED,this.onMediaDetached,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHED,this.onMediaDetached,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,a;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(a=t.tracks.video)==null?void 0:a.buffer}createData(){var e;return{v:1,sf:RC.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Je(t,this.createData());const i=t.ot===ti.INIT||t.ot===ti.VIDEO||t.ot===ti.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:a}=this;a&&(t=Object.keys(t).reduce((o,c)=>(a.includes(c)&&(o[c]=t[c]),o),{}));const l={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),d2(e.headers,t,l)):e.url=y2(e.url,t,l)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const a=e.sn-i.startSN;return i.fragments[a+1]}}getNextPart(e){var t;const{index:i,fragment:a}=e,l=(t=this.hls.levels[a.level])==null||(t=t.details)==null?void 0:t.partList;if(l){const{sn:o}=a;for(let c=l.length-1;c>=0;c--){const h=l[c];if(h.index===i&&h.fragment.sn===o)return l[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ti.TIMED_TEXT;if(e.sn==="initSegment")return ti.INIT;if(t==="audio")return ti.AUDIO;if(t==="main")return this.hls.audioTracks.length?ti.VIDEO:ti.MUXED}getTopBandwidth(e){let t=0,i;const a=this.hls;if(e===ti.AUDIO)i=a.audioTracks;else{const l=a.maxAutoLevel,o=l>-1?l+1:a.levels.length;i=a.levels.slice(0,o)}return i.forEach(l=>{l.bitrate>t&&(t=l.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===ti.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Ae.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new i(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,c){t(l),this.loader.load(l,o,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new i(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,c){t(l),this.loader.load(l,o,c)}}}}const E2=3e5;class S2 extends Mi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if(i?.action===Ut.SendAlternateToPenaltyBox&&i.flags===pi.MoveAllAlternatesMatchingHost){const a=this.levels;let l=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:c,pathwayId:h,type:d}=t.context;c&&a?o=this.getPathwayForGroupId(c,d,o):h&&(o=h)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!l&&a&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),i.resolved=this.pathwayId!==o),t.details===z.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${a&&a.length} priorities: ${st(l)} penalized: ${st(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,a=performance.now();Object.keys(i).forEach(l=>{a-i[l]>E2&&delete i[l]});for(let l=0;l<e.length;l++){const o=e[l];if(o in i)continue;if(o===this.pathwayId)return;const c=this.hls.nextLoadLevel,h=this.hls.levels[c];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,VS(t),this.hls.trigger(A.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[c];h&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,i){const a=this.getLevelsForPathway(i).concat(this.levels||[]);for(let l=0;l<a.length;l++)if(t===Oe.AUDIO_TRACK&&a[l].hasAudioGroup(e)||t===Oe.SUBTITLE_TRACK&&a[l].hasSubtitleGroup(e))return a[l].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},a={};e.forEach(l=>{const{ID:o,"BASE-ID":c,"URI-REPLACEMENT":h}=l;if(t.some(m=>m.pathwayId===o))return;const d=this.getLevelsForPathway(c).map(m=>{const g=new ot(m.attrs);g["PATHWAY-ID"]=o;const y=g.AUDIO&&`${g.AUDIO}_clone_${o}`,S=g.SUBTITLES&&`${g.SUBTITLES}_clone_${o}`;y&&(i[g.AUDIO]=y,g.AUDIO=y),S&&(a[g.SUBTITLES]=S,g.SUBTITLES=S);const E=LT(m.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),x=new tl({attrs:g,audioCodec:m.audioCodec,bitrate:m.bitrate,height:m.height,name:m.name,url:E,videoCodec:m.videoCodec,width:m.width});if(m.audioGroups)for(let T=1;T<m.audioGroups.length;T++)x.addGroupId("audio",`${m.audioGroups[T]}_clone_${o}`);if(m.subtitleGroups)for(let T=1;T<m.subtitleGroups.length;T++)x.addGroupId("text",`${m.subtitleGroups[T]}_clone_${o}`);return x});t.push(...d),zv(this.audioTracks,i,h,o),zv(this.subtitleTracks,a,h,o)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let a;try{a=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(a.protocol!=="data:"){const m=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;a.searchParams.set("_HLS_pathway",this.pathwayId),a.searchParams.set("_HLS_throughput",""+m)}const l={responseType:"json",url:a.href},o=t.steeringManifestLoadPolicy.default,c=o.errorRetry||o.timeoutRetry||{},h={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},d={onSuccess:(m,g,y,S)=>{this.log(`Loaded steering manifest: "${a}"`);const E=m.data;if(E?.VERSION!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;const{"RELOAD-URI":x,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":R}=E;if(x)try{this.uri=new self.URL(x,a).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${x}`);return}this.scheduleRefresh(this.uri||y.url),T&&this.clonePathways(T);const L={steeringManifest:E,url:a.toString()};this.hls.trigger(A.STEERING_MANIFEST_LOADED,L),R&&this.updatePathwayPriority(R)},onError:(m,g,y,S)=>{if(this.log(`Error loading steering manifest: ${m.code} ${m.text} (${g.url})`),this.stopLoad(),m.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let E=this.timeToLoad*1e3;if(m.code===429){const x=this.loader;if(typeof x?.getResponseHeader=="function"){const T=x.getResponseHeader("Retry-After");T&&(E=parseFloat(T)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,E)},onTimeout:(m,g,y)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${a}`),this.loader.load(l,h,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const a=(i=this.hls)==null?void 0:i.media;if(a&&!a.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function zv(s,e,t,i){s&&Object.keys(e).forEach(a=>{const l=s.filter(o=>o.groupId===a).map(o=>{const c=Je({},o);return c.details=void 0,c.attrs=new ot(c.attrs),c.url=c.attrs.URI=LT(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[a],c.attrs["PATHWAY-ID"]=i,c});s.push(...l)})}function LT(s,e,t,i){const{HOST:a,PARAMS:l,[t]:o}=i;let c;e&&(c=o?.[e],c&&(s=c));const h=new self.URL(s);return a&&!c&&(h.host=a),l&&Object.keys(l).sort().forEach(d=>{d&&h.searchParams.set(d,l[d])}),h.href}class $r extends Mi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=$r.CDMCleanupPromise?[$r.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:i,initData:a}=t,l=`"${t.type}" event: init data type: "${i}"`;if(this.debug(l),a!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=qa(this.config));const c=o.map(Ed).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(o=>{const c=nu(o);if(i!=="sinf"||c!==ut.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${i}" for selected key-system ${c}`);return}let h;try{const S=Lt(new Uint8Array(a)),E=Gh(JSON.parse(S).sinf),x=SS(E);if(!x)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(x.subarray(8,24))}catch(S){this.warn(`${l} Failed to parse sinf: ${S}`);return}const d=Ft(h),{keyIdToKeySessionPromise:m,mediaKeySessions:g}=this;let y=m[d];for(let S=0;S<g.length;S++){const E=g[S],x=E.decryptdata;if(!x.keyId)continue;const T=Ft(x.keyId);if(Eu(h,x.keyId)||x.uri.replace(/-/g,"").indexOf(d)!==-1){if(y=m[T],!y)continue;if(x.pssh)break;delete m[T],x.pssh=new Uint8Array(a),x.keyId=h,y=m[d]=y.then(()=>this.generateRequestWithPreferredKeySession(E,i,a,"encrypted-event-key-match")),y.catch(R=>this.handleError(R));break}}y||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(A.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(A.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,a=t?.[e];if(a)return a.licenseUrl;if(e===ut.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t?.[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(o,c,h)=>!!o&&h.indexOf(o)===c,a=t.map(o=>o.audioCodec).filter(i),l=t.map(o=>o.videoCodec).filter(i);return a.length+l.length===0&&l.push("avc1.42e01e"),new Promise((o,c)=>{const h=d=>{const m=d.shift();this.getMediaKeysPromise(m,a,l).then(g=>o({keySystem:m,mediaKeys:g})).catch(g=>{d.length?h(d):g instanceof gi?c(g):c(new gi({type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let a=`Configured requestMediaKeySystemAccess is not a function ${i}`;return US===null&&self.location.protocol==="http:"&&(a=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(a))}return i(e,t)}getMediaKeysPromise(e,t,i){var a;const l=eI(e,t,i,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],c=(a=o)==null?void 0:a.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${st(l)}`),c=this.requestMediaKeySystemAccess(e,l);const h=o=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),c.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const m=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=h.mediaKeys=d.createMediaKeys().then(y=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,m.then(S=>S?this.setMediaKeysServerCertificate(y,e,S):y)));return g.catch(y=>{this.error(`Failed to create media-keys for "${e}"}: ${y}`)}),g})}return c.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Ft(e.keyId||[])} keyUri: ${e.uri}`);const a=i.createSession(),l={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:a,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),a=Ho(t),l="cenc";this.keyIdToKeySessionPromise[a]=this.generateRequestWithPreferredKeySession(i,l,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${Ft(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Ed(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:a})=>{const l=Ed(a);l?t(l):i(new Error(`Unable to find format for key-system "${a}"`))}).catch(i)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=qa(this.config),i=e.map(nu).filter(a=>!!a&&t.indexOf(a)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let i=0;i<t.length;i++){const a=T2(e,t[i]);if(a)return a}}loadKey(e){const t=e.keyInfo.decryptdata,i=Ho(t),a=this.bannedKeyIds[i];if(a||this.getKeyStatus(t)==="internal-error"){const c=Vv(a||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const l=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${l}`);const o=this.keyIdToKeySessionPromise[i];if(!o){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${l}`),this.attemptSetMediaKeys(h,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:d,decryptdata:t}))))).then(h=>{const d="cenc",m=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,d,m,"playlist-key")});return c.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[i]=c,c}return o.catch(c=>{if(c instanceof gi){const h=Ye({},c.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const d=new gi(h,c.message);this.handleError(d,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof gi){t&&(e.data.frag=t);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${Ft(i.keyId||[])})`:""}`),this.hls.trigger(A.ERROR,e.data)}else this.error(e.message),this.hls.trigger(A.ERROR,{type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Ho(e),i=this.keyIdToKeySessionPromise[t];if(!i){const a=nu(e.keyFormat),l=a?[a]:qa(this.config);return this.attemptKeySystemAccess(l)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=qa(this.config)),e.length===0)throw new gi({type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${st({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const a=Promise.all(i).then(()=>this.media?this.media.setMediaKeys(t):new Promise((l,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(l).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(a),a.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(a),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(l=>i.indexOf(l)===-1)})}generateRequestWithPreferredKeySession(e,t,i,a){var l;const o=(l=this.config.drmSystems)==null||(l=l[e.keySystem])==null?void 0:l.generateRequest;if(o)try{const E=o.call(this.hls,t,i,e);if(!E)throw new Error("Invalid response from configured generateRequest filter");t=E.initDataType,i=E.initData?E.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(E){if(this.warn(E.message),this.hls&&this.hls.config.debug)throw E}if(i===null)return this.log(`Skipping key-session request for "${a}" (no initData)`),Promise.resolve(e);const c=Ho(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${a}" keyId: ${c} URI: ${h} (init data type: ${t} length: ${i.byteLength})`);const d=new Hh,m=e._onmessage=E=>{const x=e.mediaKeysSession;if(!x){d.emit("error",new Error("invalid state"));return}const{messageType:T,message:R}=E;this.log(`"${T}" message event for session "${x.sessionId}" message size: ${R.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,R).catch(L=>{d.eventNames().length?d.emit("error",L):this.handleError(L)}):T==="license-release"?e.keySystem===ut.FAIRPLAY&&this.updateKeySession(e,ah("acknowledged")).then(()=>this.removeSession(e)).catch(L=>this.handleError(L)):this.warn(`unhandled media key message type "${T}"`)},g=(E,x)=>{x.keyStatus=E;let T;E.startsWith("usable")?d.emit("resolved"):E==="internal-error"||E==="output-restricted"||E==="output-downscaled"?T=Vv(E,x.decryptdata):E==="expired"?T=new Error(`key expired (keyId: ${c})`):E==="released"?T=new Error("key released"):E==="status-pending"||this.warn(`unhandled key status change "${E}" (keyId: ${c})`),T&&(d.eventNames().length?d.emit("error",T):this.handleError(T))},y=e._onkeystatuseschange=E=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const T=this.getKeyStatuses(e);if(!Object.keys(T).some(O=>T[O]!=="status-pending"))return;if(T[c]==="expired"){this.log(`Expired key ${st(T)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let L=T[c];if(L)g(L,e);else{var _;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(_=e.keyStatusTimeouts)[c]||(_[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const M=this.getKeyStatus(e.decryptdata);if(M&&M!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${M} from other session.`),g(M,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),L="internal-error",g(L,e)},1e3)),this.log(`No status for keyId ${c} (${st(T)}).`)}};zt(e.mediaKeysSession,"message",m),zt(e.mediaKeysSession,"keystatuseschange",y);const S=new Promise((E,x)=>{d.on("error",x),d.on("resolved",E)});return e.mediaKeysSession.generateRequest(t,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${h}`)}).catch(E=>{throw new gi({type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_SESSION,error:E,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>S).catch(E=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw E}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((i,a)=>{if(typeof a=="string"&&typeof i=="object"){const c=a;a=i,i=c}const l="buffer"in a?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a);if(e.keySystem===ut.PLAYREADY&&l.length===16){const c=Ft(l);t[c]=i,kS(l)}const o=Ft(l);i==="internal-error"&&(this.bannedKeyIds[o]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=i}),t}fetchServerCertificate(e){const t=this.config,i=t.loader,a=new i(t),l=this.getServerCertificateUrl(e);return l?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,c)=>{const h={responseType:"arraybuffer",url:l},d=t.certLoadPolicy.default,m={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,S,E,x)=>{o(y.data)},onError:(y,S,E,x)=>{c(new gi({type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:Ye({url:h.url,data:void 0},y)},`"${e}" certificate request failed (${l}). Status: ${y.code} (${y.text})`))},onTimeout:(y,S,E)=>{c(new gi({type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${l})`))},onAbort:(y,S,E)=>{c(new Error("aborted"))}};a.load(h,m,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((a,l)=>{e.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i.byteLength}) on "${t}"`),a(e)}).catch(o=>{l(new gi({type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(a=>{throw new gi({type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:a,fatal:!1},a.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const a=new DOMParser().parseFromString(i,"application/xml"),l=a.querySelectorAll("HttpHeader");if(l.length>0){let m;for(let g=0,y=l.length;g<y;g++){var o,c;m=l[g];const S=(o=m.querySelector("name"))==null?void 0:o.textContent,E=(c=m.querySelector("value"))==null?void 0:c.textContent;S&&E&&e.setRequestHeader(S,E)}}const h=a.querySelector("Challenge"),d=h?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return ah(atob(d))}setupLicenseXHR(e,t,i,a){const l=this.config.licenseXhrSetup;return l?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return l.call(this.hls,e,t,i,a)}).catch(o=>{if(!i.decryptdata)throw o;return e.open("POST",t,!0),l.call(this.hls,e,t,i,a)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||a})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:a}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((a,l)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return l(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const d=this.config.licenseResponseCallback;if(d)try{h=d.call(this.hls,c,o,e)}catch(m){this.error(m)}a(h)}else{const h=i.errorRetry,d=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||c.status>=400&&c.status<500)l(new gi({type:Ee.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:o,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${o}). Status: ${c.status} (${c.statusText})`));else{const m=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${m} attempts left`),this.requestLicense(e,t).then(a,l)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,o,e,t).then(({xhr:h,licenseChallenge:d})=>{e.keySystem==ut.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(h,d)),h.send(d)}).catch(l)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,zt(i,"encrypted",this.onMediaEncrypted),zt(i,"waitingforkey",this.onWaitingForKey);const a=this.mediaResolved;a?a():this.mediaKeys=i.mediaKeys}onMediaDetached(){const e=this.media;e&&(ii(e,"encrypted",this.onMediaEncrypted),ii(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const i=this.media,a=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ds.clearKeyUriToKeyIdMap();const l=a.length;$r.CDMCleanupPromise=Promise.all(a.map(o=>this.removeSession(o)).concat((i==null||(e=i.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{l&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((a,l)=>(a.indexOf(l.keyFormat)===-1&&a.push(l.keyFormat),a),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i,decryptdata:a}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Ft(a?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const l=this.mediaKeySessions.indexOf(e);l>-1&&this.mediaKeySessions.splice(l,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(d=>self.clearTimeout(o[d]));const{drmSystemOptions:c}=this.config;return(iI(c)?new Promise((d,m)=>{self.setTimeout(()=>m(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(m)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}$r.CDMCleanupPromise=void 0;function Ho(s){if(!s)throw new Error("Could not read keyId of undefined decryptdata");if(s.keyId===null)throw new Error("keyId is null");return Ft(s.keyId)}function T2(s,e){if(s.keyId&&e.mediaKeysSession.keyStatuses.has(s.keyId))return e.mediaKeysSession.keyStatuses.get(s.keyId);if(s.matches(e.decryptdata))return e.keyStatus}class gi extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Vv(s,e){const t=s==="output-restricted",i=t?z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:z.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new gi({type:Ee.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${s}"`)}class x2{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const a=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=a,a&&typeof a.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const a=performance.now();if(t){if(this.lastTime){const l=a-this.lastTime,o=i-this.lastDroppedFrames,c=t-this.lastDecodedFrames,h=1e3*o/l,d=this.hls;if(d.trigger(A.FPS_DROP,{currentDropped:o,currentDecoded:c,totalDroppedFrames:i}),h>0&&o>d.config.fpsDroppedMonitoringThreshold*c){let m=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=m)&&(m=m-1,d.trigger(A.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:d.currentLevel}),d.autoLevelCapping=m,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function _T(s,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=s,e.dispatchEvent(t)}function DT(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(e.id))try{if(s.addCue(e),!s.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){qe.debug(`[texttrack-utils]: ${i}`);try{const a=new self.TextTrackCue(e.startTime,e.endTime,e.text);a.id=e.id,s.addCue(a)}catch(a){qe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${a}`)}}t==="disabled"&&(s.mode=t)}function Pr(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues)for(let i=s.cues.length;i--;)e&&s.cues[i].removeEventListener("enter",e),s.removeCue(s.cues[i]);t==="disabled"&&(s.mode=t)}function gh(s,e,t,i){const a=s.mode;if(a==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0){const l=A2(s.cues,e,t);for(let o=0;o<l.length;o++)(!i||i(l[o]))&&s.removeCue(l[o])}a==="disabled"&&(s.mode=a)}function b2(s,e){if(e<=s[0].startTime)return 0;const t=s.length-1;if(e>s[t].endTime)return-1;let i=0,a=t,l;for(;i<=a;)if(l=Math.floor((a+i)/2),e<s[l].startTime)a=l-1;else if(e>s[l].startTime&&i<t)i=l+1;else return l;return s[i].startTime-e<e-s[a].startTime?i:a}function A2(s,e,t){const i=[],a=b2(s,e);if(a>-1)for(let l=a,o=s.length;l<o;l++){const c=s[l];if(c.startTime>=e&&c.endTime<=t)i.push(c);else if(c.startTime>t)return i}return i}function lu(s){const e=[];for(let t=0;t<s.length;t++){const i=s[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(s[t])}return e}class R2 extends Qh{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=lu(this.media.textTracks);for(let l=0;l<i.length;l++)if(i[l].mode==="hidden")t=i[l];else if(i[l].mode==="showing"){t=i[l];break}const a=this.findTrackForTextTrack(t);this.subtitleTrack!==a&&this.setSubtitleTrack(a)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const a=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,a)return;lu(i.textTracks).forEach(o=>{Pr(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:a,details:l}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==a){this.warn(`Subtitle track with id:${i} and group:${a} not found in active group ${o?.groupId}`);return}const c=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${a} loaded [${l.startSN}-${l.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,a=this.groupIds;let l=this.currentTrack;if(!i||a?.length!==i?.length||i!=null&&i.some(o=>a?.indexOf(o)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(m=>!i||i.indexOf(m.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(m=>m.default)&&(this.selectDefaultTrack=!1),o.forEach((m,g)=>{m.id=g});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const c=this.hls.config.subtitlePreference;if(!l&&c){this.selectDefaultTrack=!1;const m=tn(c,o);if(m>-1)l=o[m];else{const g=tn(c,this.tracks);l=this.tracks[g]}}let h=this.findTrackId(l);h===-1&&l&&(h=this.findTrackId(null));const d={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(A.SUBTITLE_TRACKS_UPDATED,d),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let a=0;a<t.length;a++){const l=t[a];if(!(i&&!l.default||!i&&!e)&&(!e||Hs(l,e)))return a}if(e){for(let a=0;a<t.length;a++){const l=t[a];if(rl(e.attrs,l.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return a}for(let a=0;a<t.length;a++){const l=t[a];if(rl(e.attrs,l.attrs,["LANGUAGE"]))return a}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const a=t[i];if(fh(a,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Oe.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&Hs(e,i))return i;const a=tn(e,this.tracksInGroup);if(a>-1){const l=this.tracksInGroup[a];return this.setSubtitleTrack(a),l}else{if(i)return null;{const l=tn(e,t);if(l>-1)return t[l]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,a=e.groupId,l=this.getUrlWithDirectives(e.url,t),o=e.details,c=o?.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${a}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(A.SUBTITLE_TRACK_LOADING,{url:l,id:i,groupId:a,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=lu(e.textTracks),i=this.currentTrack;let a;if(i&&(a=t.filter(l=>fh(i,l))[0],a||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(l=>{l.mode!=="disabled"&&l!==a&&(l.mode="disabled")}),a){const l=this.subtitleDisplay?"showing":"hidden";a.mode!==l&&(a.mode=l)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!me(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,a=t[e]||null;if(this.trackId=e,this.currentTrack=a,this.toggleTrackModes(),!a){this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:e});return}const l=!!a.details&&!a.details.live;if(e===this.trackId&&a===i&&l)return;this.log(`Switching to subtitle-track ${e}`+(a?` "${a.name}" lang:${a.lang} group:${a.groupId}`:""));const{id:o,groupId:c="",name:h,type:d,url:m}=a;this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:o,groupId:c,name:h,type:d,url:m});const g=this.switchParams(a.url,i?.details,a.details);this.loadPlaylist(g)}}function L2(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{const l=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(a=="x"?l:l&3|8).toString(16)})}}}function Wa(s){let e=5381,t=s.length;for(;t;)e=e*33^s.charCodeAt(--t);return(e>>>0).toString()}const Gr=.025;let bu=(function(s){return s[s.Point=0]="Point",s[s.Range=1]="Range",s})({});function _2(s,e,t){return`${s.identifier}-${t+1}-${Wa(e)}`}class D2{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Dd(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Dd(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=me(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Dd(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Gr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?bu.Range:bu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return I2(this)}}function Dd(s,e){return s-e.start<e.duration/2&&!(Math.abs(s-(e.start+e.duration))<Gr)?e.start:e.start+e.duration}function IT(s,e,t){const i=new self.URL(s,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function Id(s,e){for(;(t=s.assetList[++e])!=null&&t.error;)var t;return e}function I2(s){return`["${s.identifier}" ${s.cue.pre?"<pre>":s.cue.post?"<post>":""}${s.timelineStart.toFixed(2)}-${s.resumeTime.toFixed(2)}]`}function kr(s){const e=s.timelineStart,t=s.duration||0;return`["${s.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class C2{constructor(e,t,i,a){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(A.PLAYOUT_LIMIT_REACHED,{})};const l=this.hls=new e(t);this.interstitial=i,this.assetItem=a;const o=()=>{this.hasDetails=!0};l.once(A.LEVEL_LOADED,o),l.once(A.AUDIO_TRACK_LOADED,o),l.once(A.SUBTITLE_TRACK_LOADED,o),l.on(A.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&l.on(A.BUFFER_APPENDED,()=>{const m=this.bufferedEnd;this.reachedPlayout(m)&&(this._bufferedEosTime=m,l.trigger(A.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=IT(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),a=this.timelineOffset,l=Ae.bufferInfo(e,a,0);return this.getAssetTime(l.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ae.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var a;(a=this.hls)==null||a.on(e,t)}once(e,t,i){var a;(a=this.hls)==null||a.once(e,t)}off(e,t,i){var a;(a=this.hls)==null||a.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${kr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Kv=.033;class O2 extends Mi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,a)=>e<=a.startOffset&&t>a.startOffset?(delete a.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const a=this.items;if(a)for(a[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(l=a[i])!=null&&l.event;){var l;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let a=0;a<i.length;a++){let l=i[a];if(t&&t!=="primary"&&(l=l[t]),e===l.start||e>l.start&&e<l.end)return a}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let a=e;a<=t&&i[a];a++){const l=i[a].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return a}return-1}findEventIndex(e){const t=this.items;if(t)for(let a=t.length;a--;){var i;if(((i=t[a].event)==null?void 0:i.identifier)===e)return a}return-1}findAssetIndex(e,t){const i=e.assetList,a=i.length;if(a>1)for(let l=0;l<a;l++){const o=i[l];if(!o.error){const c=o.timelineStart;if(t===c||t>c&&(t<c+(o.duration||0)||l===a-1))return l}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const i=t.assetList,a=i[i.length-1];if(a)return a.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:a}=i,l=this.events,o=this.parseDateRanges(a,{url:i.url},t),c=Object.keys(a),h=l?l.filter(d=>!c.includes(d.identifier)):[];o.length&&o.sort((d,m)=>{const g=d.cue.pre,y=d.cue.post,S=m.cue.pre,E=m.cue.post;if(g&&!S)return-1;if(S&&!g||y&&!E)return 1;if(E&&!y)return-1;if(!g&&!S&&!y&&!E){const x=d.startTime,T=m.startTime;if(x!==T)return x-T}return d.dateRange.tagOrder-m.dateRange.tagOrder}),this.events=o,h.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],i=!1){const a=this.events||[];if(a.length||t.length||this.length<2){const l=this.items,o=this.parseSchedule(a,e);(i||t.length||l?.length!==o.length||o.some((h,d)=>Math.abs(h.playout.start-l[d].playout.start)>.005||Math.abs(h.playout.end-l[d].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,l))}}parseDateRanges(e,t,i){const a=[],l=Object.keys(e);for(let o=0;o<l.length;o++){const c=l[o],h=e[c];if(h.isInterstitial){let d=this.eventMap[c];d?d.setDateRange(h):(d=new D2(h,t),this.eventMap[c]=d,i===!1&&(d.appendInPlace=i)),a.push(d)}}return a}parseSchedule(e,t){const i=[],a=t.main.details,l=a.live?1/0:a.edge;let o=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,d=0;if(e.forEach((m,g)=>{const y=m.cue.pre,S=m.cue.post,E=e[g-1]||null,x=m.appendInPlace,T=S?l:m.startOffset,R=m.duration,L=m.timelineOccupancy===bu.Range?R:0,_=m.resumptionOffset,O=E?.startTime===T,M=T+m.cumulativeDuration;let G=x?M+R:T+_;if(y||!S&&T<=0){const $=d;d+=L,m.timelineStart=M;const U=o;o+=R,i.push({event:m,start:M,end:G,playout:{start:U,end:o},integrated:{start:$,end:d}})}else if(T<=l){if(!O){const P=T-h;if(P>Kv){const q=h,re=d;d+=P;const ce=o;o+=P;const oe={previousEvent:e[g-1]||null,nextEvent:m,start:q,end:q+P,playout:{start:ce,end:o},integrated:{start:re,end:d}};i.push(oe)}else P>0&&E&&(E.cumulativeDuration+=P,i[i.length-1].end=T)}S&&(G=M),m.timelineStart=M;const $=d;d+=L;const U=o;o+=R,i.push({event:m,start:M,end:G,playout:{start:U,end:o},integrated:{start:$,end:d}})}else return;const w=m.resumeTime;S||w>l?h=l:h=w}),h<l){var c;const m=h,g=d,y=l-h;d+=y;const S=o;o+=y,i.push({previousEvent:((c=i[i.length-1])==null?void 0:c.event)||null,nextEvent:null,start:h,end:m+y,playout:{start:S,end:o},integrated:{start:g,end:d}})}this.setDurations(l,o,d)}else i.push({previousEvent:null,nextEvent:null,start:0,end:l,playout:{start:0,end:l},integrated:{start:0,end:l}}),this.setDurations(l,l,l);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,a=i.live?1/0:i.edge;let l=0,o=-1;e.forEach((c,h)=>{const d=c.cue.pre,m=c.cue.post,g=d?0:m?a:c.startTime;this.updateAssetDurations(c),o===g?c.cumulativeDuration=l:(l=0,o=g),!m&&c.snapOptions.in&&(c.resumeAnchor=Vs(null,i.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<Kv&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const S=me(c.resumeOffset)?c.resumeOffset:c.duration;l+=S})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,a=e.startTime+e.resumptionOffset;return Math.abs(i-a)>Gr?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${a}`),!1):!Object.keys(t).some(o=>{const c=t[o].details,h=c.edge;if(i>=h)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${h}`),!1;const d=Vs(null,c.fragments,i);if(!d)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const m=o==="audio"?.175:0;return Math.abs(d.start-i)<Gr+m||Math.abs(d.end-i)<Gr+m?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,a=!1,l=!1;for(let o=0;o<e.assetList.length;o++){const c=e.assetList[o],h=t+i;c.startOffset=i,c.timelineStart=h,a||(a=c.duration===null),l||(l=!!c.error);const d=c.error?0:c.duration||0;i+=d}a&&!l?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Fi(s){return`[${s.event?'"'+s.event.identifier+'"':"primary"}: ${s.start.toFixed(2)}-${s.end.toFixed(2)}]`}class w2{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let a;try{a=IT(i,this.hls.sessionId,e.baseUrl)}catch(y){const S=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,y,i);this.hls.trigger(A.ERROR,S);return}t&&a.protocol!=="data:"&&a.searchParams.set("_HLS_start_offset",""+t);const l=this.hls.config,o=l.loader,c=new o(l),h={responseType:"json",url:a.href},d=l.interstitialAssetListLoadPolicy.default,m={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,S,E,x)=>{const T=y.data,R=T?.ASSETS;if(!Array.isArray(R)){const L=this.assignAssetListError(e,z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),E.url,S,x);this.hls.trigger(A.ERROR,L);return}e.assetListResponse=T,this.hls.trigger(A.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:x})},onError:(y,S,E,x)=>{const T=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${S.url})`),S.url,x,E);this.hls.trigger(A.ERROR,T)},onTimeout:(y,S,E)=>{const x=this.assignAssetListError(e,z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${S.url})`),S.url,y,E);this.hls.trigger(A.ERROR,x)}};return c.load(h,m,g),this.hls.trigger(A.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,i,a,l,o){return e.error=i,{type:Ee.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:a,error:i,networkDetails:o,stats:l}}}function Yv(s){var e;s==null||(e=s.play())==null||e.catch(()=>{})}function zo(s,e){return`[${s}] Advancing timeline position to ${e}`}class M2 extends Mi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const a=i-this.timelinePos;if(Math.abs(a)<1/7056e5)return;const o=a<=-.01;this.timelinePos=i,this.bufferedPos=i;const c=this.playingItem;if(!c){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-a)&&this.updateSchedule(!0),this.checkBuffer(),o&&i<c.start||i>=c.end){var h;const S=this.findItemIndex(c);let E=this.schedule.findItemIndexAtTime(i);if(E===-1&&(E=S+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${i} (resolving from ${S} to ${E})`)),!this.isInterstitial(c)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!o&&E>S){const x=this.schedule.findJumpRestrictedIndex(S+1,E);if(x>S){this.setSchedulePosition(x);return}}this.setSchedulePosition(E);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(c)){const S=c.event.assetList[0];S&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,S))}return}const m=d.timelineStart,g=d.duration||0;if(o&&i<m||i>=m+g){var y;(y=c.event)!=null&&y.appendInPlace&&(this.clearAssetPlayers(c.event,c),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,d)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const a=this.playingItem;if(!a||this.playingLastItem)return;if(i>=a.end){this.timelinePos=a.end;const c=this.findItemIndex(a);this.setSchedulePosition(c+1)}const l=this.playingAsset;if(!l)return;const o=l.timelineStart+(l.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,l)},this.onScheduleUpdate=(i,a)=>{const l=this.schedule;if(!l)return;const o=this.playingItem,c=l.events||[],h=l.items||[],d=l.durations,m=i.map(x=>x.identifier),g=!!(c.length||m.length);(g||a)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${h.map(x=>Fi(x))} pos: ${this.timelinePos}`),m.length&&this.log(`Removed events ${m}`);let y=null,S=null;o&&(y=this.updateItem(o,this.timelinePos),this.itemsMatch(o,y)?this.playingItem=y:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const E=this.bufferingItem;if(E&&(S=this.updateItem(E,this.bufferedPos),this.itemsMatch(E,S)?this.bufferingItem=S:E.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(E.event,null))),i.forEach(x=>{x.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(x=>{if(x.interstitial.appendInPlace){const T=x.assetItem.timelineStart,R=x.timelineOffset-T;if(R)try{x.timelineOffset=T}catch(L){Math.abs(R)>Gr&&this.warn(`${L} ("${x.assetId}" ${x.timelineOffset}->${T})`)}}}),g||a){if(this.hls.trigger(A.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:h.slice(0),durations:d,removedIds:m}),this.isInterstitial(o)&&m.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(y,o),E&&S!==y&&this.trimInPlace(S,E),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new w2(e),this.schedule=new O2(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(A.MEDIA_ENDED,this.onMediaEnded,this),e.on(A.ERROR,this.onError,this),e.on(A.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(A.MEDIA_ENDED,this.onMediaEnded,this),e.off(A.ERROR,this.onError,this),e.off(A.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ii(e,"play",this.onPlay),ii(e,"pause",this.onPause),ii(e,"seeking",this.onSeeking),ii(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;zt(i,"seeking",this.onSeeking),zt(i,"timeupdate",this.onTimeupdate),zt(i,"play",this.onPlay),zt(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,a=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!a){this.clearScheduleState();const l=this.findItemIndex(i);this.setSchedulePosition(l)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,a=this.media;if(this.media=null,!i&&(a&&this.removeMediaListeners(a),this.detachedData)){const l=this.getBufferingPlayer();l&&(this.log(`Removing schedule state for detachedData and ${l}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=g=>g&&e.getAssetPlayer(g.identifier),a=(g,y,S,E,x)=>{if(g){let T=g[y].start;const R=g.event;if(R){if(y==="playout"||R.timelineOccupancy!==bu.Point){const L=i(S);L?.interstitial===R&&(T+=L.assetItem.startOffset+L[x])}}else{const L=E==="bufferedPos"?o():e[E];T+=L-g.start}return T}return 0},l=(g,y)=>{var S;if(g!==0&&y!=="primary"&&(S=e.schedule)!=null&&S.length){var E;const x=e.schedule.findItemIndexAtTime(g),T=(E=e.schedule.items)==null?void 0:E[x];if(T){const R=T[y].start-T.start;return g+R}}return g},o=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?c("primary"):Math.max(g,0)},c=g=>{var y,S;return(y=e.primaryDetails)!=null&&y.live?e.primaryDetails.edge:((S=e.schedule)==null?void 0:S.durations[g])||0},h=(g,y)=>{var S,E;const x=e.effectivePlayingItem;if(x!=null&&(S=x.event)!=null&&S.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${y}"`);const T=e.effectivePlayingItem,R=e.schedule.findItemIndexAtTime(g,y),L=(E=e.schedule.items)==null?void 0:E[R],_=e.getBufferingPlayer(),O=_?.interstitial,M=O?.appendInPlace,G=T&&e.itemsMatch(T,L);if(T&&(M||G)){const w=i(e.playingAsset),$=w?.media||e.primaryMedia;if($){const U=y==="primary"?$.currentTime:a(T,y,e.playingAsset,"timelinePos","currentTime"),P=g-U,q=(M?U:$.currentTime)+P;if(q>=0&&(!w||M||q<=w.duration)){$.currentTime=q;return}}}if(L){let w=g;if(y!=="primary"){const U=L[y].start,P=g-U;w=L.start+P}const $=!e.isInterstitial(L);if((!e.isInterstitial(T)||T.event.appendInPlace)&&($||L.event.appendInPlace)){const U=e.media||(M?_?.media:null);U&&(U.currentTime=w)}else if(T){const U=e.findItemIndex(T);if(R>U){const q=e.schedule.findJumpRestrictedIndex(U+1,R);if(q>U){e.setSchedulePosition(q);return}}let P=0;if($)e.timelinePos=w,e.checkBuffer();else{const q=L.event.assetList,re=g-(L[y]||L).start;for(let ce=q.length;ce--;){const oe=q[ce];if(oe.duration&&re>=oe.startOffset&&re<oe.startOffset+oe.duration){P=ce;break}}}e.setSchedulePosition(R,P)}}},d=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const y=t();return e.isInterstitial(y)?y:null},m={get bufferedEnd(){const g=t(),y=e.bufferingItem;if(y&&y===g){var S;return a(y,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-y.playout.start||((S=e.bufferingAsset)==null?void 0:S.startOffset)||0}return 0},get currentTime(){const g=d(),y=e.effectivePlayingItem;return y&&y===g?a(y,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(g){const y=d(),S=e.effectivePlayingItem;S&&S===y&&h(g+S.playout.start,"playout")},get duration(){const g=d();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const y=(g=d())==null?void 0:g.event.assetList;return y?y.map(S=>e.getAssetPlayer(S.identifier)):[]},get playingIndex(){var g;const y=(g=d())==null?void 0:g.event;return y&&e.effectivePlayingAsset?y.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return d()?m:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return o()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){h(g,"primary")},get duration(){return c("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return a(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return a(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){h(g,"integrated")},get duration(){return c("integrated")},get seekableStart(){var g;return l(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,y=g?.event;if(y&&!y.restrictions.skip){const S=e.findItemIndex(g);if(y.appendInPlace){const E=g.playout.start+g.event.duration;h(E+.001,"playout")}else e.advanceAfterAssetEnded(y,S,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let a=this.media;!a&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(a=this.primaryMedia);const l=(t=a)==null?void 0:t.currentTime;if(!(l===void 0||!me(l)))return l}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,a=e.media;if(i&&a===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&a){this.detachedData={media:a};return}const l=e.transferMedia();this.log(`transfer MediaSource from ${e} ${st(l)}`),this.detachedData=l}else t&&a&&(this.shouldPlay||(this.shouldPlay=!a.paused))}transferMediaTo(e,t){var i,a;if(e.media===t)return;let l=null;const o=this.hls,c=e!==o,h=c&&e.interstitial.appendInPlace,d=(i=this.detachedData)==null?void 0:i.mediaSource;let m;if(o.media)h&&(l=o.transferMedia(),this.detachedData=l),m="Primary";else if(d){const E=this.getBufferingPlayer();E?(l=E.transferMedia(),m=`${E}`):m="detached MediaSource"}else m="detached media";if(!l){if(d)l=this.detachedData,this.log(`using detachedData: MediaSource ${st(l)}`);else if(!this.detachedData||o.media===t){const E=this.playerQueue;E.length>1&&E.forEach(x=>{if(c&&x.interstitial.appendInPlace!==h){const T=x.interstitial;this.clearInterstitial(x.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=l&&"mediaSource"in l&&((a=l.mediaSource)==null?void 0:a.readyState)!=="closed",y=g&&l?l:t;this.log(`${g?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${m} (media.currentTime: ${t.currentTime})`);const S=this.schedule;if(y===l&&S){const E=c&&e.assetId===S.assetIdAtEnd;y.overrides={duration:S.duration,endOfStream:!c||E,cueRemoval:!c}}e.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,a=this.effectivePlayingItem;if(i===-1){const l=this.hls.startPosition;if(this.log(zo("checkStart",l)),this.timelinePos=l,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(l>=0||!this.primaryLive){const o=this.timelinePos=l>0?l:0,c=e.findItemIndexAtTime(o);this.setSchedulePosition(c)}}else if(a&&!this.playingItem){const l=e.findItemIndex(a);this.setSchedulePosition(l)}}advanceAssetBuffering(e,t){const i=e.event,a=i.findAssetIndex(t),l=Id(i,a);if(!i.isAssetPastPlayoutLimit(l))this.bufferedToEvent(e,l);else if(this.schedule){var o;const c=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,i){const a=Id(e,i);if(e.isAssetPastPlayoutLimit(a)){if(this.schedule){const l=this.schedule.items;if(l){const o=t+1,c=l.length;if(o>=c){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(zo("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const l=e.assetList[a];l&&this.advanceInPlace(l.timelineStart)}this.setSchedulePosition(t,a)}}setScheduleToAssetAtTime(e,t){const i=this.schedule;if(!i)return;const a=t.parentIdentifier,l=i.getEvent(a);if(l){const o=i.findEventIndex(a),c=i.findAssetIndex(l,e);this.advanceAfterAssetEnded(l,o,c-1)}}setSchedulePosition(e,t){var i;const a=(i=this.schedule)==null?void 0:i.items;if(!a||this.playbackDisabled)return;const l=e>=0?a[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${l&&Fi(l)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(o)){const m=o.event,g=this.playingAsset,y=g?.identifier,S=y?this.getAssetPlayer(y):null;if(S&&y&&(!this.eventItemsMatch(o,l)||t!==void 0&&y!==m.assetList[t].identifier)){var h;const E=m.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${E+1}/${m.assetList.length} ${kr(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(A.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:E,event:m,schedule:a.slice(0),scheduleIndex:e,player:S}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(m,this.findItemIndex(this.playingItem),E);return}this.retreiveMediaSource(y,l),S.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&S.detachMedia()}if(!this.eventItemsMatch(o,l)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${m} ${Fi(o)}`),m.hasPlayed=!0,this.hls.trigger(A.INTERSTITIAL_ENDED,{event:m,schedule:a.slice(0),scheduleIndex:e}),m.cue.once)){var d;this.updateSchedule();const E=(d=this.schedule)==null?void 0:d.items;if(l&&E){const x=this.findItemIndex(l);this.advanceSchedule(x,E,t,o,c)}return}}this.advanceSchedule(e,a,t,o,c)}advanceSchedule(e,t,i,a,l){const o=this.schedule;if(!o)return;const c=t[e]||null,h=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(m=>{const g=m.interstitial,y=o.findEventIndex(g.identifier);(y<e||y>e+1)&&this.clearInterstitial(g,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const m=c.event;if(i===void 0){i=o.findAssetIndex(m,this.timelinePos);const E=Id(m,i-1);if(m.isAssetPastPlayoutLimit(E)||m.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(m,e,i);return}i=E}const g=this.waitingItem;this.assetsBuffered(c,h)||this.setBufferingItem(c);let y=this.preloadAssets(m,i);if(this.eventItemsMatch(c,g||a)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${Fi(c)} ${m.appendInPlace?"append in place":""}`),this.hls.trigger(A.INTERSTITIAL_STARTED,{event:m,schedule:t.slice(0),scheduleIndex:e})),!m.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${m}`);return}if(m.assetListLoader&&(m.assetListLoader.destroy(),m.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${m}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const S=m.assetList[i];if(!S){this.advanceAfterAssetEnded(m,e,i||0);return}if(y||(y=this.getAssetPlayer(S.identifier)),y===null||y.destroyed){const E=m.assetList.length;this.warn(`asset ${i+1}/${E} player destroyed ${m}`),y=this.createAssetPlayer(m,S,i),y.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&m.appendInPlace&&this.isAssetBuffered(S))return;this.startAssetPlayer(y,i,t,e,h),this.shouldPlay&&Yv(y.media)}else c?(this.resumePrimary(c,e,a),this.shouldPlay&&Yv(this.hls.media)):l&&this.isInterstitial(a)&&(this.endedItem=null,this.playingItem=a,a.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var a,l;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Fi(e)}`),!((a=this.detachedData)!=null&&a.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(zo("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!i)return;const o=(l=this.schedule)==null?void 0:l.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Fi(e)}`),this.hls.trigger(A.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const a=this.primaryDetails;if(t===0)return this.hls.startPosition;if(a&&(i<a.fragmentStart||i>a.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ae.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const a=this.primaryMedia;if(!a)return;const l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,a),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(zo("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const a=this.hls;!a.loadingEnabled||!a.media||Math.abs((((i=a.mainForwardBufferInfo)==null?void 0:i.start)||a.media.currentTime)-e)>.5?a.startLoad(e,t):a.bufferingEnabled||a.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(A.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(A.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const i=this.hls.levels[t.level];if(!i.details)return;const a=Ye(Ye({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=a,this.schedule.parseInterstitialDateRanges(a,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],a=this.mediaSelection;if(!a){this.altSelection=Ye(Ye({},this.altSelection),{},{audio:i});return}const l=Ye(Ye({},a),{},{audio:i});this.mediaSelection=l}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],a=this.mediaSelection;if(!a){this.altSelection=Ye(Ye({},this.altSelection),{},{subtitles:i});return}const l=Ye(Ye({},a),{},{subtitles:i});this.mediaSelection=l}onAudioTrackSwitching(e,t){const i=iv(t);this.playerQueue.forEach(({hls:a})=>a&&(a.setAudioOption(t)||a.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){const i=iv(t);this.playerQueue.forEach(({hls:a})=>a&&(a.setSubtitleOption(t)||t.id!==-1&&a.setSubtitleOption(i)))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const a=this.timelinePos;this.bufferedPos=a,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let a=0;a<t.length;a++){const l=t[a];if(l.cue.post){var i;const o=this.schedule.findEventIndex(l.identifier),c=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;const a=(i=this.schedule)==null?void 0:i.items;if(e&&a){const l=this.findItemIndex(e,t);return a[l]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((l,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(l.identifier,null)});const i=e.end+.25,a=Ae.bufferInfo(this.primaryMedia,i,0);(a.end>i||(a.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${Fi(e)} (was ${Fi(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;const i=(t=this.schedule)==null?void 0:t.items;if(!i)return;const a=Ae.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=a.len<1),this.updateBufferedPos(a.end,i,e)}updateBufferedPos(e,t,i){const a=this.schedule,l=this.bufferingItem;if(this.bufferedPos>e||!a)return;if(t.length===1&&this.itemsMatch(t[0],l)){this.bufferedPos=e;return}const o=this.playingItem,c=this.findItemIndex(o);let h=a.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const m=this.findItemIndex(l),g=Math.min(m+1,t.length-1),y=t[g];if((h===-1&&l&&e>=l.end||(d=y.event)!=null&&d.appendInPlace&&e+.01>=y.start)&&(h=g),this.isInterstitial(l)){const S=l.event;if(g-c>1&&S.appendInPlace===!1||S.assetList.length===0&&S.assetListLoader)return}if(this.bufferedPos=e,h>m&&h>c)this.bufferedToItem(y);else{const S=this.primaryDetails;this.primaryLive&&S&&e>S.edge-S.targetduration&&y.start<S.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(y)&&this.preloadAssets(y.event,0)}}else i&&o&&!this.itemsMatch(o,l)&&(h===c?this.bufferedToItem(o):h===c+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(a=>{const l=this.getAssetPlayer(a.identifier);return!(l!=null&&l.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){const{items:a,events:l}=i;if(!a||!l)return t;const o=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Fi(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const d=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((m,g)=>{const y=this.getAssetPlayer(m.identifier);y&&(g===d&&y.loadSource(),y.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(A.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:a.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const a=this.detachedData;a?a.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,a=i.assetList.length===0&&!i.assetListLoader,l=i.cue.once;if(a||!l){const o=this.preloadAssets(i,t);if(o!=null&&o.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(o,c)}}}preloadAssets(e,t){const i=e.assetUrl,a=e.assetList.length,l=a===0&&!e.assetListLoader,o=e.cue.once;if(l){const h=e.timelineStart;if(e.appendInPlace){var c;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(c=y.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let d,m=0;if(!this.playingItem&&this.primaryLive&&(m=this.hls.startPosition,m===-1&&(m=this.hls.liveSyncPosition||0)),m&&!(e.cue.pre||e.cue.post)){const y=m-h;y>0&&(d=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:a} ${e}${d?` live-start: ${m} start-offset: ${d}`:""}`),i)return this.createAsset(e,0,0,h,e.duration,i);const g=this.assetListLoader.loadAssetList(e,d);g&&(e.assetListLoader=g)}else if(!o&&a){for(let d=t;d<a;d++){const m=e.assetList[d],g=this.getAssetPlayerQueueIndex(m.identifier);(g===-1||this.playerQueue[g].destroyed)&&!m.error&&this.createAssetPlayer(e,m,d)}const h=e.assetList[t];if(h){const d=this.getAssetPlayer(h.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(a=>{this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:a})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,a,l,o){const c={parentIdentifier:e.identifier,identifier:_2(e,o,t),duration:l,startOffset:i,timelineStart:a,uri:o};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,i){const a=this.hls,l=a.userConfig;let o=l.videoPreference;const c=a.loadLevelObj||a.levels[a.currentLevel];(o||c)&&(o=Je({},o),c.videoCodec&&(o.videoCodec=c.videoCodec),c.videoRange&&(o.allowedVideoRanges=[c.videoRange]));const h=a.audioTracks[a.audioTrack],d=a.subtitleTracks[a.subtitleTrack];let m=0;if(this.primaryLive||e.appendInPlace){const O=this.timelinePos-t.timelineStart;if(O>1){const M=t.duration;M&&O<M&&(m=O)}}const g=t.identifier,y=Ye(Ye({},l),{},{maxMaxBufferLength:Math.min(180,a.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:a.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:a.bandwidthEstimate,interstitialsController:void 0,startPosition:m,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:h||l.audioPreference,subtitlePreference:d||l.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(y.timelineOffset=t.timelineStart));const S=y.cmcd;S!=null&&S.sessionId&&S.contentId&&(y.cmcd=Je({},S,{contentId:Wa(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const E=new C2(this.HlsPlayerClass,y,e,t);this.playerQueue.push(E),e.assetList[i]=t;let x=!0;const T=O=>{if(O.live){var M;const $=new Error(`Interstitials MUST be VOD assets ${e}`),U={fatal:!0,type:Ee.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:$},P=((M=this.schedule)==null?void 0:M.findEventIndex(e.identifier))||-1;this.handleAssetItemError(U,e,P,i,$.message);return}const G=O.edge-O.fragmentStart,w=t.duration;(x||w===null||G>w)&&(x=!1,this.log(`Interstitial asset "${g}" duration change ${w} > ${G}`),t.duration=G,this.updateSchedule())};E.on(A.LEVEL_UPDATED,(O,{details:M})=>T(M)),E.on(A.LEVEL_PTS_UPDATED,(O,{details:M})=>T(M)),E.on(A.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const R=(O,M)=>{const G=this.getAssetPlayer(g);if(G&&M.tracks){G.off(A.BUFFER_CODECS,R),G.tracks=M.tracks;const w=this.primaryMedia;this.bufferingAsset===G.assetItem&&w&&!G.media&&this.bufferAssetPlayer(G,w)}};E.on(A.BUFFER_CODECS,R);const L=()=>{var O;const M=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${M}`),!M||!this.schedule)return;const G=this.schedule.findEventIndex(e.identifier),w=(O=this.schedule.items)==null?void 0:O[G];this.isInterstitial(w)&&this.advanceAssetBuffering(w,t)};E.on(A.BUFFERED_TO_END,L);const _=O=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const G=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,G,O)};return E.once(A.MEDIA_ENDED,_(i)),E.once(A.PLAYOUT_LIMIT_REACHED,_(1/0)),E.on(A.ERROR,(O,M)=>{if(!this.schedule)return;const G=this.getAssetPlayer(g);if(M.details===z.BUFFER_STALLED_ERROR){if(G!=null&&G.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(M,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${M.error} ${e}`)}),E.on(A.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const M=new Error(`Asset player destroyed unexpectedly ${g}`),G={fatal:!0,type:Ee.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:M};this.handleAssetItemError(G,e,this.schedule.findEventIndex(e.identifier),i,M.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${kr(t)}`),this.hls.trigger(A.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:E}),E}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const a=this.playerQueue[i];this.log(`clear ${a} toSegment: ${t&&Fi(t)}`),this.transferMediaFromPlayer(a,t),this.playerQueue.splice(i,1),a.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,a,l){const{interstitial:o,assetItem:c,assetId:h}=e,d=o.assetList.length,m=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!m||m.identifier!==h)&&(m&&(this.clearAssetPlayer(m.identifier,i[a]),delete m.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${kr(c)}`),this.hls.trigger(A.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:o,schedule:i.slice(0),scheduleIndex:a,player:e})),this.bufferAssetPlayer(e,l)}bufferAssetPlayer(e,t){var i,a;if(!this.schedule)return;const{interstitial:l,assetItem:o}=e,c=this.schedule.findEventIndex(l.identifier),h=(i=this.schedule.items)==null?void 0:i[c];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=o;const d=this.getBufferingPlayer();if(d===e)return;const m=l.appendInPlace;if(m&&d?.interstitial.appendInPlace===!1)return;const g=d?.tracks||((a=this.detachedData)==null?void 0:a.tracks)||this.requiredTracks;if(m&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!fS(g,e.tracks)){const y=new Error(`Asset ${kr(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),S={fatal:!0,type:Ee.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:y},E=l.findAssetIndex(o);this.handleAssetItemError(S,l,c,E,y.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,i=this.primaryMedia;if(!t||!i)return;const a=i.currentTime,l=t.findAssetIndex(e,a),o=e.assetList[l];if(o){const c=this.getAssetPlayer(o.identifier);if(c){const h=c.currentTime||a-o.timelineStart,d=c.duration-h;if(this.warn(`Stalled at ${h} of ${h+d} in ${c} ${e} (media.currentTime: ${a})`),h&&(d/i.playbackRate<.5||c.bufferedInPlaceToEnd(i))&&c.hls){const m=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,m,l)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,a,l){if(e.details===z.BUFFER_STALLED_ERROR)return;const o=t.assetList[a]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&kr(o)} ${e.error}`),!this.schedule)return;const c=o?.identifier||"",h=this.getAssetPlayerQueueIndex(c),d=this.playerQueue[h]||null,m=this.schedule.items,g=Je({},e,{fatal:!1,errorAction:Fr(!0),asset:o,assetListIndex:a,event:t,schedule:m,scheduleIndex:i,player:d});if(this.hls.trigger(A.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const y=this.playingAsset,S=this.bufferingAsset,E=new Error(l);if(o&&(this.clearAssetPlayer(c,null),o.error=E),!t.assetList.some(x=>!x.error))t.error=E;else for(let x=a;x<t.assetList.length;x++)this.resetAssetPlayer(t.assetList[x].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):y&&y.identifier===c?this.advanceAfterAssetEnded(t,i,a):S&&S.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,S)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;let a=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${a} playing: ${Fi(i)} error: ${e.error}`),a===-1&&(a=this.hls.startPosition);const o=this.updateItem(i,a);this.itemsMatch(i,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(a===-1){this.checkStart();return}if(!this.schedule)return;const l=this.schedule.findItemIndexAtTime(a);this.setSchedulePosition(l)}onAssetListLoaded(e,t){var i,a;const l=t.event,o=l.identifier,c=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(o)))return;const h=l.timelineStart,d=l.duration;let m=0;c.forEach((x,T)=>{const R=parseFloat(x.DURATION);this.createAsset(l,T,m,h+m,R,x.URI),m+=R}),l.duration=m,this.log(`Loaded asset-list with duration: ${m} (was: ${d}) ${l}`);const g=this.waitingItem,y=g?.event.identifier===o;this.updateSchedule();const S=(a=this.bufferingItem)==null?void 0:a.event;if(y){var E;const x=this.schedule.findEventIndex(o),T=(E=this.schedule.items)==null?void 0:E[x];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==x){l.error=new Error(`Interstitial ${c.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${l}`),this.log(l.error.message),this.updateSchedule(!0),this.primaryFallback(l);return}this.setBufferingItem(T)}this.setSchedulePosition(x)}else if(S?.identifier===o){const x=l.assetList[0];if(x){const T=this.getAssetPlayer(x.identifier);if(S.appendInPlace){const R=this.primaryMedia;T&&R&&this.bufferAssetPlayer(T,R)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case z.ASSET_LIST_PARSING_ERROR:case z.ASSET_LIST_LOAD_ERROR:case z.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case z.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const qv=500;class N2 extends jh{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",ge.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ie.IDLE,this.setInterval(qv),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:a}=t;if(this.fragContextChanged(i)||(pt(i)&&(this.fragPrevious=i),this.state=ie.IDLE),!a)return;const l=this.tracksBuffered[this.currentTrackId];if(!l)return;let o;const c=i.start;for(let d=0;d<l.length;d++)if(c>=l[d].start&&c<=l[d].end){o=l[d];break}const h=i.start+i.duration;o?o.end=h:(o={start:c,end:h},l.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:a}=t;if(i===0&&a!==Number.POSITIVE_INFINITY){const l=a-1;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(o=>{for(let c=0;c<o.length;){if(o[c].end<=l){o.shift();continue}else if(o[c].start<l)o[c].start=l;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,l,ge.SUBTITLE)}}onError(e,t){const i=t.frag;i?.type===ge.SUBTITLE&&(t.details===z.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ie.STOPPED&&(this.state=ie.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&mT(this.levels,t)){this.levels=t.map(i=>new tl(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const a=new tl(i);return this.tracksBuffered[a.id]=[],a}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ge.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.state!==ie.STOPPED&&this.setInterval(qv)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:a,levels:l}=this,{details:o,id:c}=t;if(!l){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const h=l[c];if(c>=l.length||!h)return;this.log(`Subtitle track ${c} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(o.live||(i=h.details)!=null&&i.live){if(o.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const y=g.fragments[0];if(!h.details)o.hasProgramDateTime&&g.hasProgramDateTime?(Tu(o,g),d=o.fragmentStart):y&&(d=y.start,oh(o,d));else{var m;d=this.alignPlaylists(o,h.details,(m=this.levelLastLoaded)==null?void 0:m.details),d===0&&y&&(d=y.start,oh(o,d))}g&&!this.startFragRequested&&this.setStartPosition(g,d)}h.details=o,this.levelLastLoaded=h,c===a&&(this.hls.trigger(A.SUBTITLE_TRACK_UPDATED,{details:o,id:c,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===ie.IDLE&&(Vs(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,a=t.decryptdata,l=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&a!=null&&a.key&&a.iv&&Br(a.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),a.key.buffer,a.iv.buffer,$h(a.method)).catch(c=>{throw l.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const h=performance.now();l.trigger(A.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:o,tdecrypt:h}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=ie.IDLE})}}doTick(){if(!this.media){this.state=ie.IDLE;return}if(this.state===ie.IDLE){const{currentTrackId:e,levels:t}=this,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:a}=this,l=this.getLoadPosition(),o=Ae.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,a.maxBufferHole),{end:c,len:h}=o,d=i.details,m=this.hls.maxBufferLength+d.levelTargetDuration;if(h>m)return;const g=d.fragments,y=g.length,S=d.edge;let E=null;const x=this.fragPrevious;if(c<S){const L=a.maxFragLookUpTolerance,_=c>S-L?0:L;E=Vs(x,g,Math.max(g[0].start,c),_),!E&&x&&x.start<g[0].start&&(E=g[0])}else E=g[y-1];if(E=this.filterReplacedPrimary(E,i.details),!E)return;const T=E.sn-d.startSN,R=g[T-1];if(R&&R.cc===E.cc&&this.fragmentTracker.getState(R)===_t.NOT_LOADED&&(E=R),this.fragmentTracker.getState(E)===_t.NOT_LOADED){const L=this.mapToInitFragWhenRequired(E);L&&this.loadFragment(L,i,c)}}}loadFragment(e,t,i){pt(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new k2(this.tracksBuffered[this.currentTrackId]||[])}}class k2{constructor(e){this.buffered=void 0;const t=(i,a,l)=>{if(a=a>>>0,a>l-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${a}) is greater than the maximum bound (${l})`);return e[a][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const P2={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},CT=s=>String.fromCharCode(P2[s]||s),Bi=15,Dn=100,U2={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},F2={17:2,18:4,21:6,22:8,23:10,19:13,20:15},B2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},$2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},G2=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class j2{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;qe.log(`${this.time} [${e}] ${i}`)}}}const Fs=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class OT{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const a=t[i];e.hasOwnProperty(a)&&(this[a]=e[a])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class H2{constructor(){this.uchar=" ",this.penState=new OT}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class z2{constructor(e){this.chars=[],this.pos=0,this.currPenState=new OT,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Dn;t++)this.chars.push(new H2);this.logger=e}equals(e){for(let t=0;t<Dn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Dn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Dn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Dn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Dn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=CT(e);if(this.pos>=Dn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Dn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<Dn;i++){const a=this.chars[i].uchar;a!==" "&&(t=!1),e.push(a)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Cd{constructor(e){this.rows=[],this.currRow=Bi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Bi;t++)this.rows.push(new z2(e));this.logger=e}reset(){for(let e=0;e<Bi;e++)this.rows[e].clear();this.currRow=Bi-1}equals(e){let t=!0;for(let i=0;i<Bi;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Bi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Bi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+st(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Bi;c++)this.rows[c].clear();const l=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const c=o.rows[l].cueStartTime,h=this.logger.time;if(c!==null&&h!==null&&c<h)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(o.rows[l+d])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const l=e.indent,o=Math.max(l-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}const a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+st(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",a=-1;for(let l=0;l<Bi;l++){const o=this.rows[l].getTextString();o&&(a=l+1,e?t.push("Row "+a+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Xv{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Cd(i),this.nonDisplayedMemory=new Cd(i),this.lastOutputScreen=new Cd(i),this.currRollUpRow=this.displayedMemory.rows[Bi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Bi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,a=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=a[i]}this.logger.log(2,"MIDROW: "+st(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Qv{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=K2(),this.logger=void 0;const a=this.logger=new j2;this.channels=[null,new Xv(e,t,a),new Xv(e+1,i,a)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const a=t[i]&127,l=t[i+1]&127;let o=!1,c=null;if(a===0&&l===0)continue;this.logger.log(3,()=>"["+Fs([t[i],t[i+1]])+"] -> ("+Fs([a,l])+")");const h=this.cmdHistory;if(a>=16&&a<=31){if(V2(a,l,h)){Vo(null,null,h),this.logger.log(3,()=>"Repeated command ("+Fs([a,l])+") is dropped");continue}Vo(a,l,this.cmdHistory),o=this.parseCmd(a,l),o||(o=this.parseMidrow(a,l)),o||(o=this.parsePAC(a,l)),o||(o=this.parseBackgroundAttributes(a,l))}else Vo(null,null,h);if(!o&&(c=this.parseChars(a,l),c)){const m=this.currentChannel;m&&m>0?this.channels[m].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Fs([a,l])+" orig: "+Fs([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,a=(e===23||e===31)&&t>=33&&t<=35;if(!(i||a))return!1;const l=e===20||e===21||e===23?1:2,o=this.channels[l];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=l,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const a=this.channels[i];return a?(a.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Fs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const a=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,l=(e===16||e===24)&&t>=64&&t<=95;if(!(a||l))return!1;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?U2[e]:B2[e]:i=o===1?F2[e]:$2[e];const c=this.channels[o];return c?(c.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const a={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,a.underline=(i&1)===1,i<=13?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(a.italics=!0,a.color="white"):a.indent=Math.floor((i-16)/2)*4,a}parseChars(e,t){let i,a=null,l=null;if(e>=25?(i=2,l=e-8):(i=1,l=e),l>=17&&l<=19){let o;l===17?o=t+80:l===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+CT(o)+"' in channel "+i),a=[o]}else e>=32&&e<=127&&(a=t===0?[e]:[e,t]);return a&&this.logger.log(3,()=>"Char codes =  "+Fs(a).join(",")),a}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,a=(e===23||e===31)&&t>=45&&t<=47;if(!(i||a))return!1;let l;const o={};e===16||e===24?(l=Math.floor((t-32)/2),o.background=G2[l],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Vo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Vo(s,e,t){t.a=s,t.b=e}function V2(s,e,t){return t.a===s&&t.b===e}function K2(){return{a:null,b:null}}var em=(function(){if(Su!=null&&Su.VTTCue)return self.VTTCue;const s=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,h){if(typeof h!="string"||!Array.isArray(c))return!1;const d=h.toLowerCase();return~c.indexOf(d)?d:!1}function i(c){return t(s,c)}function a(c){return t(e,c)}function l(c,...h){let d=1;for(;d<arguments.length;d++){const m=arguments[d];for(const g in m)c[g]=m[g]}return c}function o(c,h,d){const m=this,g={enumerable:!0};m.hasBeenReset=!1;let y="",S=!1,E=c,x=h,T=d,R=null,L="",_=!0,O="auto",M="start",G=50,w="middle",$=50,U="middle";Object.defineProperty(m,"id",l({},g,{get:function(){return y},set:function(P){y=""+P}})),Object.defineProperty(m,"pauseOnExit",l({},g,{get:function(){return S},set:function(P){S=!!P}})),Object.defineProperty(m,"startTime",l({},g,{get:function(){return E},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");E=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",l({},g,{get:function(){return x},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");x=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",l({},g,{get:function(){return T},set:function(P){T=""+P,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",l({},g,{get:function(){return R},set:function(P){R=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",l({},g,{get:function(){return L},set:function(P){const q=i(P);if(q===!1)throw new SyntaxError("An invalid or illegal string was specified.");L=q,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",l({},g,{get:function(){return _},set:function(P){_=!!P,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",l({},g,{get:function(){return O},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");O=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",l({},g,{get:function(){return M},set:function(P){const q=a(P);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");M=q,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",l({},g,{get:function(){return G},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");G=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",l({},g,{get:function(){return w},set:function(P){const q=a(P);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");w=q,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",l({},g,{get:function(){return $},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");$=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",l({},g,{get:function(){return U},set:function(P){const q=a(P);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");U=q,this.hasBeenReset=!0}})),m.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class Y2{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function wT(s){function e(i,a,l,o){return(i|0)*3600+(a|0)*60+(l|0)+parseFloat(o||0)}const t=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class q2{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let a=0;a<i.length;++a)if(t===i[a]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function MT(s,e,t,i){const a=i?s.split(i):[s];for(const l in a){if(typeof a[l]!="string")continue;const o=a[l].split(t);if(o.length!==2)continue;const c=o[0],h=o[1];e(c,h)}}const ph=new em(0,0,""),Ko=ph.align==="middle"?"middle":"center";function X2(s,e,t){const i=s;function a(){const c=wT(s);if(c===null)throw new Error("Malformed timestamp: "+i);return s=s.replace(/^[^\sa-zA-Z-]+/,""),c}function l(c,h){const d=new q2;MT(c,function(y,S){let E;switch(y){case"region":for(let x=t.length-1;x>=0;x--)if(t[x].id===S){d.set(y,t[x].region);break}break;case"vertical":d.alt(y,S,["rl","lr"]);break;case"line":E=S.split(","),d.integer(y,E[0]),d.percent(y,E[0])&&d.set("snapToLines",!1),d.alt(y,E[0],["auto"]),E.length===2&&d.alt("lineAlign",E[1],["start",Ko,"end"]);break;case"position":E=S.split(","),d.percent(y,E[0]),E.length===2&&d.alt("positionAlign",E[1],["start",Ko,"end","line-left","line-right","auto"]);break;case"size":d.percent(y,S);break;case"align":d.alt(y,S,["start",Ko,"end","left","right"]);break}},/:/,/\s/),h.region=d.get("region",null),h.vertical=d.get("vertical","");let m=d.get("line","auto");m==="auto"&&ph.line===-1&&(m=-1),h.line=m,h.lineAlign=d.get("lineAlign","start"),h.snapToLines=d.get("snapToLines",!0),h.size=d.get("size",100),h.align=d.get("align",Ko);let g=d.get("position","auto");g==="auto"&&ph.position===50&&(g=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=g}function o(){s=s.replace(/^\s+/,"")}if(o(),e.startTime=a(),o(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);s=s.slice(3),o(),e.endTime=a(),o(),l(s,e)}function NT(s){return s.replace(/<br(?: \/)?>/gi,`
`)}class Q2{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Y2,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let l=t.buffer,o=0;for(l=NT(l);o<l.length&&l[o]!=="\r"&&l[o]!==`
`;)++o;const c=l.slice(0,o);return l[o]==="\r"&&++o,l[o]===`
`&&++o,t.buffer=l.slice(o),c}function a(l){MT(l,function(o,c){},/:/)}try{let l="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;l=i();const c=l.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:l=i(),t.state){case"HEADER":/:/.test(l)?a(l):l||(t.state="ID");continue;case"NOTE":l||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){t.state="NOTE";break}if(!l)continue;if(t.cue=new em(0,0,""),t.state="CUE",l.indexOf("-->")===-1){t.cue.id=l;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{X2(l,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=l.indexOf("-->")!==-1;if(!l||c&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=l}continue;case"BADCUE":l||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const W2=/\r\n|\n\r|\n|\r/g,Od=function(e,t,i=0){return e.slice(i,i+t.length)===t},Z2=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),a=parseInt(e.slice(-9,-7)),l=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!me(t)||!me(i)||!me(a)||!me(l))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*a,t+=3600*1e3*l,t};function tm(s,e,t){return Wa(s.toString())+Wa(e.toString())+Wa(t)}const J2=function(e,t,i){let a=e[t],l=e[a.prevCC];if(!l||!l.new&&a.new){e.ccOffset=e.presentationOffset=a.start,a.new=!1;return}for(;(o=l)!=null&&o.new;){var o;e.ccOffset+=a.start-l.start,a.new=!1,a=l,l=e[a.prevCC]}e.presentationOffset=i};function eO(s,e,t,i,a,l,o){const c=new Q2,h=Si(new Uint8Array(s)).trim().replace(W2,`
`).split(`
`),d=[],m=e?aC(e.baseTime,e.timescale):0;let g="00:00.000",y=0,S=0,E,x=!0;c.oncue=function(T){const R=t[i];let L=t.ccOffset;const _=(y-m)/9e4;if(R!=null&&R.new&&(S!==void 0?L=t.ccOffset=R.start:J2(t,i,_)),_){if(!e){E=new Error("Missing initPTS for VTT MPEGTS");return}L=_-t.presentationOffset}const O=T.endTime-T.startTime,M=yi((T.startTime+L-S)*9e4,a*9e4)/9e4;T.startTime=Math.max(M,0),T.endTime=Math.max(M+O,0);const G=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(G)),T.id||(T.id=tm(T.startTime,T.endTime,G)),T.endTime>0&&d.push(T)},c.onparsingerror=function(T){E=T},c.onflush=function(){if(E){o(E);return}l(d)},h.forEach(T=>{if(x)if(Od(T,"X-TIMESTAMP-MAP=")){x=!1,T.slice(16).split(",").forEach(R=>{Od(R,"LOCAL:")?g=R.slice(6):Od(R,"MPEGTS:")&&(y=parseInt(R.slice(7)))});try{S=Z2(g)/1e3}catch(R){E=R}return}else T===""&&(x=!1);c.parse(T+`
`)}),c.flush()}const wd="stpp.ttml.im1t",kT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,PT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,tO={left:"start",center:"center",right:"end",start:"start",end:"end"};function Wv(s,e,t,i){const a=Ce(new Uint8Array(s),["mdat"]);if(a.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const l=a.map(c=>Si(c)),o=rC(e.baseTime,1,e.timescale);try{l.forEach(c=>t(iO(c,o)))}catch(c){i(c)}}function iO(s,e){const a=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("tt")[0];if(!a)throw new Error("Invalid ttml");const l={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(l).reduce((g,y)=>(g[y]=a.getAttribute(`ttp:${y}`)||l[y],g),{}),c=a.getAttribute("xml:space")!=="preserve",h=Zv(Md(a,"styling","style")),d=Zv(Md(a,"layout","region")),m=Md(a,"body","[begin]");return[].map.call(m,g=>{const y=UT(g,c);if(!y||!g.hasAttribute("begin"))return null;const S=kd(g.getAttribute("begin"),o),E=kd(g.getAttribute("dur"),o);let x=kd(g.getAttribute("end"),o);if(S===null)throw Jv(g);if(x===null){if(E===null)throw Jv(g);x=S+E}const T=new em(S-e,x-e,y);T.id=tm(T.startTime,T.endTime,T.text);const R=d[g.getAttribute("region")],L=h[g.getAttribute("style")],_=nO(R,L,h),{textAlign:O}=_;if(O){const M=tO[O];M&&(T.lineAlign=M),T.align=O}return Je(T,_),T}).filter(g=>g!==null)}function Md(s,e,t){const i=s.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function Zv(s){return s.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function UT(s,e){return[].slice.call(s.childNodes).reduce((t,i,a)=>{var l;return i.nodeName==="br"&&a?t+`
`:(l=i.childNodes)!=null&&l.length?UT(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function nO(s,e,t){const i="http://www.w3.org/ns/ttml#styling";let a=null;const l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=s!=null&&s.hasAttribute("style")?s.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(a=t[o]),l.reduce((c,h)=>{const d=Nd(e,i,h)||Nd(s,i,h)||Nd(a,i,h);return d&&(c[h]=d),c},{})}function Nd(s,e,t){return s&&s.hasAttributeNS(e,t)?s.getAttributeNS(e,t):null}function Jv(s){return new Error(`Could not parse ttml timestamp ${s}`)}function kd(s,e){if(!s)return null;let t=wT(s);return t===null&&(kT.test(s)?t=sO(s,e):PT.test(s)&&(t=rO(s,e))),t}function sO(s,e){const t=kT.exec(s),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function rO(s,e){const t=PT.exec(s),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class Yo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class aO{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tE(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Yo(this,"textTrack1"),t=new Yo(this,"textTrack2"),i=new Yo(this,"textTrack3"),a=new Yo(this,"textTrack4");this.cea608Parser1=new Qv(1,e,t),this.cea608Parser2=new Qv(3,i,a)}addCues(e,t,i,a,l){let o=!1;for(let c=l.length;c--;){const h=l[c],d=lO(h[0],h[1],t,i);if(d>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],i),o=!0,d/(i-t)>.5))return}if(o||l.push([t,i]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,i,a)}else{const c=this.Cues.newCue(null,t,i,a);this.hls.trigger(A.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:a,timescale:l,trackId:o}){const{unparsedVttFrags:c}=this;i===ge.MAIN&&(this.initPTS[t.cc]={baseTime:a,timescale:l,trackId:o}),c.length&&(this.unparsedVttFrags=[],c.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(A.FRAG_LOADED,h):this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let a=0;a<i.textTracks.length;a++){const l=i.textTracks[a];if(eE(l,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return l}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:a}=this,{label:l,languageCode:o}=t[e],c=this.getExistingTrack(l,o);if(c)i[e]=c,Pr(i[e]),_T(i[e],a);else{const h=this.createTextTrack("captions",l,o);h&&(h[e]=!0,i[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,a={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=a,this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[a]})}createTextTrack(e,t,i){const a=this.media;if(a)return a.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:a}=this;Object.keys(a).forEach(l=>{Pr(a[l]),delete a[l]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tE(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)Pr(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],a=i.some(l=>l.textCodec===wd);if(this.config.enableWebVTT||a&&this.config.enableIMSC1){if(mT(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,c=o?lu(o.textTracks):null;if(this.tracks.forEach((h,d)=>{let m;if(c){let g=null;for(let y=0;y<c.length;y++)if(c[y]&&eE(c[y],h)){g=c[y],c[y]=null;break}g&&(m=g)}if(m)Pr(m);else{const g=FT(h);m=this.createTextTrack(g,h.name,h.lang),m&&(m.mode="disabled")}m&&this.textTracks.push(m)}),c!=null&&c.length){const h=c.filter(d=>d!==null).map(d=>d.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const a=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!a)return;const l=`textTrack${a[1]}`,o=this.captionsProperties[l];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ge.MAIN){var i,a;const{cea608Parser1:l,cea608Parser2:o,lastSn:c}=this,{cc:h,sn:d}=t.frag,m=(i=(a=t.part)==null?void 0:a.index)!=null?i:-1;l&&o&&(d!==c+1||d===c&&m!==this.lastPartIndex+1||h!==this.lastCc)&&(l.reset(),o.reset()),this.lastCc=h,this.lastSn=d,this.lastPartIndex=m}}onFragLoaded(e,t){const{frag:i,payload:a}=t;if(i.type===ge.SUBTITLE)if(a.byteLength){const l=i.decryptdata,o="stats"in t;if(l==null||!l.encrypted||o){const c=this.tracks[i.level],h=this.vttCCs;h[i.cc]||(h[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),c&&c.textCodec===wd?this._parseIMSC1(i,a):this._parseVTTs(t)}}else this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;Wv(t,this.initPTS[e.cc],a=>{this._appendCues(a,e.level),i.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},a=>{i.logger.log(`Failed to parse IMSC1: ${a}`),i.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})}_parseVTTs(e){var t;const{frag:i,payload:a}=e,{initPTS:l,unparsedVttFrags:o}=this,c=l.length-1;if(!l[i.cc]&&c===-1){o.push(e);return}const h=this.hls,d=(t=i.initSegment)!=null&&t.data?wi(i.initSegment.data,new Uint8Array(a)).buffer:a;eO(d,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,m=>{this._appendCues(m,i.level),h.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},m=>{const g=m.message==="Missing initPTS for VTT MPEGTS";g?o.push(e):this._fallbackToIMSC1(i,a),h.logger.log(`Failed to parse VTT cue: ${m}`),!(g&&c>i.cc)&&h.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:m})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||Wv(t,this.initPTS[e.cc],()=>{i.textCodec=wd,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const a=this.textTracks[t];if(!a||a.mode==="disabled")return;e.forEach(l=>DT(a,l))}else{const a=this.tracks[t];if(!a)return;const l=a.default?"default":"subtitles"+t;i.trigger(A.CUES_PARSED,{type:"subtitles",cues:e,track:l})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===ge.SUBTITLE&&this.onFragLoaded(A.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:a}=t;if(!(i.type===ge.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let l=0;l<a.length;l++){const o=a[l].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(o);this.cea608Parser1.addData(a[l].pts,c[0]),this.cea608Parser2.addData(a[l].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:a,type:l}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!l||l==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(h=>gh(c[h],t,i))}if(this.config.renderTextTracksNatively&&t===0&&a!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(h=>gh(c[h],t,a))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let a=2;for(let l=0;l<i;l++){const o=e[a++],c=127&e[a++],h=127&e[a++];if(c===0&&h===0)continue;if((4&o)!==0){const m=3&o;(m===0||m===1)&&(t[m].push(c),t[m].push(h))}}return t}}function FT(s){return s.characteristics&&/transcribes-spoken-dialog/gi.test(s.characteristics)&&/describes-music-and-sound/gi.test(s.characteristics)?"captions":"subtitles"}function eE(s,e){return!!s&&s.kind===FT(e)&&fh(e,s)}function lO(s,e,t,i){return Math.min(e,i)-Math.max(s,t)}function tE(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const oO=/\s/,uO={newCue(s,e,t,i){const a=[];let l,o,c,h,d;const m=self.VTTCue||self.TextTrackCue;for(let y=0;y<i.rows.length;y++)if(l=i.rows[y],c=!0,h=0,d="",!l.isEmpty()){var g;for(let x=0;x<l.chars.length;x++)oO.test(l.chars[x].uchar)&&c?h++:(d+=l.chars[x].uchar,c=!1);l.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const S=NT(d.trim()),E=tm(e,t,S);s!=null&&(g=s.cues)!=null&&g.getCueById(E)||(o=new m(e,t,S),o.id=E,o.line=y+1,o.align="left",o.position=10+Math.min(80,Math.floor(h*8/32)*10),a.push(o))}return s&&a.length&&(a.sort((y,S)=>y.line==="auto"||S.line==="auto"?0:y.line>8&&S.line>8?S.line-y.line:y.line-S.line),a.forEach(y=>DT(s,y))),a}};function cO(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const fO=/(\d+)-(\d+)\/(\d+)/;class iE{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||gO,this.controller=new self.AbortController,this.stats=new Mh}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();const l=dO(e,this.controller.signal),o=e.responseType==="arraybuffer",c=o?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,l),self.clearTimeout(this.requestTimeout),t.timeout=h&&me(h)?h:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(a,e,this.response))},t.timeout),(sl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var y;this.response=this.loader=g;const S=Math.max(self.performance.now(),a.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(a,e,this.response))},d-(S-a.loading.start)),!g.ok){const{status:x,statusText:T}=g;throw new pO(T||"fetch, bad network response",x,g)}a.loading.first=S,a.total=mO(g.headers)||a.total;const E=(y=this.callbacks)==null?void 0:y.onProgress;return E&&me(t.highWaterMark)?this.loadProgressively(g,a,e,t.highWaterMark,E):o?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var y,S;const E=this.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);const x=g[c];x&&(a.loaded=a.total=x);const T={url:E.url,data:g,code:E.status},R=(y=this.callbacks)==null?void 0:y.onProgress;R&&!me(t.highWaterMark)&&R(a,e,g,E),(S=this.callbacks)==null||S.onSuccess(T,a,e,E)}).catch(g=>{var y;if(self.clearTimeout(this.requestTimeout),a.aborted)return;const S=g&&g.code||0,E=g?g.message:null;(y=this.callbacks)==null||y.onError({code:S,text:E},e,g?g.details:null,a)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,a=0,l){const o=new qS,c=e.body.getReader(),h=()=>c.read().then(d=>{if(d.done)return o.dataLength&&l(t,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const m=d.value,g=m.length;return t.loaded+=g,g<a||o.dataLength?(o.push(m),o.dataLength>=a&&l(t,i,o.flush().buffer,e)):l(t,i,m.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function dO(s,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Je({},s.headers))};return s.rangeEnd&&t.headers.set("Range","bytes="+s.rangeStart+"-"+String(s.rangeEnd-1)),t}function hO(s){const e=fO.exec(s);if(e)return parseInt(e[2])-parseInt(e[1])+1}function mO(s){const e=s.get("Content-Range");if(e){const i=hO(e);if(me(i))return i}const t=s.get("Content-Length");if(t)return parseInt(t)}function gO(s,e){return new self.Request(s.url,e)}class pO extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const yO=/^age:\s*[\d.]+\s*$/im;class BT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Mh,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0,a.aborted=!1;const l=this.xhrSetup;l?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return l(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),l(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{var c;(c=this.callbacks)==null||c.onError({code:i.status,text:o.message},t,i,a)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const a=t.headers,{maxTimeToFirstByteMs:l,maxLoadTimeMs:o}=i.loadPolicy;if(a)for(const c in a)e.setRequestHeader(c,a[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=l&&me(l)?l:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const a=t.readyState,l=this.config;if(!i.aborted&&a>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),l.timeout!==l.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),l.timeout=l.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),a===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,m=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const E=m??t.response;if(E!=null){var o,c;i.loading.end=Math.max(self.performance.now(),i.loading.first);const x=t.responseType==="arraybuffer"?E.byteLength:E.length;i.loaded=i.total=x,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const T=(o=this.callbacks)==null?void 0:o.onProgress;T&&T(i,e,E,t);const R={url:t.responseURL,data:E,code:d};(c=this.callbacks)==null||c.onSuccess(R,i,e,t);return}}const g=l.loadPolicy.errorRetry,y=i.retry,S={url:e.url,data:void 0,code:d};if(vu(g,y,!1,S))this.retry(g);else{var h;qe.error(`${d} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:d,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(vu(e,t,!0))this.retry(e);else{var i;qe.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const a=this.callbacks;a&&(this.abortInternal(),a.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Uh(e,i.retry),i.retry++,qe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&yO.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const vO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},EO=Ye(Ye({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:BT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:OD,bufferController:TC,capLevelController:Wh,errorController:PD,fpsController:x2,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:US,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:vO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},SO()),{},{subtitleStreamController:N2,subtitleTrackController:R2,timelineController:aO,audioStreamController:yC,audioTrackController:vC,emeController:$r,cmcdController:v2,contentSteeringController:S2,interstitialsController:M2});function SO(){return{cueHandler:uO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function TO(s,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=yh(s),a=["manifest","level","frag"],l=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return a.forEach(o=>{const c=`${o==="level"?"playlist":o}LoadPolicy`,h=e[c]===void 0,d=[];l.forEach(m=>{const g=`${o}Loading${m}`,y=e[g];if(y!==void 0&&h){d.push(g);const S=i[c].default;switch(e[c]={default:S},m){case"TimeOut":S.maxLoadTimeMs=y,S.maxTimeToFirstByteMs=y;break;case"MaxRetry":S.errorRetry.maxNumRetry=y,S.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":S.errorRetry.retryDelayMs=y,S.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":S.errorRetry.maxRetryDelayMs=y,S.timeoutRetry.maxRetryDelayMs=y;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${c}": ${st(e[c])}`)}),Ye(Ye({},i),e)}function yh(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(yh):Object.keys(s).reduce((e,t)=>(e[t]=yh(s[t]),e),{}):s}function xO(s,e){const t=s.loader;t!==iE&&t!==BT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):cO()&&(s.loader=iE,s.progressive=!0,s.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ou=2,bO=.1,AO=.05,RO=100;class LO extends wS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(RO),this.mediaSource=t.mediaSource;const i=this.media=t.media;zt(i,"playing",this.onMediaPlaying),zt(i,"waiting",this.onMediaWaiting),zt(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(ii(i,"playing",this.onMediaPlaying),ii(i,"waiting",this.onMediaWaiting),ii(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,a;const l=(i=this.hls)==null?void 0:i.config;if(!l)return;const o=this.media;if(!o)return;const{seeking:c}=o,h=this.seeking&&!c,d=!this.seeking&&c,m=o.paused&&!c||o.ended||o.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!m&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||h){h&&this.stallResolved(e);return}if(m){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1}));return}if(!Ae.getBuffered(o).length){this.nudgeRetry=0;return}const g=Ae.bufferInfo(o,e,0),y=g.nextStart||0,S=this.fragmentTracker;if(c&&S&&this.hls){const G=nE(this.hls.inFlightFragments,e),w=g.len>ou,$=!y||G||y-e>ou&&!S.getPartialFragment(e);if(w||$)return;this.moved=!1}const E=(a=this.hls)==null?void 0:a.latestLevelDetails;if(!this.moved&&this.stalled!==null&&S){if(!(g.len>0)&&!y)return;const w=Math.max(y,g.start||0)-e,U=!!(E!=null&&E.live)?E.targetduration*2:ou,P=qo(e,S);if(w>0&&(w<=U||P)){o.paused||this._trySkipBufferHole(P);return}}const x=l.detectStallWithCurrentTimeMs,T=self.performance.now(),R=this.waiting;let L=this.stalled;if(L===null)if(R>0&&T-R<x)L=this.stalled=R;else{this.stalled=T;return}const _=T-L;if(!c&&(_>=x||R)&&this.hls){var O;if(((O=this.mediaSource)==null?void 0:O.readyState)==="ended"&&!(E!=null&&E.live)&&Math.abs(e-(E?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const M=Ae.bufferInfo(o,e,l.maxBufferHole);this._tryFixBufferStall(M,_,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(A.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const a=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&a&&a.length>1&&e>a.end(0)){const l=Ae.bufferedInfo(Ae.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&t>=l.start){const o=Ae.timeRangesToArray(a),c=Ae.bufferedInfo(o,t,0).bufferedIndex;if(c>-1&&c<o.length-1){const h=Ae.bufferedInfo(o,e,0).bufferedIndex,d=o[c].end,m=o[c+1].start;if((h===-1||h>c)&&m-d<1&&e-d<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${m} buffered index: ${h}`);this.warn(g.message),this.media.currentTime+=1e-6;let y=qo(e,this.fragmentTracker);y&&"fragment"in y?y=y.fragment:y||(y=void 0);const S=Ae.bufferInfo(this.media,e,0);this.hls.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:y,buffer:S.len,bufferInfo:S})}}}}}_tryFixBufferStall(e,t,i){var a,l;const{fragmentTracker:o,media:c}=this,h=(a=this.hls)==null?void 0:a.config;if(!c||!o||!h)return;const d=(l=this.hls)==null?void 0:l.latestLevelDetails,m=qo(i,o);if((m||d!=null&&d.live&&i<d.fragmentStart)&&(this._trySkipBufferHole(m)||!this.media))return;const g=e.buffered,y=this.adjacentTraversal(e,i);(g&&g.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-i<h.maxBufferHole||y))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,a=e.nextStart;if(i&&a){const l=i.getFragAtPos(t,ge.MAIN),o=i.getFragAtPos(a,ge.MAIN);if(l&&o)return o.sn-l.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:a,stalled:l}=this;if(!a&&l!==null&&i&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${st(e)})`);this.warn(o.message),t.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:l}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:a}=this,l=(t=this.hls)==null?void 0:t.config;if(!a||!i||!l)return 0;const o=a.currentTime,c=Ae.bufferInfo(a,o,0),h=o<c.start?c.start:c.nextStart;if(h&&this.hls){const m=c.len<=l.maxBufferHole,g=c.len>0&&c.len<1&&a.readyState<3,y=h-o;if(y>0&&(m||g)){if(y>l.maxBufferHole){let E=!1;if(o===0){const x=i.getAppendedFrag(0,ge.MAIN);x&&h<x.end&&(E=!0)}if(!E&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||nE(this.hls.inFlightFragments,h))return 0;let T=!1,R=e.end;for(;R<h;){const L=qo(R,i);if(L)R+=L.duration;else{T=!0;break}}if(T)return 0}}const S=Math.max(h+AO,o+bO);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${S}`),this.moved=!0,a.currentTime=S,!(e!=null&&e.gap)){const E=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${S}`),x={type:Ee.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?x.part=e:x.frag=e),this.hls.trigger(A.ERROR,x)}return S}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:a}=this,l=t?.config;if(!i||!l)return 0;const o=i.currentTime;if(this.nudgeRetry++,a<l.nudgeMaxRetry){const c=o+(a+1)*l.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${o} to ${c}`);this.warn(h.message),i.currentTime=c,t.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${o} after ${l.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function nE(s,e){const t=sE(s.main);if(t&&t.start<=e)return t;const i=sE(s.audio);return i&&i.start<=e?i:null}function sE(s){if(!s)return null;switch(s.state){case ie.IDLE:case ie.STOPPED:case ie.ENDED:case ie.ERROR:return null}return s.frag}function qo(s,e){return e.getAppendedFrag(s,ge.MAIN)||e.getPartialFragment(s)}const _O=.25;function vh(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Pd(s,e,t,i,a){let l=new s(e,t,"");try{l.value=i,a&&(l.type=a)}catch{l=new s(e,t,st(a?Ye({type:a},i):i))}return l}const Xo=(()=>{const s=vh();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class DO{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(A.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Pr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return _T(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:a}=this.hls.config;if(!i&&!a)return;const{samples:l}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=vh();if(o)for(let c=0;c<l.length;c++){const h=l[c].type;if(h===vi.emsg&&!i||!a)continue;const d=tT(l[c].data),m=l[c].pts;let g=m+l[c].duration;g>Xo&&(g=Xo),g-m<=0&&(g=m+_O);for(let S=0;S<d.length;S++){const E=d[S];if(!iT(E)){this.updateId3CueEnds(m,h);const x=Pd(o,m,g,E,h);x&&this.id3Track.addCue(x)}}}}updateId3CueEnds(e,t){var i;const a=(i=this.id3Track)==null?void 0:i.cues;if(a)for(let l=a.length;l--;){const o=a[l];o.type===t&&o.startTime<e&&o.endTime===Xo&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:a}){const{id3Track:l,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=o;if(l&&(c||h)){let d;a==="audio"?d=m=>m.type===vi.audioId3&&h:a==="video"?d=m=>m.type===vi.emsg&&c:d=m=>m.type===vi.audioId3&&h||m.type===vi.emsg&&c,gh(l,t,i,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:a,enableDateRangeMetadataCues:l,interstitialsController:o}=this.hls.config;if(!l)return;const c=vh();if(i&&a&&!o){const{fragmentStart:x,fragmentEnd:T}=e;let R=this.assetCue;R?(R.startTime=x,R.endTime=T):c&&(R=this.assetCue=Pd(c,x,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),R&&(R.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(R),R.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:d}=e,m=Object.keys(d);let g=this.dateRangeCuesAppended;if(h&&t){var y;if((y=h.cues)!=null&&y.length){const x=Object.keys(g).filter(T=>!m.includes(T));for(let T=x.length;T--;){var S;const R=x[T],L=(S=g[R])==null?void 0:S.cues;delete g[R],L&&Object.keys(L).forEach(_=>{const O=L[_];if(O){O.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(O)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const E=e.fragments[e.fragments.length-1];if(!(m.length===0||!me(E?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let x=0;x<m.length;x++){const T=m[x],R=d[T],L=R.startTime,_=g[T],O=_?.cues||{};let M=_?.durationKnown||!1,G=Xo;const{duration:w,endDate:$}=R;if($&&w!==null)G=L+w,M=!0;else if(R.endOnNext&&!M){const P=m.reduce((q,re)=>{if(re!==R.id){const ce=d[re];if(ce.class===R.class&&ce.startDate>R.startDate&&(!q||R.startDate<q.startDate))return ce}return q},null);P&&(G=P.startTime,M=!0)}const U=Object.keys(R.attr);for(let P=0;P<U.length;P++){const q=U[P];if(!XD(q))continue;const re=O[q];if(re)M&&!(_!=null&&_.durationKnown)?re.endTime=G:Math.abs(re.startTime-L)>.01&&(re.startTime=L,re.endTime=G);else if(c){let ce=R.attr[q];QD(q)&&(ce=dS(ce));const fe=Pd(c,L,G,{key:q,data:ce},vi.dateRange);fe&&(fe.id=T,this.id3Track.addCue(fe),O[q]=fe,o&&(q==="X-ASSET-LIST"||q==="X-ASSET-URL")&&fe.addEventListener("enter",this.onEventCueEnter))}}g[T]={cues:O,dateRange:R,durationKnown:M}}}}}class IO{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const a=this.computeLatency();if(a===null)return;this._latency=a;const{lowLatencyMode:l,maxLiveSyncPlaybackRate:o}=this.config;if(!l||o===1||!i.live)return;const c=this.targetLatency;if(c===null)return;const h=a-c,d=Math.min(this.maxLatency,c+i.targetduration);if(h<d&&h>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,o)),y=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,S=Math.min(g,Math.max(1,y));this.changeMediaPlaybackRate(t,S)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:a}=e,{liveSyncDuration:l,liveSyncDurationCount:o,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let d=c&&i||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||d===0)&&(d=l!==void 0?l:o*a);const m=a;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,m)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const a=i.edge,l=e-t-this.edgeStalled,o=a-i.totalduration,c=a-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,l),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,a;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(a=this.targetLatency)==null?void 0:a.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class CO extends Qh{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,a=[],l={},o={};let c=!1,h=!1,d=!1;t.levels.forEach(m=>{const g=m.attrs;let{audioCodec:y,videoCodec:S}=m;y&&(m.audioCodec=y=mu(y,i)||void 0),S&&(S=m.videoCodec=dD(S));const{width:E,height:x,unknownCodecs:T}=m,R=T?.length||0;if(c||(c=!!(E&&x)),h||(h=!!S),d||(d=!!y),R||y&&!this.isAudioSupported(y)||S&&!this.isVideoSupported(S)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:L,"FRAME-RATE":_,"HDCP-LEVEL":O,"PATHWAY-ID":M,RESOLUTION:G,"VIDEO-RANGE":w}=g,U=`${`${M||"."}-`}${m.bitrate}-${G}-${_}-${L}-${w}-${O}`;if(l[U])if(l[U].uri!==m.url&&!m.attrs["PATHWAY-ID"]){const P=o[U]+=1;m.attrs["PATHWAY-ID"]=new Array(P+1).join(".");const q=this.createLevel(m);l[U]=q,a.push(q)}else l[U].addGroupId("audio",g.AUDIO),l[U].addGroupId("text",g.SUBTITLES);else{const P=this.createLevel(m);l[U]=P,o[U]=1,a.push(P)}}),this.filterAndSortMediaOptions(a,t,c,h,d)}createLevel(e){const t=new tl(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const a=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(a.message),t.supportedResult=AS(a,[])}return t}isAudioSupported(e){return Ja(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ja(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,a,l){var o;let c=[],h=[],d=e;const m=((o=t.stats)==null?void 0:o.parsing)||{};if((i||a)&&l&&(d=d.filter(({videoCodec:L,videoRange:_,width:O,height:M})=>(!!L||!!(O&&M))&&xD(_))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let L="no level with compatible codecs found in manifest",_=L;t.levels.length&&(_=`one or more CODECS in variant not supported: ${st(t.levels.map(M=>M.attrs.CODECS).filter((M,G,w)=>w.indexOf(M)===G))}`,this.warn(_),L+=` (${_})`);const O=new Error(L);this.hls.trigger(A.ERROR,{type:Ee.MEDIA_ERROR,details:z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:O,reason:_})}}),m.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(L=>!L.audioCodec||this.isAudioSupported(L.audioCodec)),rE(c)),t.subtitles&&(h=t.subtitles,rE(h));const g=d.slice(0);d.sort((L,_)=>{if(L.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(L.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&L.height!==_.height)return L.height-_.height;if(L.frameRate!==_.frameRate)return L.frameRate-_.frameRate;if(L.videoRange!==_.videoRange)return gu.indexOf(L.videoRange)-gu.indexOf(_.videoRange);if(L.videoCodec!==_.videoCodec){const O=Qy(L.videoCodec),M=Qy(_.videoCodec);if(O!==M)return M-O}if(L.uri===_.uri&&L.codecSet!==_.codecSet){const O=hu(L.codecSet),M=hu(_.codecSet);if(O!==M)return M-O}return L.averageBitrate!==_.averageBitrate?L.averageBitrate-_.averageBitrate:0});let y=g[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==g.length)){for(let L=0;L<g.length;L++)if(g[L].pathwayId===d[0].pathwayId){y=g[L];break}}this._levels=d;for(let L=0;L<d.length;L++)if(d[L]===y){var S;this._firstLevel=L;const _=y.bitrate,O=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${_}`),((S=this.hls.userConfig)==null?void 0:S.abrEwmaDefaultEstimate)===void 0){const M=Math.min(_,this.hls.config.abrEwmaDefaultEstimateMax);M>O&&O===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=M)}break}const E=l&&!a,x=this.hls.config,T=!!(x.audioStreamController&&x.audioTrackController),R={levels:d,audioTracks:c,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:a,altAudio:T&&!E&&c.some(L=>!!L.url)};m.end=performance.now(),this.hls.trigger(A.MANIFEST_PARSED,R)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const m=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:m,reason:m.message}),g)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,a=this.currentLevel,l=a?a.attrs["PATHWAY-ID"]:void 0,o=t[e],c=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&a&&l===c)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${c?" with Pathway "+c:""} from level ${i}${l?" with Pathway "+l:""}`);const h={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(A.LEVEL_SWITCHING,h);const d=o.details;if(!d||d.live){const m=this.switchParams(o.uri,a?.details,d);this.loadPlaylist(m)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(a=>t.indexOf(a)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===Oe.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ge.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(l=>!!i[l]))return;const a=this._levels[t.level];a!=null&&a.loadError&&(this.log(`Resetting level error count of ${a.loadError} on frag buffered`),a.loadError=0)}}onLevelLoaded(e,t){var i;const{level:a,details:l}=t,o=t.levelInfo;if(!o){var c;this.warn(`Invalid level index ${a}`),(c=t.deliveryDirectives)!=null&&c.skip&&(l.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let h=o.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(a,t,h)}else(i=t.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),a=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],o=e.details,c=o?.age;this.log(`Loading level index ${a}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l?" Pathway "+l:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(A.LEVEL_LOADING,{url:i,level:a,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((l,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(l),l===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,l.details&&l.details.fragments.forEach(c=>c.level=-1)),!1));VS(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const a=i.length-1;this._firstLevel=Math.min(this._firstLevel,a),this._startLevel&&(this._startLevel=Math.min(this._startLevel,a)),this.hls.trigger(A.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(A.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function rE(s){const e={};s.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function $T(){return self.SourceBuffer||self.WebKitSourceBuffer}function GT(){if(!ms())return!1;const e=$T();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function OO(){if(!GT())return!1;const s=ms();return typeof s?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>s.isTypeSupported(el(e,"video")))||["mp4a.40.2","fLaC"].some(e=>s.isTypeSupported(el(e,"audio"))))}function wO(){var s;const e=$T();return typeof(e==null||(s=e.prototype)==null?void 0:s.changeType)=="function"}const MO=100;class NO extends jh{constructor(e,t,i){super(e,t,i,"stream-controller",ge.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const a=this.media,l=a?a.currentTime:null;if(l===null||!me(l)||(this.log(`Media seeked to ${l.toFixed(3)}`),!this.getBufferedFrag(l)))return;const o=this.getFwdBufferInfoAtPos(a,l,ge.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${l} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:a}=this;if(this.stopLoad(),this.setInterval(MO),this.level=-1,!this.startFragRequested){let l=a.startLevel;l===-1&&(a.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=a.firstAutoLevel),a.nextLoadLevel=l,this.level=a.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ie.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ie.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ie.WAITING_LEVEL:{const{levels:e,level:t}=this,i=e?.[t],a=i?.details;if(a&&(!a.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(a))break;this.state=ie.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ie.IDLE;break}break}case ie.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ie.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:a}=this;if(t===null||!a&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const l=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[l]))return;const o=i[l],c=this.getMainFwdBufferInfo();if(c===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const x={};this.altAudio===2&&(x.type="video"),this.hls.trigger(A.BUFFER_EOS,x),this.state=ie.ENDED;return}if(!this.buffering)return;e.loadLevel!==l&&e.manualLevel===-1&&this.log(`Adapting to level ${l} from level ${this.level}`),this.level=e.nextLoadLevel=l;const d=o.details;if(!d||this.state===ie.WAITING_LEVEL||this.waitForLive(o)){this.level=l,this.state=ie.WAITING_LEVEL,this.startFragRequested=!1;return}const m=c.len,g=this.getMaxBufferLength(o.maxBitrate);if(m>=g)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:c.end;let S=this.getNextFragment(y,d);if(this.couldBacktrack&&!this.fragPrevious&&S&&pt(S)&&this.fragmentTracker.getState(S)!==_t.OK){var E;const T=((E=this.backtrackFragment)!=null?E:S).sn-d.startSN,R=d.fragments[T-1];R&&S.cc===R.cc&&(S=R,this.fragmentTracker.removeFragment(R))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(S&&this.isLoopLoading(S,y)){if(!S.gap){const T=this.audioOnly&&!this.altAudio?nt.AUDIO:nt.VIDEO,R=(T===nt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,T,ge.MAIN)}S=this.getNextFragmentLoopLoading(S,d,c,ge.MAIN,g)}S&&(S.initSegment&&!S.initSegment.data&&!this.bitrateTest&&(S=S.initSegment),this.loadFragment(S,o,y))}loadFragment(e,t,i){const a=this.fragmentTracker.getState(e);a===_t.NOT_LOADED||a===_t.PARTIAL?pt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ge.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const a=this.getAppendedFrag(t.currentTime);a&&a.start>1&&this.flushMainBuffer(0,a.start-1);const l=this.getLevelDetails();if(l!=null&&l.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<l.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,h=e[c],d=this.fragLastKbps;d&&this.fragCurrent?i=this.fragCurrent.duration*h.maxBitrate/(1e3*d)+1:i=0}else i=0;const o=this.getBufferedFrag(t.currentTime+i);if(o){const c=this.followingBufferedFrag(o);if(c){this.abortCurrentFrag();const h=c.maxStartPTS?c.maxStartPTS:c.start,d=c.duration,m=Math.max(o.end,h+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(m,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ie.KEY_LOADING:case ie.FRAG_LOADING:case ie.FRAG_LOADING_WAITING_RETRY:case ie.PARSING:case ie.PARSED:this.state=ie.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;zt(i,"playing",this.onMediaPlaying),zt(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(ii(i,"playing",this.onMediaPlaying),ii(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(A.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,a=!1;for(let l=0;l<t.levels.length;l++){const o=t.levels[l].audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,a=a||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&a&&!wO(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ie.IDLE)return;const a=t.levelInfo;(!a.details||a.details.live&&(this.levelLastLoaded!==a||a.details.expired)||this.waitForCdnTuneIn(a.details))&&(this.state=ie.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:a,startFragRequested:l}=this,o=t.level,c=t.details,h=c.totalduration;if(!a){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${h}`);const d=t.levelInfo,m=this.fragCurrent;m&&(this.state===ie.FRAG_LOADING||this.state===ie.FRAG_LOADING_WAITING_RETRY)&&m.level!==t.level&&m.loader&&this.abortCurrentFrag();let g=0;if(c.live||(i=d.details)!=null&&i.live){var y;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;g=this.alignPlaylists(c,d.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(d.details=c,this.levelLastLoaded=d,l||this.setStartPosition(c,g),this.hls.trigger(A.LEVEL_UPDATED,{details:c,level:o}),this.state===ie.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=ie.IDLE}l&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const a=this.hls.liveSyncPosition,l=this.getLoadPosition(),o=e.fragmentStart,c=e.edge,h=l>=o-t.maxFragLookUpTolerance&&l<=c;if(a!==null&&i.duration>a&&(l<a||!h)){const m=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&i.readyState<4||l<c-m)&&(this._hasEnoughToStart||(this.nextLoadPosition=a),i.readyState))if(this.warn(`Playback: ${l.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${a.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const g=Ae.bufferInfo(i,a,0);if(!((d=g.buffered)!=null&&d.length)){i.currentTime=a;return}if(g.start<=l){i.currentTime=a;return}const{nextStart:S}=Ae.bufferedInfo(g.buffered,l,0);S&&(i.currentTime=S)}else i.currentTime=a}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:a,payload:l}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=o[i.level];if(!c){this.warn(`Level ${i.level} not found on progress`);return}const h=c.details;if(!h){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const d=c.videoCodec,m=h.PTSKnown||!h.live,g=(t=i.initSegment)==null?void 0:t.data,y=this._getAudioCodec(c),S=this.transmuxer=this.transmuxer||new hT(this.hls,ge.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=a?a.index:-1,x=E!==-1,T=new Bh(i.level,i.sn,i.stats.chunkCount,l.byteLength,E,x),R=this.initPTS[i.cc];S.push(l,g,y,d,i,a,h.totalduration,m,T,R)}onAudioTrackSwitching(e,t){const i=this.hls,a=this.altAudio!==0;if(pu(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(a){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(A.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(A.AUDIO_TRACK_SWITCHED,t)}),i.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(A.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=pu(t.url,this.hls);if(i){const a=this.videoBuffer;a&&this.mediaBuffer!==a&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=a)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let a,l,o=!1;for(const c in i){const h=i[c];if(h.id==="main"){if(l=c,a=h,c==="video"){const d=i[c];d&&(this.videoBuffer=d.buffer)}}else o=!0}o&&a?(this.log(`Alternate track found, use ${l}.buffered to schedule main fragment loading`),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:a}=t,l=i.type===ge.MAIN;if(l){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${a?" p: "+a.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ie.PARSED&&(this.state=ie.IDLE);return}const c=a?a.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),pt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,a)}const o=this.media;o&&(!this._hasEnoughToStart&&Ae.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=ie.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.MAIN,t);break;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ie.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===Oe.LEVEL&&(this.state=ie.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ie.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==nt.AUDIO||!this.altAudio){const i=(t===nt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,ge.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const a=this.timelineOffset;a&&i&&(i+=a);const l=this.getLevelDetails(),o=Ae.getBuffered(e),c=o.length?o.start(0):0,h=c-i,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<d||this.loadingParts&&h<2*(l?.partTarget||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),i+=h,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${c}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:a}=this,l=i?.frag;if(!l||this.fragContextChanged(l))return;t.fragmentError=0,this.state=ie.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=l.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),a.trigger(A.FRAG_LOADED,i),l.bitrateTest=!1}).catch(i=>{this.state===ie.STOPPED||this.state===ie.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:i}=this,{remuxResult:a,chunkMeta:l}=e,o=this.getCurrentContext(l);if(!o){this.resetWhenMissingContext(l);return}const{frag:c,part:h,level:d}=o,{video:m,text:g,id3:y,initSegment:S}=a,{details:E}=d,x=this.altAudio?void 0:a.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=ie.PARSING,S){const T=S.tracks;if(T){const O=c.initSegment||c;if(this.unhandledEncryptionError(S,c))return;this._bufferInitSegment(d,T,O,l),i.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:t,tracks:T})}const R=S.initPTS,L=S.timescale,_=this.initPTS[c.cc];if(me(R)&&(!_||_.baseTime!==R||_.timescale!==L)){const O=S.trackId;this.initPTS[c.cc]={baseTime:R,timescale:L,trackId:O},i.trigger(A.INIT_PTS_FOUND,{frag:c,id:t,initPTS:R,timescale:L,trackId:O})}}if(m&&E){x&&m.type==="audiovideo"&&this.logMuxedErr(c);const T=E.fragments[c.sn-1-E.startSN],R=c.sn===E.startSN,L=!T||c.cc>T.cc;if(a.independent!==!1){const{startPTS:_,endPTS:O,startDTS:M,endDTS:G}=m;if(h)h.elementaryStreams[m.type]={startPTS:_,endPTS:O,startDTS:M,endDTS:G};else if(m.firstKeyFrame&&m.independent&&l.id===1&&!L&&(this.couldBacktrack=!0),m.dropped&&m.independent){const w=this.getMainFwdBufferInfo(),$=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,U=m.firstKeyFramePTS?m.firstKeyFramePTS:_;if(!R&&$<U-this.config.maxBufferHole&&!L){this.backtrack(c);return}else L&&(c.gap=!0);c.setElementaryStreamInfo(m.type,c.start,O,c.start,G,!0)}else R&&_-(E.appliedTimelineOffset||0)>ou&&(c.gap=!0);c.setElementaryStreamInfo(m.type,_,O,M,G),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(m,c,h,l,R||L)}else if(R||L)c.gap=!0;else{this.backtrack(c);return}}if(x){const{startPTS:T,endPTS:R,startDTS:L,endDTS:_}=x;h&&(h.elementaryStreams[nt.AUDIO]={startPTS:T,endPTS:R,startDTS:L,endDTS:_}),c.setElementaryStreamInfo(nt.AUDIO,T,R,L,_),this.bufferFragmentData(x,c,h,l)}if(E&&y!=null&&y.samples.length){const T={id:t,frag:c,details:E,samples:y.samples};i.trigger(A.FRAG_PARSING_METADATA,T)}if(E&&g){const T={id:t,frag:c,details:E,samples:g.samples};i.trigger(A.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${pt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,a){if(this.state!==ie.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:l,video:o,audiovideo:c}=t;if(l){const d=e.audioCodec;let m=tu(l.codec,d);m==="mp4a"&&(m="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){m&&(m.indexOf("mp4a.40.5")!==-1?m="mp4a.40.2":m="mp4a.40.5");const y=l.metadata;y&&"channelCount"in y&&(y.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(m="mp4a.40.5")}m&&m.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(m="mp4a.40.2",this.log(`Android: force audio codec to ${m}`)),d&&d!==m&&this.log(`Swapping manifest audio codec "${d}" for "${m}"`),l.levelCodec=m,l.id=ge.MAIN,this.log(`Init audio buffer, container:${l.container}, codecs[selected/level/parsed]=[${m||""}/${d||""}/${l.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=ge.MAIN;const d=o.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${o.codec!==d?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(A.BUFFER_CODECS,t),!this.hls)return;h.forEach(d=>{const g=t[d].initSegment;g!=null&&g.byteLength&&this.hls.trigger(A.BUFFER_APPENDING,{type:d,data:g,frag:i,part:null,chunkMeta:a,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ge.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ie.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Ae.isBuffered(e,i)?t=this.getAppendedFrag(i):Ae.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const a=this.fragPlaying,l=t.level;(!a||t.sn!==a.sn||a.level!==l)&&(this.fragPlaying=t,this.hls.trigger(A.FRAG_CHANGED,{frag:t}),(!a||a.level!==l)&&this.hls.trigger(A.LEVEL_SWITCHED,{level:l}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return me(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(me(t)){const i=this.getLevelDetails(),a=this.currentFrag||(i?Vs(null,i.fragments,t):null);if(a){const l=a.programDateTime;if(l!==null){const o=l+(t-a.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class kO extends Mi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const a=this.keyIdToKeyInfo[i].loader;if(a){var t;if(e&&e!==((t=a.context)==null?void 0:t.frag.type))return;a.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=z.KEY_LOAD_ERROR,i,a,l){return new In({type:Ee.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:l,error:i,networkDetails:a})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let a=0,l=t.length;a<l;a++){const o=t[a];if(e.cc<=o.cc&&(!pt(e)||!pt(o)||e.sn<o.sn)||!i&&a==l-1)return this.emeController.selectKeySystemFormat(o).then(c=>{if(!this.emeController)return;o.setKeyFormat(c);const h=nu(c);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const a=qa(this.config);if(a.length)return this.emeController.getKeySystemAccess(a)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,a;t&&e.setKeyFormat(t);const l=e.decryptdata;if(!l){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,d))}const o=l.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const c=Ud(l);let h=this.keyIdToKeyInfo[c];if((i=h)!=null&&i.decryptdata.key)return l.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(a=h)!=null&&a.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(m=>{const{keyInfo:g}=m;return l.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${l.keyId?" keyId: "+Ft(l.keyId):""} URI: ${l.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[c]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${l.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var a;if(!e.decryptdata.keyId&&(a=t.initSegment)!=null&&a.data){const o=eD(t.initSegment.data);if(o.length){let c=o[0];c.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${Ft(c)}`),ds.setKeyIdForUri(e.decryptdata.uri,c)):(c=ds.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Ft(c)}`)),e.decryptdata.keyId=c}}if(!e.decryptdata.keyId&&!pt(t))return Promise.resolve(i);const l=this.emeController.loadKey(i);return(e.keyLoadPromise=l.then(o=>(e.mediaKeySessionContext=o,i))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,a=i.loader,l=new a(i);return t.keyLoader=e.loader=l,e.keyLoadPromise=new Promise((o,c)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=i.keyLoadPolicy.default,m={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,S,E,x)=>{const{frag:T,keyInfo:R}=E,L=Ud(R.decryptdata);if(!T.decryptdata||R!==this.keyIdToKeyInfo[L])return c(this.createKeyLoadError(T,z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),x));R.decryptdata.key=T.decryptdata.key=new Uint8Array(y.data),T.keyLoader=null,R.loader=null,o({frag:T,keyInfo:R})},onError:(y,S,E,x)=>{this.resetLoader(S),c(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),E,Ye({url:h.url,data:void 0},y)))},onTimeout:(y,S,E)=>{this.resetLoader(S),c(this.createKeyLoadError(t,z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(y,S,E)=>{this.resetLoader(S),c(this.createKeyLoadError(t,z.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};l.load(h,m,g)})}resetLoader(e){const{frag:t,keyInfo:i,url:a}=e,l=i.loader;t.keyLoader===l&&(t.keyLoader=null,i.loader=null);const o=Ud(i.decryptdata)||a;delete this.keyIdToKeyInfo[o],l&&l.destroy()}}function Ud(s){if(s.keyFormat!==Bt.FAIRPLAY){const e=s.keyId;if(e)return Ft(e)}return s.uri}function aE(s){const{type:e}=s;switch(e){case Oe.AUDIO_TRACK:return ge.AUDIO;case Oe.SUBTITLE_TRACK:return ge.SUBTITLE;default:return ge.MAIN}}function Fd(s,e){let t=s.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class PO{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,a=t.loader,l=i||a,o=new l(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Oe.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:a,pathwayId:l,url:o,deliveryDirectives:c,levelInfo:h}=t;this.load({id:i,level:a,pathwayId:l,responseType:"text",type:Oe.LEVEL,url:o,deliveryDirectives:c,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:i,groupId:a,url:l,deliveryDirectives:o,track:c}=t;this.load({id:i,groupId:a,level:null,responseType:"text",type:Oe.AUDIO_TRACK,url:l,deliveryDirectives:o,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:i,groupId:a,url:l,deliveryDirectives:o,track:c}=t;this.load({id:i,groupId:a,level:null,responseType:"text",type:Oe.SUBTITLE_TRACK,url:l,deliveryDirectives:o,levelOrTrack:c})}onLevelsUpdated(e,t){const i=this.loaders[Oe.LEVEL];if(i){const a=i.context;a&&!t.levels.some(l=>l===a.levelOrTrack)&&(i.abort(),delete this.loaders[Oe.LEVEL])}}load(e){var t;const i=this.hls.config;let a=this.getInternalLoader(e);if(a){const d=this.hls.logger,m=a.context;if(m&&m.levelOrTrack===e.levelOrTrack&&(m.url===e.url||m.deliveryDirectives&&!e.deliveryDirectives)){m.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${m.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),a.abort()}let l;if(e.type===Oe.MANIFEST?l=i.manifestLoadPolicy.default:l=Je({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),me((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===Oe.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===Oe.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===Oe.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const m=d.partTarget,g=d.targetduration;if(m&&g){const y=Math.max(m*3,g*.8)*1e3;l=Je({},l,{maxTimeToFirstByteMs:Math.min(y,l.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,l.maxTimeToFirstByteMs)})}}}const o=l.errorRetry||l.timeoutRetry||{},c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},h={onSuccess:(d,m,g,y)=>{const S=this.getInternalLoader(g);this.resetInternalLoader(g.type);const E=d.data;m.parsing.start=performance.now(),nn.isMediaPlaylist(E)||g.type!==Oe.MANIFEST?this.handleTrackOrLevelPlaylist(d,m,g,y||null,S):this.handleMasterPlaylist(d,m,g,y)},onError:(d,m,g,y)=>{this.handleNetworkError(m,g,!1,d,y)},onTimeout:(d,m,g)=>{this.handleNetworkError(m,g,!0,void 0,d)}};a.load(e,c,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,a){const l=this.hls,o=e.data,c=Fd(e,i),h=nn.parseMasterPlaylist(o,c);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,h.playlistParsingError,a,t);return}const{contentSteering:d,levels:m,sessionData:g,sessionKeys:y,startTimeOffset:S,variableList:E}=h;this.variableList=E,m.forEach(L=>{const{unknownCodecs:_}=L;if(_){const{preferManagedMediaSource:O}=this.hls.config;let{audioCodec:M,videoCodec:G}=L;for(let w=_.length;w--;){const $=_[w];Ja($,"audio",O)?(L.audioCodec=M=M?`${M},${$}`:$,Hr.audio[M.substring(0,4)]=2,_.splice(w,1)):Ja($,"video",O)&&(L.videoCodec=G=G?`${G},${$}`:$,Hr.video[G.substring(0,4)]=2,_.splice(w,1))}}});const{AUDIO:x=[],SUBTITLES:T,"CLOSED-CAPTIONS":R}=nn.parseMasterPlaylistMedia(o,c,h);x.length&&!x.some(_=>!_.url)&&m[0].audioCodec&&!m[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),x.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ot({}),bitrate:0,url:""})),l.trigger(A.MANIFEST_LOADED,{levels:m,audioTracks:x,subtitles:T,captions:R,contentSteering:d,url:c,stats:t,networkDetails:a,sessionData:g,sessionKeys:y,startTimeOffset:S,variableList:E})}handleTrackOrLevelPlaylist(e,t,i,a,l){const o=this.hls,{id:c,level:h,type:d}=i,m=Fd(e,i),g=me(h)?h:me(c)?c:0,y=aE(i),S=nn.parseLevelPlaylist(e.data,m,g,y,0,this.variableList);if(d===Oe.MANIFEST){const E={attrs:new ot({}),bitrate:0,details:S,name:"",url:m};S.requestScheduled=t.loading.start+jS(S,0),o.trigger(A.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:m,stats:t,networkDetails:a,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=S,this.handlePlaylistLoaded(S,e,t,i,a,l)}handleManifestParsingError(e,t,i,a,l){this.hls.trigger(A.ERROR,{type:Ee.NETWORK_ERROR,details:z.MANIFEST_PARSING_ERROR,fatal:t.type===Oe.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:a,stats:l})}handleNetworkError(e,t,i=!1,a,l){let o=`A network ${i?"timeout":"error"+(a?" (status "+a.code+")":"")} occurred while loading ${e.type}`;e.type===Oe.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Oe.AUDIO_TRACK||e.type===Oe.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let h=z.UNKNOWN,d=!1;const m=this.getInternalLoader(e);switch(e.type){case Oe.MANIFEST:h=i?z.MANIFEST_LOAD_TIMEOUT:z.MANIFEST_LOAD_ERROR,d=!0;break;case Oe.LEVEL:h=i?z.LEVEL_LOAD_TIMEOUT:z.LEVEL_LOAD_ERROR,d=!1;break;case Oe.AUDIO_TRACK:h=i?z.AUDIO_TRACK_LOAD_TIMEOUT:z.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case Oe.SUBTITLE_TRACK:h=i?z.SUBTITLE_TRACK_LOAD_TIMEOUT:z.SUBTITLE_LOAD_ERROR,d=!1;break}m&&this.resetInternalLoader(e.type);const g={type:Ee.NETWORK_ERROR,details:h,fatal:d,url:e.url,loader:m,context:e,error:c,networkDetails:t,stats:l};if(a){const y=t?.url||e.url;g.response=Ye({url:y,data:void 0},a)}this.hls.trigger(A.ERROR,g)}handlePlaylistLoaded(e,t,i,a,l,o){const c=this.hls,{type:h,level:d,levelOrTrack:m,id:g,groupId:y,deliveryDirectives:S}=a,E=Fd(t,a),x=aE(a);let T=typeof a.level=="number"&&x===ge.MAIN?d:void 0;const R=e.playlistParsingError;if(R){if(this.hls.logger.warn(`${R} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(A.ERROR,{type:Ee.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:E,error:R,reason:R.message,response:t,context:a,level:T,parent:x,networkDetails:l,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const L=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(A.ERROR,{type:Ee.NETWORK_ERROR,details:z.LEVEL_EMPTY_ERROR,fatal:!1,url:E,error:L,reason:L.message,response:t,context:a,level:T,parent:x,networkDetails:l,stats:i});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case Oe.MANIFEST:case Oe.LEVEL:if(T){if(!m)T=0;else if(m!==c.levels[T]){const L=c.levels.indexOf(m);L>-1&&(T=L)}}c.trigger(A.LEVEL_LOADED,{details:e,levelInfo:m||c.levels[0],level:T||0,id:g||0,stats:i,networkDetails:l,deliveryDirectives:S,withoutMultiVariant:h===Oe.MANIFEST});break;case Oe.AUDIO_TRACK:c.trigger(A.AUDIO_TRACK_LOADED,{details:e,track:m,id:g||0,groupId:y||"",stats:i,networkDetails:l,deliveryDirectives:S});break;case Oe.SUBTITLE_TRACK:c.trigger(A.SUBTITLE_TRACK_LOADED,{details:e,track:m,id:g||0,groupId:y||"",stats:i,networkDetails:l,deliveryDirectives:S});break}}}class Ei{static get version(){return il}static isMSESupported(){return GT()}static isSupported(){return OO()}static getMediaSource(){return ms()}static get Events(){return A}static get MetadataSchema(){return vi}static get ErrorTypes(){return Ee}static get ErrorDetails(){return z}static get DefaultConfig(){return Ei.defaultConfig?Ei.defaultConfig:EO}static set DefaultConfig(e){Ei.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Hh,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=j_(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=TO(Ei.DefaultConfig,e,t);this.userConfig=e,i.progressive&&xO(i,t);const{abrController:a,bufferController:l,capLevelController:o,errorController:c,fpsController:h}=i,d=new c(this),m=this.abrController=new a(this),g=new UD(this),y=i.interstitialsController,S=y?this.interstitialsController=new y(this,Ei):null,E=this.bufferController=new l(this,g),x=this.capLevelController=new o(this),T=new h(this),R=new PO(this),L=i.contentSteeringController,_=L?new L(this):null,O=this.levelController=new CO(this,_),M=new DO(this),G=new kO(this.config,this.logger),w=this.streamController=new NO(this,g,G),$=this.gapController=new LO(this,g);x.setStreamController(w),T.setStreamController(w);const U=[R,O,w];S&&U.splice(1,0,S),_&&U.splice(1,0,_),this.networkControllers=U;const P=[m,E,$,x,T,M,g];this.audioTrackController=this.createController(i.audioTrackController,U);const q=i.audioStreamController;q&&U.push(this.audioStreamController=new q(this,g,G)),this.subtitleTrackController=this.createController(i.subtitleTrackController,U);const re=i.subtitleStreamController;re&&U.push(this.subtititleStreamController=new re(this,g,G)),this.createController(i.timelineController,P),G.emeController=this.emeController=this.createController(i.emeController,P),this.cmcdController=this.createController(i.cmcdController,P),this.latencyController=this.createController(IO,P),this.coreComponents=P,U.push(d);const ce=d.onErrorOut;typeof ce=="function"&&this.on(A.ERROR,ce,d),this.on(A.MANIFEST_LOADED,R.onManifestLoaded,R)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,a){this._emitter.off(e,t,i,a)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const a=e===A.ERROR;this.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:a,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(A.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const l=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(A.ERROR,{type:Ee.OTHER_ERROR,details:z.ATTACH_MEDIA_ERROR,fatal:!0,error:l});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,a=t?e:{media:i};this._media=i,this.trigger(A.MEDIA_ATTACHING,a)}detachMedia(){this.logger.log("detachMedia"),this.trigger(A.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(A.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,a=this._url=wh.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${a}`),t&&i&&(i!==a||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(A.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ge.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ge.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ge.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=L2()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){TD(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let a=0;a<i;a++)if(e[a].maxBitrate>=t)return a;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let a;if(t===-1&&e!=null&&e.length?a=e.length-1:a=t,i)for(let l=a;l--;){const o=e[l].attrs["HDCP-LEVEL"];if(o&&o<=i)return l}return a}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=_S(t);return RS(e,i,navigator.mediaCapabilities)}}Ei.defaultConfig=void 0;const lE="/hls/test.m3u8",UO="/logo.jpg",FO=()=>{const s=W.useRef(null),[e,t]=W.useState(null);return W.useEffect(()=>{const i=s.current;if(i)if(Ei.isSupported()){const a=new Ei({debug:!1,enableWorker:!0});return a.loadSource(lE),a.attachMedia(i),a.on(Ei.Events.MANIFEST_PARSED,()=>{i.play().catch(l=>{console.log("Autoplay prevented:",l)})}),a.on(Ei.Events.ERROR,(l,o)=>{if(o.fatal)switch(o.type){case Ei.ErrorTypes.NETWORK_ERROR:console.error("Network error encountered",o),a.startLoad();break;case Ei.ErrorTypes.MEDIA_ERROR:console.error("Media error encountered",o),a.recoverMediaError();break;default:console.error("Fatal error, cannot recover",o),a.destroy(),t("Stream is currently offline.");break}}),()=>{a.destroy()}}else i.canPlayType("application/vnd.apple.mpegurl")?(i.src=lE,i.addEventListener("loadedmetadata",()=>{i.play().catch(a=>{console.log("Autoplay prevented:",a)})}),i.addEventListener("error",()=>{t("Stream is currently offline.")})):t("Your browser does not support HLS playback.")},[]),I.jsxs("div",{className:"relative",children:[I.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl transform rotate-1 opacity-20"}),I.jsx("div",{className:"relative bg-slate-900/90 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700/50 shadow-2xl",children:I.jsxs("div",{className:"aspect-video relative group",children:[e?I.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-400 bg-slate-900",children:[I.jsx("svg",{className:"w-12 h-12 mb-4 text-slate-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})}),I.jsx("p",{children:e})]}):I.jsx("video",{ref:s,className:"w-full h-full object-cover",controls:!0,muted:!0,playsInline:!0}),!e&&I.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-3 pointer-events-none select-none",children:[I.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-red-600/90 backdrop-blur-sm rounded-full w-fit shadow-lg",children:[I.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),I.jsx("span",{className:"text-white text-xs font-bold uppercase tracking-wider",children:"Live"})]}),I.jsx("img",{src:UO,alt:"Channel Logo",className:"w-15 opacity-80 ml-1"})]})]})})]})},BO=()=>I.jsxs("div",{className:"space-y-6",children:[I.jsx(FO,{}),I.jsx("div",{className:"bg-slate-900/80 border border-slate-800/50 rounded-xl p-4",children:I.jsxs("div",{className:"flex gap-3",children:[I.jsx("div",{className:"flex-shrink-0",children:I.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),I.jsxs("div",{children:[I.jsx("h3",{className:"text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600",children:"Stream Disclaimer"}),I.jsx("p",{className:"mt-1 text-md text-white/90",children:"This livestream does not include audio. There may be a latency of 60-90 seconds depending on your network connection along with an included delay."})]})]})})]}),$O=()=>{const{pastLitters:s,isLoading:e,error:t}=Oh();return I.jsx($E,{title:"Past Litters",litters:s,isLoading:e,error:t})},GO=()=>I.jsx("h1",{children:"Gallery"}),jO=()=>I.jsx("h1",{children:"Admin"}),oE=[{id:"pup-1",litter_id:"litter-2",name:"Puppy 1",color:"Fawn",gender:"Male",status:"Available",profile_picture:"img-pup-1",image_ids:["img-pup-1","img-pup-1-play"],description:"Generic description for Puppy 1. He is the biggest of the bunch, very brave, and loves to explore new toys."},{id:"pup-2",litter_id:"litter-2",name:"Puppy 2",color:"Fawn",gender:"Male",status:"Available",profile_picture:"img-pup-2",image_ids:["img-pup-2"],description:"Generic description for Puppy 2. A gentle giant who loves cuddles and playing with his siblings."},{id:"pup-3",litter_id:"litter-2",name:"Puppy 3",color:"Black",gender:"Female",status:"Reserved",profile_picture:"img-pup-3",image_ids:["img-pup-3","img-gallery-3"],description:"Generic description for Puppy 3. She is sleek, fast, and incredibly smart."}],uE="https://placehold.co/400x400/2563eb/white?text=Parent",HO=({mother:s,father:e,motherNameFallback:t,fatherNameFallback:i})=>{const a=s?s.profilePicture:uE,l=e?e.profilePicture:uE,o=s?s.name:t,c=e?e.name:i;return I.jsxs("section",{className:"w-full",children:[I.jsx("h3",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 mb-6 flex items-center gap-2",children:"The Parents"}),I.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[I.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-xl p-6 flex items-center gap-6 transition-colors shadow-sm hover:border-blue-500/30",children:[I.jsx("img",{src:l,alt:c,className:"w-24 h-24 rounded-full object-cover border-4 border-slate-600 shadow-lg"}),I.jsxs("div",{children:[I.jsx("span",{className:"text-sm font-bold text-blue-400 uppercase tracking-wider",children:"Father"}),I.jsx("h4",{className:"text-2xl font-bold text-white mt-1",children:c}),e&&I.jsx("p",{className:"text-slate-400 text-sm mt-2 line-clamp-2",children:e.description})]})]}),I.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-xl p-6 flex items-center gap-6 transition-colors shadow-sm hover:border-pink-500/30",children:[I.jsx("img",{src:a,alt:o,className:"w-24 h-24 rounded-full object-cover border-4 border-slate-600 shadow-lg"}),I.jsxs("div",{children:[I.jsx("span",{className:"text-sm font-bold text-pink-400 uppercase tracking-wider",children:"Mother"}),I.jsx("h4",{className:"text-2xl font-bold text-white mt-1",children:o}),s&&I.jsx("p",{className:"text-slate-400 text-sm mt-2 line-clamp-2",children:s.description})]})]})]})]})},zO=({images:s,litterName:e})=>I.jsxs("div",{className:"lg:col-span-2",children:[I.jsxs("div",{className:"flex items-center justify-between mb-6",children:[I.jsx("h3",{className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 flex items-center gap-2",children:"Litter Gallery"}),I.jsxs("span",{className:"text-sm font-semibold text-blue-300 bg-blue-900/30 border border-blue-500/20 px-3 py-1 rounded-full",children:[s.length," Photos"]})]}),s.length>0?I.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:s.map((t,i)=>I.jsxs("div",{className:"group relative aspect-square overflow-hidden rounded-xl bg-slate-800/50 border border-slate-700/50 hover:border-blue-500/30 transition-all duration-300 shadow-sm cursor-pointer",children:[I.jsx("img",{src:t.url,alt:t.description||`${e} gallery ${i+1}`,className:"h-full w-full object-cover transition-transform duration-700 group-hover:scale-110",loading:"lazy"}),I.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-slate-900 via-slate-900/90 to-transparent p-4 flex flex-col justify-end min-h-[40%]",children:[t.puppyName&&I.jsx("div",{className:"flex items-center gap-2 mb-1",children:I.jsx("span",{className:"text-xs font-bold text-blue-300 uppercase tracking-wide truncate",children:t.puppyName})}),I.jsx("p",{className:"text-xs font-medium text-slate-200 line-clamp-2 leading-relaxed",children:t.description||"Litter Moment"})]})]},i))}):I.jsx("div",{className:"flex flex-col items-center justify-center py-20 bg-slate-800/30 border border-slate-700/50 border-dashed rounded-2xl text-slate-500",children:I.jsx("p",{children:"No photos uploaded yet."})})]}),cE=s=>new Date(s).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric",timeZone:"UTC"}),VO=s=>{switch(s){case"Planned":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";case"Available":return"bg-green-500/20 text-green-300 border-green-500/30";case"Sold":return"bg-red-500/20 text-red-300 border-red-500/30";default:return"bg-slate-500/20 text-slate-300 border-slate-500/30"}},KO=({litter:s})=>{const e=Lu();return I.jsxs("div",{className:"relative h-[300px] sm:h-[400px] w-full overflow-hidden",children:[I.jsx("img",{src:s.profilePicture,alt:s.name,className:"w-full h-full object-cover"}),I.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/60 to-transparent"}),I.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 sm:p-8",children:[I.jsxs("button",{onClick:()=>e(-1),className:"mb-4 flex items-center text-sm text-blue-400 hover:text-blue-300 transition-colors gap-2 group cursor-pointer",children:[I.jsx(Z1,{className:"w-4 h-4 transition-transform group-hover:-translate-x-1"}),"Back to Nursery"]}),I.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[I.jsx("div",{children:I.jsx("h1",{className:"text-4xl sm:text-5xl font-extrabold text-white tracking-tight",children:s.name})}),I.jsxs("div",{className:"flex gap-8 text-sm sm:text-base border-t sm:border-t-0 border-slate-700/50 pt-4 sm:pt-0",children:[I.jsxs("div",{children:[I.jsx("p",{className:"text-slate-400 uppercase text-xs tracking-wider mb-1",children:"Status"}),I.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide border ${VO(s.status)}`,children:s.status})]}),I.jsxs("div",{children:[I.jsx("p",{className:"text-slate-400 uppercase text-xs tracking-wider mb-1",children:"Born"}),I.jsx("p",{className:"font-semibold text-white",children:cE(s.birthDate)})]}),I.jsxs("div",{children:[I.jsx("p",{className:"text-slate-400 uppercase text-xs tracking-wider mb-1",children:"Go Home"}),I.jsx("p",{className:"font-semibold text-white",children:cE(s.availableDate)})]})]})]})]})]})},YO=s=>{switch(s){case"Available":return"bg-green-500/20 text-green-300 border-green-500/30";case"Reserved":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";case"Sold":return"bg-red-500/20 text-red-300 border-red-500/30";default:return"bg-slate-500/20 text-slate-300 border-slate-500/30"}},qO=s=>s==="Male"?I.jsx("span",{className:"inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase border bg-blue-500/20 text-blue-300 border-blue-500/30",children:"Male"}):I.jsx("span",{className:"inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase border bg-pink-500/20 text-pink-300 border-pink-500/30",children:"Female"}),XO=({puppies:s})=>!s||s.length===0?null:I.jsxs("section",{className:"mt-12 border-t border-slate-700/50 pt-12",children:[I.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[I.jsx("h3",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 flex items-center gap-2",children:"Meet the Puppies"}),I.jsx("span",{className:"px-3 py-1 text-xs font-semibold rounded-full bg-blue-900/30 text-blue-300 border border-blue-500/20",children:s.length})]}),I.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(e=>I.jsxs("div",{className:"group bg-slate-800/50 rounded-xl overflow-hidden border border-slate-700/50 hover:border-blue-500/30 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/10 flex flex-col",children:[I.jsx("div",{className:"aspect-square relative overflow-hidden bg-slate-900",children:I.jsx("img",{src:e.profile_picture,alt:e.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"})}),I.jsxs("div",{className:"p-5 flex-grow flex flex-col",children:[I.jsx("h4",{className:"text-xl font-bold text-slate-100 group-hover:text-blue-400 transition-colors mb-4",children:e.name}),I.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[I.jsxs("div",{children:[I.jsx("p",{className:"text-[10px] text-slate-400 uppercase tracking-wider font-semibold mb-1",children:"Color"}),I.jsx("p",{className:"text-sm font-medium text-slate-200 truncate",children:e.color})]}),I.jsxs("div",{children:[I.jsx("p",{className:"text-[10px] text-slate-400 uppercase tracking-wider font-semibold mb-1",children:"Gender"}),I.jsx("div",{children:qO(e.gender)})]}),I.jsxs("div",{children:[I.jsx("p",{className:"text-[10px] text-slate-400 uppercase tracking-wider font-semibold mb-1",children:"Status"}),I.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase border ${YO(e.status)}`,children:e.status})]})]}),e.description&&I.jsx("div",{className:"border-t border-slate-700/50 pt-3 mt-auto",children:I.jsx("p",{className:"text-sm text-slate-300 leading-relaxed line-clamp-2",children:e.description})})]})]},e.id))})]}),QO="https://placehold.co/400x400/2563eb/white?text=Puppy",WO=()=>{const{id:s}=qA(),e=Lu(),{litters:t,isLoading:i,error:a}=Oh(),{pugs:l,isLoading:o}=BE(),c=t.find(S=>S.id===s);if(i||o)return I.jsx("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-12 border border-slate-800/50 shadow-xl flex justify-center",children:I.jsx("span",{className:"text-blue-400 font-semibold animate-pulse",children:"Loading Details..."})});if(a||!c)return I.jsxs("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl p-12 border border-slate-800/50 shadow-xl flex flex-col items-center justify-center text-center",children:[I.jsx("h2",{className:"text-2xl font-bold text-slate-200 mb-2",children:"Litter Not Found"}),I.jsx("button",{onClick:()=>e(-1),className:"px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors mt-4 cursor-pointer",children:"Go Back"})]});const h=l.find(S=>S.id===c.motherId),d=l.find(S=>S.id===c.fatherId),m=oE.filter(S=>S.litter_id===c.id).map(S=>{const E=Nn.find(x=>x.id===S.profile_picture);return{...S,profile_picture:E?`/assets/images/${E.filename}`:QO}}),g=new Map;c.images.forEach(S=>{if(S===c.profilePicture)return;const E=Nn.find(x=>S.includes(x.filename));g.set(S,{url:S,description:E?E.description:void 0,puppyName:void 0})}),oE.filter(S=>S.litter_id===c.id).forEach(S=>{S.image_ids&&S.image_ids.forEach(E=>{if(E===S.profile_picture)return;const x=Nn.find(T=>T.id===E);if(x){const T=`/assets/images/${x.filename}`;g.set(T,{url:T,description:x.description,puppyName:S.name})}})});const y=Array.from(g.values());return I.jsxs("div",{className:"mx-2 sm:mx-4 bg-slate-900/80 backdrop-blur-sm rounded-xl border border-slate-800/50 shadow-xl overflow-hidden mb-12",children:[I.jsx(KO,{litter:c}),I.jsxs("div",{className:"p-6 sm:p-8 space-y-12",children:[I.jsx(HO,{mother:h,father:d,motherNameFallback:c.motherName,fatherNameFallback:c.fatherName}),I.jsx(XO,{puppies:m}),I.jsx(zO,{images:y,litterName:c.name})]})]})};function ZO(){return I.jsx(c1,{children:I.jsxs(Wi,{element:I.jsx(fR,{}),children:[I.jsx(Wi,{path:"/",element:I.jsx(XR,{})}),I.jsx(Wi,{path:"/ouradults",element:I.jsx(ZR,{})}),I.jsx(Wi,{path:"/nursery",element:I.jsx(M_,{})}),I.jsx(Wi,{path:"/live",element:I.jsx(BO,{})}),I.jsx(Wi,{path:"/pastlitters",element:I.jsx($O,{})}),I.jsx(Wi,{path:"/gallery",element:I.jsx(GO,{})}),I.jsx(Wi,{path:"/litter/:id",element:I.jsx(WO,{})}),I.jsx(Wi,{path:"/admin",element:I.jsx(jO,{})})]})})}mA.createRoot(document.getElementById("root")).render(I.jsx(W.StrictMode,{children:I.jsx(M1,{children:I.jsx(ZO,{})})}));
